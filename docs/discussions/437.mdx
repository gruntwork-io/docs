---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<CenterLayout>
<span class="title">Knowledge Base</span>
<h1>Getting too many arguments in call to spdy.NewRoundTripperWithProxy error when i try to run my terratest go code which deploys, validates and un-deploys k8s pod to/from AWS EKS</h1>
<GitHub json={{"id":"D_kwDOF8slf84APpsV","number":437,"author":{"login":"pandu-bhojaraj-mf"},"title":"Getting too many arguments in call to spdy.NewRoundTripperWithProxy error when i try to run my terratest go code which deploys, validates and un-deploys k8s pod to/from AWS EKS","body":"\r\n**Problem :**\r\nGetting too many arguments in call to spdy.NewRoundTripperWithProxy error when i try to run my terratest go code which deploys, validates and un-deploys k8s pod to/from AWS EKS\r\n\r\n**Problem description** \r\n\r\nHi All I am getting the error as mentioned in subject when i run my terratest go code. **Actually my scripts were perfectly working fine around 3 months back** but **looks like some library change happened** in between these 3 months in **k8s side which is affecting my scripts** \r\n\r\nMost problematic part is **i am unable to find out at which line number my script is failing** \r\n\r\ngo mod init  and go go mod tidy are working fine but as soon as i run go test command getting the error as attached in the screen shot\r\n<img width=\"960\" alt=\"Issue\" src=\"https://user-images.githubusercontent.com/73541850/170688549-0f2cc749-dc70-4a33-b9b0-a2f731affa75.png\">\r\n\r\nMy code is present in drop box  , here is the link  https://www.dropbox.com/s/qre9zq8jqj9vfmf/ig_data_loader_test.go?dl=0\r\n\r\nPlease do the **needful as it is blocking me from running my automated tests** \r\n\r\nMy go version \r\n\r\n`go version go1.17.8 linux/amd64`\r\n\r\nBelow are the commands i used for deploying \r\n\r\n`go mod init <folder name under which .go script is present>`\r\n`go mod tidy -compat=1.17`\r\n`go test -v -timeout 120m`\r\n\r\n\r\n---\r\n\r\n<ins datetime=\"2022-05-27T11:12:44Z\">\r\n  <p><a href=\"https://support.gruntwork.io/hc/requests/108669\">Tracked in ticket #108669</a></p>\r\n</ins>\r\n","bodyHTML":"<p dir=\"auto\"><strong>Problem :</strong><br>\nGetting too many arguments in call to spdy.NewRoundTripperWithProxy error when i try to run my terratest go code which deploys, validates and un-deploys k8s pod to/from AWS EKS</p>\n<p dir=\"auto\"><strong>Problem description</strong></p>\n<p dir=\"auto\">Hi All I am getting the error as mentioned in subject when i run my terratest go code. <strong>Actually my scripts were perfectly working fine around 3 months back</strong> but <strong>looks like some library change happened</strong> in between these 3 months in <strong>k8s side which is affecting my scripts</strong></p>\n<p dir=\"auto\">Most problematic part is <strong>i am unable to find out at which line number my script is failing</strong></p>\n<p dir=\"auto\">go mod init  and go go mod tidy are working fine but as soon as i run go test command getting the error as attached in the screen shot<br>\n<a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/73541850/170688549-0f2cc749-dc70-4a33-b9b0-a2f731affa75.png\"><img width=\"960\" alt=\"Issue\" src=\"https://user-images.githubusercontent.com/73541850/170688549-0f2cc749-dc70-4a33-b9b0-a2f731affa75.png\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\">My code is present in drop box  , here is the link  <a href=\"https://www.dropbox.com/s/qre9zq8jqj9vfmf/ig_data_loader_test.go?dl=0\" rel=\"nofollow\">https://www.dropbox.com/s/qre9zq8jqj9vfmf/ig_data_loader_test.go?dl=0</a></p>\n<p dir=\"auto\">Please do the <strong>needful as it is blocking me from running my automated tests</strong></p>\n<p dir=\"auto\">My go version</p>\n<p dir=\"auto\"><code class=\"notranslate\">go version go1.17.8 linux/amd64</code></p>\n<p dir=\"auto\">Below are the commands i used for deploying</p>\n<p dir=\"auto\"><code class=\"notranslate\">go mod init &lt;folder name under which .go script is present&gt;</code><br>\n<code class=\"notranslate\">go mod tidy -compat=1.17</code><br>\n<code class=\"notranslate\">go test -v -timeout 120m</code></p>\n<hr>\n<ins datetime=\"2022-05-27T11:12:44Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/108669\" rel=\"nofollow\">Tracked in ticket #108669</a></p>\n</ins>","answer":{"body":"The k8s library versions need to be in sync with Terratest. You can do the following to ensure they are in sync:\r\n\r\n1. Remove your current `go.sum`\r\n2. In your `go.mod`, make sure the following 3 k8s libraries are locked to the same version as terratest: https://github.com/gruntwork-io/terratest/blob/master/go.mod#L46-L48\r\n3. Run `go mod tidy -compat=1.17`\r\n4. Resolve any compile errors in your current code.\r\n","bodyHTML":"<p dir=\"auto\">The k8s library versions need to be in sync with Terratest. You can do the following to ensure they are in sync:</p>\n<ol dir=\"auto\">\n<li>Remove your current <code class=\"notranslate\">go.sum</code></li>\n<li>In your <code class=\"notranslate\">go.mod</code>, make sure the following 3 k8s libraries are locked to the same version as terratest: <a href=\"https://github.com/gruntwork-io/terratest/blob/master/go.mod#L46-L48\">https://github.com/gruntwork-io/terratest/blob/master/go.mod#L46-L48</a></li>\n<li>Run <code class=\"notranslate\">go mod tidy -compat=1.17</code></li>\n<li>Resolve any compile errors in your current code.</li>\n</ol>"},"comments":{"edges":[{"node":{"author":{"login":"zackproser"},"body":"Hello, \r\n \r\nIt appears that your k8s.io/apimachinery library is out of date. \r\n \r\nIf you look at the docs for the function you're seeing an error on: https://pkg.go.dev/k8s.io/apimachinery/pkg/util/httpstream/spdy#NewRoundTripperWithProxy you can see that the signature of the NewRoundTripperWithProxy method matches what the error message is telling you. \r\n \r\nMeanwhile, your local version of the NewRoundTripperWithProxy method is using a different signature. \r\n \r\nThis suggests to me that your go.mod and go.sum entries for your [k8s.io/apimachinery](http://k8s.io/apimachinery) library have been updated - but your local source code has not. \r\n \r\nTo resolve this, I would grep through your local codebase to find every call to NewRoundTripperWithProxy and update those calls to match the updated signature of https://pkg.go.dev/k8s.io/apimachinery/pkg/util/httpstream/spdy#NewRoundTripperWithProxy\r\n\r\nAlso please note, this is not really a Gruntwork code issue - your question is about how to resolve a Golang dependency issue with Go libraries that Gruntwork does not produce or maintain."}},{"node":{"author":{"login":"zackproser"},"body":"Hi @pandu-bhojaraj-mf  - if the signature mismatch is happening outside of your own application code, then it's possible some of your dependencies are out of date. \r\n\r\nLooking at your go.mod entry, it appeared that some of the k8s packages being indirectly required were out of date - at v0.20.1 whereas you are trying to use `v0.24.1` of `k8s.io/apimachinery`. \r\n\r\nI was able to get your code to build by running the following commands: \r\n\r\n`go get -u k8s.io/client-go@v0.24.1`\r\n`go mod tidy` \r\n`go build`\r\n\r\nAgain, the issue you're facing here is not related in any way to Gruntwork code or applications. You are asking a generic Golang development question. \r\n\r\n"}},{"node":{"author":{"login":"pandu-bhojaraj-mf"},"body":"\r\n I have posted in stack overflow\r\n\r\nhttps://stackoverflow.com/questions/72521259/getting-too-many-arguments-in-call-to-spdy-newroundtripperwithproxy-error-when-i"}},{"node":{"author":{"login":"yorinasub17"},"body":"The k8s library versions need to be in sync with Terratest. You can do the following to ensure they are in sync:\r\n\r\n1. Remove your current `go.sum`\r\n2. In your `go.mod`, make sure the following 3 k8s libraries are locked to the same version as terratest: https://github.com/gruntwork-io/terratest/blob/master/go.mod#L46-L48\r\n3. Run `go mod tidy -compat=1.17`\r\n4. Resolve any compile errors in your current code.\r\n"}},{"node":{"author":{"login":"pandu-bhojaraj-mf"},"body":"Hi @yorinasub17  and @zackproser \r\n\r\n**Thanks a lot** for your help :) . I am able to **run** my script **successfully without any errors** by following below steps  \r\n\r\n`go mod init <test script name>`\r\n`go get -u k8s.io/apimachinery@v0.20.6`\r\n`go mod tidy -compat=1.17`\r\n`go test -v -timeout 120m | tee test_output.log`\r\n\r\nThis discussion can be marked as resolved/**closed** now"}}]}}} />

</CenterLayout>
  

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "eee31128364dcc9d18ed26ff1b75a47f"
}
##DOCS-SOURCER-END -->
