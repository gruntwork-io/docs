---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<CenterLayout>
<span class="title">Knowledge Base</span>
<h1>Template_File to templatefile migration</h1>
<GitHub json={{"id":"D_kwDOF8slf84APRpQ","number":350,"author":{"login":"matthewlittle"},"title":"Template_File to templatefile migration","body":"I'm upgrading our usage of `template_file` (deprecated) to `templatefile` and I could use a little help with the following:\r\n\r\n```data \"template_file\" \"vpn_routes\" {\r\n  count    = length(data.template_file.all_vpc_cidr_blocks.*.rendered)\r\n  template = \"${cidrhost(element(data.template_file.all_vpc_cidr_blocks.*.rendered, count.index), 0)} ${cidrnetmask(element(data.template_file.all_vpc_cidr_blocks.*.rendered, count.index))}\"\r\n}\r\n\r\ndata \"template_file\" \"all_vpc_cidr_blocks\" {\r\n  count    = length(data.terraform_remote_state.other_vpcs.*.vpc_cidr_block) + 1\r\n  template = element(concat(data.terraform_remote_state.other_vpcs.*.vpc_cidr_block, list(data.terraform_remote_state.mgmt_vpc.vpc_cidr_block)), count.index)\r\n}\r\n\r\n```\r\n\r\nThese aren't standard paths to templates, so I'm not sure how to migrate them.","bodyHTML":"<p dir=\"auto\">I'm upgrading our usage of <code class=\"notranslate\">template_file</code> (deprecated) to <code class=\"notranslate\">templatefile</code> and I could use a little help with the following:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  count    = length(data.template_file.all_vpc_cidr_blocks.*.rendered)\n  template = &quot;${cidrhost(element(data.template_file.all_vpc_cidr_blocks.*.rendered, count.index), 0)} ${cidrnetmask(element(data.template_file.all_vpc_cidr_blocks.*.rendered, count.index))}&quot;\n}\n\ndata &quot;template_file&quot; &quot;all_vpc_cidr_blocks&quot; {\n  count    = length(data.terraform_remote_state.other_vpcs.*.vpc_cidr_block) + 1\n  template = element(concat(data.terraform_remote_state.other_vpcs.*.vpc_cidr_block, list(data.terraform_remote_state.mgmt_vpc.vpc_cidr_block)), count.index)\n}\n\"><pre lang=\"data\" class=\"notranslate\"><code>  count    = length(data.template_file.all_vpc_cidr_blocks.*.rendered)\n  template = \"${cidrhost(element(data.template_file.all_vpc_cidr_blocks.*.rendered, count.index), 0)} ${cidrnetmask(element(data.template_file.all_vpc_cidr_blocks.*.rendered, count.index))}\"\n}\n\ndata \"template_file\" \"all_vpc_cidr_blocks\" {\n  count    = length(data.terraform_remote_state.other_vpcs.*.vpc_cidr_block) + 1\n  template = element(concat(data.terraform_remote_state.other_vpcs.*.vpc_cidr_block, list(data.terraform_remote_state.mgmt_vpc.vpc_cidr_block)), count.index)\n}\n\n</code></pre></div>\n<p dir=\"auto\">These aren't standard paths to templates, so I'm not sure how to migrate them.</p>","answer":{"body":"Since you are using `template_file` as a string template rather than file, the proper replacement here is actually `locals` with plain string interpolation instead of `templatefile`:\r\n\r\n```\r\nlocals {\r\n  all_vpc_cidr_blocks = concat([data.terraform_remote_state.mgmt_vpc.vpc_cidr_block], data.terraform_remote_state.other_vpcs.*.vpc_cidr_block)\r\n\r\n  all_vpc_cidr_nets = [\r\n    for vpc_cidr in local.all_vpc_cidr_blocks :\r\n    \"${cidrhost(vpc_cidr)} ${cidrnetmask(vpc_cidr)}\"\r\n  ]\r\n}\r\n```","bodyHTML":"<p dir=\"auto\">Since you are using <code class=\"notranslate\">template_file</code> as a string template rather than file, the proper replacement here is actually <code class=\"notranslate\">locals</code> with plain string interpolation instead of <code class=\"notranslate\">templatefile</code>:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"locals {\n  all_vpc_cidr_blocks = concat([data.terraform_remote_state.mgmt_vpc.vpc_cidr_block], data.terraform_remote_state.other_vpcs.*.vpc_cidr_block)\n\n  all_vpc_cidr_nets = [\n    for vpc_cidr in local.all_vpc_cidr_blocks :\n    &quot;${cidrhost(vpc_cidr)} ${cidrnetmask(vpc_cidr)}&quot;\n  ]\n}\"><pre class=\"notranslate\"><code>locals {\n  all_vpc_cidr_blocks = concat([data.terraform_remote_state.mgmt_vpc.vpc_cidr_block], data.terraform_remote_state.other_vpcs.*.vpc_cidr_block)\n\n  all_vpc_cidr_nets = [\n    for vpc_cidr in local.all_vpc_cidr_blocks :\n    \"${cidrhost(vpc_cidr)} ${cidrnetmask(vpc_cidr)}\"\n  ]\n}\n</code></pre></div>"},"comments":{"edges":[{"node":{"author":{"login":"rhoboat"},"body":"Hey @matthewlittle! Could you be more specific about where this template file is located, and more about the context behind this migration?"}},{"node":{"author":{"login":"matthewlittle"},"body":"Sure @rhoboat, happy to add more context.\r\n\r\nOur entire dev group has upgraded to new Apple hardware w/ their new chipset. As such we're unable to manage our deployments with the current version (0.11.15). I'd like to get it up to the most recent version (and continue to keep it up to date).\r\n\r\nBoth outputs from the `template_file` above are piped into the `ecs_cluster` module as \r\n\r\n```\r\n alb_security_group_ids     = [compact(concat(data.template_file.alb_public_security_group_ids.*.rendered, data.template_file.alb_internal_security_group_ids.*.rendered))]\r\n  num_alb_security_group_ids = [var.allow_requests_from_public_alb, var.allow_requests_from_internal_alb]\r\n```\r\n"}},{"node":{"author":{"login":"yorinasub17"},"body":"Since you are using `template_file` as a string template rather than file, the proper replacement here is actually `locals` with plain string interpolation instead of `templatefile`:\r\n\r\n```\r\nlocals {\r\n  all_vpc_cidr_blocks = concat([data.terraform_remote_state.mgmt_vpc.vpc_cidr_block], data.terraform_remote_state.other_vpcs.*.vpc_cidr_block)\r\n\r\n  all_vpc_cidr_nets = [\r\n    for vpc_cidr in local.all_vpc_cidr_blocks :\r\n    \"${cidrhost(vpc_cidr)} ${cidrnetmask(vpc_cidr)}\"\r\n  ]\r\n}\r\n```"}},{"node":{"author":{"login":"matthewlittle"},"body":"@yorinasub17 another question related to this: \r\n\r\n```\r\ndata \"template_file\" \"alb_public_security_group_ids\" {\r\n  count    = var.allow_requests_from_public_alb\r\n  template = element(data.terraform_remote_state.alb_public.*.alb_security_group_id, count.index)\r\n}\r\n```\r\n\r\nThe `count` variable is actually a boolean. I'm not sure how it works with `count.index`. This code was initially setup back in 2018 and hasn't been touched since. I'm assuming it was used a way of expressing conditional logic in older versions of terraform. Any insight there?"}}]}}} />

</CenterLayout>
  

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "6babbf7888178b6e4f10f93ca458673c"
}
##DOCS-SOURCER-END -->
