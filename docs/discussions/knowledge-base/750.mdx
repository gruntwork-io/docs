---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/750" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>How do I fix an OIDC thumbprint mismatch?</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AUerL","number":750,"author":{"login":"adamlundrigan"},"title":"How do I fix an OIDC thumbprint mismatch?","body":"We have configured GitHub Actions to be able to assume the deployment role in our Reference Architecture `shared` account to upload build assets (from Serverless Framework) to S3 so our Terraform modules can read them from a centralized location to deploy to application accounts. \r\n\r\nA GitHub Actions run failed today with this error:\r\n> Error: OpenIDConnect provider's HTTPS certificate doesn't match configured thumbprint\r\n\r\nSome Googling turned up this blog post from GitHub:\r\nhttps://github.blog/changelog/2023-06-27-github-actions-update-on-oidc-integration-with-aws/\r\n\r\nit seems that at some point recently they added a second certificate chain with different thumbprint to the GitHub Actions service. \r\n\r\nHow do we fix this?\r\n\r\n(this post was modified from it's original to pose it as a question with an answer in a comment so that the answer could be marked as accepted)\r\n\r\n---\r\n\r\n<ins datetime=\"2023-07-04T17:26:51Z\">\r\n  <p><a href=\"https://support.gruntwork.io/hc/requests/110320\">Tracked in ticket #110320</a></p>\r\n</ins>\r\n","bodyHTML":"<p dir=\"auto\">We have configured GitHub Actions to be able to assume the deployment role in our Reference Architecture <code class=\"notranslate\">shared</code> account to upload build assets (from Serverless Framework) to S3 so our Terraform modules can read them from a centralized location to deploy to application accounts.</p>\n<p dir=\"auto\">A GitHub Actions run failed today with this error:</p>\n<blockquote>\n<p dir=\"auto\">Error: OpenIDConnect provider's HTTPS certificate doesn't match configured thumbprint</p>\n</blockquote>\n<p dir=\"auto\">Some Googling turned up this blog post from GitHub:<br>\n<a href=\"https://github.blog/changelog/2023-06-27-github-actions-update-on-oidc-integration-with-aws/\" rel=\"nofollow\">https://github.blog/changelog/2023-06-27-github-actions-update-on-oidc-integration-with-aws/</a></p>\n<p dir=\"auto\">it seems that at some point recently they added a second certificate chain with different thumbprint to the GitHub Actions service.</p>\n<p dir=\"auto\">How do we fix this?</p>\n<p dir=\"auto\">(this post was modified from it's original to pose it as a question with an answer in a comment so that the answer could be marked as accepted)</p>\n<hr>\n<ins datetime=\"2023-07-04T17:26:51Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/110320\" rel=\"nofollow\">Tracked in ticket #110320</a></p>\n</ins>","answer":{"body":"Credit to @adamlundrigan (I extracted this from his initial post):\r\n\r\nI checked our `account-baseline-app` module for `shared` and we're not explicitly setting a list of thumbprints via `github_actions_openid_connect_provider_thumbprint_list`, which means the Terraform is falling back to extracting the certificate thumbprint from `https://token.actions.githubusercontent.com`:\r\n\r\nhttps://github.com/gruntwork-io/terraform-aws-service-catalog/blob/2b35fe7ab89482e57a5746f1b14e31974dfb8f22/modules/landingzone/account-baseline-app/main.tf#L552-L558\r\n\r\nthis presumably only extracts one of the thumbprints (the one for the certificate `https://token.actions.githubusercontent.com` used), which then causes our GitHub Actions runs to intermittently fail when the Actions server connects to GitHub using a different certificate than was previously detected. \r\n\r\nOur workaround is to hard-code the list of thumbprints:\r\n\r\n```\r\n  github_actions_openid_connect_provider_thumbprint_list = [\r\n    \"6938fd4d98bab03faadb97b34396831e3780aea1\",\r\n    \"1c58a3a8518e8759bf075b76b750d4f2df264fcd\",\r\n  ]\r\n```\r\n\r\nWe should fix the extraction to pull _both_ certificates.\r\n\r\nThanks, @adamlundrigan !","bodyHTML":"<p dir=\"auto\">Credit to <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/adamlundrigan/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/adamlundrigan\">@adamlundrigan</a> (I extracted this from his initial post):</p>\n<p dir=\"auto\">I checked our <code class=\"notranslate\">account-baseline-app</code> module for <code class=\"notranslate\">shared</code> and we're not explicitly setting a list of thumbprints via <code class=\"notranslate\">github_actions_openid_connect_provider_thumbprint_list</code>, which means the Terraform is falling back to extracting the certificate thumbprint from <code class=\"notranslate\">https://token.actions.githubusercontent.com</code>:</p>\n<p dir=\"auto\"><a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/2b35fe7ab89482e57a5746f1b14e31974dfb8f22/modules/landingzone/account-baseline-app/main.tf#L552-L558\">https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/2b35fe7ab89482e57a5746f1b14e31974dfb8f22/modules/landingzone/account-baseline-app/main.tf#L552-L558</a></p>\n<p dir=\"auto\">this presumably only extracts one of the thumbprints (the one for the certificate <code class=\"notranslate\">https://token.actions.githubusercontent.com</code> used), which then causes our GitHub Actions runs to intermittently fail when the Actions server connects to GitHub using a different certificate than was previously detected.</p>\n<p dir=\"auto\">Our workaround is to hard-code the list of thumbprints:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  github_actions_openid_connect_provider_thumbprint_list = [\n    &quot;6938fd4d98bab03faadb97b34396831e3780aea1&quot;,\n    &quot;1c58a3a8518e8759bf075b76b750d4f2df264fcd&quot;,\n  ]\"><pre class=\"notranslate\"><code class=\"notranslate\">  github_actions_openid_connect_provider_thumbprint_list = [\n    \"6938fd4d98bab03faadb97b34396831e3780aea1\",\n    \"1c58a3a8518e8759bf075b76b750d4f2df264fcd\",\n  ]\n</code></pre></div>\n<p dir=\"auto\">We should fix the extraction to pull <em>both</em> certificates.</p>\n<p dir=\"auto\">Thanks, <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/adamlundrigan/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/adamlundrigan\">@adamlundrigan</a> !</p>"}}} />

</CenterLayout>
  

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "9388718588b655786d68a1f136c16ffe"
}
##DOCS-SOURCER-END -->
