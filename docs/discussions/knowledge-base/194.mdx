---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/194" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>OpenVPN best practices in the Reference Architecture</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AOxMI","number":194,"author":{"login":"rhoboat"},"title":"OpenVPN best practices in the Reference Architecture","body":"Hi all,\r\nI am using `openvpn-admin` CLI to generate OpenVPN certificates for all the other users and I am a bit confused. Can someone clarify my questions or point me to some documentation that could help.\r\n\r\nI am using `aws-auth` with my own credentials to switch between Dev and Stage env and then use `openvpn-admin request --username <IAM-USERNAME>` to generate the OpenVPN profiles in that respective account for other users. I was wondering if that’s the right way of doing it.\r\n\r\nI have the following questions in this regards:\r\n\r\n- I see that even if I delete the user from IAM (of Security account), the VPN profile I created for that particular user using the above command is still active and they can access the AWS resources. Is there a better way of offboarding the user?\r\n- A user who has access only to Dev env can also access resources in Stage env if I create a VPN profile for them from Stage env using above command.  Is that how it’s supposed to work?\r\n- Where do I see a list of all the active profiles I created so that I can revoke unused profiles?","bodyHTML":"<p dir=\"auto\">Hi all,<br>\nI am using <code class=\"notranslate\">openvpn-admin</code> CLI to generate OpenVPN certificates for all the other users and I am a bit confused. Can someone clarify my questions or point me to some documentation that could help.</p>\n<p dir=\"auto\">I am using <code class=\"notranslate\">aws-auth</code> with my own credentials to switch between Dev and Stage env and then use <code class=\"notranslate\">openvpn-admin request --username &lt;IAM-USERNAME&gt;</code> to generate the OpenVPN profiles in that respective account for other users. I was wondering if that’s the right way of doing it.</p>\n<p dir=\"auto\">I have the following questions in this regards:</p>\n<ul dir=\"auto\">\n<li>I see that even if I delete the user from IAM (of Security account), the VPN profile I created for that particular user using the above command is still active and they can access the AWS resources. Is there a better way of offboarding the user?</li>\n<li>A user who has access only to Dev env can also access resources in Stage env if I create a VPN profile for them from Stage env using above command.  Is that how it’s supposed to work?</li>\n<li>Where do I see a list of all the active profiles I created so that I can revoke unused profiles?</li>\n</ul>","answer":{"body":"Thank you for your question, I'll answer them inline!\r\n\r\n> I see that even if I delete the user from IAM (of Security account), the VPN profile I created for that particular user using the above command is still active and they can access the AWS resources. Is there a better way of offboarding the user?\r\n\r\nOnce you have removed the IAM user, an OpenVPN Admin should run the [`revoke`](https://github.com/gruntwork-io/terraform-aws-openvpn/tree/master/modules/openvpn-admin#commandline-options) command that will add this user to the CRL (certificate revoke list).\r\n\r\n> A user who has access only to Dev env can also access resources in Stage env if I create a VPN profile for them from Stage env using above command. Is that how it’s supposed to work?\r\n\r\nThis depends on how you have set up the architecture. If there is a OpenVPN server on each environment, then the certificates are different, and therefore, access are individual per environment.\r\n\r\n> Where do I see a list of all the active profiles I created so that I can revoke unused profiles?\r\n\r\nWhen we do `revoke`, we are not removing the certificate for the user at hand, instead, we add the user to the CRL. However, we don't have a compiled list of users which are active and **not** in the CRL. Users in the CRL are meant to not be active.\r\n\r\nI hope this clarifies a bit more the questions about the OpenVPN role in the Reference Architecture!","bodyHTML":"<p dir=\"auto\">Thank you for your question, I'll answer them inline!</p>\n<blockquote>\n<p dir=\"auto\">I see that even if I delete the user from IAM (of Security account), the VPN profile I created for that particular user using the above command is still active and they can access the AWS resources. Is there a better way of offboarding the user?</p>\n</blockquote>\n<p dir=\"auto\">Once you have removed the IAM user, an OpenVPN Admin should run the <a href=\"https://github.com/gruntwork-io/terraform-aws-openvpn/tree/master/modules/openvpn-admin#commandline-options\"><code class=\"notranslate\">revoke</code></a> command that will add this user to the CRL (certificate revoke list).</p>\n<blockquote>\n<p dir=\"auto\">A user who has access only to Dev env can also access resources in Stage env if I create a VPN profile for them from Stage env using above command. Is that how it’s supposed to work?</p>\n</blockquote>\n<p dir=\"auto\">This depends on how you have set up the architecture. If there is a OpenVPN server on each environment, then the certificates are different, and therefore, access are individual per environment.</p>\n<blockquote>\n<p dir=\"auto\">Where do I see a list of all the active profiles I created so that I can revoke unused profiles?</p>\n</blockquote>\n<p dir=\"auto\">When we do <code class=\"notranslate\">revoke</code>, we are not removing the certificate for the user at hand, instead, we add the user to the CRL. However, we don't have a compiled list of users which are active and <strong>not</strong> in the CRL. Users in the CRL are meant to not be active.</p>\n<p dir=\"auto\">I hope this clarifies a bit more the questions about the OpenVPN role in the Reference Architecture!</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "0d4fcea54422a63b5b6a16caeb288f43"
}
##DOCS-SOURCER-END -->
