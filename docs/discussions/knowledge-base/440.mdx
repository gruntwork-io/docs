---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/440" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Reorganization of terraform/terragrunt code to make it more scalable</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84APrje","number":440,"author":{"login":"alvaro-ort"},"title":"Reorganization of terraform/terragrunt code to make it more scalable","body":"\nWe've created a terraform repo that deploys a Fargate based ECS with an ALB, VPM and routes. The main terraform folder contains 6 modules\r\n\r\nWe have the main file that allows us to deploy the `6 modules`. So with a simple `terraform apply` everything is deployed (around 35 resources). \r\n\r\nFurthermore, we have implemented terragrunt to keep things `DRY` between environments.\r\n\r\nThe main repo looks like this:\r\n\r\n```\r\nterraform_modules/\r\n    cloudwatch/\r\n    ecs/\r\n    iam/\r\n    lb/\r\n    route53/\r\n    vpc/\r\n    main.tf\r\n    variables.tf\r\nenvironments/\r\n    dev/\r\n         terragrunt.hcl\r\n    staging/\r\n    production/\r\n````\r\n\r\nthe `terragrunt.hcl` file looks as follows:\r\n```\r\nterraform {\r\n  source = \"../..//terraform_modules/\"\r\n}\r\n\r\ninputs = {\r\n  AWS_REGION = get_env(\"AWS_REGION\")\r\n  AWS_ACCES_KEY = get_env(\"AWS_ACCESS_KEY\")\r\n  AWS_SECRET_KEY = get_env(\"AWS_SECRET_KEY\")\r\n}\r\n```\r\n\r\nMain questions:\r\n- From the book `Terraform up& running - O'Reilly` it looks like it's not good practice to deploy everything from a single command, since I'll be dealing with more than 35 resources at once. What would be the best recommendations? \r\n     - Should I deploy resources from the modules folder and create a readme with instruction on the modules deployment order?\r\n     - If so, should I replace from `variables` in each module to `data` ?\r\n- Terragrunt organization:\r\n     - from the documentation, it looks like i should refactor as well my single terragrunt to split it into multiple terragrunts. For my given config, should I do that?\r\n\r\nThanks in advance,\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\n\n---\n\n<ins datetime=\"2022-05-31T14:56:04Z\">\n  <p><a href=\"https://support.gruntwork.io/hc/requests/108682\">Tracked in ticket #108682</a></p>\n</ins>\n","bodyHTML":"<p dir=\"auto\">We've created a terraform repo that deploys a Fargate based ECS with an ALB, VPM and routes. The main terraform folder contains 6 modules</p>\n<p dir=\"auto\">We have the main file that allows us to deploy the <code class=\"notranslate\">6 modules</code>. So with a simple <code class=\"notranslate\">terraform apply</code> everything is deployed (around 35 resources).</p>\n<p dir=\"auto\">Furthermore, we have implemented terragrunt to keep things <code class=\"notranslate\">DRY</code> between environments.</p>\n<p dir=\"auto\">The main repo looks like this:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"terraform_modules/\n    cloudwatch/\n    ecs/\n    iam/\n    lb/\n    route53/\n    vpc/\n    main.tf\n    variables.tf\nenvironments/\n    dev/\n         terragrunt.hcl\n    staging/\n    production/\"><pre class=\"notranslate\"><code class=\"notranslate\">terraform_modules/\n    cloudwatch/\n    ecs/\n    iam/\n    lb/\n    route53/\n    vpc/\n    main.tf\n    variables.tf\nenvironments/\n    dev/\n         terragrunt.hcl\n    staging/\n    production/\n</code></pre></div>\n<p dir=\"auto\">the <code class=\"notranslate\">terragrunt.hcl</code> file looks as follows:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"terraform {\n  source = &quot;../..//terraform_modules/&quot;\n}\n\ninputs = {\n  AWS_REGION = get_env(&quot;AWS_REGION&quot;)\n  AWS_ACCES_KEY = get_env(&quot;AWS_ACCESS_KEY&quot;)\n  AWS_SECRET_KEY = get_env(&quot;AWS_SECRET_KEY&quot;)\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">terraform {\n  source = \"../..//terraform_modules/\"\n}\n\ninputs = {\n  AWS_REGION = get_env(\"AWS_REGION\")\n  AWS_ACCES_KEY = get_env(\"AWS_ACCESS_KEY\")\n  AWS_SECRET_KEY = get_env(\"AWS_SECRET_KEY\")\n}\n</code></pre></div>\n<p dir=\"auto\">Main questions:</p>\n<ul dir=\"auto\">\n<li>From the book <code class=\"notranslate\">Terraform up&amp; running - O'Reilly</code> it looks like it's not good practice to deploy everything from a single command, since I'll be dealing with more than 35 resources at once. What would be the best recommendations?\n<ul dir=\"auto\">\n<li>Should I deploy resources from the modules folder and create a readme with instruction on the modules deployment order?</li>\n<li>If so, should I replace from <code class=\"notranslate\">variables</code> in each module to <code class=\"notranslate\">data</code> ?</li>\n</ul>\n</li>\n<li>Terragrunt organization:\n<ul dir=\"auto\">\n<li>from the documentation, it looks like i should refactor as well my single terragrunt to split it into multiple terragrunts. For my given config, should I do that?</li>\n</ul>\n</li>\n</ul>\n<p dir=\"auto\">Thanks in advance,</p>\n<hr>\n<ins datetime=\"2022-05-31T14:56:04Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/108682\" rel=\"nofollow\">Tracked in ticket #108682</a></p>\n</ins>","answer":{"body":"Hi, I believe this is touching on the question of how granular your infrastructure modules should be (as in, when is a module too \"big\"). If so, then I believe the answers to this knowledge base post should help: https://github.com/gruntwork-io/knowledge-base/discussions/402\r\n\r\nOnce you have figured out how you want to componentize your modules, then you can start thinking about how to handle deployment order and dependency management, in which case Terragrunt `dependency` blocks will come into play. Refer to the [terragrunt docs on working with multiple modules](https://terragrunt.gruntwork.io/docs/features/execute-terraform-commands-on-multiple-modules-at-once/) for more info on what Terragrunt offers to help with this.\r\n\r\nOne thing to be aware of though is that if you really do want to deploy and manage all your infrastructure as one unit (that is, you don't think the risks of managing all the components together are worth the cost of breaking it apart), then you should NOT transition away from your current implementation. Multi module/state management adds a lot of overhead and you lose some niceties like having access to a global plan (see [this comment](https://github.com/gruntwork-io/terragrunt/issues/720#issuecomment-497888756)). In other words, if you want to, or see a need to, manage your environments as one unit, then it is perfectly fine to keep what you have.","bodyHTML":"<p dir=\"auto\">Hi, I believe this is touching on the question of how granular your infrastructure modules should be (as in, when is a module too \"big\"). If so, then I believe the answers to this knowledge base post should help: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"4049818\" data-permission-text=\"Title is private\" data-url=\"https://github.com/gruntwork-io/knowledge-base/discussions/402\" data-hovercard-type=\"discussion\" data-hovercard-url=\"/gruntwork-io/knowledge-base/discussions/402/hovercard\" href=\"https://github.com/orgs/gruntwork-io/discussions/402\">#402</a></p>\n<p dir=\"auto\">Once you have figured out how you want to componentize your modules, then you can start thinking about how to handle deployment order and dependency management, in which case Terragrunt <code class=\"notranslate\">dependency</code> blocks will come into play. Refer to the <a href=\"https://terragrunt.gruntwork.io/docs/features/execute-terraform-commands-on-multiple-modules-at-once/\" rel=\"nofollow\">terragrunt docs on working with multiple modules</a> for more info on what Terragrunt offers to help with this.</p>\n<p dir=\"auto\">One thing to be aware of though is that if you really do want to deploy and manage all your infrastructure as one unit (that is, you don't think the risks of managing all the components together are worth the cost of breaking it apart), then you should NOT transition away from your current implementation. Multi module/state management adds a lot of overhead and you lose some niceties like having access to a global plan (see <a href=\"https://github.com/gruntwork-io/terragrunt/issues/720#issuecomment-497888756\" data-hovercard-type=\"issue\" data-hovercard-url=\"/gruntwork-io/terragrunt/issues/720/hovercard\">this comment</a>). In other words, if you want to, or see a need to, manage your environments as one unit, then it is perfectly fine to keep what you have.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "5c427073896e2cbe430c41b8e91d2b8b"
}
##DOCS-SOURCER-END -->
