---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/698" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Terragrunt repository/directory layout to implement least access privilege</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84ATh2d","number":698,"author":{"login":"blueelephants"},"title":"Terragrunt repository/directory layout to implement least access privilege","body":"\r\nI am currently working on a Terragrunt GitHub repository/directory layout setup for deploying the \"core cloud infrastructure setup\" of an corporate Azure environment, which should consists of multiple components:\r\n- networking hubs in multiple regions (for hub and spoke networking)\r\n- central logging stack in multiple regions\r\n- (and a couple of more corporate components ..)\r\n\r\nI need to have two fully isolated environments: **prd** and **dev** (changes to these environments need to be strictly isolated; state files should be on different storage accounts too, etc.)\r\n \r\nFor IT security requirements, I need to implement the **least access privilege concept**, which also needs to be applied for running automation code.\r\nThat means, instead of having one single Azure Service Principal (i.e. automation user) which is configured as superuser (so-called Owner in Azure) on the entire cloud environment, I need to have muliple ones - e.g.\r\n- network-hub-automation-prd\r\n- network-hub-automation-dev\r\n- central-logging-automation-prd\r\n- central-logging-automation-dev\r\n\r\nwhich are configured with the **minimum permissions** necessary on Azure (e.g. network-hub-automation-prd should only be able to deploy the network related resources in the configured prd subscriptions).  \r\n\r\nIn addition, people doing dev work shouldn't be able to run prd automation (unless they are also member of the prd team) - **segration of duties**.\r\n\r\nThis is all to **reduce the blast radius** if dev/prd mistakes happen and/or any credentials for automation users get leaked, etc. \r\n\r\nDeployment of these different components of the core infrastructure should then be done via individual **GitHub actions**.\r\n\r\nI did lots of research on the Internet to find out the **most suitable (mono/poly) repository and directory layout**, but I am still not sure which way to go forward.\r\n\r\nCurrently I can think of these layouts:\r\n\r\n### (A) One mono repository\r\n\r\nRepository: **live-infrastructure**\r\n```\r\n/\r\n├── .github\r\n│   ├── workflows\r\n│   │   ├── dev\r\n│   │   │   ├── north-europe\r\n│   │   │   │   ├── central-logging\r\n│   │   │   │   │   action.yaml\r\n│   │   │   │   ├── networking-hub\r\n│   │   │   │   │   action.yaml\r\n│   │   │   ├── west-europe\r\n│   │   │   │   ├── central-logging\r\n│   │   │   │   │   action.yaml\r\n│   │   │   │   ├── networking-hub\r\n│   │   │   │   │   action.yaml\r\n│   │   ├── prd\r\n│   │   │   ├── north-europe\r\n│   │   │   │   ├── central-logging\r\n│   │   │   │   │   action.yaml\r\n│   │   │   │   ├── networking─ hub\r\n│   │   │   │   │   action.yaml\r\n│   │   │   ├── west-europe\r\n│   │   │   │   ├── central-logging\r\n│   │   │   │   │   action.yaml\r\n│   │   │   │   ├── networking-hub\r\n│   │   │   │   │   action.yaml\r\n├── live\r\n│   terragrunt.hcl\r\n│   ├── dev\r\n│   │   env.hcl\r\n│   │   ├── north-europe\r\n│   │   │   region.hcl\r\n│   │   │   ├── central-logging\r\n│   │   │   │   terragrunt.hcl\r\n│   │   │   ├── networking-hub\r\n│   │   │   │   terragrunt.hcl\r\n│   │   ├── west-europe\r\n│   │   │   region.hcl\r\n│   │   │   ├── central-logging\r\n│   │   │   │   terragrunt.hcl\r\n│   │   │   ├── networking-hub\r\n│   │   │   │   terragrunt.hcl\r\n│   ├── prd\r\n│   │   env.hcl\r\n│   │   ├── north-europe\r\n│   │   │   region.hcl\r\n│   │   │   ├── central-logging\r\n│   │   │   │   terragrunt.hcl\r\n│   │   │   ├── networking-hub\r\n│   │   │   │   terragrunt.hcl\r\n│   │   ├── west-europe\r\n│   │   │   region.hcl\r\n│   │   │   ├── central-logging\r\n│   │   │   │   terragrunt.hcl\r\n│   │   │   ├── networking-hub\r\n│   │   │   │   terragrunt.hcl\r\n```\r\n- This is following the approach as laid out here: https://github.com/gruntwork-io/terragrunt-infrastructure-live-example.\r\n- Dev/Prd credentials for the automation users (service principals) could be stored as GitHub repository secrets and be reused in the different GitHub action.yaml\r\n- However, this would mean that people doing changes on dev would work in the same repository as people doing changes in prd.\r\n- This might complicate \"segration of duties\" and isololation of dev/prd work as also all dev/prd people would be able to see/use all configured GitHub dev/prd repository secrets \r\n\r\n### (B) One repository per environment (poly-repo)\r\n\r\nRepository: **live-infrastructure-dev**\r\n```\r\n/\r\n├── .github\r\n│   ├── workflows\r\n│   │   ├── dev\r\n│   │   │   ├── north-europe\r\n│   │   │   │   ├── central-logging\r\n│   │   │   │   │   action.yaml\r\n│   │   │   │   ├── networking-hub\r\n│   │   │   │   │   action.yaml\r\n│   │   │   ├── west-europe\r\n│   │   │   │   ├── central-logging\r\n│   │   │   │   │   action.yaml\r\n│   │   │   │   ├── networking-hub\r\n│   │   │   │   │   action.yaml\r\n├── live\r\n│   terragrunt.hcl\r\n│   ├── dev\r\n│   │   env.hcl\r\n│   │   ├── north-europe\r\n│   │   │   region.hcl\r\n│   │   │   ├── central-logging\r\n│   │   │   │   terragrunt.hcl\r\n│   │   │   ├── networking-hub\r\n│   │   │   │   terragrunt.hcl\r\n│   │   ├── west-europe\r\n│   │   │   region.hcl\r\n│   │   │   ├── central-logging\r\n│   │   │   │   terragrunt.hcl\r\n│   │   │   ├── networking-hub\r\n│   │   │   │   terragrunt.hcl\r\n```\r\n\r\nRepository: **live-infrastructure-prd**\r\n```\r\n/\r\n├── .github\r\n│   ├── workflows\r\n│   │   ├── prd\r\n│   │   │   ├── north-europe\r\n│   │   │   │   ├── central-logging\r\n│   │   │   │   │   action.yaml\r\n│   │   │   │   ├── networking-hub\r\n│   │   │   │   │   action.yaml\r\n│   │   │   ├── west-europe\r\n│   │   │   │   ├── central-logging\r\n│   │   │   │   │   action.yaml\r\n│   │   │   │   ├── networking-hub\r\n│   │   │   │   │   action.yaml\r\n├── live\r\n│   terragrunt.hcl\r\n│   ├── prd\r\n│   │   env.hcl\r\n│   │   ├── north-europe\r\n│   │   │   region.hcl\r\n│   │   │   ├── central-logging\r\n│   │   │   │   terragrunt.hcl\r\n│   │   │   ├── networking-hub\r\n│   │   │   │   terragrunt.hcl\r\n│   │   ├── west-europe\r\n│   │   │   region.hcl\r\n│   │   │   ├── central-logging\r\n│   │   │   │   terragrunt.hcl\r\n│   │   │   ├── networking-hub\r\n│   │   │   │   terragrunt.hcl\r\n ```    \r\n\r\n- Dev credentials for the automation users (service principals) could be stored as GitHub repository secrets in live-infrastructure-dev repository only\r\n- Prd credentials for the automation users (service principals) could be stored as GitHub repository secrets in live-infrastructure-prd repository only\r\n- This would give much better isolation between the dev/prd teams, as they have only access to one of the repositories and the configured GitHub respository secrets\r\n- However, somebody could still mistakenly configure a GitHub action to run e.g. the network-hub automation with the GitHub repository secrets for the central-logging automation\r\n\r\n\r\n### (C) One repository per component per environment (poly-repo)\r\n\r\nRepository: **live-infrastructure-central-loging-dev**\r\n```\r\n/\r\n├── .github\r\n│   ├── workflows\r\n│   │   ├── dev\r\n│   │   │   ├── north-europe\r\n│   │   │   │   ├── central-logging\r\n│   │   │   │   │   action.yaml\r\n│   │   │   ├── west-europe\r\n│   │   │   │   ├── central-logging\r\n│   │   │   │   │   action.yaml\r\n├── live\r\n│   terragrunt.hcl\r\n│   ├── dev\r\n│   │   env.hcl\r\n│   │   ├── north-europe\r\n│   │   │   region.hcl\r\n│   │   │   ├── central-logging\r\n│   │   │   │   terragrunt.hcl\r\n│   │   ├── west-europe\r\n│   │   │   region.hcl\r\n│   │   │   ├── central-logging\r\n│   │   │   │   terragrunt.hcl\r\n```\r\n\r\nRepository: **live-infrastructure-networking-hub-dev**\r\n```\r\n/\r\n├── .github\r\n│   ├── workflows\r\n│   │   ├── dev\r\n│   │   │   ├── north-europe\r\n│   │   │   │   ├── networking-hub\r\n│   │   │   │   │   action.yaml\r\n│   │   │   ├── west-europe\r\n│   │   │   │   ├── networking-hub\r\n│   │   │   │   │   action.yaml\r\n├── live\r\n│   terragrunt.hcl\r\n│   ├── dev\r\n│   │   env.hcl\r\n│   │   ├── north-europe\r\n│   │   │   region.hcl\r\n│   │   │   ├── networking-hub\r\n│   │   │   │   terragrunt.hcl\r\n│   │   ├── west-europe\r\n│   │   │   region.hcl\r\n│   │   │   ├── networking-hub\r\n│   │   │   │   terragrunt.hcl\r\n```\r\n\r\nRepository: **live-infrastructure-central-loging-prd**\r\n```\r\n/\r\n├── .github\r\n│   ├── workflows\r\n│   │   ├── prd\r\n│   │   │   ├── north-europe\r\n│   │   │   │   ├── central-logging\r\n│   │   │   │   │   action.yaml\r\n│   │   │   ├── west-europe\r\n│   │   │   │   ├── central-logging\r\n│   │   │   │   │   action.yaml\r\n├── live\r\n│   terragrunt.hcl\r\n│   ├── prd\r\n│   │   env.hcl\r\n│   │   ├── north-europe\r\n│   │   │   region.hcl\r\n│   │   │   ├── central-logging\r\n│   │   │   │   terragrunt.hcl\r\n│   │   ├── west-europe\r\n│   │   │   region.hcl\r\n│   │   │   ├── central-logging\r\n│   │   │   │   terragrunt.hcl\r\n```\r\n\r\nRepository: **live-infrastructure-networking-hub-prd**\r\n```\r\n/\r\n├── .github\r\n│   ├── workflows\r\n│   │   ├── prd\r\n│   │   │   ├── north-europe\r\n│   │   │   │   ├── networking-hub\r\n│   │   │   │   │   action.yaml\r\n│   │   │   ├── west-europe\r\n│   │   │   │   ├── networking-hub\r\n│   │   │   │   │   action.yaml\r\n├── live\r\n│   terragrunt.hcl\r\n│   ├── prd\r\n│   │   env.hcl\r\n│   │   ├── north-europe\r\n│   │   │   region.hcl\r\n│   │   │   ├── networking-hub\r\n│   │   │   │   terragrunt.hcl\r\n│   │   ├── west-europe\r\n│   │   │   region.hcl\r\n│   │   │   ├── networking-hub\r\n│   │   │   │   terragrunt.hcl\r\n```\r\n- Small repositories doing just the necessary work are handy seem to offer the best isolation\r\n- However, this all comes at the cost of (too??) many repositories, which introduce maintenance costs\r\n\r\n\r\nI would be happy if you can share your thoughts and experience with me and any good/best practices.\r\n\r\n---\r\n\r\n<ins datetime=\"2023-04-23T07:50:19Z\">\r\n  <p><a href=\"https://support.gruntwork.io/hc/requests/110107\">Tracked in ticket #110107</a></p>\r\n</ins>\r\n","bodyHTML":"<p dir=\"auto\">I am currently working on a Terragrunt GitHub repository/directory layout setup for deploying the \"core cloud infrastructure setup\" of an corporate Azure environment, which should consists of multiple components:</p>\n<ul dir=\"auto\">\n<li>networking hubs in multiple regions (for hub and spoke networking)</li>\n<li>central logging stack in multiple regions</li>\n<li>(and a couple of more corporate components ..)</li>\n</ul>\n<p dir=\"auto\">I need to have two fully isolated environments: <strong>prd</strong> and <strong>dev</strong> (changes to these environments need to be strictly isolated; state files should be on different storage accounts too, etc.)</p>\n<p dir=\"auto\">For IT security requirements, I need to implement the <strong>least access privilege concept</strong>, which also needs to be applied for running automation code.<br>\nThat means, instead of having one single Azure Service Principal (i.e. automation user) which is configured as superuser (so-called Owner in Azure) on the entire cloud environment, I need to have muliple ones - e.g.</p>\n<ul dir=\"auto\">\n<li>network-hub-automation-prd</li>\n<li>network-hub-automation-dev</li>\n<li>central-logging-automation-prd</li>\n<li>central-logging-automation-dev</li>\n</ul>\n<p dir=\"auto\">which are configured with the <strong>minimum permissions</strong> necessary on Azure (e.g. network-hub-automation-prd should only be able to deploy the network related resources in the configured prd subscriptions).</p>\n<p dir=\"auto\">In addition, people doing dev work shouldn't be able to run prd automation (unless they are also member of the prd team) - <strong>segration of duties</strong>.</p>\n<p dir=\"auto\">This is all to <strong>reduce the blast radius</strong> if dev/prd mistakes happen and/or any credentials for automation users get leaked, etc.</p>\n<p dir=\"auto\">Deployment of these different components of the core infrastructure should then be done via individual <strong>GitHub actions</strong>.</p>\n<p dir=\"auto\">I did lots of research on the Internet to find out the <strong>most suitable (mono/poly) repository and directory layout</strong>, but I am still not sure which way to go forward.</p>\n<p dir=\"auto\">Currently I can think of these layouts:</p>\n<h3 dir=\"auto\">(A) One mono repository</h3>\n<p dir=\"auto\">Repository: <strong>live-infrastructure</strong></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"/\n├── .github\n│   ├── workflows\n│   │   ├── dev\n│   │   │   ├── north-europe\n│   │   │   │   ├── central-logging\n│   │   │   │   │   action.yaml\n│   │   │   │   ├── networking-hub\n│   │   │   │   │   action.yaml\n│   │   │   ├── west-europe\n│   │   │   │   ├── central-logging\n│   │   │   │   │   action.yaml\n│   │   │   │   ├── networking-hub\n│   │   │   │   │   action.yaml\n│   │   ├── prd\n│   │   │   ├── north-europe\n│   │   │   │   ├── central-logging\n│   │   │   │   │   action.yaml\n│   │   │   │   ├── networking─ hub\n│   │   │   │   │   action.yaml\n│   │   │   ├── west-europe\n│   │   │   │   ├── central-logging\n│   │   │   │   │   action.yaml\n│   │   │   │   ├── networking-hub\n│   │   │   │   │   action.yaml\n├── live\n│   terragrunt.hcl\n│   ├── dev\n│   │   env.hcl\n│   │   ├── north-europe\n│   │   │   region.hcl\n│   │   │   ├── central-logging\n│   │   │   │   terragrunt.hcl\n│   │   │   ├── networking-hub\n│   │   │   │   terragrunt.hcl\n│   │   ├── west-europe\n│   │   │   region.hcl\n│   │   │   ├── central-logging\n│   │   │   │   terragrunt.hcl\n│   │   │   ├── networking-hub\n│   │   │   │   terragrunt.hcl\n│   ├── prd\n│   │   env.hcl\n│   │   ├── north-europe\n│   │   │   region.hcl\n│   │   │   ├── central-logging\n│   │   │   │   terragrunt.hcl\n│   │   │   ├── networking-hub\n│   │   │   │   terragrunt.hcl\n│   │   ├── west-europe\n│   │   │   region.hcl\n│   │   │   ├── central-logging\n│   │   │   │   terragrunt.hcl\n│   │   │   ├── networking-hub\n│   │   │   │   terragrunt.hcl\"><pre class=\"notranslate\"><code class=\"notranslate\">/\n├── .github\n│   ├── workflows\n│   │   ├── dev\n│   │   │   ├── north-europe\n│   │   │   │   ├── central-logging\n│   │   │   │   │   action.yaml\n│   │   │   │   ├── networking-hub\n│   │   │   │   │   action.yaml\n│   │   │   ├── west-europe\n│   │   │   │   ├── central-logging\n│   │   │   │   │   action.yaml\n│   │   │   │   ├── networking-hub\n│   │   │   │   │   action.yaml\n│   │   ├── prd\n│   │   │   ├── north-europe\n│   │   │   │   ├── central-logging\n│   │   │   │   │   action.yaml\n│   │   │   │   ├── networking─ hub\n│   │   │   │   │   action.yaml\n│   │   │   ├── west-europe\n│   │   │   │   ├── central-logging\n│   │   │   │   │   action.yaml\n│   │   │   │   ├── networking-hub\n│   │   │   │   │   action.yaml\n├── live\n│   terragrunt.hcl\n│   ├── dev\n│   │   env.hcl\n│   │   ├── north-europe\n│   │   │   region.hcl\n│   │   │   ├── central-logging\n│   │   │   │   terragrunt.hcl\n│   │   │   ├── networking-hub\n│   │   │   │   terragrunt.hcl\n│   │   ├── west-europe\n│   │   │   region.hcl\n│   │   │   ├── central-logging\n│   │   │   │   terragrunt.hcl\n│   │   │   ├── networking-hub\n│   │   │   │   terragrunt.hcl\n│   ├── prd\n│   │   env.hcl\n│   │   ├── north-europe\n│   │   │   region.hcl\n│   │   │   ├── central-logging\n│   │   │   │   terragrunt.hcl\n│   │   │   ├── networking-hub\n│   │   │   │   terragrunt.hcl\n│   │   ├── west-europe\n│   │   │   region.hcl\n│   │   │   ├── central-logging\n│   │   │   │   terragrunt.hcl\n│   │   │   ├── networking-hub\n│   │   │   │   terragrunt.hcl\n</code></pre></div>\n<ul dir=\"auto\">\n<li>This is following the approach as laid out here: <a href=\"https://github.com/gruntwork-io/terragrunt-infrastructure-live-example\">https://github.com/gruntwork-io/terragrunt-infrastructure-live-example</a>.</li>\n<li>Dev/Prd credentials for the automation users (service principals) could be stored as GitHub repository secrets and be reused in the different GitHub action.yaml</li>\n<li>However, this would mean that people doing changes on dev would work in the same repository as people doing changes in prd.</li>\n<li>This might complicate \"segration of duties\" and isololation of dev/prd work as also all dev/prd people would be able to see/use all configured GitHub dev/prd repository secrets</li>\n</ul>\n<h3 dir=\"auto\">(B) One repository per environment (poly-repo)</h3>\n<p dir=\"auto\">Repository: <strong>live-infrastructure-dev</strong></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"/\n├── .github\n│   ├── workflows\n│   │   ├── dev\n│   │   │   ├── north-europe\n│   │   │   │   ├── central-logging\n│   │   │   │   │   action.yaml\n│   │   │   │   ├── networking-hub\n│   │   │   │   │   action.yaml\n│   │   │   ├── west-europe\n│   │   │   │   ├── central-logging\n│   │   │   │   │   action.yaml\n│   │   │   │   ├── networking-hub\n│   │   │   │   │   action.yaml\n├── live\n│   terragrunt.hcl\n│   ├── dev\n│   │   env.hcl\n│   │   ├── north-europe\n│   │   │   region.hcl\n│   │   │   ├── central-logging\n│   │   │   │   terragrunt.hcl\n│   │   │   ├── networking-hub\n│   │   │   │   terragrunt.hcl\n│   │   ├── west-europe\n│   │   │   region.hcl\n│   │   │   ├── central-logging\n│   │   │   │   terragrunt.hcl\n│   │   │   ├── networking-hub\n│   │   │   │   terragrunt.hcl\"><pre class=\"notranslate\"><code class=\"notranslate\">/\n├── .github\n│   ├── workflows\n│   │   ├── dev\n│   │   │   ├── north-europe\n│   │   │   │   ├── central-logging\n│   │   │   │   │   action.yaml\n│   │   │   │   ├── networking-hub\n│   │   │   │   │   action.yaml\n│   │   │   ├── west-europe\n│   │   │   │   ├── central-logging\n│   │   │   │   │   action.yaml\n│   │   │   │   ├── networking-hub\n│   │   │   │   │   action.yaml\n├── live\n│   terragrunt.hcl\n│   ├── dev\n│   │   env.hcl\n│   │   ├── north-europe\n│   │   │   region.hcl\n│   │   │   ├── central-logging\n│   │   │   │   terragrunt.hcl\n│   │   │   ├── networking-hub\n│   │   │   │   terragrunt.hcl\n│   │   ├── west-europe\n│   │   │   region.hcl\n│   │   │   ├── central-logging\n│   │   │   │   terragrunt.hcl\n│   │   │   ├── networking-hub\n│   │   │   │   terragrunt.hcl\n</code></pre></div>\n<p dir=\"auto\">Repository: <strong>live-infrastructure-prd</strong></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"/\n├── .github\n│   ├── workflows\n│   │   ├── prd\n│   │   │   ├── north-europe\n│   │   │   │   ├── central-logging\n│   │   │   │   │   action.yaml\n│   │   │   │   ├── networking-hub\n│   │   │   │   │   action.yaml\n│   │   │   ├── west-europe\n│   │   │   │   ├── central-logging\n│   │   │   │   │   action.yaml\n│   │   │   │   ├── networking-hub\n│   │   │   │   │   action.yaml\n├── live\n│   terragrunt.hcl\n│   ├── prd\n│   │   env.hcl\n│   │   ├── north-europe\n│   │   │   region.hcl\n│   │   │   ├── central-logging\n│   │   │   │   terragrunt.hcl\n│   │   │   ├── networking-hub\n│   │   │   │   terragrunt.hcl\n│   │   ├── west-europe\n│   │   │   region.hcl\n│   │   │   ├── central-logging\n│   │   │   │   terragrunt.hcl\n│   │   │   ├── networking-hub\n│   │   │   │   terragrunt.hcl\"><pre class=\"notranslate\"><code class=\"notranslate\">/\n├── .github\n│   ├── workflows\n│   │   ├── prd\n│   │   │   ├── north-europe\n│   │   │   │   ├── central-logging\n│   │   │   │   │   action.yaml\n│   │   │   │   ├── networking-hub\n│   │   │   │   │   action.yaml\n│   │   │   ├── west-europe\n│   │   │   │   ├── central-logging\n│   │   │   │   │   action.yaml\n│   │   │   │   ├── networking-hub\n│   │   │   │   │   action.yaml\n├── live\n│   terragrunt.hcl\n│   ├── prd\n│   │   env.hcl\n│   │   ├── north-europe\n│   │   │   region.hcl\n│   │   │   ├── central-logging\n│   │   │   │   terragrunt.hcl\n│   │   │   ├── networking-hub\n│   │   │   │   terragrunt.hcl\n│   │   ├── west-europe\n│   │   │   region.hcl\n│   │   │   ├── central-logging\n│   │   │   │   terragrunt.hcl\n│   │   │   ├── networking-hub\n│   │   │   │   terragrunt.hcl\n</code></pre></div>\n<ul dir=\"auto\">\n<li>Dev credentials for the automation users (service principals) could be stored as GitHub repository secrets in live-infrastructure-dev repository only</li>\n<li>Prd credentials for the automation users (service principals) could be stored as GitHub repository secrets in live-infrastructure-prd repository only</li>\n<li>This would give much better isolation between the dev/prd teams, as they have only access to one of the repositories and the configured GitHub respository secrets</li>\n<li>However, somebody could still mistakenly configure a GitHub action to run e.g. the network-hub automation with the GitHub repository secrets for the central-logging automation</li>\n</ul>\n<h3 dir=\"auto\">(C) One repository per component per environment (poly-repo)</h3>\n<p dir=\"auto\">Repository: <strong>live-infrastructure-central-loging-dev</strong></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"/\n├── .github\n│   ├── workflows\n│   │   ├── dev\n│   │   │   ├── north-europe\n│   │   │   │   ├── central-logging\n│   │   │   │   │   action.yaml\n│   │   │   ├── west-europe\n│   │   │   │   ├── central-logging\n│   │   │   │   │   action.yaml\n├── live\n│   terragrunt.hcl\n│   ├── dev\n│   │   env.hcl\n│   │   ├── north-europe\n│   │   │   region.hcl\n│   │   │   ├── central-logging\n│   │   │   │   terragrunt.hcl\n│   │   ├── west-europe\n│   │   │   region.hcl\n│   │   │   ├── central-logging\n│   │   │   │   terragrunt.hcl\"><pre class=\"notranslate\"><code class=\"notranslate\">/\n├── .github\n│   ├── workflows\n│   │   ├── dev\n│   │   │   ├── north-europe\n│   │   │   │   ├── central-logging\n│   │   │   │   │   action.yaml\n│   │   │   ├── west-europe\n│   │   │   │   ├── central-logging\n│   │   │   │   │   action.yaml\n├── live\n│   terragrunt.hcl\n│   ├── dev\n│   │   env.hcl\n│   │   ├── north-europe\n│   │   │   region.hcl\n│   │   │   ├── central-logging\n│   │   │   │   terragrunt.hcl\n│   │   ├── west-europe\n│   │   │   region.hcl\n│   │   │   ├── central-logging\n│   │   │   │   terragrunt.hcl\n</code></pre></div>\n<p dir=\"auto\">Repository: <strong>live-infrastructure-networking-hub-dev</strong></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"/\n├── .github\n│   ├── workflows\n│   │   ├── dev\n│   │   │   ├── north-europe\n│   │   │   │   ├── networking-hub\n│   │   │   │   │   action.yaml\n│   │   │   ├── west-europe\n│   │   │   │   ├── networking-hub\n│   │   │   │   │   action.yaml\n├── live\n│   terragrunt.hcl\n│   ├── dev\n│   │   env.hcl\n│   │   ├── north-europe\n│   │   │   region.hcl\n│   │   │   ├── networking-hub\n│   │   │   │   terragrunt.hcl\n│   │   ├── west-europe\n│   │   │   region.hcl\n│   │   │   ├── networking-hub\n│   │   │   │   terragrunt.hcl\"><pre class=\"notranslate\"><code class=\"notranslate\">/\n├── .github\n│   ├── workflows\n│   │   ├── dev\n│   │   │   ├── north-europe\n│   │   │   │   ├── networking-hub\n│   │   │   │   │   action.yaml\n│   │   │   ├── west-europe\n│   │   │   │   ├── networking-hub\n│   │   │   │   │   action.yaml\n├── live\n│   terragrunt.hcl\n│   ├── dev\n│   │   env.hcl\n│   │   ├── north-europe\n│   │   │   region.hcl\n│   │   │   ├── networking-hub\n│   │   │   │   terragrunt.hcl\n│   │   ├── west-europe\n│   │   │   region.hcl\n│   │   │   ├── networking-hub\n│   │   │   │   terragrunt.hcl\n</code></pre></div>\n<p dir=\"auto\">Repository: <strong>live-infrastructure-central-loging-prd</strong></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"/\n├── .github\n│   ├── workflows\n│   │   ├── prd\n│   │   │   ├── north-europe\n│   │   │   │   ├── central-logging\n│   │   │   │   │   action.yaml\n│   │   │   ├── west-europe\n│   │   │   │   ├── central-logging\n│   │   │   │   │   action.yaml\n├── live\n│   terragrunt.hcl\n│   ├── prd\n│   │   env.hcl\n│   │   ├── north-europe\n│   │   │   region.hcl\n│   │   │   ├── central-logging\n│   │   │   │   terragrunt.hcl\n│   │   ├── west-europe\n│   │   │   region.hcl\n│   │   │   ├── central-logging\n│   │   │   │   terragrunt.hcl\"><pre class=\"notranslate\"><code class=\"notranslate\">/\n├── .github\n│   ├── workflows\n│   │   ├── prd\n│   │   │   ├── north-europe\n│   │   │   │   ├── central-logging\n│   │   │   │   │   action.yaml\n│   │   │   ├── west-europe\n│   │   │   │   ├── central-logging\n│   │   │   │   │   action.yaml\n├── live\n│   terragrunt.hcl\n│   ├── prd\n│   │   env.hcl\n│   │   ├── north-europe\n│   │   │   region.hcl\n│   │   │   ├── central-logging\n│   │   │   │   terragrunt.hcl\n│   │   ├── west-europe\n│   │   │   region.hcl\n│   │   │   ├── central-logging\n│   │   │   │   terragrunt.hcl\n</code></pre></div>\n<p dir=\"auto\">Repository: <strong>live-infrastructure-networking-hub-prd</strong></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"/\n├── .github\n│   ├── workflows\n│   │   ├── prd\n│   │   │   ├── north-europe\n│   │   │   │   ├── networking-hub\n│   │   │   │   │   action.yaml\n│   │   │   ├── west-europe\n│   │   │   │   ├── networking-hub\n│   │   │   │   │   action.yaml\n├── live\n│   terragrunt.hcl\n│   ├── prd\n│   │   env.hcl\n│   │   ├── north-europe\n│   │   │   region.hcl\n│   │   │   ├── networking-hub\n│   │   │   │   terragrunt.hcl\n│   │   ├── west-europe\n│   │   │   region.hcl\n│   │   │   ├── networking-hub\n│   │   │   │   terragrunt.hcl\"><pre class=\"notranslate\"><code class=\"notranslate\">/\n├── .github\n│   ├── workflows\n│   │   ├── prd\n│   │   │   ├── north-europe\n│   │   │   │   ├── networking-hub\n│   │   │   │   │   action.yaml\n│   │   │   ├── west-europe\n│   │   │   │   ├── networking-hub\n│   │   │   │   │   action.yaml\n├── live\n│   terragrunt.hcl\n│   ├── prd\n│   │   env.hcl\n│   │   ├── north-europe\n│   │   │   region.hcl\n│   │   │   ├── networking-hub\n│   │   │   │   terragrunt.hcl\n│   │   ├── west-europe\n│   │   │   region.hcl\n│   │   │   ├── networking-hub\n│   │   │   │   terragrunt.hcl\n</code></pre></div>\n<ul dir=\"auto\">\n<li>Small repositories doing just the necessary work are handy seem to offer the best isolation</li>\n<li>However, this all comes at the cost of (too??) many repositories, which introduce maintenance costs</li>\n</ul>\n<p dir=\"auto\">I would be happy if you can share your thoughts and experience with me and any good/best practices.</p>\n<hr>\n<ins datetime=\"2023-04-23T07:50:19Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/110107\" rel=\"nofollow\">Tracked in ticket #110107</a></p>\n</ins>","answer":{"body":"This is more of a question of your deployment workflow than of Terragrunt. Even if you weren't using Terragrunt, and solely using Terraform, you'd still have to resolve the question of \"how do I decide which parts of my infrastructure code can be updated by which devs?\"\r\n\r\nThere are many different ways to answer this question. Here are just a few:\r\n\r\n1. **Use multiple repos, and to only grant certain devs access to certain repos**. This is the idea you mention in your post above, and it can work, but please be aware of the [trade offs between a monorepo vs polyrepos for managing your live infrastructure](https://github.com/gruntwork-io/terragrunt-infrastructure-modules-example#monorepo-vs-polyrepo). Also, note that depending on how granular your access privileges need to be, creating separate repos for them can get quite messy. If it's really just \"prod vs non-prod,\" then two repos will do the trick. But if it gets more complicated—e.g., one team should be able to update A and B but not C or D, whereas another team can update A and C, but not B or D—then shuffling things around many different repos may get messy.\r\n1. **Code review**. Require that (a) all changes to your repos to be submitted via pull requests and (b) that pull requests must be reviewed by at least 1 non-author before they can be merged (see [GitHub protected branches](https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/managing-protected-branches/about-protected-branches). If you do that, then the reviewers of the PR can see who submitted it and if that person shouldn't be allowed to update that part of the code, you can reject the PR.\r\n1. **CI checks**. Closely related to the previous item, instead of (or in addition to) human reviewers, you could have a CI server (e.g., GitHub Actions, CircleCI, Jenkins) that runs against every PR, looks at each commit, sees who made the changes, if they are allowed to change those files (i.e., those part of your infrastructure), and if not, fail the build, and blocking merge of the PR (you can enable this as part of protected branches). You should also [enforce commit signing](https://docs.github.com/en/authentication/managing-commit-signature-verification/about-commit-signature-verification) so commits can't be spoofed.\r\n1. **Deployment checks**. Closely related to the previous item, you could have your deployment system enforce access controls. The assumption here is that you deploy changes with some automated system (e.g., GitHub Actions, CircleCI, etc) and that system, before doing a deployment on some committed code, scans the code to see who made the changes, if they are allowed to change those files (i.e., those part of your infrastructure), and if not, don't do the deployment. Again, enforced commit signing is a good idea here.\r\n\r\nI'd recommend using items (2)-(4) in most cases, as they give you a bunch of nice benefits, including enforcing access controls as per this discussion. Note that all of these items work with monorepos or polyrepos too.","bodyHTML":"<p dir=\"auto\">This is more of a question of your deployment workflow than of Terragrunt. Even if you weren't using Terragrunt, and solely using Terraform, you'd still have to resolve the question of \"how do I decide which parts of my infrastructure code can be updated by which devs?\"</p>\n<p dir=\"auto\">There are many different ways to answer this question. Here are just a few:</p>\n<ol dir=\"auto\">\n<li><strong>Use multiple repos, and to only grant certain devs access to certain repos</strong>. This is the idea you mention in your post above, and it can work, but please be aware of the <a href=\"https://github.com/gruntwork-io/terragrunt-infrastructure-modules-example#monorepo-vs-polyrepo\">trade offs between a monorepo vs polyrepos for managing your live infrastructure</a>. Also, note that depending on how granular your access privileges need to be, creating separate repos for them can get quite messy. If it's really just \"prod vs non-prod,\" then two repos will do the trick. But if it gets more complicated—e.g., one team should be able to update A and B but not C or D, whereas another team can update A and C, but not B or D—then shuffling things around many different repos may get messy.</li>\n<li><strong>Code review</strong>. Require that (a) all changes to your repos to be submitted via pull requests and (b) that pull requests must be reviewed by at least 1 non-author before they can be merged (see <a href=\"https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/managing-protected-branches/about-protected-branches\">GitHub protected branches</a>. If you do that, then the reviewers of the PR can see who submitted it and if that person shouldn't be allowed to update that part of the code, you can reject the PR.</li>\n<li><strong>CI checks</strong>. Closely related to the previous item, instead of (or in addition to) human reviewers, you could have a CI server (e.g., GitHub Actions, CircleCI, Jenkins) that runs against every PR, looks at each commit, sees who made the changes, if they are allowed to change those files (i.e., those part of your infrastructure), and if not, fail the build, and blocking merge of the PR (you can enable this as part of protected branches). You should also <a href=\"https://docs.github.com/en/authentication/managing-commit-signature-verification/about-commit-signature-verification\">enforce commit signing</a> so commits can't be spoofed.</li>\n<li><strong>Deployment checks</strong>. Closely related to the previous item, you could have your deployment system enforce access controls. The assumption here is that you deploy changes with some automated system (e.g., GitHub Actions, CircleCI, etc) and that system, before doing a deployment on some committed code, scans the code to see who made the changes, if they are allowed to change those files (i.e., those part of your infrastructure), and if not, don't do the deployment. Again, enforced commit signing is a good idea here.</li>\n</ol>\n<p dir=\"auto\">I'd recommend using items (2)-(4) in most cases, as they give you a bunch of nice benefits, including enforcing access controls as per this discussion. Note that all of these items work with monorepos or polyrepos too.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "42199fdc4d79c9dededd9dcce30369f9"
}
##DOCS-SOURCER-END -->
