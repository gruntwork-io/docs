---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/538" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Using &quot;iam_role&quot; with S3 state bucket in another account</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AQdAq","number":538,"author":{"login":"tcourtnage-tbl"},"title":"Using \"iam_role\" with S3 state bucket in another account","body":"\nHi. I'm having a heck of a time with something that I swear worked fine two days ago. Now I can't explain the failure.\r\n\r\nI'm trying to use the `iam_role` feature to have Terragrunt deploy resources into another AWS account and keep my remote state DRY.\r\n\r\nMy `terragrunt.hcl` at the root of my project. `my-state-bucket`  is in account 111111111111.\r\n```\r\nremote_state {\r\n  backend = \"s3\"\r\n  generate = {\r\n    path      = \"backend.tf\"\r\n    if_exists = \"overwrite_terragrunt\"\r\n  }\r\n  config = {\r\n    bucket = \"my-state-bucket\"\r\n\r\n    key = \"${path_relative_to_include()}/terraform.tfstate\"\r\n    region         = \"us-east-1\"\r\n    encrypt        = true\r\n    dynamodb_table = \"terraform-locks\"\r\n  }\r\n}\r\n```\r\nMy `terragrunt.hcl` in a subfolder:\r\n```\r\ninclude \"parent\" {\r\n  path = find_in_parent_folders()\r\n}\r\n\r\niam_role = \"arn:aws:iam::222222222222:role/my-cross-account-role\"\r\n\r\nterraform {\r\n  source = \"tfr://registry.terraform.io/........\"\r\n}\r\n\r\ninputs = {\r\n....\r\n}\r\n```\r\n`my-cross-account-role` has AdminstratorAccess, and has a policy that allows `s3:*` access to `my-state-bucket` and `kms:*` to the CMK KMS. `my-state-bucket` also has a bucket policy that allows `s3:*` for the `arn:aws:iam::222222222222:role/my-cross-account-role` principal. The KMS key also has a policy that allows `kms:*` to the principal as well.\r\n\r\nWhen I run `terragrunt plan --terragrunt-log-level debug`, I get this:\r\n\r\n```\r\n...\r\nDEBU[0000] Assuming IAM role arn:aws:iam::222222222222:role/my-cross-account-role with a session duration of 0 seconds.\r\n....\r\nDEBU[0000] Initializing remote state for the s3 backend  prefix=[.....] \r\nDEBU[0000] Checking if SSE is enabled for AWS S3 bucket my-state-bucket  prefix=[.....] \r\nDEBU[0001] Checking if bucket my-state-bucket is have root access  prefix=[.....] \r\nDEBU[0001] Could not get policy for bucket my-state-bucket  prefix=[.....] \r\nDEBU[0001] Checking if bucket my-state-bucket is enforced with TLS  prefix=[.....] \r\nERRO[0001] MethodNotAllowed: The specified method is not allowed against this resource.\r\n\tstatus code: 405, request id: EH84T2FY841KD420, host id: YSYFjAWjZ1mYp7C4L5h1v7VV6A38ff6mdK9MY05o1h424dGlUrl21Cif5vGugZlIl/OFhmQkCZY= \r\nERRO[0001] Unable to determine underlying exit code, so Terragrunt will exit with error code 1 \r\n```\r\n\r\nI can assume the `my-cross-account-role` at the cli, and can successsfully access the bucket, list objects, put and get objects and everything is good. However, if I try this, it fails, similar to the error above:\r\n```\r\n$ aws s3api get-bucket-policy --bucket my-state-bucket\r\n\r\nAn error occurred (MethodNotAllowed) when calling the GetBucketPolicy operation: The specified method is not allowed against this resource.\r\n```\r\n\r\nThe only thing I can come up with is https://docs.aws.amazon.com/AmazonS3/latest/API/API_GetBucketPolicy.html, a 405 Method Not Allowed because the identity doesn't belong to the bucket owner's account. As mentioned, I'm 99.9999% sure this was working two days ago, and after many changes and things moving around, now I can't figure out what's going on!\r\n\r\nHappy to provide more details if I'm missing some details above.\n\n---\n\n<ins datetime=\"2022-08-17T22:57:36Z\">\n  <p><a href=\"https://support.gruntwork.io/hc/requests/109144\">Tracked in ticket #109144</a></p>\n</ins>\n","bodyHTML":"<p dir=\"auto\">Hi. I'm having a heck of a time with something that I swear worked fine two days ago. Now I can't explain the failure.</p>\n<p dir=\"auto\">I'm trying to use the <code class=\"notranslate\">iam_role</code> feature to have Terragrunt deploy resources into another AWS account and keep my remote state DRY.</p>\n<p dir=\"auto\">My <code class=\"notranslate\">terragrunt.hcl</code> at the root of my project. <code class=\"notranslate\">my-state-bucket</code>  is in account 111111111111.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"remote_state {\n  backend = &quot;s3&quot;\n  generate = {\n    path      = &quot;backend.tf&quot;\n    if_exists = &quot;overwrite_terragrunt&quot;\n  }\n  config = {\n    bucket = &quot;my-state-bucket&quot;\n\n    key = &quot;${path_relative_to_include()}/terraform.tfstate&quot;\n    region         = &quot;us-east-1&quot;\n    encrypt        = true\n    dynamodb_table = &quot;terraform-locks&quot;\n  }\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">remote_state {\n  backend = \"s3\"\n  generate = {\n    path      = \"backend.tf\"\n    if_exists = \"overwrite_terragrunt\"\n  }\n  config = {\n    bucket = \"my-state-bucket\"\n\n    key = \"${path_relative_to_include()}/terraform.tfstate\"\n    region         = \"us-east-1\"\n    encrypt        = true\n    dynamodb_table = \"terraform-locks\"\n  }\n}\n</code></pre></div>\n<p dir=\"auto\">My <code class=\"notranslate\">terragrunt.hcl</code> in a subfolder:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"include &quot;parent&quot; {\n  path = find_in_parent_folders()\n}\n\niam_role = &quot;arn:aws:iam::222222222222:role/my-cross-account-role&quot;\n\nterraform {\n  source = &quot;tfr://registry.terraform.io/........&quot;\n}\n\ninputs = {\n....\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">include \"parent\" {\n  path = find_in_parent_folders()\n}\n\niam_role = \"arn:aws:iam::222222222222:role/my-cross-account-role\"\n\nterraform {\n  source = \"tfr://registry.terraform.io/........\"\n}\n\ninputs = {\n....\n}\n</code></pre></div>\n<p dir=\"auto\"><code class=\"notranslate\">my-cross-account-role</code> has AdminstratorAccess, and has a policy that allows <code class=\"notranslate\">s3:*</code> access to <code class=\"notranslate\">my-state-bucket</code> and <code class=\"notranslate\">kms:*</code> to the CMK KMS. <code class=\"notranslate\">my-state-bucket</code> also has a bucket policy that allows <code class=\"notranslate\">s3:*</code> for the <code class=\"notranslate\">arn:aws:iam::222222222222:role/my-cross-account-role</code> principal. The KMS key also has a policy that allows <code class=\"notranslate\">kms:*</code> to the principal as well.</p>\n<p dir=\"auto\">When I run <code class=\"notranslate\">terragrunt plan --terragrunt-log-level debug</code>, I get this:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"...\nDEBU[0000] Assuming IAM role arn:aws:iam::222222222222:role/my-cross-account-role with a session duration of 0 seconds.\n....\nDEBU[0000] Initializing remote state for the s3 backend  prefix=[.....] \nDEBU[0000] Checking if SSE is enabled for AWS S3 bucket my-state-bucket  prefix=[.....] \nDEBU[0001] Checking if bucket my-state-bucket is have root access  prefix=[.....] \nDEBU[0001] Could not get policy for bucket my-state-bucket  prefix=[.....] \nDEBU[0001] Checking if bucket my-state-bucket is enforced with TLS  prefix=[.....] \nERRO[0001] MethodNotAllowed: The specified method is not allowed against this resource.\n\tstatus code: 405, request id: EH84T2FY841KD420, host id: YSYFjAWjZ1mYp7C4L5h1v7VV6A38ff6mdK9MY05o1h424dGlUrl21Cif5vGugZlIl/OFhmQkCZY= \nERRO[0001] Unable to determine underlying exit code, so Terragrunt will exit with error code 1 \"><pre class=\"notranslate\"><code class=\"notranslate\">...\nDEBU[0000] Assuming IAM role arn:aws:iam::222222222222:role/my-cross-account-role with a session duration of 0 seconds.\n....\nDEBU[0000] Initializing remote state for the s3 backend  prefix=[.....] \nDEBU[0000] Checking if SSE is enabled for AWS S3 bucket my-state-bucket  prefix=[.....] \nDEBU[0001] Checking if bucket my-state-bucket is have root access  prefix=[.....] \nDEBU[0001] Could not get policy for bucket my-state-bucket  prefix=[.....] \nDEBU[0001] Checking if bucket my-state-bucket is enforced with TLS  prefix=[.....] \nERRO[0001] MethodNotAllowed: The specified method is not allowed against this resource.\n\tstatus code: 405, request id: EH84T2FY841KD420, host id: YSYFjAWjZ1mYp7C4L5h1v7VV6A38ff6mdK9MY05o1h424dGlUrl21Cif5vGugZlIl/OFhmQkCZY= \nERRO[0001] Unable to determine underlying exit code, so Terragrunt will exit with error code 1 \n</code></pre></div>\n<p dir=\"auto\">I can assume the <code class=\"notranslate\">my-cross-account-role</code> at the cli, and can successsfully access the bucket, list objects, put and get objects and everything is good. However, if I try this, it fails, similar to the error above:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ aws s3api get-bucket-policy --bucket my-state-bucket\n\nAn error occurred (MethodNotAllowed) when calling the GetBucketPolicy operation: The specified method is not allowed against this resource.\"><pre class=\"notranslate\"><code class=\"notranslate\">$ aws s3api get-bucket-policy --bucket my-state-bucket\n\nAn error occurred (MethodNotAllowed) when calling the GetBucketPolicy operation: The specified method is not allowed against this resource.\n</code></pre></div>\n<p dir=\"auto\">The only thing I can come up with is <a href=\"https://docs.aws.amazon.com/AmazonS3/latest/API/API_GetBucketPolicy.html\" rel=\"nofollow\">https://docs.aws.amazon.com/AmazonS3/latest/API/API_GetBucketPolicy.html</a>, a 405 Method Not Allowed because the identity doesn't belong to the bucket owner's account. As mentioned, I'm 99.9999% sure this was working two days ago, and after many changes and things moving around, now I can't figure out what's going on!</p>\n<p dir=\"auto\">Happy to provide more details if I'm missing some details above.</p>\n<hr>\n<ins datetime=\"2022-08-17T22:57:36Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/109144\" rel=\"nofollow\">Tracked in ticket #109144</a></p>\n</ins>","answer":{"body":"Did you recently update `terragrunt` to the latest version? This may be an issue with the introduction of the bucket state syncing feature in Terragrunt.\r\n\r\nCan you try setting `disable_bucket_update = true` on the `remote_state` block and see if that avoids the issue? E.g.:\r\n\r\n```hcl\r\nremote_state {\r\n  backend = \"s3\"\r\n  generate = {\r\n    path      = \"backend.tf\"\r\n    if_exists = \"overwrite_terragrunt\"\r\n  }\r\n  config = {\r\n    bucket = \"my-state-bucket\"\r\n\r\n    key = \"${path_relative_to_include()}/terraform.tfstate\"\r\n    region         = \"us-east-1\"\r\n    encrypt        = true\r\n    dynamodb_table = \"terraform-locks\"\r\n  }\r\n  disable_bucket_update = true\r\n}\r\n```","bodyHTML":"<p dir=\"auto\">Did you recently update <code class=\"notranslate\">terragrunt</code> to the latest version? This may be an issue with the introduction of the bucket state syncing feature in Terragrunt.</p>\n<p dir=\"auto\">Can you try setting <code class=\"notranslate\">disable_bucket_update = true</code> on the <code class=\"notranslate\">remote_state</code> block and see if that avoids the issue? E.g.:</p>\n<div class=\"highlight highlight-source-hcl notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"remote_state {\n  backend = &quot;s3&quot;\n  generate = {\n    path      = &quot;backend.tf&quot;\n    if_exists = &quot;overwrite_terragrunt&quot;\n  }\n  config = {\n    bucket = &quot;my-state-bucket&quot;\n\n    key = &quot;${path_relative_to_include()}/terraform.tfstate&quot;\n    region         = &quot;us-east-1&quot;\n    encrypt        = true\n    dynamodb_table = &quot;terraform-locks&quot;\n  }\n  disable_bucket_update = true\n}\"><pre class=\"notranslate\"><span class=\"pl-en\">remote_state</span> {\n  <span class=\"pl-v\"><span class=\"pl-smi\">backend</span> <span class=\"pl-k\">=</span> </span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>s3<span class=\"pl-pds\">\"</span></span>\n  <span class=\"pl-v\"><span class=\"pl-smi\">generate</span> <span class=\"pl-k\">=</span> </span>{\n    path      <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>backend.tf<span class=\"pl-pds\">\"</span></span>\n    if_exists <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>overwrite_terragrunt<span class=\"pl-pds\">\"</span></span>\n  }\n  <span class=\"pl-v\"><span class=\"pl-smi\">config</span> <span class=\"pl-k\">=</span> </span>{\n    bucket <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>my-state-bucket<span class=\"pl-pds\">\"</span></span>\n\n    key <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-k\">${</span><span class=\"pl-c1\">path_relative_to_include</span>()<span class=\"pl-k\">}</span>/terraform.tfstate<span class=\"pl-pds\">\"</span></span>\n    region         <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>us-east-1<span class=\"pl-pds\">\"</span></span>\n    encrypt        <span class=\"pl-k\">=</span> <span class=\"pl-c1\">true</span>\n    dynamodb_table <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>terraform-locks<span class=\"pl-pds\">\"</span></span>\n  }\n  <span class=\"pl-v\"><span class=\"pl-smi\">disable_bucket_update</span> <span class=\"pl-k\">=</span> </span><span class=\"pl-c1\">true</span>\n}</pre></div>"}}} />

</CenterLayout>
  

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "07d6716c3103dc1345263ea4721d7fc6"
}
##DOCS-SOURCER-END -->
