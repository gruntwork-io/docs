---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/201" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Openvpn-admin support for IMDSv2</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AOy4m","number":201,"author":{"login":"marinalimeira"},"title":"Openvpn-admin support for IMDSv2","body":"I'm having issues getting credentials using gruntwork terraform-aws-openvpn-admin utility after enabling instance metadata version 2 (IMDSv2) on an ec2 openvpn instance. Is IMDSv2 already supported and what is the possible workaround on this?\n\n```\n/go/src/github.com/gruntwork-io/package-openvpn/modules/openvpn-admin/src/main.go:18 (0x839517)\n/usr/local/go/src/runtime/proc.go:201 (0x42bf27)\n/usr/local/go/src/runtime/asm_amd64.s:1333 (0x456831)\n\" error=\"Error finding AWS credentials (did you set the AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY environment variables?): NoCredentialProviders: no valid providers in chain. Deprecated.\n        For verbose messaging see aws.Config.CredentialsChainVerboseErrors\"\n\n```","bodyHTML":"<p dir=\"auto\">I'm having issues getting credentials using gruntwork terraform-aws-openvpn-admin utility after enabling instance metadata version 2 (IMDSv2) on an ec2 openvpn instance. Is IMDSv2 already supported and what is the possible workaround on this?</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"/go/src/github.com/gruntwork-io/package-openvpn/modules/openvpn-admin/src/main.go:18 (0x839517)\n/usr/local/go/src/runtime/proc.go:201 (0x42bf27)\n/usr/local/go/src/runtime/asm_amd64.s:1333 (0x456831)\n&quot; error=&quot;Error finding AWS credentials (did you set the AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY environment variables?): NoCredentialProviders: no valid providers in chain. Deprecated.\n        For verbose messaging see aws.Config.CredentialsChainVerboseErrors&quot;\n\"><pre class=\"notranslate\"><code class=\"notranslate\">/go/src/github.com/gruntwork-io/package-openvpn/modules/openvpn-admin/src/main.go:18 (0x839517)\n/usr/local/go/src/runtime/proc.go:201 (0x42bf27)\n/usr/local/go/src/runtime/asm_amd64.s:1333 (0x456831)\n\" error=\"Error finding AWS credentials (did you set the AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY environment variables?): NoCredentialProviders: no valid providers in chain. Deprecated.\n        For verbose messaging see aws.Config.CredentialsChainVerboseErrors\"\n\n</code></pre></div>","answer":{"body":"Within the threads, this has been \"solved\" as an issue that will be resolved once upgrading the openvpn module to at least [v0.17.0](https://github.com/gruntwork-io/terraform-aws-openvpn/releases/tag/v0.17.0). However, in this case they're already using a newer version [v0.19.0](https://github.com/gruntwork-io/terraform-aws-openvpn/releases/tag/v0.19.0).\r\n\r\nHowever, starting in v0.17.1, we actually introduced a backward incompatibility with Terraform < 0.13! Here is the PR that introduced a dependency on [private-s3-bucket v0.57.1](https://github.com/gruntwork-io/terraform-aws-security/blob/v0.57.1/modules/private-s3-bucket/main.tf#L8). As you can see from that line, `required_providers` was already in use by that version (started in [v0.48.3](https://github.com/gruntwork-io/terraform-aws-security/blob/v0.48.3/modules/private-s3-bucket/main.tf#L7)).\r\n\r\nThat module, private-s3-bucket, requires using Terraform AWS Provider version `>= 3.66.0`, in order to setup the new `aws_s3_replication_configuration`.\r\n\r\nMy understanding based on all of this, is that we did not adequately communicate that there was a backward incompatibility introduced in every module that was updated to use _any other module_ that uses `required_providers` _and also_ required an AWS Provider version that would cause the module to fail if Terraform < 0.13 was used.\r\n\r\nThat is, the openvpn repo update to v0.17.1 and above should have mentioned this in the guide.\r\n","bodyHTML":"<p dir=\"auto\">Within the threads, this has been \"solved\" as an issue that will be resolved once upgrading the openvpn module to at least <a href=\"https://github.com/gruntwork-io/terraform-aws-openvpn/releases/tag/v0.17.0\">v0.17.0</a>. However, in this case they're already using a newer version <a href=\"https://github.com/gruntwork-io/terraform-aws-openvpn/releases/tag/v0.19.0\">v0.19.0</a>.</p>\n<p dir=\"auto\">However, starting in v0.17.1, we actually introduced a backward incompatibility with Terraform &lt; 0.13! Here is the PR that introduced a dependency on <a href=\"https://github.com/gruntwork-io/terraform-aws-security/blob/v0.57.1/modules/private-s3-bucket/main.tf#L8\">private-s3-bucket v0.57.1</a>. As you can see from that line, <code class=\"notranslate\">required_providers</code> was already in use by that version (started in <a href=\"https://github.com/gruntwork-io/terraform-aws-security/blob/v0.48.3/modules/private-s3-bucket/main.tf#L7\">v0.48.3</a>).</p>\n<p dir=\"auto\">That module, private-s3-bucket, requires using Terraform AWS Provider version <code class=\"notranslate\">&gt;= 3.66.0</code>, in order to setup the new <code class=\"notranslate\">aws_s3_replication_configuration</code>.</p>\n<p dir=\"auto\">My understanding based on all of this, is that we did not adequately communicate that there was a backward incompatibility introduced in every module that was updated to use <em>any other module</em> that uses <code class=\"notranslate\">required_providers</code> <em>and also</em> required an AWS Provider version that would cause the module to fail if Terraform &lt; 0.13 was used.</p>\n<p dir=\"auto\">That is, the openvpn repo update to v0.17.1 and above should have mentioned this in the guide.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "e21544e43b1a73b43d958f3794c33a77"
}
##DOCS-SOURCER-END -->
