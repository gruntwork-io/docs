---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/331" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>eks-aws-auth-merger not working</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84APM4o","number":331,"author":{"login":"DeepthiKodali2305"},"title":"eks-aws-auth-merger not working","body":"eks-aws-auth-merger was deployed successfully but the additional nodes deployed which needed to be added to the cluster throw the below error\r\n\r\n\r\n│ Error: Post \"http://localhost/api/v1/namespaces/aws-auth-merger/configmaps\": dial tcp 127.0.0.1:80: connect: connection refused","bodyHTML":"<p dir=\"auto\">eks-aws-auth-merger was deployed successfully but the additional nodes deployed which needed to be added to the cluster throw the below error</p>\n<p dir=\"auto\">│ Error: Post \"<a href=\"http://localhost/api/v1/namespaces/aws-auth-merger/configmaps\" rel=\"nofollow\">http://localhost/api/v1/namespaces/aws-auth-merger/configmaps</a>\": dial tcp 127.0.0.1:80: connect: connection refused</p>","answer":{"body":"Hi Petri,\n\nI have identified the issue.\nProvider block was missing from managed nodes  hcl files and I have added them now\n\nThanks and regards\nPhani Deepthi Kodali\n\n\n\nC2 General\nFrom: Kodali, Deepthi, Vodafone (External)\nSent: 04 April 2022 12:37\nTo: gruntwork-io/knowledge-base ***@***.***>; gruntwork-io/knowledge-base ***@***.***>\nCc: Author ***@***.***>\nSubject: RE: [gruntwork-io/knowledge-base] eks-aws-auth-merger not working (Discussion #331)\n\nHi Petri,\n\nI include the following lines of code in eks-aws-auth-merger terragrunt.hcl\n\ngenerate \"k8s_provider\" {\n  path      = \"k8s_provider.tf\"\n  if_exists = \"overwrite_terragrunt\"\n  contents  = <<EOF\nprovider \"kubernetes\" {\n  experiments {\n    manifest_resource = true\n  }\n  host                   = data.aws_eks_cluster.cluster.endpoint\n  cluster_ca_certificate = base64decode(data.aws_eks_cluster.cluster.certificate_authority.0.data)\n  token                  = data.aws_eks_cluster_auth.cluster.token\n}\n\n\n\n\n\nC2 General\nFrom: Petri Autero ***@***.******@***.***>>\nSent: 04 April 2022 12:33\nTo: gruntwork-io/knowledge-base ***@***.******@***.***>>\nCc: Kodali, Deepthi, Vodafone (External) ***@***.******@***.***>>; Author ***@***.******@***.***>>\nSubject: Re: [gruntwork-io/knowledge-base] eks-aws-auth-merger not working (Discussion #331)\n\nCYBER SECURITY WARNING: This email is from an external source - be careful of attachments and links. Please follow the Cyber Code and report suspicious emails.\n\nOk, so it definitely looks like a provider configuration issue. How do you include the provider generate block in the hcl file you're trying to apply?\n\n-\nReply to this email directly, view it on GitHub<https://eur03.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fgruntwork-io%2Fknowledge-base%2Fdiscussions%2F331%23discussioncomment-2499616&data=04%7C01%7Cdeepthi.kodali%40vodafone.com%7C60ac4688ccc44fb975e908da162ef0d3%7C68283f3b84874c86adb3a5228f18b893%7C0%7C0%7C637846688130809183%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&sdata=qBI37e%2BH2rVifPYumyyYVshkTazQyMosHCj3JROmwlU%3D&reserved=0>, or unsubscribe<https://eur03.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fnotifications%2Funsubscribe-auth%2FAV3MA3ZXNQ3JNQHIS3EFNCTVDLHQPANCNFSM5SOVQOTQ&data=04%7C01%7Cdeepthi.kodali%40vodafone.com%7C60ac4688ccc44fb975e908da162ef0d3%7C68283f3b84874c86adb3a5228f18b893%7C0%7C0%7C637846688130809183%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&sdata=pGXeSz8ukx20rZzKmLVBEY2F4rYjhLl%2F0ba%2B%2FPGTQ3k%3D&reserved=0>.\nYou are receiving this because you authored the thread.Message ID: ***@***.******@***.***>>\n","bodyHTML":"<div class=\"email-fragment\">Hi Petri,\n\nI have identified the issue.\nProvider block was missing from managed nodes  hcl files and I have added them now\n\nThanks and regards\nPhani Deepthi Kodali\n\n\n\nC2 General\nFrom: Kodali, Deepthi, Vodafone (External)\nSent: 04 April 2022 12:37\nTo: gruntwork-io/knowledge-base ***@***.***&gt;; gruntwork-io/knowledge-base ***@***.***&gt;\nCc: Author ***@***.***&gt;\nSubject: RE: [gruntwork-io/knowledge-base] eks-aws-auth-merger not working (Discussion <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"3984936\" data-permission-text=\"Title is private\" data-url=\"https://github.com/gruntwork-io/knowledge-base/discussions/331\" href=\"https://github.com/gruntwork-io/knowledge-base/discussions/331\">#331</a>)\n\nHi Petri,\n\nI include the following lines of code in eks-aws-auth-merger terragrunt.hcl\n\ngenerate \"k8s_provider\" {\n  path      = \"k8s_provider.tf\"\n  if_exists = \"overwrite_terragrunt\"\n  contents  = &lt;&lt;EOF\nprovider \"kubernetes\" {\n  experiments {\n    manifest_resource = true\n  }\n  host                   = data.aws_eks_cluster.cluster.endpoint\n  cluster_ca_certificate = base64decode(data.aws_eks_cluster.cluster.certificate_authority.0.data)\n  token                  = data.aws_eks_cluster_auth.cluster.token\n}\n\n\n\n\n\nC2 General\nFrom: Petri Autero ***@***.******@***.***&gt;&gt;\nSent: 04 April 2022 12:33\nTo: gruntwork-io/knowledge-base ***@***.******@***.***&gt;&gt;\nCc: Kodali, Deepthi, Vodafone (External) ***@***.******@***.***&gt;&gt;; Author ***@***.******@***.***&gt;&gt;\nSubject: Re: [gruntwork-io/knowledge-base] eks-aws-auth-merger not working (Discussion <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"3984936\" data-permission-text=\"Title is private\" data-url=\"https://github.com/gruntwork-io/knowledge-base/discussions/331\" href=\"https://github.com/gruntwork-io/knowledge-base/discussions/331\">#331</a>)\n\nCYBER SECURITY WARNING: This email is from an external source - be careful of attachments and links. Please follow the Cyber Code and report suspicious emails.\n\nOk, so it definitely looks like a provider configuration issue. How do you include the provider generate block in the hcl file you're trying to apply?\n\n-\nReply to this email directly, view it on GitHub&lt;<a href=\"https://eur03.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fgruntwork-io%2Fknowledge-base%2Fdiscussions%2F331%23discussioncomment-2499616&amp;data=04%7C01%7Cdeepthi.kodali%40vodafone.com%7C60ac4688ccc44fb975e908da162ef0d3%7C68283f3b84874c86adb3a5228f18b893%7C0%7C0%7C637846688130809183%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=qBI37e%2BH2rVifPYumyyYVshkTazQyMosHCj3JROmwlU%3D&amp;reserved=0\">https://eur03.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fgruntwork-io%2Fknowledge-base%2Fdiscussions%2F331%23discussioncomment-2499616&amp;data=04%7C01%7Cdeepthi.kodali%40vodafone.com%7C60ac4688ccc44fb975e908da162ef0d3%7C68283f3b84874c86adb3a5228f18b893%7C0%7C0%7C637846688130809183%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=qBI37e%2BH2rVifPYumyyYVshkTazQyMosHCj3JROmwlU%3D&amp;reserved=0</a>&gt;, or unsubscribe&lt;<a href=\"https://eur03.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fnotifications%2Funsubscribe-auth%2FAV3MA3ZXNQ3JNQHIS3EFNCTVDLHQPANCNFSM5SOVQOTQ&amp;data=04%7C01%7Cdeepthi.kodali%40vodafone.com%7C60ac4688ccc44fb975e908da162ef0d3%7C68283f3b84874c86adb3a5228f18b893%7C0%7C0%7C637846688130809183%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=pGXeSz8ukx20rZzKmLVBEY2F4rYjhLl%2F0ba%2B%2FPGTQ3k%3D&amp;reserved=0\">https://eur03.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgithub.com%2Fnotifications%2Funsubscribe-auth%2FAV3MA3ZXNQ3JNQHIS3EFNCTVDLHQPANCNFSM5SOVQOTQ&amp;data=04%7C01%7Cdeepthi.kodali%40vodafone.com%7C60ac4688ccc44fb975e908da162ef0d3%7C68283f3b84874c86adb3a5228f18b893%7C0%7C0%7C637846688130809183%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=pGXeSz8ukx20rZzKmLVBEY2F4rYjhLl%2F0ba%2B%2FPGTQ3k%3D&amp;reserved=0</a>&gt;.\nYou are receiving this because you authored the thread.Message ID: ***@***.******@***.***&gt;&gt;</div>"}}} />

</CenterLayout>
  

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "671832ff6139d2c65e8280102f3f3a04"
}
##DOCS-SOURCER-END -->
