---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/8" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Destroying and re-creating dependent Terraform modules when their parent changes</h1>
<GitHub discussion={{"id":"MDEwOkRpc2N1c3Npb24zNTM5MzYz","number":8,"author":{"login":"zackproser"},"title":"Destroying and re-creating dependent Terraform modules when their parent changes","body":"_A user asked:_\r\n\r\n>Hi. We are trying to recreate worker node on calico cni-updates. Is it possible to destroy and recreate the worker node module on parent module changes?\r\n```\r\nmodule \"calico_cni\" {\r\n  source = \"../../modules/calico-cni\"\r\n  cluster_kubeconfig = module.control_plane.eks_kubeconfig\r\n}\r\n\r\nmodule \"cluster_workers\" {\r\n  source                       = \"../../modules/cluster-creation/cluster-workers\"\r\n  depends_on                   = [module.calico_cni]\r\n  cf_vpc_stack                 = var.cf_vpc_stack\r\n  eks_certificate_authority    = module.control_plane.eks_cluster_certificate_authority\r\n  eks_cluster_endpoint         = module.control_plane.eks_cluster_endpoint\r\n  eks_cluster_name             = module.control_plane.eks_cluster_name\r\n  node_group_configurations    = var.node_group_configurations\r\n  workers_ami_id               = var.ami_id\r\n  workers_instance_type        = var.instance_type\r\n  workers_ssm_arn              = module.iam_roles.worker_nodes_ssm_policy_arn\r\n  cluster_kubeconfig           = module.control_plane.eks_kubeconfig\r\n  wait_for_kube_system_timeout = var.wait_for_kube_system_timeout\r\n}\r\n```","bodyHTML":"<p dir=\"auto\"><em>A user asked:</em></p>\n<blockquote>\n<p dir=\"auto\">Hi. We are trying to recreate worker node on calico cni-updates. Is it possible to destroy and recreate the worker node module on parent module changes?</p>\n</blockquote>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"module &quot;calico_cni&quot; {\n  source = &quot;../../modules/calico-cni&quot;\n  cluster_kubeconfig = module.control_plane.eks_kubeconfig\n}\n\nmodule &quot;cluster_workers&quot; {\n  source                       = &quot;../../modules/cluster-creation/cluster-workers&quot;\n  depends_on                   = [module.calico_cni]\n  cf_vpc_stack                 = var.cf_vpc_stack\n  eks_certificate_authority    = module.control_plane.eks_cluster_certificate_authority\n  eks_cluster_endpoint         = module.control_plane.eks_cluster_endpoint\n  eks_cluster_name             = module.control_plane.eks_cluster_name\n  node_group_configurations    = var.node_group_configurations\n  workers_ami_id               = var.ami_id\n  workers_instance_type        = var.instance_type\n  workers_ssm_arn              = module.iam_roles.worker_nodes_ssm_policy_arn\n  cluster_kubeconfig           = module.control_plane.eks_kubeconfig\n  wait_for_kube_system_timeout = var.wait_for_kube_system_timeout\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">module \"calico_cni\" {\n  source = \"../../modules/calico-cni\"\n  cluster_kubeconfig = module.control_plane.eks_kubeconfig\n}\n\nmodule \"cluster_workers\" {\n  source                       = \"../../modules/cluster-creation/cluster-workers\"\n  depends_on                   = [module.calico_cni]\n  cf_vpc_stack                 = var.cf_vpc_stack\n  eks_certificate_authority    = module.control_plane.eks_cluster_certificate_authority\n  eks_cluster_endpoint         = module.control_plane.eks_cluster_endpoint\n  eks_cluster_name             = module.control_plane.eks_cluster_name\n  node_group_configurations    = var.node_group_configurations\n  workers_ami_id               = var.ami_id\n  workers_instance_type        = var.instance_type\n  workers_ssm_arn              = module.iam_roles.worker_nodes_ssm_policy_arn\n  cluster_kubeconfig           = module.control_plane.eks_kubeconfig\n  wait_for_kube_system_timeout = var.wait_for_kube_system_timeout\n}\n</code></pre></div>","answer":{"body":"The best way to achieve this would be to set, for example, a name parameter in your child module (such as the [`worker_name_prefix`](https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/b4fec0f7701f1017cc80226c11790c65bd141f27/modules/services/eks-workers/variables.tf#L207-L211)) in our eks workers module) to the version of CNI - or _something similar that will change everytime that CNI is deployed._\r\n\r\nThis way, Terraform will consider the name change a destructive and backward incompatible change, causing the dependent resources to be destroyed and re-created as you intend. ","bodyHTML":"<p dir=\"auto\">The best way to achieve this would be to set, for example, a name parameter in your child module (such as the <a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/b4fec0f7701f1017cc80226c11790c65bd141f27/modules/services/eks-workers/variables.tf#L207-L211\"><code class=\"notranslate\">worker_name_prefix</code></a>) in our eks workers module) to the version of CNI - or <em>something similar that will change everytime that CNI is deployed.</em></p>\n<p dir=\"auto\">This way, Terraform will consider the name change a destructive and backward incompatible change, causing the dependent resources to be destroyed and re-created as you intend.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "9933191460f67fe6b8014fda1b69ac35"
}
##DOCS-SOURCER-END -->
