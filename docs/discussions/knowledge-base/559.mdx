---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/559" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>How can I keep a &quot;local&quot; tf module next to/close to the terragrunt.hcl?</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AQzG_","number":559,"author":{"login":"pieterbreed"},"title":"How can I keep a \"local\" tf module next to/close to the terragrunt.hcl?","body":"\nHi, I'm fairly new to terragrunt, so apologies if I'm asking something with an obvious answer.\r\n\r\nI'm confused by this section in the [example tutorial](https://terragrunt.gruntwork.io/docs/getting-started/quick-start/):\r\n\r\n```\r\nstage\r\n├── terragrunt.hcl\r\n├── frontend-app\r\n│   ├── main.tf\r\n│   └── terragrunt.hcl\r\n└── mysql\r\n    ├── main.tf\r\n    └── terragrunt.hcl\r\n```\r\n\r\nThis seems to hint at a capability what I want, but I can't get it to work.\r\n\r\nI have some terraform modules that are fairly generic and shared over some terragrunt directories. I have them on the same filesystem (not in git). It looks more or less like this:\r\n\r\n```\r\n├── terraform\r\n│   └── modules\r\n│       ├── application-cache\r\n│       │   ├── main.tf\r\n│       ├── centralized-alarms\r\n│       │   ├── main.tf\r\n...\r\n└── terragrunt\r\n    ├── prodapp\r\n    │   ├── account.yaml\r\n    │   ├── appcache\r\n    │   │   ├── local\r\n    │   │   │   ├── main.tf\r\n    │   │   └── terragrunt.hcl\r\n```\r\n\r\nFor one of terragrunt.hcl files, I need a little bit of local customization in how a shared module (`application-cache`) is called. Specifically, one of the parameters that I just provide manually in the testing environment, instead needs to be read from a cloudformation output. So I have a little bit of local, environment-specific customization around invoking the shared/generic module. \r\n\r\nMy problem is I cannot figure out how to achieve this. I don't want to create another module in the \"shared\" modules directory which is specifically only serves as an \"entry point\" module for one specific environment. I'd rather keep the terraform code \"close\" to the terragrunt.hcl it applies to.\r\n\r\nI've tried to have the `main.tf` in the same folder as the `terragrunt.hcl` file like the example tutorial, which seems to imply that I must not have a `terraform { source ... }` block in `terragrunt.hcl`. But then the locals are not passed correctly to the variables I declare in the `main.tf` using the `input` block. When I run `terragrunt apply` it asks for the value of a variable that is declared in the `main.tf` and specified in the `terragrunt.hcl` file's `inputs`.\r\n\r\nI've also tried having a `./local` directory with `./local/main.tf`, attempting to treat it as a terraform module. In the `terragrunt.hcl` file I then specify `terraform { source = \".//local\" }` bit this fails with paths to the shared terraform modules not being resolved correctly.\r\n\r\n```\r\n| Error: Unreadable module directory\r\n│ \r\n│ Unable to evaluate directory symlink: lstat ../../../../terraform: no such\r\n│ file or directory\r\n```\r\n\r\nReally my question is, if I have shared terraform modules, and my environments have slight dissimilarities in how those shared modules are invoked, how must I structure the terragrunt repository to accomplish this?\n\n---\n\n<ins datetime=\"2022-09-19T11:55:36Z\">\n  <p><a href=\"https://support.gruntwork.io/hc/requests/109257\">Tracked in ticket #109257</a></p>\n</ins>\n","bodyHTML":"<p dir=\"auto\">Hi, I'm fairly new to terragrunt, so apologies if I'm asking something with an obvious answer.</p>\n<p dir=\"auto\">I'm confused by this section in the <a href=\"https://terragrunt.gruntwork.io/docs/getting-started/quick-start/\" rel=\"nofollow\">example tutorial</a>:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"stage\n├── terragrunt.hcl\n├── frontend-app\n│   ├── main.tf\n│   └── terragrunt.hcl\n└── mysql\n    ├── main.tf\n    └── terragrunt.hcl\"><pre class=\"notranslate\"><code class=\"notranslate\">stage\n├── terragrunt.hcl\n├── frontend-app\n│   ├── main.tf\n│   └── terragrunt.hcl\n└── mysql\n    ├── main.tf\n    └── terragrunt.hcl\n</code></pre></div>\n<p dir=\"auto\">This seems to hint at a capability what I want, but I can't get it to work.</p>\n<p dir=\"auto\">I have some terraform modules that are fairly generic and shared over some terragrunt directories. I have them on the same filesystem (not in git). It looks more or less like this:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"├── terraform\n│   └── modules\n│       ├── application-cache\n│       │   ├── main.tf\n│       ├── centralized-alarms\n│       │   ├── main.tf\n...\n└── terragrunt\n    ├── prodapp\n    │   ├── account.yaml\n    │   ├── appcache\n    │   │   ├── local\n    │   │   │   ├── main.tf\n    │   │   └── terragrunt.hcl\"><pre class=\"notranslate\"><code class=\"notranslate\">├── terraform\n│   └── modules\n│       ├── application-cache\n│       │   ├── main.tf\n│       ├── centralized-alarms\n│       │   ├── main.tf\n...\n└── terragrunt\n    ├── prodapp\n    │   ├── account.yaml\n    │   ├── appcache\n    │   │   ├── local\n    │   │   │   ├── main.tf\n    │   │   └── terragrunt.hcl\n</code></pre></div>\n<p dir=\"auto\">For one of terragrunt.hcl files, I need a little bit of local customization in how a shared module (<code class=\"notranslate\">application-cache</code>) is called. Specifically, one of the parameters that I just provide manually in the testing environment, instead needs to be read from a cloudformation output. So I have a little bit of local, environment-specific customization around invoking the shared/generic module.</p>\n<p dir=\"auto\">My problem is I cannot figure out how to achieve this. I don't want to create another module in the \"shared\" modules directory which is specifically only serves as an \"entry point\" module for one specific environment. I'd rather keep the terraform code \"close\" to the terragrunt.hcl it applies to.</p>\n<p dir=\"auto\">I've tried to have the <code class=\"notranslate\">main.tf</code> in the same folder as the <code class=\"notranslate\">terragrunt.hcl</code> file like the example tutorial, which seems to imply that I must not have a <code class=\"notranslate\">terraform { source ... }</code> block in <code class=\"notranslate\">terragrunt.hcl</code>. But then the locals are not passed correctly to the variables I declare in the <code class=\"notranslate\">main.tf</code> using the <code class=\"notranslate\">input</code> block. When I run <code class=\"notranslate\">terragrunt apply</code> it asks for the value of a variable that is declared in the <code class=\"notranslate\">main.tf</code> and specified in the <code class=\"notranslate\">terragrunt.hcl</code> file's <code class=\"notranslate\">inputs</code>.</p>\n<p dir=\"auto\">I've also tried having a <code class=\"notranslate\">./local</code> directory with <code class=\"notranslate\">./local/main.tf</code>, attempting to treat it as a terraform module. In the <code class=\"notranslate\">terragrunt.hcl</code> file I then specify <code class=\"notranslate\">terraform { source = \".//local\" }</code> bit this fails with paths to the shared terraform modules not being resolved correctly.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"| Error: Unreadable module directory\n│ \n│ Unable to evaluate directory symlink: lstat ../../../../terraform: no such\n│ file or directory\"><pre class=\"notranslate\"><code class=\"notranslate\">| Error: Unreadable module directory\n│ \n│ Unable to evaluate directory symlink: lstat ../../../../terraform: no such\n│ file or directory\n</code></pre></div>\n<p dir=\"auto\">Really my question is, if I have shared terraform modules, and my environments have slight dissimilarities in how those shared modules are invoked, how must I structure the terragrunt repository to accomplish this?</p>\n<hr>\n<ins datetime=\"2022-09-19T11:55:36Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/109257\" rel=\"nofollow\">Tracked in ticket #109257</a></p>\n</ins>","answer":{"body":"Hi,\r\nAFAIK, it depends on how big are dissimilarities:\r\n * can be used `dependency` block and outputs passed to `application-cache` - but it will require to extract terraform code as separated module and reference it in Terragrunt\r\n * can be used `generate` block to put custom code in the module directory before the invocation of Terraform\r\n\r\nReferences:\r\nhttps://terragrunt.gruntwork.io/docs/reference/config-blocks-and-attributes/#dependency\r\nhttps://terragrunt.gruntwork.io/docs/reference/config-blocks-and-attributes/#generate\r\n\r\nI also created some examples using `generate` and `dependency` in https://github.com/denis256/terragrunt-tests/tree/master/discussion-559\r\n\r\nI hope this helps\r\n","bodyHTML":"<p dir=\"auto\">Hi,<br>\nAFAIK, it depends on how big are dissimilarities:</p>\n<ul dir=\"auto\">\n<li>can be used <code class=\"notranslate\">dependency</code> block and outputs passed to <code class=\"notranslate\">application-cache</code> - but it will require to extract terraform code as separated module and reference it in Terragrunt</li>\n<li>can be used <code class=\"notranslate\">generate</code> block to put custom code in the module directory before the invocation of Terraform</li>\n</ul>\n<p dir=\"auto\">References:<br>\n<a href=\"https://terragrunt.gruntwork.io/docs/reference/config-blocks-and-attributes/#dependency\" rel=\"nofollow\">https://terragrunt.gruntwork.io/docs/reference/config-blocks-and-attributes/#dependency</a><br>\n<a href=\"https://terragrunt.gruntwork.io/docs/reference/config-blocks-and-attributes/#generate\" rel=\"nofollow\">https://terragrunt.gruntwork.io/docs/reference/config-blocks-and-attributes/#generate</a></p>\n<p dir=\"auto\">I also created some examples using <code class=\"notranslate\">generate</code> and <code class=\"notranslate\">dependency</code> in <a href=\"https://github.com/denis256/terragrunt-tests/tree/master/discussion-559\">https://github.com/denis256/terragrunt-tests/tree/master/discussion-559</a></p>\n<p dir=\"auto\">I hope this helps</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "40f2d96c2bb2dd955fa75c6faf965cd4"
}
##DOCS-SOURCER-END -->
