---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/655" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>ecs-deploy-runner is not authorized  (RA)</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84ASYoh","number":655,"author":{"login":"drafie"},"title":"ecs-deploy-runner is not authorized  (RA)","body":"\nWe are having an issue deploying an RDS instance in our RA.   When using the for-production example in the service catalog, we are able to terragrunt apply locally, but when committing the changes to the repo Github actions returns an error: access denied because no identify-based policy allows rds:DescribeDBSSubnetGroups action. \r\n\r\nWe have added RDS permissions to the deploy_permissions.yml and read_only_permissions.yml\r\n\r\nRDSDeployAccess:\r\n  effect: \"Allow\"\r\n  actions:\r\n  - \"rds:*\"\r\n  resources:\r\n  - \"*\"\r\nRDSReadOnlyAccess:\r\n  effect: \"Allow\"\r\n  actions:\r\n  - \"rds:Describe*\"\r\n  - \"rds:List*\"\r\n  - \"rds:Download*\"\r\n  resources:\r\n  - \"*\"\r\n\r\nBut still, we get this error: \r\n\r\nError: AccessDenied: User: arn:aws:sts::xxxxxxxx:assumed-role/ecs-deploy-runner-terraform-planner/xxxxxx is not authorized to perform: rds:DescribeDBSubnetGroups on resource: arn:aws:rds:us-east-1:xxxxxxxxx:subgrp:rds-xxxxx because no identity-based policy allows the rds:DescribeDBSubnetGroups action\r\nstatus code: 403, request id: f179d814-1dd7-4f5e-97db-c136883ae1db\r\nwith module.database.aws_db_subnet_group.db[0],\r\non .terraform/modules/database/modules/rds/main.tf line 397, in resource \"aws_db_subnet_group\" \"db\":\r\n397: resource \"aws_db_subnet_group\" \"db\" {\r\n\r\n\r\nWe copied these two files from the service catalog: \r\n\r\nhttps://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/_envcommon/data-stores/rds.hcl\r\n\r\nhttps://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/dev/us-west-2/dev/data-stores/rds/terragrunt.hcl\r\n\r\nAre we overlooking something obvious?\r\n\r\n\r\n\n\n---\n\n<ins datetime=\"2023-02-03T07:13:23Z\">\n  <p><a href=\"https://support.gruntwork.io/hc/requests/109862\">Tracked in ticket #109862</a></p>\n</ins>\n","bodyHTML":"<p dir=\"auto\">We are having an issue deploying an RDS instance in our RA.   When using the for-production example in the service catalog, we are able to terragrunt apply locally, but when committing the changes to the repo Github actions returns an error: access denied because no identify-based policy allows rds:DescribeDBSSubnetGroups action.</p>\n<p dir=\"auto\">We have added RDS permissions to the deploy_permissions.yml and read_only_permissions.yml</p>\n<p dir=\"auto\">RDSDeployAccess:<br>\neffect: \"Allow\"<br>\nactions:</p>\n<ul dir=\"auto\">\n<li>\"rds:*\"<br>\nresources:</li>\n<li>\"*\"<br>\nRDSReadOnlyAccess:<br>\neffect: \"Allow\"<br>\nactions:</li>\n<li>\"rds:Describe*\"</li>\n<li>\"rds:List*\"</li>\n<li>\"rds:Download*\"<br>\nresources:</li>\n<li>\"*\"</li>\n</ul>\n<p dir=\"auto\">But still, we get this error:</p>\n<p dir=\"auto\">Error: AccessDenied: User: arn:aws:sts::xxxxxxxx:assumed-role/ecs-deploy-runner-terraform-planner/xxxxxx is not authorized to perform: rds:DescribeDBSubnetGroups on resource: arn:aws:rds:us-east-1:xxxxxxxxx:subgrp:rds-xxxxx because no identity-based policy allows the rds:DescribeDBSubnetGroups action<br>\nstatus code: 403, request id: f179d814-1dd7-4f5e-97db-c136883ae1db<br>\nwith module.database.aws_db_subnet_group.db[0],<br>\non .terraform/modules/database/modules/rds/main.tf line 397, in resource \"aws_db_subnet_group\" \"db\":<br>\n397: resource \"aws_db_subnet_group\" \"db\" {</p>\n<p dir=\"auto\">We copied these two files from the service catalog:</p>\n<p dir=\"auto\"><a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/_envcommon/data-stores/rds.hcl\">https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/_envcommon/data-stores/rds.hcl</a></p>\n<p dir=\"auto\"><a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/dev/us-west-2/dev/data-stores/rds/terragrunt.hcl\">https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/dev/us-west-2/dev/data-stores/rds/terragrunt.hcl</a></p>\n<p dir=\"auto\">Are we overlooking something obvious?</p>\n<hr>\n<ins datetime=\"2023-02-03T07:13:23Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/109862\" rel=\"nofollow\">Tracked in ticket #109862</a></p>\n</ins>","answer":{"body":"Hi @drafie, I wonder if github has the permission to assume the role that has those permissions. When setting up the account baseline with the landingzone module, have you enabled `var.enable_github_actions_access`?\r\n\r\n\r\nIf you haven't yet, here are some varibles you might find useful from\r\nhttps://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/modules/landingzone/account-baseline-app/variables.tf :\r\n```\r\n# ---------------------------------------------------------------------------------------------------------------------\r\n# OPTIONAL EXTERNAL IAM ACCESS PARAMETERS\r\n# These variables have defaults, but may be overridden by the operator.\r\n# ---------------------------------------------------------------------------------------------------------------------\r\n\r\nvariable \"enable_github_actions_access\" {\r\n  description = \"When true, create an Open ID Connect Provider that GitHub actions can use to assume IAM roles in the account. Refer to https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/configuring-openid-connect-in-amazon-web-services for more information.\"\r\n  type        = bool\r\n  default     = false\r\n}\r\n\r\nvariable \"github_actions_openid_connect_provider_thumbprint_list\" {\r\n  description = \"When set, use the statically provided hardcoded list of thumbprints rather than looking it up dynamically. This is useful if you want to trade reliability of the OpenID Connect Provider across certificate renewals with a static list that is obtained using a trustworthy mechanism, to mitigate potential damage from a domain hijacking attack on GitHub domains.\"\r\n  type        = list(string)\r\n  default     = null\r\n}\r\nvariable \"allow_auto_deploy_from_github_actions_for_sources\" {\r\n  description = \"Map of github repositories to the list of branches that are allowed to assume the IAM role. The repository should be encoded as org/repo-name (e.g., gruntwork-io/terrraform-aws-ci). Allows GitHub Actions to assume the auto deploy IAM role using an OpenID Connect Provider for the given repositories. Refer to the docs for github-actions-iam-role for more information. Note that this is mutually exclusive with var.allow_auto_deploy_from_other_account_arns. Only used if var.enable_github_actions_access is true. \"\r\n  type        = map(list(string))\r\n  default     = {}\r\n  # Example:\r\n  # default = {\r\n  #   \"gruntwork-io/terraform-aws-security\" = [\"main\", \"dev\"]\r\n  # }\r\n}\r\n```\r\n\r\nYou might want to use them as input here if you want to enable it for all environments (\r\nhttps://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/_envcommon/landingzone/account-baseline-app-base.hcl) or use it somewhere else depending how you want to configure this. You can also find more information about enabling github actions on our [github-actions-iam-role module](https://github.com/gruntwork-io/terraform-aws-security/tree/main/modules/github-actions-iam-role).\r\n","bodyHTML":"<p dir=\"auto\">Hi <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/drafie/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/drafie\">@drafie</a>, I wonder if github has the permission to assume the role that has those permissions. When setting up the account baseline with the landingzone module, have you enabled <code class=\"notranslate\">var.enable_github_actions_access</code>?</p>\n<p dir=\"auto\">If you haven't yet, here are some varibles you might find useful from<br>\n<a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/modules/landingzone/account-baseline-app/variables.tf\">https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/modules/landingzone/account-baseline-app/variables.tf</a> :</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"# ---------------------------------------------------------------------------------------------------------------------\n# OPTIONAL EXTERNAL IAM ACCESS PARAMETERS\n# These variables have defaults, but may be overridden by the operator.\n# ---------------------------------------------------------------------------------------------------------------------\n\nvariable &quot;enable_github_actions_access&quot; {\n  description = &quot;When true, create an Open ID Connect Provider that GitHub actions can use to assume IAM roles in the account. Refer to https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/configuring-openid-connect-in-amazon-web-services for more information.&quot;\n  type        = bool\n  default     = false\n}\n\nvariable &quot;github_actions_openid_connect_provider_thumbprint_list&quot; {\n  description = &quot;When set, use the statically provided hardcoded list of thumbprints rather than looking it up dynamically. This is useful if you want to trade reliability of the OpenID Connect Provider across certificate renewals with a static list that is obtained using a trustworthy mechanism, to mitigate potential damage from a domain hijacking attack on GitHub domains.&quot;\n  type        = list(string)\n  default     = null\n}\nvariable &quot;allow_auto_deploy_from_github_actions_for_sources&quot; {\n  description = &quot;Map of github repositories to the list of branches that are allowed to assume the IAM role. The repository should be encoded as org/repo-name (e.g., gruntwork-io/terrraform-aws-ci). Allows GitHub Actions to assume the auto deploy IAM role using an OpenID Connect Provider for the given repositories. Refer to the docs for github-actions-iam-role for more information. Note that this is mutually exclusive with var.allow_auto_deploy_from_other_account_arns. Only used if var.enable_github_actions_access is true. &quot;\n  type        = map(list(string))\n  default     = {}\n  # Example:\n  # default = {\n  #   &quot;gruntwork-io/terraform-aws-security&quot; = [&quot;main&quot;, &quot;dev&quot;]\n  # }\n}\"><pre class=\"notranslate\"><code class=\"notranslate\"># ---------------------------------------------------------------------------------------------------------------------\n# OPTIONAL EXTERNAL IAM ACCESS PARAMETERS\n# These variables have defaults, but may be overridden by the operator.\n# ---------------------------------------------------------------------------------------------------------------------\n\nvariable \"enable_github_actions_access\" {\n  description = \"When true, create an Open ID Connect Provider that GitHub actions can use to assume IAM roles in the account. Refer to https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/configuring-openid-connect-in-amazon-web-services for more information.\"\n  type        = bool\n  default     = false\n}\n\nvariable \"github_actions_openid_connect_provider_thumbprint_list\" {\n  description = \"When set, use the statically provided hardcoded list of thumbprints rather than looking it up dynamically. This is useful if you want to trade reliability of the OpenID Connect Provider across certificate renewals with a static list that is obtained using a trustworthy mechanism, to mitigate potential damage from a domain hijacking attack on GitHub domains.\"\n  type        = list(string)\n  default     = null\n}\nvariable \"allow_auto_deploy_from_github_actions_for_sources\" {\n  description = \"Map of github repositories to the list of branches that are allowed to assume the IAM role. The repository should be encoded as org/repo-name (e.g., gruntwork-io/terrraform-aws-ci). Allows GitHub Actions to assume the auto deploy IAM role using an OpenID Connect Provider for the given repositories. Refer to the docs for github-actions-iam-role for more information. Note that this is mutually exclusive with var.allow_auto_deploy_from_other_account_arns. Only used if var.enable_github_actions_access is true. \"\n  type        = map(list(string))\n  default     = {}\n  # Example:\n  # default = {\n  #   \"gruntwork-io/terraform-aws-security\" = [\"main\", \"dev\"]\n  # }\n}\n</code></pre></div>\n<p dir=\"auto\">You might want to use them as input here if you want to enable it for all environments (<br>\n<a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/_envcommon/landingzone/account-baseline-app-base.hcl\">https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/_envcommon/landingzone/account-baseline-app-base.hcl</a>) or use it somewhere else depending how you want to configure this. You can also find more information about enabling github actions on our <a href=\"https://github.com/gruntwork-io/terraform-aws-security/tree/main/modules/github-actions-iam-role\">github-actions-iam-role module</a>.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "071df57375e10b3a602b90be7b481d51"
}
##DOCS-SOURCER-END -->
