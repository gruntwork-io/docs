---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/807" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Migrate users from account-baseline-security to iam-users-and-groups</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AYR31","number":807,"author":{"login":"justin-octo"},"title":"Migrate users from account-baseline-security to iam-users-and-groups","body":"\nTrying to move users out of security/_global/account-baseline (uses account-baseline-security) and into a new module security/_global/iam/users using iam-users-and-groups\r\n\r\nInitially we had our users deployed using terraform-aws-service-catalog/landingzone/account-baseline because we only had a few engineers/architects.  We have since added more users to our admin staff.  Managing the users has become very unwieldy using account-baseline-security.  And so we want to split off the users into a separate module and iam-users-adn-groups seems to be the best way.\r\nMy thought was to just move the users over and leave the groups (mostly just the CrossAccount groups).  We already had the users in a separate users.yml file.\r\nWhat's the best way to do this?\r\n\r\nI am trying to do a terragrunt state mv command, but when I try to do a terragrunt plan in the new folder/location it says: \r\n```\r\nError: resource address \"aws_iam_user.user\" does not exist in the configuration.\r\n```\r\n\r\nBut it is definitely in the users.yml file.  Thinking I just imported it wrong?\r\n\n\n---\n\n<ins datetime=\"2024-03-12T20:12:06Z\">\n  <p><a href=\"https://support.gruntwork.io/hc/requests/110818\">Tracked in ticket #110818</a></p>\n</ins>\n","bodyHTML":"<p dir=\"auto\">Trying to move users out of security/_global/account-baseline (uses account-baseline-security) and into a new module security/_global/iam/users using iam-users-and-groups</p>\n<p dir=\"auto\">Initially we had our users deployed using terraform-aws-service-catalog/landingzone/account-baseline because we only had a few engineers/architects.  We have since added more users to our admin staff.  Managing the users has become very unwieldy using account-baseline-security.  And so we want to split off the users into a separate module and iam-users-adn-groups seems to be the best way.<br>\nMy thought was to just move the users over and leave the groups (mostly just the CrossAccount groups).  We already had the users in a separate users.yml file.<br>\nWhat's the best way to do this?</p>\n<p dir=\"auto\">I am trying to do a terragrunt state mv command, but when I try to do a terragrunt plan in the new folder/location it says:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Error: resource address &quot;aws_iam_user.user&quot; does not exist in the configuration.\"><pre class=\"notranslate\"><code class=\"notranslate\">Error: resource address \"aws_iam_user.user\" does not exist in the configuration.\n</code></pre></div>\n<p dir=\"auto\">But it is definitely in the users.yml file.  Thinking I just imported it wrong?</p>\n<hr>\n<ins datetime=\"2024-03-12T20:12:06Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/110818\" rel=\"nofollow\">Tracked in ticket #110818</a></p>\n</ins>","answer":{"body":"New Steps:\r\n1. Backup state file in account-baseline\r\n```\r\ncd /work/infrastructure-live/security/_global/account-baseline\r\naws-vault exec security-profile -- terragrunt state pull > iam-users.tfstate\r\n```\r\n2. Download state file in iam-users iam-users.tfstate \r\n```\r\ncd /work/infrastructure-live/security/_global/iam/users/\r\naws-vault exec security-profile -- terragrunt state pull > iam-users.tfstate\r\n```\r\n3. From account-baseline, terragrunt state mv user and group memberships -state-out /work/infrastructure-live/security/_global/iam/users/iam-users.tfstate\r\n```\r\ncd /work/infrastructure-live/security/_global/account-baseline\r\naws-vault exec security-profile -- terragrunt state mv -state-out /work/infrastructure-live/security/_global/iam/users/iam-users.tfstate module.iam_users.aws_iam_user_group_membership.group_memberships[\\\"test.user\\\"] module.iam_users.aws_iam_user_group_membership.group_memberships[\\\"test.user\\\"]\r\naws-vault exec security-profile -- terragrunt state mv -state-out /work/infrastructure-live/security/_global/iam/users/iam-users.tfstate module.iam_users.aws_iam_user.user[\\\"test.user\\\"] module.iam_users.aws_iam_user.user[\\\"test.user\\\"]\r\naws-vault exec security-profile -- terragrunt state mv -state-out /work/infrastructure-live/security/_global/iam/users/iam-users.tfstate module.iam_users.aws_iam_user_login_profile.web_console[\\\"test.user\\\"] module.iam_users.aws_iam_user_login_profile.web_console[\\\"test.user\\\"]\r\n```\r\n5. Uncomment user in iam/users/users.yml AND comment out user from account-baseline/users.yml\r\n6. Push to remote state file in S3\r\n```\r\ncd /work/infrastructure-live/security/_global/iam/users/\r\naws-vault exec security-profile -- terragrunt state push /work/infrastructure-live/security/_global/iam/users/iam-users.tfstate\r\n```\r\n7. From /work/infrastructure-live/security/_global/iam/users/, run `aws-vault exec security-profile -- terragrunt plan` to verify \"no changes\"\r\n8. Fix things... if needed.\r\n9. If it is all good, Delete the local state file, `rm /work/infrastructure-live/security/_global/iam/users/iam-users.tfstate`","bodyHTML":"<p dir=\"auto\">New Steps:</p>\n<ol dir=\"auto\">\n<li>Backup state file in account-baseline</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"cd /work/infrastructure-live/security/_global/account-baseline\naws-vault exec security-profile -- terragrunt state pull &gt; iam-users.tfstate\"><pre class=\"notranslate\"><code class=\"notranslate\">cd /work/infrastructure-live/security/_global/account-baseline\naws-vault exec security-profile -- terragrunt state pull &gt; iam-users.tfstate\n</code></pre></div>\n<ol start=\"2\" dir=\"auto\">\n<li>Download state file in iam-users iam-users.tfstate</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"cd /work/infrastructure-live/security/_global/iam/users/\naws-vault exec security-profile -- terragrunt state pull &gt; iam-users.tfstate\"><pre class=\"notranslate\"><code class=\"notranslate\">cd /work/infrastructure-live/security/_global/iam/users/\naws-vault exec security-profile -- terragrunt state pull &gt; iam-users.tfstate\n</code></pre></div>\n<ol start=\"3\" dir=\"auto\">\n<li>From account-baseline, terragrunt state mv user and group memberships -state-out /work/infrastructure-live/security/_global/iam/users/iam-users.tfstate</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"cd /work/infrastructure-live/security/_global/account-baseline\naws-vault exec security-profile -- terragrunt state mv -state-out /work/infrastructure-live/security/_global/iam/users/iam-users.tfstate module.iam_users.aws_iam_user_group_membership.group_memberships[\\&quot;test.user\\&quot;] module.iam_users.aws_iam_user_group_membership.group_memberships[\\&quot;test.user\\&quot;]\naws-vault exec security-profile -- terragrunt state mv -state-out /work/infrastructure-live/security/_global/iam/users/iam-users.tfstate module.iam_users.aws_iam_user.user[\\&quot;test.user\\&quot;] module.iam_users.aws_iam_user.user[\\&quot;test.user\\&quot;]\naws-vault exec security-profile -- terragrunt state mv -state-out /work/infrastructure-live/security/_global/iam/users/iam-users.tfstate module.iam_users.aws_iam_user_login_profile.web_console[\\&quot;test.user\\&quot;] module.iam_users.aws_iam_user_login_profile.web_console[\\&quot;test.user\\&quot;]\"><pre class=\"notranslate\"><code class=\"notranslate\">cd /work/infrastructure-live/security/_global/account-baseline\naws-vault exec security-profile -- terragrunt state mv -state-out /work/infrastructure-live/security/_global/iam/users/iam-users.tfstate module.iam_users.aws_iam_user_group_membership.group_memberships[\\\"test.user\\\"] module.iam_users.aws_iam_user_group_membership.group_memberships[\\\"test.user\\\"]\naws-vault exec security-profile -- terragrunt state mv -state-out /work/infrastructure-live/security/_global/iam/users/iam-users.tfstate module.iam_users.aws_iam_user.user[\\\"test.user\\\"] module.iam_users.aws_iam_user.user[\\\"test.user\\\"]\naws-vault exec security-profile -- terragrunt state mv -state-out /work/infrastructure-live/security/_global/iam/users/iam-users.tfstate module.iam_users.aws_iam_user_login_profile.web_console[\\\"test.user\\\"] module.iam_users.aws_iam_user_login_profile.web_console[\\\"test.user\\\"]\n</code></pre></div>\n<ol start=\"5\" dir=\"auto\">\n<li>Uncomment user in iam/users/users.yml AND comment out user from account-baseline/users.yml</li>\n<li>Push to remote state file in S3</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"cd /work/infrastructure-live/security/_global/iam/users/\naws-vault exec security-profile -- terragrunt state push /work/infrastructure-live/security/_global/iam/users/iam-users.tfstate\"><pre class=\"notranslate\"><code class=\"notranslate\">cd /work/infrastructure-live/security/_global/iam/users/\naws-vault exec security-profile -- terragrunt state push /work/infrastructure-live/security/_global/iam/users/iam-users.tfstate\n</code></pre></div>\n<ol start=\"7\" dir=\"auto\">\n<li>From /work/infrastructure-live/security/_global/iam/users/, run <code class=\"notranslate\">aws-vault exec security-profile -- terragrunt plan</code> to verify \"no changes\"</li>\n<li>Fix things... if needed.</li>\n<li>If it is all good, Delete the local state file, <code class=\"notranslate\">rm /work/infrastructure-live/security/_global/iam/users/iam-users.tfstate</code></li>\n</ol>"}}} />

</CenterLayout>
  

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "9f16f01f1077f1b7ebd8f320bf848e3d"
}
##DOCS-SOURCER-END -->
