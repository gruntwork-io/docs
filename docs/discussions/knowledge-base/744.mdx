---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/744" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Unable to import Terraform existing resources into Terragrunt</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AUZCt","number":744,"author":{"login":"lpossamai"},"title":"Unable to import Terraform existing resources into Terragrunt","body":"\r\nFollowing up on https://github.com/orgs/gruntwork-io/discussions/740, I've started to implement Terragrunt into my existing (pure) Terraform repository.\r\n\r\nI have the following structure now:\r\n```\r\n├── config\r\n│   ├── _envcommon\r\n│   │   ├── vpc.hcl\r\n│   ├── Makefile\r\n├── environments\r\n│   └── test\r\n│       ├── ap-southeast-2\r\n│       │   ├── vpc\r\n│       │   │   ├── Makefile\r\n│       │   │   ├── terragrunt.hcl\r\n│       │   │   └── versions.tf\r\n│       │   └── region.hcl\r\n│       ├── env.hcl\r\n│       └── Makefile\r\n├── Makefile\r\n└── terragrunt.hcl\r\n```\r\n\r\nThe `config/_envcommon/vpc.hcl` file has the VPC module config:\r\n```HCL\r\nlocals {\r\n  # Automatically load environment-level variables\r\n  environment_vars = read_terragrunt_config(find_in_parent_folders(\"env.hcl\"))\r\n\r\n  # Automatically load region-level variables\r\n  region_vars = read_terragrunt_config(find_in_parent_folders(\"region.hcl\"))\r\n  aws_region  = local.region_vars.locals.aws_region\r\n\r\n  # Extract out common variables for reuse\r\n  env = local.environment_vars.locals.environment\r\n\r\n  # Expose the base source URL so different versions of the module can be deployed in different environments.\r\n  base_source_url = \"tfr:///terraform-aws-modules/vpc/aws//?version=4.0.0\"\r\n}\r\n\r\ninputs = {\r\n  # Public access to the database subnets; set the below to true\r\n  create_database_subnet_group           = false\r\n  create_database_subnet_route_table     = false\r\n  create_database_internet_gateway_route = false\r\n\r\n  manage_default_route_table = true\r\n  default_route_table_tags   = { DefaultRouteTable = true }\r\n\r\n  enable_dns_hostnames = true\r\n  enable_dns_support   = true\r\n\r\n  # If NOT PRODUCTION, we have one NAT Gateway per AZ\r\n  enable_nat_gateway     = true\r\n  single_nat_gateway     = local.env == \"production\" || local.env == \"staging\" ? false : true\r\n  one_nat_gateway_per_az = local.env == \"production\" || local.env == \"staging\" ? true : false\r\n\r\n  enable_vpn_gateway = local.env == \"production\" ? true : false\r\n\r\n  enable_dhcp_options              = false\r\n  dhcp_options_domain_name         = \"service.consul\"\r\n  dhcp_options_domain_name_servers = [\"127.0.0.1\", \"10.10.0.2\"]\r\n\r\n  # Default security group - ingress/egress rules cleared to deny all\r\n  manage_default_security_group  = true\r\n  default_security_group_ingress = [{\r\n    cidr_blocks = \"10.0.0.0/8\"\r\n    description = \"Allow all from the local network.\"\r\n    from_port   = 0\r\n    protocol    = \"-1\"\r\n    self        = false\r\n    to_port     = 0\r\n  }]\r\n  default_security_group_egress  = []\r\n\r\n  # VPC Flow Logs (Cloudwatch log group and IAM role will be created)\r\n  enable_flow_log                      = true\r\n  create_flow_log_cloudwatch_log_group = true\r\n  create_flow_log_cloudwatch_iam_role  = true\r\n  flow_log_max_aggregation_interval    = 60\r\n\r\n  private_subnet_tags = {\r\n    \"type\" = \"Private\"\r\n  }\r\n\r\n  public_subnet_tags = {\r\n    \"type\" = \"Public\"\r\n  }\r\n\r\n  database_subnet_tags = {\r\n    \"type\"    = \"Private\"\r\n    \"service\" = \"Database\"\r\n  }\r\n\r\n  elasticache_subnet_tags = {\r\n    \"type\"    = \"Public\"\r\n    \"service\" = \"ElastiCache\"\r\n  }\r\n}\r\n```\r\n\r\nAnd `environments/test/ap-southeast-2/vpc/terragrunt.hcl` has:\r\n```HCL\r\nlocals {\r\n  # Automatically load environment-level variables\r\n  environment_vars = read_terragrunt_config(find_in_parent_folders(\"env.hcl\"))\r\n\r\n  # Automatically load region-level variables\r\n  region_vars = read_terragrunt_config(find_in_parent_folders(\"region.hcl\"))\r\n  aws_region  = local.region_vars.locals.aws_region\r\n\r\n  # Extract out common variables for reuse\r\n  env        = local.environment_vars.locals.environment\r\n  account_id = local.environment_vars.locals.aws_account_id\r\n\r\n  # create a list of subnets\r\n  private_subnets_cidr = tolist(concat([local.environment_vars.locals.private_subnet_a, local.environment_vars.locals.private_subnet_b, local.environment_vars.locals.private_subnet_c]))\r\n  public_subnets_cidr = concat([local.environment_vars.locals.public_subnet_a, local.environment_vars.locals.public_subnet_b, local.environment_vars.locals.public_subnet_c])\r\n  database_subnets_cidr = concat([local.environment_vars.locals.database_subnet_a, local.environment_vars.locals.database_subnet_b, local.environment_vars.locals.database_subnet_c])\r\n  elasticache_subnets_cidr = concat([local.environment_vars.locals.elasticache_subnet_a, local.environment_vars.locals.elasticache_subnet_b, local.environment_vars.locals.elasticache_subnet_c])\r\n  infra_subnets_cidr = concat([local.environment_vars.locals.infra_subnet_a, local.environment_vars.locals.infra_subnet_b, local.environment_vars.locals.infra_subnet_c])\r\n\r\n  # Extract out workspace variables for reuse\r\n  VPC_CIDR = local.environment_vars.locals.VPC_CIDR\r\n}\r\n\r\nterraform {\r\n  source = \"${include.envcommon.locals.base_source_url}\"\r\n}\r\n\r\ninclude \"root\" {\r\n  path = find_in_parent_folders()\r\n}\r\n\r\ninclude \"envcommon\" {\r\n  path   = \"${dirname(find_in_parent_folders())}/config/_envcommon/vpc.hcl\"\r\n  expose = true\r\n}\r\n\r\ninputs = {\r\n  name = \"example-${local.env}-VPC\"\r\n  cidr = local.VPC_CIDR # 10.0.0.0/8 is reserved for EC2-Classic\r\n\r\n  azs                 = [\"${local.aws_region}a\", \"${local.aws_region}b\", \"${local.aws_region}c\"]\r\n  private_subnets     = local.private_subnets_cidr\r\n  public_subnets      = local.public_subnets_cidr\r\n  database_subnets    = local.database_subnets_cidr\r\n  elasticache_subnets = local.elasticache_subnets_cidr\r\n  intra_subnets       = local.infra_subnets_cidr\r\n}\r\n```\r\n\r\nI was able to successfully import the VPC and its subnets:\r\n```\r\n 2535* terragrunt import \"aws_subnet.private[0]\" subnet-XXX\r\n 2536* terragrunt import \"aws_subnet.private[1]\" subnet-XXX\r\n 2537* terragrunt import \"aws_subnet.private[2]\" subnet-XXX\r\n 2538* terragrunt import \"aws_subnet.public[0]\" subnet-XXX\r\n 2539* terragrunt import \"aws_subnet.public[1]\" subnet-XXX\r\n```\r\n\r\nNow, when trying to import one of the `aws_route_table` resources, I get the following error:\r\n```\r\nterragrunt import \"aws_route_table.public[0]\" rtb-XXX\r\n\r\nError: resource address \"aws_route_table.public[0]\" does not exist in the configuration.\r\n\r\nBefore importing this resource, please create its configuration in the root module. For example:\r\n\r\nresource \"aws_route_table\" \"public\" {\r\n  # (resource arguments)\r\n}\r\n```\r\n\r\nIf I run `terragrunt plan` in the `environments/test/ap-southeast-2/vpc/` directory, I can see it is trying to add that same resource:\r\n```\r\n  # aws_route_table.public[0] will be created\r\n  + resource \"aws_route_table\" \"public\" {\r\n      + arn              = (known after apply)\r\n      + id               = (known after apply)\r\n      + owner_id         = (known after apply)\r\n      + propagating_vgws = (known after apply)\r\n      + route            = (known after apply)\r\n      + tags             = {\r\n          + \"Name\" = \"example-test-VPC-public\"\r\n        }\r\n      + tags_all         = {\r\n          + \"Name\" = \"example-test-VPC-public\"\r\n        }\r\n      + vpc_id           = \"vpc-XXX\"\r\n    }\r\n```\r\n\r\nWhat am I missing here?\r\n\r\n---\r\n\r\n<ins datetime=\"2023-06-27T22:03:11Z\">\r\n  <p><a href=\"https://support.gruntwork.io/hc/requests/110306\">Tracked in ticket #110306</a></p>\r\n</ins>\r\n","bodyHTML":"<p dir=\"auto\">Following up on <a href=\"https://github.com/orgs/gruntwork-io/discussions/740\">https://github.com/orgs/gruntwork-io/discussions/740</a>, I've started to implement Terragrunt into my existing (pure) Terraform repository.</p>\n<p dir=\"auto\">I have the following structure now:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"├── config\n│   ├── _envcommon\n│   │   ├── vpc.hcl\n│   ├── Makefile\n├── environments\n│   └── test\n│       ├── ap-southeast-2\n│       │   ├── vpc\n│       │   │   ├── Makefile\n│       │   │   ├── terragrunt.hcl\n│       │   │   └── versions.tf\n│       │   └── region.hcl\n│       ├── env.hcl\n│       └── Makefile\n├── Makefile\n└── terragrunt.hcl\"><pre class=\"notranslate\"><code class=\"notranslate\">├── config\n│   ├── _envcommon\n│   │   ├── vpc.hcl\n│   ├── Makefile\n├── environments\n│   └── test\n│       ├── ap-southeast-2\n│       │   ├── vpc\n│       │   │   ├── Makefile\n│       │   │   ├── terragrunt.hcl\n│       │   │   └── versions.tf\n│       │   └── region.hcl\n│       ├── env.hcl\n│       └── Makefile\n├── Makefile\n└── terragrunt.hcl\n</code></pre></div>\n<p dir=\"auto\">The <code class=\"notranslate\">config/_envcommon/vpc.hcl</code> file has the VPC module config:</p>\n<div class=\"highlight highlight-source-hcl notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"locals {\n  # Automatically load environment-level variables\n  environment_vars = read_terragrunt_config(find_in_parent_folders(&quot;env.hcl&quot;))\n\n  # Automatically load region-level variables\n  region_vars = read_terragrunt_config(find_in_parent_folders(&quot;region.hcl&quot;))\n  aws_region  = local.region_vars.locals.aws_region\n\n  # Extract out common variables for reuse\n  env = local.environment_vars.locals.environment\n\n  # Expose the base source URL so different versions of the module can be deployed in different environments.\n  base_source_url = &quot;tfr:///terraform-aws-modules/vpc/aws//?version=4.0.0&quot;\n}\n\ninputs = {\n  # Public access to the database subnets; set the below to true\n  create_database_subnet_group           = false\n  create_database_subnet_route_table     = false\n  create_database_internet_gateway_route = false\n\n  manage_default_route_table = true\n  default_route_table_tags   = { DefaultRouteTable = true }\n\n  enable_dns_hostnames = true\n  enable_dns_support   = true\n\n  # If NOT PRODUCTION, we have one NAT Gateway per AZ\n  enable_nat_gateway     = true\n  single_nat_gateway     = local.env == &quot;production&quot; || local.env == &quot;staging&quot; ? false : true\n  one_nat_gateway_per_az = local.env == &quot;production&quot; || local.env == &quot;staging&quot; ? true : false\n\n  enable_vpn_gateway = local.env == &quot;production&quot; ? true : false\n\n  enable_dhcp_options              = false\n  dhcp_options_domain_name         = &quot;service.consul&quot;\n  dhcp_options_domain_name_servers = [&quot;127.0.0.1&quot;, &quot;10.10.0.2&quot;]\n\n  # Default security group - ingress/egress rules cleared to deny all\n  manage_default_security_group  = true\n  default_security_group_ingress = [{\n    cidr_blocks = &quot;10.0.0.0/8&quot;\n    description = &quot;Allow all from the local network.&quot;\n    from_port   = 0\n    protocol    = &quot;-1&quot;\n    self        = false\n    to_port     = 0\n  }]\n  default_security_group_egress  = []\n\n  # VPC Flow Logs (Cloudwatch log group and IAM role will be created)\n  enable_flow_log                      = true\n  create_flow_log_cloudwatch_log_group = true\n  create_flow_log_cloudwatch_iam_role  = true\n  flow_log_max_aggregation_interval    = 60\n\n  private_subnet_tags = {\n    &quot;type&quot; = &quot;Private&quot;\n  }\n\n  public_subnet_tags = {\n    &quot;type&quot; = &quot;Public&quot;\n  }\n\n  database_subnet_tags = {\n    &quot;type&quot;    = &quot;Private&quot;\n    &quot;service&quot; = &quot;Database&quot;\n  }\n\n  elasticache_subnet_tags = {\n    &quot;type&quot;    = &quot;Public&quot;\n    &quot;service&quot; = &quot;ElastiCache&quot;\n  }\n}\"><pre class=\"notranslate\"><span class=\"pl-en\">locals</span> {\n  <span class=\"pl-c\"><span class=\"pl-c\">#</span> Automatically load environment-level variables<span class=\"pl-c\"></span></span>\n  <span class=\"pl-v\"><span class=\"pl-smi\">environment_vars</span> <span class=\"pl-k\">=</span> </span><span class=\"pl-c1\">read_terragrunt_config</span>(<span class=\"pl-c1\">find_in_parent_folders</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>env.hcl<span class=\"pl-pds\">\"</span></span>))\n\n  <span class=\"pl-c\"><span class=\"pl-c\">#</span> Automatically load region-level variables<span class=\"pl-c\"></span></span>\n  <span class=\"pl-v\"><span class=\"pl-smi\">region_vars</span> <span class=\"pl-k\">=</span> </span><span class=\"pl-c1\">read_terragrunt_config</span>(<span class=\"pl-c1\">find_in_parent_folders</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>region.hcl<span class=\"pl-pds\">\"</span></span>))\n  <span class=\"pl-v\"><span class=\"pl-smi\">aws_region</span>  <span class=\"pl-k\">=</span> </span>local<span class=\"pl-k\">.</span><span class=\"pl-smi\">region_vars</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">locals</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">aws_region</span>\n\n  <span class=\"pl-c\"><span class=\"pl-c\">#</span> Extract out common variables for reuse<span class=\"pl-c\"></span></span>\n  <span class=\"pl-v\"><span class=\"pl-smi\">env</span> <span class=\"pl-k\">=</span> </span>local<span class=\"pl-k\">.</span><span class=\"pl-smi\">environment_vars</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">locals</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">environment</span>\n\n  <span class=\"pl-c\"><span class=\"pl-c\">#</span> Expose the base source URL so different versions of the module can be deployed in different environments.<span class=\"pl-c\"></span></span>\n  <span class=\"pl-v\"><span class=\"pl-smi\">base_source_url</span> <span class=\"pl-k\">=</span> </span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>tfr:///terraform-aws-modules/vpc/aws//?version=4.0.0<span class=\"pl-pds\">\"</span></span>\n}\n\n<span class=\"pl-v\"><span class=\"pl-smi\">inputs</span> <span class=\"pl-k\">=</span> </span>{\n  <span class=\"pl-c\"><span class=\"pl-c\">#</span> Public access to the database subnets; set the below to true<span class=\"pl-c\"></span></span>\n  create_database_subnet_group           <span class=\"pl-k\">=</span> <span class=\"pl-c1\">false</span>\n  create_database_subnet_route_table     <span class=\"pl-k\">=</span> <span class=\"pl-c1\">false</span>\n  create_database_internet_gateway_route <span class=\"pl-k\">=</span> <span class=\"pl-c1\">false</span>\n\n  manage_default_route_table <span class=\"pl-k\">=</span> <span class=\"pl-c1\">true</span>\n  default_route_table_tags   <span class=\"pl-k\">=</span> { DefaultRouteTable <span class=\"pl-k\">=</span> <span class=\"pl-c1\">true</span> }\n\n  enable_dns_hostnames <span class=\"pl-k\">=</span> <span class=\"pl-c1\">true</span>\n  enable_dns_support   <span class=\"pl-k\">=</span> <span class=\"pl-c1\">true</span>\n\n  <span class=\"pl-c\"><span class=\"pl-c\">#</span> If NOT PRODUCTION, we have one NAT Gateway per AZ<span class=\"pl-c\"></span></span>\n  enable_nat_gateway     <span class=\"pl-k\">=</span> <span class=\"pl-c1\">true</span>\n  single_nat_gateway     <span class=\"pl-k\">=</span> local.env <span class=\"pl-k\">==</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>production<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">||</span> local.env <span class=\"pl-k\">==</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>staging<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">?</span> <span class=\"pl-c1\">false</span> <span class=\"pl-k\">:</span> <span class=\"pl-c1\">true</span>\n  one_nat_gateway_per_az <span class=\"pl-k\">=</span> local.env <span class=\"pl-k\">==</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>production<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">||</span> local.env <span class=\"pl-k\">==</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>staging<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">?</span> <span class=\"pl-c1\">true</span> <span class=\"pl-k\">:</span> <span class=\"pl-c1\">false</span>\n\n  enable_vpn_gateway <span class=\"pl-k\">=</span> local.env <span class=\"pl-k\">==</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>production<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">?</span> <span class=\"pl-c1\">true</span> <span class=\"pl-k\">:</span> <span class=\"pl-c1\">false</span>\n\n  enable_dhcp_options              <span class=\"pl-k\">=</span> <span class=\"pl-c1\">false</span>\n  dhcp_options_domain_name         <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>service.consul<span class=\"pl-pds\">\"</span></span>\n  dhcp_options_domain_name_servers <span class=\"pl-k\">=</span> [<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>127.0.0.1<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>10.10.0.2<span class=\"pl-pds\">\"</span></span>]\n\n  <span class=\"pl-c\"><span class=\"pl-c\">#</span> Default security group - ingress/egress rules cleared to deny all<span class=\"pl-c\"></span></span>\n  manage_default_security_group  <span class=\"pl-k\">=</span> <span class=\"pl-c1\">true</span>\n  default_security_group_ingress <span class=\"pl-k\">=</span> [{\n    cidr_blocks <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>10.0.0.0/8<span class=\"pl-pds\">\"</span></span>\n    description <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Allow all from the local network.<span class=\"pl-pds\">\"</span></span>\n    from_port   <span class=\"pl-k\">=</span> <span class=\"pl-c1\">0</span>\n    protocol    <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>-1<span class=\"pl-pds\">\"</span></span>\n    self        <span class=\"pl-k\">=</span> <span class=\"pl-c1\">false</span>\n    to_port     <span class=\"pl-k\">=</span> <span class=\"pl-c1\">0</span>\n  }]\n  default_security_group_egress  <span class=\"pl-k\">=</span> []\n\n  <span class=\"pl-c\"><span class=\"pl-c\">#</span> VPC Flow Logs (Cloudwatch log group and IAM role will be created)<span class=\"pl-c\"></span></span>\n  enable_flow_log                      <span class=\"pl-k\">=</span> <span class=\"pl-c1\">true</span>\n  create_flow_log_cloudwatch_log_group <span class=\"pl-k\">=</span> <span class=\"pl-c1\">true</span>\n  create_flow_log_cloudwatch_iam_role  <span class=\"pl-k\">=</span> <span class=\"pl-c1\">true</span>\n  flow_log_max_aggregation_interval    <span class=\"pl-k\">=</span> <span class=\"pl-c1\">60</span>\n\n  private_subnet_tags <span class=\"pl-k\">=</span> {\n    <span class=\"pl-pds\">\"</span>type<span class=\"pl-pds\">\"</span> <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Private<span class=\"pl-pds\">\"</span></span>\n  }\n\n  public_subnet_tags <span class=\"pl-k\">=</span> {\n    <span class=\"pl-pds\">\"</span>type<span class=\"pl-pds\">\"</span> <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Public<span class=\"pl-pds\">\"</span></span>\n  }\n\n  database_subnet_tags <span class=\"pl-k\">=</span> {\n    <span class=\"pl-pds\">\"</span>type<span class=\"pl-pds\">\"</span>    <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Private<span class=\"pl-pds\">\"</span></span>\n    <span class=\"pl-pds\">\"</span>service<span class=\"pl-pds\">\"</span> <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Database<span class=\"pl-pds\">\"</span></span>\n  }\n\n  elasticache_subnet_tags <span class=\"pl-k\">=</span> {\n    <span class=\"pl-pds\">\"</span>type<span class=\"pl-pds\">\"</span>    <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Public<span class=\"pl-pds\">\"</span></span>\n    <span class=\"pl-pds\">\"</span>service<span class=\"pl-pds\">\"</span> <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>ElastiCache<span class=\"pl-pds\">\"</span></span>\n  }\n}</pre></div>\n<p dir=\"auto\">And <code class=\"notranslate\">environments/test/ap-southeast-2/vpc/terragrunt.hcl</code> has:</p>\n<div class=\"highlight highlight-source-hcl notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"locals {\n  # Automatically load environment-level variables\n  environment_vars = read_terragrunt_config(find_in_parent_folders(&quot;env.hcl&quot;))\n\n  # Automatically load region-level variables\n  region_vars = read_terragrunt_config(find_in_parent_folders(&quot;region.hcl&quot;))\n  aws_region  = local.region_vars.locals.aws_region\n\n  # Extract out common variables for reuse\n  env        = local.environment_vars.locals.environment\n  account_id = local.environment_vars.locals.aws_account_id\n\n  # create a list of subnets\n  private_subnets_cidr = tolist(concat([local.environment_vars.locals.private_subnet_a, local.environment_vars.locals.private_subnet_b, local.environment_vars.locals.private_subnet_c]))\n  public_subnets_cidr = concat([local.environment_vars.locals.public_subnet_a, local.environment_vars.locals.public_subnet_b, local.environment_vars.locals.public_subnet_c])\n  database_subnets_cidr = concat([local.environment_vars.locals.database_subnet_a, local.environment_vars.locals.database_subnet_b, local.environment_vars.locals.database_subnet_c])\n  elasticache_subnets_cidr = concat([local.environment_vars.locals.elasticache_subnet_a, local.environment_vars.locals.elasticache_subnet_b, local.environment_vars.locals.elasticache_subnet_c])\n  infra_subnets_cidr = concat([local.environment_vars.locals.infra_subnet_a, local.environment_vars.locals.infra_subnet_b, local.environment_vars.locals.infra_subnet_c])\n\n  # Extract out workspace variables for reuse\n  VPC_CIDR = local.environment_vars.locals.VPC_CIDR\n}\n\nterraform {\n  source = &quot;${include.envcommon.locals.base_source_url}&quot;\n}\n\ninclude &quot;root&quot; {\n  path = find_in_parent_folders()\n}\n\ninclude &quot;envcommon&quot; {\n  path   = &quot;${dirname(find_in_parent_folders())}/config/_envcommon/vpc.hcl&quot;\n  expose = true\n}\n\ninputs = {\n  name = &quot;example-${local.env}-VPC&quot;\n  cidr = local.VPC_CIDR # 10.0.0.0/8 is reserved for EC2-Classic\n\n  azs                 = [&quot;${local.aws_region}a&quot;, &quot;${local.aws_region}b&quot;, &quot;${local.aws_region}c&quot;]\n  private_subnets     = local.private_subnets_cidr\n  public_subnets      = local.public_subnets_cidr\n  database_subnets    = local.database_subnets_cidr\n  elasticache_subnets = local.elasticache_subnets_cidr\n  intra_subnets       = local.infra_subnets_cidr\n}\"><pre class=\"notranslate\"><span class=\"pl-en\">locals</span> {\n  <span class=\"pl-c\"><span class=\"pl-c\">#</span> Automatically load environment-level variables<span class=\"pl-c\"></span></span>\n  <span class=\"pl-v\"><span class=\"pl-smi\">environment_vars</span> <span class=\"pl-k\">=</span> </span><span class=\"pl-c1\">read_terragrunt_config</span>(<span class=\"pl-c1\">find_in_parent_folders</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>env.hcl<span class=\"pl-pds\">\"</span></span>))\n\n  <span class=\"pl-c\"><span class=\"pl-c\">#</span> Automatically load region-level variables<span class=\"pl-c\"></span></span>\n  <span class=\"pl-v\"><span class=\"pl-smi\">region_vars</span> <span class=\"pl-k\">=</span> </span><span class=\"pl-c1\">read_terragrunt_config</span>(<span class=\"pl-c1\">find_in_parent_folders</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>region.hcl<span class=\"pl-pds\">\"</span></span>))\n  <span class=\"pl-v\"><span class=\"pl-smi\">aws_region</span>  <span class=\"pl-k\">=</span> </span>local<span class=\"pl-k\">.</span><span class=\"pl-smi\">region_vars</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">locals</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">aws_region</span>\n\n  <span class=\"pl-c\"><span class=\"pl-c\">#</span> Extract out common variables for reuse<span class=\"pl-c\"></span></span>\n  <span class=\"pl-v\"><span class=\"pl-smi\">env</span>        <span class=\"pl-k\">=</span> </span>local<span class=\"pl-k\">.</span><span class=\"pl-smi\">environment_vars</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">locals</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">environment</span>\n  <span class=\"pl-v\"><span class=\"pl-smi\">account_id</span> <span class=\"pl-k\">=</span> </span>local<span class=\"pl-k\">.</span><span class=\"pl-smi\">environment_vars</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">locals</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">aws_account_id</span>\n\n  <span class=\"pl-c\"><span class=\"pl-c\">#</span> create a list of subnets<span class=\"pl-c\"></span></span>\n  <span class=\"pl-v\"><span class=\"pl-smi\">private_subnets_cidr</span> <span class=\"pl-k\">=</span> </span><span class=\"pl-c1\">tolist</span>(<span class=\"pl-c1\">concat</span>([<span class=\"pl-smi\">local</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">environment_vars</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">locals</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">private_subnet_a</span>, <span class=\"pl-smi\">local</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">environment_vars</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">locals</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">private_subnet_b</span>, <span class=\"pl-smi\">local</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">environment_vars</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">locals</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">private_subnet_c</span>]))\n  <span class=\"pl-v\"><span class=\"pl-smi\">public_subnets_cidr</span> <span class=\"pl-k\">=</span> </span><span class=\"pl-c1\">concat</span>([<span class=\"pl-smi\">local</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">environment_vars</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">locals</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">public_subnet_a</span>, <span class=\"pl-smi\">local</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">environment_vars</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">locals</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">public_subnet_b</span>, <span class=\"pl-smi\">local</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">environment_vars</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">locals</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">public_subnet_c</span>])\n  <span class=\"pl-v\"><span class=\"pl-smi\">database_subnets_cidr</span> <span class=\"pl-k\">=</span> </span><span class=\"pl-c1\">concat</span>([<span class=\"pl-smi\">local</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">environment_vars</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">locals</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">database_subnet_a</span>, <span class=\"pl-smi\">local</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">environment_vars</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">locals</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">database_subnet_b</span>, <span class=\"pl-smi\">local</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">environment_vars</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">locals</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">database_subnet_c</span>])\n  <span class=\"pl-v\"><span class=\"pl-smi\">elasticache_subnets_cidr</span> <span class=\"pl-k\">=</span> </span><span class=\"pl-c1\">concat</span>([<span class=\"pl-smi\">local</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">environment_vars</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">locals</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">elasticache_subnet_a</span>, <span class=\"pl-smi\">local</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">environment_vars</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">locals</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">elasticache_subnet_b</span>, <span class=\"pl-smi\">local</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">environment_vars</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">locals</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">elasticache_subnet_c</span>])\n  <span class=\"pl-v\"><span class=\"pl-smi\">infra_subnets_cidr</span> <span class=\"pl-k\">=</span> </span><span class=\"pl-c1\">concat</span>([<span class=\"pl-smi\">local</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">environment_vars</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">locals</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">infra_subnet_a</span>, <span class=\"pl-smi\">local</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">environment_vars</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">locals</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">infra_subnet_b</span>, <span class=\"pl-smi\">local</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">environment_vars</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">locals</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">infra_subnet_c</span>])\n\n  <span class=\"pl-c\"><span class=\"pl-c\">#</span> Extract out workspace variables for reuse<span class=\"pl-c\"></span></span>\n  <span class=\"pl-v\"><span class=\"pl-smi\">VPC_CIDR</span> <span class=\"pl-k\">=</span> </span>local<span class=\"pl-k\">.</span><span class=\"pl-smi\">environment_vars</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">locals</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">VPC_CIDR</span>\n}\n\n<span class=\"pl-en\">terraform</span> {\n  <span class=\"pl-v\"><span class=\"pl-smi\">source</span> <span class=\"pl-k\">=</span> </span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-k\">${</span><span class=\"pl-smi\">include</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">envcommon</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">locals</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">base_source_url</span><span class=\"pl-k\">}</span><span class=\"pl-pds\">\"</span></span>\n}\n\n<span class=\"pl-en\">include</span> <span class=\"pl-smi\">\"root\"</span> {\n  <span class=\"pl-v\"><span class=\"pl-smi\">path</span> <span class=\"pl-k\">=</span> </span><span class=\"pl-c1\">find_in_parent_folders</span>()\n}\n\n<span class=\"pl-en\">include</span> <span class=\"pl-smi\">\"envcommon\"</span> {\n  <span class=\"pl-v\"><span class=\"pl-smi\">path</span>   <span class=\"pl-k\">=</span> </span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-k\">${</span><span class=\"pl-c1\">dirname</span>(<span class=\"pl-c1\">find_in_parent_folders</span>())<span class=\"pl-k\">}</span>/config/_envcommon/vpc.hcl<span class=\"pl-pds\">\"</span></span>\n  <span class=\"pl-v\"><span class=\"pl-smi\">expose</span> <span class=\"pl-k\">=</span> </span><span class=\"pl-c1\">true</span>\n}\n\n<span class=\"pl-v\"><span class=\"pl-smi\">inputs</span> <span class=\"pl-k\">=</span> </span>{\n  name <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>example-<span class=\"pl-k\">${</span><span class=\"pl-smi\">local</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">env</span><span class=\"pl-k\">}</span>-VPC<span class=\"pl-pds\">\"</span></span>\n  cidr <span class=\"pl-k\">=</span> local.VPC_CIDR <span class=\"pl-c\"><span class=\"pl-c\">#</span> 10.0.0.0/8 is reserved for EC2-Classic<span class=\"pl-c\"></span></span>\n\n  azs                 <span class=\"pl-k\">=</span> [<span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-k\">${</span><span class=\"pl-smi\">local</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">aws_region</span><span class=\"pl-k\">}</span>a<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-k\">${</span><span class=\"pl-smi\">local</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">aws_region</span><span class=\"pl-k\">}</span>b<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-k\">${</span><span class=\"pl-smi\">local</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">aws_region</span><span class=\"pl-k\">}</span>c<span class=\"pl-pds\">\"</span></span>]\n  private_subnets     <span class=\"pl-k\">=</span> local.private_subnets_cidr\n  public_subnets      <span class=\"pl-k\">=</span> local.public_subnets_cidr\n  database_subnets    <span class=\"pl-k\">=</span> local.database_subnets_cidr\n  elasticache_subnets <span class=\"pl-k\">=</span> local.elasticache_subnets_cidr\n  intra_subnets       <span class=\"pl-k\">=</span> local.infra_subnets_cidr\n}</pre></div>\n<p dir=\"auto\">I was able to successfully import the VPC and its subnets:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\" 2535* terragrunt import &quot;aws_subnet.private[0]&quot; subnet-XXX\n 2536* terragrunt import &quot;aws_subnet.private[1]&quot; subnet-XXX\n 2537* terragrunt import &quot;aws_subnet.private[2]&quot; subnet-XXX\n 2538* terragrunt import &quot;aws_subnet.public[0]&quot; subnet-XXX\n 2539* terragrunt import &quot;aws_subnet.public[1]&quot; subnet-XXX\"><pre class=\"notranslate\"><code class=\"notranslate\"> 2535* terragrunt import \"aws_subnet.private[0]\" subnet-XXX\n 2536* terragrunt import \"aws_subnet.private[1]\" subnet-XXX\n 2537* terragrunt import \"aws_subnet.private[2]\" subnet-XXX\n 2538* terragrunt import \"aws_subnet.public[0]\" subnet-XXX\n 2539* terragrunt import \"aws_subnet.public[1]\" subnet-XXX\n</code></pre></div>\n<p dir=\"auto\">Now, when trying to import one of the <code class=\"notranslate\">aws_route_table</code> resources, I get the following error:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"terragrunt import &quot;aws_route_table.public[0]&quot; rtb-XXX\n\nError: resource address &quot;aws_route_table.public[0]&quot; does not exist in the configuration.\n\nBefore importing this resource, please create its configuration in the root module. For example:\n\nresource &quot;aws_route_table&quot; &quot;public&quot; {\n  # (resource arguments)\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">terragrunt import \"aws_route_table.public[0]\" rtb-XXX\n\nError: resource address \"aws_route_table.public[0]\" does not exist in the configuration.\n\nBefore importing this resource, please create its configuration in the root module. For example:\n\nresource \"aws_route_table\" \"public\" {\n  # (resource arguments)\n}\n</code></pre></div>\n<p dir=\"auto\">If I run <code class=\"notranslate\">terragrunt plan</code> in the <code class=\"notranslate\">environments/test/ap-southeast-2/vpc/</code> directory, I can see it is trying to add that same resource:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  # aws_route_table.public[0] will be created\n  + resource &quot;aws_route_table&quot; &quot;public&quot; {\n      + arn              = (known after apply)\n      + id               = (known after apply)\n      + owner_id         = (known after apply)\n      + propagating_vgws = (known after apply)\n      + route            = (known after apply)\n      + tags             = {\n          + &quot;Name&quot; = &quot;example-test-VPC-public&quot;\n        }\n      + tags_all         = {\n          + &quot;Name&quot; = &quot;example-test-VPC-public&quot;\n        }\n      + vpc_id           = &quot;vpc-XXX&quot;\n    }\"><pre class=\"notranslate\"><code class=\"notranslate\">  # aws_route_table.public[0] will be created\n  + resource \"aws_route_table\" \"public\" {\n      + arn              = (known after apply)\n      + id               = (known after apply)\n      + owner_id         = (known after apply)\n      + propagating_vgws = (known after apply)\n      + route            = (known after apply)\n      + tags             = {\n          + \"Name\" = \"example-test-VPC-public\"\n        }\n      + tags_all         = {\n          + \"Name\" = \"example-test-VPC-public\"\n        }\n      + vpc_id           = \"vpc-XXX\"\n    }\n</code></pre></div>\n<p dir=\"auto\">What am I missing here?</p>\n<hr>\n<ins datetime=\"2023-06-27T22:03:11Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/110306\" rel=\"nofollow\">Tracked in ticket #110306</a></p>\n</ins>","answer":{"body":"Okay. After deleting the `.terragrunt-csche` folder, the import worked.","bodyHTML":"<p dir=\"auto\">Okay. After deleting the <code class=\"notranslate\">.terragrunt-csche</code> folder, the import worked.</p>"}}} />

</CenterLayout>
  

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "9fdb508eb3586849024c0169c2997970"
}
##DOCS-SOURCER-END -->
