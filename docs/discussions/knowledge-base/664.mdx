---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/664" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>CircleCI pipeline fails to build AMI image [ERROR: error: unbalanced parenthesis at position 230]</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84ASdwf","number":664,"author":{"login":"nadiia-caspar"},"title":"CircleCI pipeline fails to build AMI image [ERROR: error: unbalanced parenthesis at position 230]","body":"\nHello all,\r\n\r\ni am trying to build AMI with CircleCI pipelines. I took the examples of CircleCI scripts from [here](https://github.com/gruntwork-io/terraform-aws-service-catalog/tree/master/examples/for-production/infrastructure-live/_ci/scripts). The AMI build script I took from [here](https://github.com/gruntwork-io/terraform-aws-service-catalog/tree/master/examples/for-production/infrastructure-live/shared/us-west-2/_regional/amis). \r\n\r\nThe CircleCI gives the following error, looks like from [this line](https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/shared/us-west-2/_regional/amis/build_eks_cluster_instance.sh#L105):\r\n```\r\n#!/bin/bash -eo pipefail\r\n./_ci/scripts/run-build-scripts.sh \"$SOURCE_REF\" \"$CIRCLE_BRANCH\"\r\nThe following build scripts were updated:\r\nshared-services/eu-central-1/_global/amis/build_eks_cluster_instance.sh\r\nCalling build script shared-services/eu-central-1/_global/amis/build_eks_cluster_instance.sh\r\n2023-02-09 13:07:30 [INFO] [aws-auth] Assuming role arn:aws:iam::502221110000:role/allow-auto-deploy-from-other-accounts. These creds will expire after 3600 seconds.\r\n2023-02-09 13:07:32 [INFO] [aws-auth] Success!\r\n[infrastructure-deployer] INFO[2023-02-09T13:07:33Z] Invoking Lambda function ecs-deploy-runner-invoker to trigger deployment. \r\nERROR: error: unbalanced parenthesis at position 230\r\n```\r\n\r\nI assume that the bash line was somehow not correctly parsed by `ecs-deploy-runner-invoker` Lambda function. \r\n\r\nHave someone saw something like this? Is there any workaround?\n\n---\n\n<ins datetime=\"2023-02-09T13:20:02Z\">\n  <p><a href=\"https://support.gruntwork.io/hc/requests/109887\">Tracked in ticket #109887</a></p>\n</ins>\n","bodyHTML":"<p dir=\"auto\">Hello all,</p>\n<p dir=\"auto\">i am trying to build AMI with CircleCI pipelines. I took the examples of CircleCI scripts from <a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/tree/master/examples/for-production/infrastructure-live/_ci/scripts\">here</a>. The AMI build script I took from <a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/tree/master/examples/for-production/infrastructure-live/shared/us-west-2/_regional/amis\">here</a>.</p>\n<p dir=\"auto\">The CircleCI gives the following error, looks like from <a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/shared/us-west-2/_regional/amis/build_eks_cluster_instance.sh#L105\">this line</a>:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"#!/bin/bash -eo pipefail\n./_ci/scripts/run-build-scripts.sh &quot;$SOURCE_REF&quot; &quot;$CIRCLE_BRANCH&quot;\nThe following build scripts were updated:\nshared-services/eu-central-1/_global/amis/build_eks_cluster_instance.sh\nCalling build script shared-services/eu-central-1/_global/amis/build_eks_cluster_instance.sh\n2023-02-09 13:07:30 [INFO] [aws-auth] Assuming role arn:aws:iam::502221110000:role/allow-auto-deploy-from-other-accounts. These creds will expire after 3600 seconds.\n2023-02-09 13:07:32 [INFO] [aws-auth] Success!\n[infrastructure-deployer] INFO[2023-02-09T13:07:33Z] Invoking Lambda function ecs-deploy-runner-invoker to trigger deployment. \nERROR: error: unbalanced parenthesis at position 230\"><pre class=\"notranslate\"><code class=\"notranslate\">#!/bin/bash -eo pipefail\n./_ci/scripts/run-build-scripts.sh \"$SOURCE_REF\" \"$CIRCLE_BRANCH\"\nThe following build scripts were updated:\nshared-services/eu-central-1/_global/amis/build_eks_cluster_instance.sh\nCalling build script shared-services/eu-central-1/_global/amis/build_eks_cluster_instance.sh\n2023-02-09 13:07:30 [INFO] [aws-auth] Assuming role arn:aws:iam::502221110000:role/allow-auto-deploy-from-other-accounts. These creds will expire after 3600 seconds.\n2023-02-09 13:07:32 [INFO] [aws-auth] Success!\n[infrastructure-deployer] INFO[2023-02-09T13:07:33Z] Invoking Lambda function ecs-deploy-runner-invoker to trigger deployment. \nERROR: error: unbalanced parenthesis at position 230\n</code></pre></div>\n<p dir=\"auto\">I assume that the bash line was somehow not correctly parsed by <code class=\"notranslate\">ecs-deploy-runner-invoker</code> Lambda function.</p>\n<p dir=\"auto\">Have someone saw something like this? Is there any workaround?</p>\n<hr>\n<ins datetime=\"2023-02-09T13:20:02Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/109887\" rel=\"nofollow\">Tracked in ticket #109887</a></p>\n</ins>","answer":{"body":"Hello, grunties!\r\n\r\nI figured out the problem. I had a typo in `allowed_repos_regex` value, so the `--packer-template-path` option for the `infrastructure-deployer` command could not be compared correctly with allowed repos.","bodyHTML":"<p dir=\"auto\">Hello, grunties!</p>\n<p dir=\"auto\">I figured out the problem. I had a typo in <code class=\"notranslate\">allowed_repos_regex</code> value, so the <code class=\"notranslate\">--packer-template-path</code> option for the <code class=\"notranslate\">infrastructure-deployer</code> command could not be compared correctly with allowed repos.</p>"}}} />

</CenterLayout>
  

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "34c4859993f87e162b252bc29c23734f"
}
##DOCS-SOURCER-END -->
