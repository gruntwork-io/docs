---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/681" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>I received an email from AWS regarding shared NAT Gateways, what should I do?</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AS4jD","number":681,"author":{"login":"arsci"},"title":"I received an email from AWS regarding shared NAT Gateways, what should I do?","body":"\nI received the following email from AWS regarding NAT Gateways. As a Reference Architecture customer and Gruntwork VPC module user I would like to know if there is anything I need to do\r\n\r\n\r\n> We have observed that your Amazon VPC resources are using a shared NAT Gateway across multiple Availability Zones (AZ). To ensure high availability and minimize inter-AZ data transfer costs, we recommend utilizing separate NAT Gateways in each AZ and routing traffic locally within the same AZ.\r\nEach NAT Gateway operates within a designated AZ and is built with redundancy in that zone only. As a result, if the NAT Gateway or AZ experiences failure, resources utilizing that NAT Gateway in other AZ(s) also get impacted. Additionally, routing traffic from one AZ to a NAT Gateway in a different AZ incurs additional inter-AZ data transfer charges. We recommend choosing a maintenance window for architecture changes in your Amazon VPC.\r\nThe following is a list of your VPCs and NAT Gateways that are shared across AZ(s), in the format: ‘VPC | NAT Gateway’:\r\nvpc-xxxxxx | nat-xxxxxx\r\nPlease refer to the AWS public documentation on how to create a NAT Gateway [1], and how to configure routes for different NAT Gateway use cases [2].\r\nShould you have any questions or concerns, please reach out to the AWS Support team [3].\r\n[1] https://docs.aws.amazon.com/vpc/latest/userguide/vpc-nat-gateway.html#nat-gateway-working-with\r\n[2] https://docs.aws.amazon.com/vpc/latest/userguide/nat-gateway-scenarios.html\r\n[3] https://aws.amazon.com/support\n\n---\n\n<ins datetime=\"2023-03-10T19:52:39Z\">\n  <p><a href=\"https://support.gruntwork.io/hc/requests/109981\">Tracked in ticket #109981</a></p>\n</ins>\n","bodyHTML":"<p dir=\"auto\">I received the following email from AWS regarding NAT Gateways. As a Reference Architecture customer and Gruntwork VPC module user I would like to know if there is anything I need to do</p>\n<blockquote>\n<p dir=\"auto\">We have observed that your Amazon VPC resources are using a shared NAT Gateway across multiple Availability Zones (AZ). To ensure high availability and minimize inter-AZ data transfer costs, we recommend utilizing separate NAT Gateways in each AZ and routing traffic locally within the same AZ.<br>\nEach NAT Gateway operates within a designated AZ and is built with redundancy in that zone only. As a result, if the NAT Gateway or AZ experiences failure, resources utilizing that NAT Gateway in other AZ(s) also get impacted. Additionally, routing traffic from one AZ to a NAT Gateway in a different AZ incurs additional inter-AZ data transfer charges. We recommend choosing a maintenance window for architecture changes in your Amazon VPC.<br>\nThe following is a list of your VPCs and NAT Gateways that are shared across AZ(s), in the format: ‘VPC | NAT Gateway’:<br>\nvpc-xxxxxx | nat-xxxxxx<br>\nPlease refer to the AWS public documentation on how to create a NAT Gateway [1], and how to configure routes for different NAT Gateway use cases [2].<br>\nShould you have any questions or concerns, please reach out to the AWS Support team [3].<br>\n[1] <a href=\"https://docs.aws.amazon.com/vpc/latest/userguide/vpc-nat-gateway.html#nat-gateway-working-with\" rel=\"nofollow\">https://docs.aws.amazon.com/vpc/latest/userguide/vpc-nat-gateway.html#nat-gateway-working-with</a><br>\n[2] <a href=\"https://docs.aws.amazon.com/vpc/latest/userguide/nat-gateway-scenarios.html\" rel=\"nofollow\">https://docs.aws.amazon.com/vpc/latest/userguide/nat-gateway-scenarios.html</a><br>\n[3] <a href=\"https://aws.amazon.com/support\" rel=\"nofollow\">https://aws.amazon.com/support</a></p>\n</blockquote>\n<hr>\n<ins datetime=\"2023-03-10T19:52:39Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/109981\" rel=\"nofollow\">Tracked in ticket #109981</a></p>\n</ins>","answer":{"body":"Recently AWS sent out an email notifying customers of shared NAT Gateways in VPCs, and made a recommendation to utilize separate NAT Gateways in each AZ to ensure high availability and to minimize inter-AZ data transfer costs.\r\n\r\nFor non-production and non-critical environments, it is not always necessary (or cost-effective) to deploy dedicated NAT Gateways across every AZ. \r\n\r\nFor any type of critical, production environment that requires high availability and redundancy, or an environment that would incur high inter-AZ data transfer costs by sharing a NAT Gateway across AZs, you should utilize dedicated NAT Gateways in separate AZs.\r\n\r\n[For Gruntwork Reference Architecture customers, please see details about a bug we discovered below](#gruntwork-reference-architecture-customers)\r\n\r\n[Gruntwork VPC Module Users](#gruntwork-vpc-module-users)\r\n\r\n## Gruntwork Reference Architecture Customers\r\n\r\n_We discovered a bug in the configuration for the application VPC_ in which only one shared NAT is being created and used by all of the private application subnets. We recommend that your reference architecture configurations be updated to ensure there are multiple NAT Gateways for the application VPC.\r\n\r\nTo update this configuration you will need to modify the `num_nat_gateways` input in your Terragrunt configuration to deploy the desired number of NAT Gateways for your application VPC (at least 3 NAT Gateways, or 1-per AZ is recommended). The Gruntwork VPC Module will automatically distribute the requested number of NAT Gateways across available AZs and configure your private app subnet route tables accordingly. (Please remember to always test and validate any changes before deploying to production environments!)\r\n\r\nYou can find the relevant application VPC terragrunt configuration in the `inputs` block in `_envcommon/networking/vpc-app.hcl`\r\n\r\nIf you wish to also add additional NAT Gateways to your management VPC, you can find the relevant Terragrunt configuration in the `inputs` block in `_envcommon/mgmt/vpc-mgmt.hcl`\r\n\r\nAlso see: [Gruntwork Docs: Making changes to your infrastructure: Terragrunt](https://docs.gruntwork.io/reference/services/intro/make-changes-to-your-infrastructure/#making-changes-to-terragrunt-code)\r\n\r\n## Gruntwork VPC Module users\r\n\r\nFor users that wish to configure additional NAT Gateways to a VPC created with the Gruntwork VPC Module, you can specify the number of gateways you'd like to create with the `num_nat_gateways` input. The VPC module will automatically distribute your requested NAT Gateways across available AZs, and configure your private subnet route table rules accordingly. \r\n\r\nAlso see: [Gruntwork Docs: Making changes to your infrastructure: Terraform](https://docs.gruntwork.io/reference/services/intro/make-changes-to-your-infrastructure/#making-changes-to-vanilla-terraform-code)\r\n","bodyHTML":"<p dir=\"auto\">Recently AWS sent out an email notifying customers of shared NAT Gateways in VPCs, and made a recommendation to utilize separate NAT Gateways in each AZ to ensure high availability and to minimize inter-AZ data transfer costs.</p>\n<p dir=\"auto\">For non-production and non-critical environments, it is not always necessary (or cost-effective) to deploy dedicated NAT Gateways across every AZ.</p>\n<p dir=\"auto\">For any type of critical, production environment that requires high availability and redundancy, or an environment that would incur high inter-AZ data transfer costs by sharing a NAT Gateway across AZs, you should utilize dedicated NAT Gateways in separate AZs.</p>\n<p dir=\"auto\"><a href=\"#gruntwork-reference-architecture-customers\">For Gruntwork Reference Architecture customers, please see details about a bug we discovered below</a></p>\n<p dir=\"auto\"><a href=\"#gruntwork-vpc-module-users\">Gruntwork VPC Module Users</a></p>\n<h2 dir=\"auto\">Gruntwork Reference Architecture Customers</h2>\n<p dir=\"auto\"><em>We discovered a bug in the configuration for the application VPC</em> in which only one shared NAT is being created and used by all of the private application subnets. We recommend that your reference architecture configurations be updated to ensure there are multiple NAT Gateways for the application VPC.</p>\n<p dir=\"auto\">To update this configuration you will need to modify the <code class=\"notranslate\">num_nat_gateways</code> input in your Terragrunt configuration to deploy the desired number of NAT Gateways for your application VPC (at least 3 NAT Gateways, or 1-per AZ is recommended). The Gruntwork VPC Module will automatically distribute the requested number of NAT Gateways across available AZs and configure your private app subnet route tables accordingly. (Please remember to always test and validate any changes before deploying to production environments!)</p>\n<p dir=\"auto\">You can find the relevant application VPC terragrunt configuration in the <code class=\"notranslate\">inputs</code> block in <code class=\"notranslate\">_envcommon/networking/vpc-app.hcl</code></p>\n<p dir=\"auto\">If you wish to also add additional NAT Gateways to your management VPC, you can find the relevant Terragrunt configuration in the <code class=\"notranslate\">inputs</code> block in <code class=\"notranslate\">_envcommon/mgmt/vpc-mgmt.hcl</code></p>\n<p dir=\"auto\">Also see: <a href=\"https://docs.gruntwork.io/reference/services/intro/make-changes-to-your-infrastructure/#making-changes-to-terragrunt-code\" rel=\"nofollow\">Gruntwork Docs: Making changes to your infrastructure: Terragrunt</a></p>\n<h2 dir=\"auto\">Gruntwork VPC Module users</h2>\n<p dir=\"auto\">For users that wish to configure additional NAT Gateways to a VPC created with the Gruntwork VPC Module, you can specify the number of gateways you'd like to create with the <code class=\"notranslate\">num_nat_gateways</code> input. The VPC module will automatically distribute your requested NAT Gateways across available AZs, and configure your private subnet route table rules accordingly.</p>\n<p dir=\"auto\">Also see: <a href=\"https://docs.gruntwork.io/reference/services/intro/make-changes-to-your-infrastructure/#making-changes-to-vanilla-terraform-code\" rel=\"nofollow\">Gruntwork Docs: Making changes to your infrastructure: Terraform</a></p>"}}} />

</CenterLayout>
  

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "3534da170c93da9a0d0a0522f7bc6736"
}
##DOCS-SOURCER-END -->
