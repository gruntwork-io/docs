---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/647" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>How do I operate on IAM resources when using aws-vault?</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84ASSpq","number":647,"author":{"login":"zackproser"},"title":"How do I operate on IAM resources when using aws-vault?","body":"\r\nA customer asked: \r\n> I am using `aws-vault` to manage access to my AWS accounts. When I attempt to run the `exec` command to delete IAM resources, I get a security token error. What do I need to do to be able to delete IAM resources when using `aws-vault`?\r\n\r\n```bash\r\naws-vault exec <account-profile>-- aws iam list-users\r\n```\r\n---\r\n\r\n<ins datetime=\"2023-01-26T15:11:53Z\">\r\n  <p><a href=\"https://support.gruntwork.io/hc/requests/109838\">Tracked in ticket #109838</a></p>\r\n</ins>\r\n","bodyHTML":"<p dir=\"auto\">A customer asked:</p>\n<blockquote>\n<p dir=\"auto\">I am using <code class=\"notranslate\">aws-vault</code> to manage access to my AWS accounts. When I attempt to run the <code class=\"notranslate\">exec</code> command to delete IAM resources, I get a security token error. What do I need to do to be able to delete IAM resources when using <code class=\"notranslate\">aws-vault</code>?</p>\n</blockquote>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"aws-vault exec &lt;account-profile&gt;-- aws iam list-users\"><pre class=\"notranslate\">aws-vault <span class=\"pl-c1\">exec</span> <span class=\"pl-k\">&lt;</span>account-profile<span class=\"pl-k\">&gt;</span>-- aws iam list-users</pre></div>\n<hr>\n<ins datetime=\"2023-01-26T15:11:53Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/109838\" rel=\"nofollow\">Tracked in ticket #109838</a></p>\n</ins>","answer":{"body":"\r\n![vaultsession](https://user-images.githubusercontent.com/1769996/215109078-8a999555-dc46-4049-8cb4-d7f20ba37820.gif)\r\nThe temporary session token returned by [the AWS STS action `GetSessionToken`](https://docs.aws.amazon.com/STS/latest/APIReference/API_GetSessionToken.html) is valid for making API calls to AWS services - with the following important exception: \r\n\r\n> You cannot call any IAM API operations unless MFA authentication information is included in the request. \r\n\r\nThis causes confusion to users of aws-vault who are using an IAM user in their profile. When they attempt to use calls for IAM they get InvalidClientTokenId, and ultimately are forced to expose their permanent credentials by passing the `--no-session` flag to their `aws-vault exec` commands.\r\n\r\n\r\nSee also: https://github.com/99designs/aws-vault/issues/1056","bodyHTML":"<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/1769996/215109078-8a999555-dc46-4049-8cb4-d7f20ba37820.gif\"><img src=\"https://user-images.githubusercontent.com/1769996/215109078-8a999555-dc46-4049-8cb4-d7f20ba37820.gif\" alt=\"vaultsession\" data-animated-image=\"\" style=\"max-width: 100%;\"></a><br>\nThe temporary session token returned by <a href=\"https://docs.aws.amazon.com/STS/latest/APIReference/API_GetSessionToken.html\" rel=\"nofollow\">the AWS STS action <code class=\"notranslate\">GetSessionToken</code></a> is valid for making API calls to AWS services - with the following important exception:</p>\n<blockquote>\n<p dir=\"auto\">You cannot call any IAM API operations unless MFA authentication information is included in the request.</p>\n</blockquote>\n<p dir=\"auto\">This causes confusion to users of aws-vault who are using an IAM user in their profile. When they attempt to use calls for IAM they get InvalidClientTokenId, and ultimately are forced to expose their permanent credentials by passing the <code class=\"notranslate\">--no-session</code> flag to their <code class=\"notranslate\">aws-vault exec</code> commands.</p>\n<p dir=\"auto\">See also: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1411377749\" data-permission-text=\"Title is private\" data-url=\"https://github.com/99designs/aws-vault/issues/1056\" data-hovercard-type=\"issue\" data-hovercard-url=\"/99designs/aws-vault/issues/1056/hovercard\" href=\"https://github.com/99designs/aws-vault/issues/1056\">99designs/aws-vault#1056</a></p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "7bbafcda22f319ec5b7b2e390e5c8176"
}
##DOCS-SOURCER-END -->
