---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Multiple terraform sources</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84APxps","number":463,"author":{"login":"geek876"},"title":"Multiple terraform sources","body":"\nSo i have my TG directory structure as below\r\n```\r\n.\r\n├── env1\r\n│   └── applications\r\n│       ├── app1\r\n│       │   └── terragrunt.hcl\r\n│       ├── app2\r\n│       │   └── terragrunt.hcl\r\n│       └── app3\r\n│           └── terragrunt.hcl\r\n├── env2\r\n│   └── applications\r\n│       └── app1\r\n│           └── terragrunt.hcl\r\n├── env3\r\n├── main.hcl\r\n└── modules\r\n    ├── app1\r\n    │   ├── main1.tf\r\n    │   └── main2.tf\r\n    └── app2\r\n        └── main2.tf\r\n```\r\nI have couple of environments `env1, env2, env3`. Each `env` has `app1, app2...` applications.\r\nThe *applications/app1, applications/app2 ...* directories  only contains `terragrunt.hcl` and a `config.tfvars` where i set variables relevant to that app.\r\nThe `terragrunt.hcl` file is all same. It simply does a `find_in_parent_folders('main.hcl')`.\r\n\r\nThe `main.hcl` simply does a \r\n```\r\nlocals {\r\n  root_dir = get_parent_terragrunt_dir()\r\n  relative_path = path_relative_to_include()\r\n deployment_path_components = compact(split(\"/\", local.relative_path))\r\n\r\n app = reverse(local.deployment_path_components)[0]\r\n}\r\n\r\nterraform {\r\n    source = \"${local.root_dir}/..//modules/${local.app}\"\r\n}\r\n```\r\nThe whole idea is that when i execute `terragrunt plan/apply` from say `app2`, it just runs **terraform tf** files from `modules/app2`. The `config.tfvars` of **app2** drives what variation of `app2` it should provision for that environment.\r\n\r\nThis works as expected.\r\n\r\nHowever, Now i have a need to **also** run **terraform tf** files from another module (**another/main1.tf and another/main2.tf**) when I run say **app1**. So when I run `terragrunt plan/apply` from say `app1`, it should copy/run whatever is in `modules/app1` + `modules/another`. \r\n\r\nI have tried using dependency which works but i was trying to see if there was a way to perhaps merge the `source` attribute of `terraform` block to include both this paths or some other better way of doing it ?  I want to keep `modules/app1` and `modules/another` as separate modules and include them both via  `applications/app1/terragrunt.hcl`. \r\n\r\n```\r\n└── modules\r\n    ├── app1\r\n    │   ├── main1.tf\r\n    │   └── main2.tf\r\n    └── app2\r\n        └── main2.tf\r\n    └── another\r\n        └── main1.tf\r\n        └── main2.tf\r\n```\r\n\r\nI also tried multiple includes within `applications/app1/terragrunt.hcl` like below. But i noticed that whatever is the second `terraform source` that gets run. The below would run `tf files` from `modules/another` and not from `modules/app1`\r\n```\r\ninclude app {\r\n  terraform {\r\n    source = <path-to-modules/app1> \r\n  }\r\n}\r\n\r\ninclude another {\r\n  terraform {\r\n    source = <path-to-modules/another> \r\n  }\r\n}\r\n```\r\nAny guidance would be much appreciated.\r\n\r\nThanks.\n\n---\n\n<ins datetime=\"2022-06-10T23:46:05Z\">\n  <p><a href=\"https://support.gruntwork.io/hc/requests/108752\">Tracked in ticket #108752</a></p>\n</ins>\n","bodyHTML":"<p dir=\"auto\">So i have my TG directory structure as below</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\".\n├── env1\n│   └── applications\n│       ├── app1\n│       │   └── terragrunt.hcl\n│       ├── app2\n│       │   └── terragrunt.hcl\n│       └── app3\n│           └── terragrunt.hcl\n├── env2\n│   └── applications\n│       └── app1\n│           └── terragrunt.hcl\n├── env3\n├── main.hcl\n└── modules\n    ├── app1\n    │   ├── main1.tf\n    │   └── main2.tf\n    └── app2\n        └── main2.tf\"><pre class=\"notranslate\"><code>.\n├── env1\n│   └── applications\n│       ├── app1\n│       │   └── terragrunt.hcl\n│       ├── app2\n│       │   └── terragrunt.hcl\n│       └── app3\n│           └── terragrunt.hcl\n├── env2\n│   └── applications\n│       └── app1\n│           └── terragrunt.hcl\n├── env3\n├── main.hcl\n└── modules\n    ├── app1\n    │   ├── main1.tf\n    │   └── main2.tf\n    └── app2\n        └── main2.tf\n</code></pre></div>\n<p dir=\"auto\">I have couple of environments <code class=\"notranslate\">env1, env2, env3</code>. Each <code class=\"notranslate\">env</code> has <code class=\"notranslate\">app1, app2...</code> applications.<br>\nThe <em>applications/app1, applications/app2 ...</em> directories  only contains <code class=\"notranslate\">terragrunt.hcl</code> and a <code class=\"notranslate\">config.tfvars</code> where i set variables relevant to that app.<br>\nThe <code class=\"notranslate\">terragrunt.hcl</code> file is all same. It simply does a <code class=\"notranslate\">find_in_parent_folders('main.hcl')</code>.</p>\n<p dir=\"auto\">The <code class=\"notranslate\">main.hcl</code> simply does a</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"locals {\n  root_dir = get_parent_terragrunt_dir()\n  relative_path = path_relative_to_include()\n deployment_path_components = compact(split(&quot;/&quot;, local.relative_path))\n\n app = reverse(local.deployment_path_components)[0]\n}\n\nterraform {\n    source = &quot;${local.root_dir}/..//modules/${local.app}&quot;\n}\"><pre class=\"notranslate\"><code>locals {\n  root_dir = get_parent_terragrunt_dir()\n  relative_path = path_relative_to_include()\n deployment_path_components = compact(split(\"/\", local.relative_path))\n\n app = reverse(local.deployment_path_components)[0]\n}\n\nterraform {\n    source = \"${local.root_dir}/..//modules/${local.app}\"\n}\n</code></pre></div>\n<p dir=\"auto\">The whole idea is that when i execute <code class=\"notranslate\">terragrunt plan/apply</code> from say <code class=\"notranslate\">app2</code>, it just runs <strong>terraform tf</strong> files from <code class=\"notranslate\">modules/app2</code>. The <code class=\"notranslate\">config.tfvars</code> of <strong>app2</strong> drives what variation of <code class=\"notranslate\">app2</code> it should provision for that environment.</p>\n<p dir=\"auto\">This works as expected.</p>\n<p dir=\"auto\">However, Now i have a need to <strong>also</strong> run <strong>terraform tf</strong> files from another module (<strong>another/main1.tf and another/main2.tf</strong>) when I run say <strong>app1</strong>. So when I run <code class=\"notranslate\">terragrunt plan/apply</code> from say <code class=\"notranslate\">app1</code>, it should copy/run whatever is in <code class=\"notranslate\">modules/app1</code> + <code class=\"notranslate\">modules/another</code>.</p>\n<p dir=\"auto\">I have tried using dependency which works but i was trying to see if there was a way to perhaps merge the <code class=\"notranslate\">source</code> attribute of <code class=\"notranslate\">terraform</code> block to include both this paths or some other better way of doing it ?  I want to keep <code class=\"notranslate\">modules/app1</code> and <code class=\"notranslate\">modules/another</code> as separate modules and include them both via  <code class=\"notranslate\">applications/app1/terragrunt.hcl</code>.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"└── modules\n    ├── app1\n    │   ├── main1.tf\n    │   └── main2.tf\n    └── app2\n        └── main2.tf\n    └── another\n        └── main1.tf\n        └── main2.tf\"><pre class=\"notranslate\"><code>└── modules\n    ├── app1\n    │   ├── main1.tf\n    │   └── main2.tf\n    └── app2\n        └── main2.tf\n    └── another\n        └── main1.tf\n        └── main2.tf\n</code></pre></div>\n<p dir=\"auto\">I also tried multiple includes within <code class=\"notranslate\">applications/app1/terragrunt.hcl</code> like below. But i noticed that whatever is the second <code class=\"notranslate\">terraform source</code> that gets run. The below would run <code class=\"notranslate\">tf files</code> from <code class=\"notranslate\">modules/another</code> and not from <code class=\"notranslate\">modules/app1</code></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"include app {\n  terraform {\n    source = &lt;path-to-modules/app1&gt; \n  }\n}\n\ninclude another {\n  terraform {\n    source = &lt;path-to-modules/another&gt; \n  }\n}\"><pre class=\"notranslate\"><code>include app {\n  terraform {\n    source = &lt;path-to-modules/app1&gt; \n  }\n}\n\ninclude another {\n  terraform {\n    source = &lt;path-to-modules/another&gt; \n  }\n}\n</code></pre></div>\n<p dir=\"auto\">Any guidance would be much appreciated.</p>\n<p dir=\"auto\">Thanks.</p>\n<hr>\n<ins datetime=\"2022-06-10T23:46:05Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/108752\" rel=\"nofollow\">Tracked in ticket #108752</a></p>\n</ins>","answer":{"body":"This is not a supported feature of Terragrunt. The feature request ticket for this is https://github.com/gruntwork-io/terragrunt/issues/1462, but as indicated [in this comment](https://github.com/gruntwork-io/terragrunt/issues/1462#issuecomment-742559624), supporting that operating model requires a major overhaul of Terragrunt internals.\r\n\r\nThe best workaround currently is to generate a Terraform module that calls those modules using `module` blocks on the fly using `generate` blocks.","bodyHTML":"<p dir=\"auto\">This is not a supported feature of Terragrunt. The feature request ticket for this is <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"758658616\" data-permission-text=\"Title is private\" data-url=\"https://github.com/gruntwork-io/terragrunt/issues/1462\" data-hovercard-type=\"issue\" data-hovercard-url=\"/gruntwork-io/terragrunt/issues/1462/hovercard\" href=\"https://github.com/gruntwork-io/terragrunt/issues/1462\">gruntwork-io/terragrunt#1462</a>, but as indicated <a href=\"https://github.com/gruntwork-io/terragrunt/issues/1462#issuecomment-742559624\" data-hovercard-type=\"issue\" data-hovercard-url=\"/gruntwork-io/terragrunt/issues/1462/hovercard\">in this comment</a>, supporting that operating model requires a major overhaul of Terragrunt internals.</p>\n<p dir=\"auto\">The best workaround currently is to generate a Terraform module that calls those modules using <code class=\"notranslate\">module</code> blocks on the fly using <code class=\"notranslate\">generate</code> blocks.</p>"}}} />

</CenterLayout>
  

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "feeda94dccd3ebf02a9b609074051726"
}
##DOCS-SOURCER-END -->
