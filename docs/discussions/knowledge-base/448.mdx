---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/448" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Switching from OpenVPN to Tailscale</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84APvYD","number":448,"author":{"login":"moos3"},"title":"Switching from OpenVPN to Tailscale","body":"\nIs there any documentation out yet for switching from OpenVPN to Tailscale?\n\n---\n\n<ins datetime=\"2022-06-07T18:52:04Z\">\n  <p><a href=\"https://support.gruntwork.io/hc/requests/108723\">Tracked in ticket #108723</a></p>\n</ins>\n","bodyHTML":"<p dir=\"auto\">Is there any documentation out yet for switching from OpenVPN to Tailscale?</p>\n<hr>\n<ins datetime=\"2022-06-07T18:52:04Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/108723\" rel=\"nofollow\">Tracked in ticket #108723</a></p>\n</ins>","answer":{"body":"There is no documentation for switching to Tailscale, as you can use both in parallel. To use Tailscale, you need to deploy the [tailscale-subnet-router](https://github.com/gruntwork-io/terraform-aws-service-catalog/tree/master/modules/mgmt/tailscale-subnet-router) module.\r\n\r\nThe steps to deploy it are:\r\n\r\n- Sign up for a Tailscale account if you haven't already.\r\n- Create a [tailscale ACL tag](https://tailscale.com/kb/1068/acl-tags/) for each environment (`dev`, `stage`, `prod`). Note that you will need to update the Tailscale ACL to assign owners for each tag.\r\n\r\n- Add an `autoApprovers` rule in the Tailscale ACL to auto approve subnet routers for each tag. Example:\r\n\r\n    ```\r\n    // Allow servers to automatically expose default VPC routes\r\n    \"autoApprovers\": {\r\n      \"routes\": {\r\n        \"10.2.0.0/18\": [\"tag:dev\"],\r\n        \"10.4.0.0/18\": [\"tag:stage\"],\r\n        \"10.0.0.0/18\": [\"tag:prod\"]\r\n      },\r\n    },\r\n    ```\r\n\r\n- Add ACL rule to allow your users to access the tags. See https://tailscale.com/kb/1018/acls/ for more info.\r\n- Follow [this docs entry](https://github.com/gruntwork-io/terraform-aws-service-catalog/tree/master/modules/mgmt/tailscale-subnet-router#how-do-i-authenticate-the-server-to-tailscale) to create an Tailscale auth key for each environment.\r\n- Upload the auth key to Secrets Manager in each environment. Record the ARN, as this will need to be provided as the input variable `auth_key_secrets_manager_arn`.\r\n- Create a new `build_tailscale_subnet_router.sh` script in `shared/REGION/_regional/amis` that follows the same patterns as the other scripts to build the AMI using packer with [the tailscale-subnet-router-ubuntu.pkr.hcl template](https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/modules/mgmt/tailscale-subnet-router/tailscale-subnet-router-ubuntu.pkr.hcl).\r\n- Run the script while authenticating to the `shared` account to build the AMI.\r\n- Once you have the AMI, create a new `terragrunt.hcl` config for deploying the `tailscale-subnet-router` module. You can use https://github.com/gruntwork-io/knowledge-base/discussions/360#discussioncomment-2570548 as a template.","bodyHTML":"<p dir=\"auto\">There is no documentation for switching to Tailscale, as you can use both in parallel. To use Tailscale, you need to deploy the <a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/tree/master/modules/mgmt/tailscale-subnet-router\">tailscale-subnet-router</a> module.</p>\n<p dir=\"auto\">The steps to deploy it are:</p>\n<ul dir=\"auto\">\n<li>\n<p dir=\"auto\">Sign up for a Tailscale account if you haven't already.</p>\n</li>\n<li>\n<p dir=\"auto\">Create a <a href=\"https://tailscale.com/kb/1068/acl-tags/\" rel=\"nofollow\">tailscale ACL tag</a> for each environment (<code class=\"notranslate\">dev</code>, <code class=\"notranslate\">stage</code>, <code class=\"notranslate\">prod</code>). Note that you will need to update the Tailscale ACL to assign owners for each tag.</p>\n</li>\n<li>\n<p dir=\"auto\">Add an <code class=\"notranslate\">autoApprovers</code> rule in the Tailscale ACL to auto approve subnet routers for each tag. Example:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"// Allow servers to automatically expose default VPC routes\n&quot;autoApprovers&quot;: {\n  &quot;routes&quot;: {\n    &quot;10.2.0.0/18&quot;: [&quot;tag:dev&quot;],\n    &quot;10.4.0.0/18&quot;: [&quot;tag:stage&quot;],\n    &quot;10.0.0.0/18&quot;: [&quot;tag:prod&quot;]\n  },\n},\"><pre class=\"notranslate\"><code class=\"notranslate\">// Allow servers to automatically expose default VPC routes\n\"autoApprovers\": {\n  \"routes\": {\n    \"10.2.0.0/18\": [\"tag:dev\"],\n    \"10.4.0.0/18\": [\"tag:stage\"],\n    \"10.0.0.0/18\": [\"tag:prod\"]\n  },\n},\n</code></pre></div>\n</li>\n<li>\n<p dir=\"auto\">Add ACL rule to allow your users to access the tags. See <a href=\"https://tailscale.com/kb/1018/acls/\" rel=\"nofollow\">https://tailscale.com/kb/1018/acls/</a> for more info.</p>\n</li>\n<li>\n<p dir=\"auto\">Follow <a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/tree/master/modules/mgmt/tailscale-subnet-router#how-do-i-authenticate-the-server-to-tailscale\">this docs entry</a> to create an Tailscale auth key for each environment.</p>\n</li>\n<li>\n<p dir=\"auto\">Upload the auth key to Secrets Manager in each environment. Record the ARN, as this will need to be provided as the input variable <code class=\"notranslate\">auth_key_secrets_manager_arn</code>.</p>\n</li>\n<li>\n<p dir=\"auto\">Create a new <code class=\"notranslate\">build_tailscale_subnet_router.sh</code> script in <code class=\"notranslate\">shared/REGION/_regional/amis</code> that follows the same patterns as the other scripts to build the AMI using packer with <a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/modules/mgmt/tailscale-subnet-router/tailscale-subnet-router-ubuntu.pkr.hcl\">the tailscale-subnet-router-ubuntu.pkr.hcl template</a>.</p>\n</li>\n<li>\n<p dir=\"auto\">Run the script while authenticating to the <code class=\"notranslate\">shared</code> account to build the AMI.</p>\n</li>\n<li>\n<p dir=\"auto\">Once you have the AMI, create a new <code class=\"notranslate\">terragrunt.hcl</code> config for deploying the <code class=\"notranslate\">tailscale-subnet-router</code> module. You can use <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"4011367\" data-permission-text=\"Title is private\" data-url=\"https://github.com/gruntwork-io/knowledge-base/discussions/360\" data-hovercard-type=\"discussion\" data-hovercard-url=\"/gruntwork-io/knowledge-base/discussions/360/hovercard?comment_id=2570548\" href=\"https://github.com/orgs/gruntwork-io/discussions/360#discussioncomment-2570548\">#360 (comment)</a> as a template.</p>\n</li>\n</ul>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "345aae9f95bd00264bb73bebf0add10f"
}
##DOCS-SOURCER-END -->
