---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/26" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Replica number changes on new deployments</h1>
<GitHub discussion={{"id":"MDEwOkRpc2N1c3Npb24zNTU0ODcx","number":26,"author":{"login":"gruntwork-support"},"title":"Replica number changes on new deployments","body":"_This message was extracted from a discussion that originally took place in Gruntwork Community Slack. Names and URLs have been removed where appropriate_\n\n\n**From a customer**\n\nHi,\n\nWhen using HPA like :\n\n```\nautoscaler = {\n  enable          = true\n  min_replicas    = 6\n  max_replicas    = 150\n  avg_cpu_util    = 15\n  avg_memory_util = 0\n}\n```\n\nNo matter what the current `REPLICA` number the deployment set it to `6`.\nMy expectation  is that the `REPLICA` will not change as a result of the deployment.\n\nPlease advice","bodyHTML":"<p dir=\"auto\"><em>This message was extracted from a discussion that originally took place in Gruntwork Community Slack. Names and URLs have been removed where appropriate</em></p>\n<p dir=\"auto\"><strong>From a customer</strong></p>\n<p dir=\"auto\">Hi,</p>\n<p dir=\"auto\">When using HPA like :</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"autoscaler = {\n  enable          = true\n  min_replicas    = 6\n  max_replicas    = 150\n  avg_cpu_util    = 15\n  avg_memory_util = 0\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">autoscaler = {\n  enable          = true\n  min_replicas    = 6\n  max_replicas    = 150\n  avg_cpu_util    = 15\n  avg_memory_util = 0\n}\n</code></pre></div>\n<p dir=\"auto\">No matter what the current <code class=\"notranslate\">REPLICA</code> number the deployment set it to <code class=\"notranslate\">6</code>.<br>\nMy expectation  is that the <code class=\"notranslate\">REPLICA</code> will not change as a result of the deployment.</p>\n<p dir=\"auto\">Please advice</p>","answer":{"body":"**From a grunt**\n\nHey person,\n\nI've asked for some guidance on this, and here's some details:\n\nThe deployment is getting reset by the helm chart, specifically the `replicaCount` input. `HPA` works by overwriting the replica count of the deployment, but there's no `ignore_changes` terraform type behaviour in helm. Therefore, the helm chart just overwrites the deployment every time based on what is in the helm chart.\n\nIt might best to use a `run_cmd` call in `terragrunt` that uses `kubectl` to get the current value of the replica count on the Deployment and update the input value to use that.","bodyHTML":"<p dir=\"auto\"><strong>From a grunt</strong></p>\n<p dir=\"auto\">Hey person,</p>\n<p dir=\"auto\">I've asked for some guidance on this, and here's some details:</p>\n<p dir=\"auto\">The deployment is getting reset by the helm chart, specifically the <code class=\"notranslate\">replicaCount</code> input. <code class=\"notranslate\">HPA</code> works by overwriting the replica count of the deployment, but there's no <code class=\"notranslate\">ignore_changes</code> terraform type behaviour in helm. Therefore, the helm chart just overwrites the deployment every time based on what is in the helm chart.</p>\n<p dir=\"auto\">It might best to use a <code class=\"notranslate\">run_cmd</code> call in <code class=\"notranslate\">terragrunt</code> that uses <code class=\"notranslate\">kubectl</code> to get the current value of the replica count on the Deployment and update the input value to use that.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "0587f01c699d0d218814f421eabbb7e3"
}
##DOCS-SOURCER-END -->
