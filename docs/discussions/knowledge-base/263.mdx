---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/263" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>How do I resolve private route53 domains in the Reference Architecture?</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AO_D4","number":263,"author":{"login":"yorinasub17"},"title":"How do I resolve private route53 domains in the Reference Architecture?","body":"On route53 private, every different environment will be using the same internal services domain name according to [common.hcl](https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/188d19e4c378da9adb2a05cdcf6e02ecf0fec034/examples/for-production/infrastructure-live/common.hcl#L95).\r\n\r\nI've broken those out into different subdomains before, calling out the env in the subdomain so like `product.{$ENV}.company.com` which allows me to resolve the domains per environment. But instead with this model, it's not called out and everything is `gruntworks.aws`. How do I differentiate the environments in this model?","bodyHTML":"<p dir=\"auto\">On route53 private, every different environment will be using the same internal services domain name according to <a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/188d19e4c378da9adb2a05cdcf6e02ecf0fec034/examples/for-production/infrastructure-live/common.hcl#L95\">common.hcl</a>.</p>\n<p dir=\"auto\">I've broken those out into different subdomains before, calling out the env in the subdomain so like <code class=\"notranslate\">product.{$ENV}.company.com</code> which allows me to resolve the domains per environment. But instead with this model, it's not called out and everything is <code class=\"notranslate\">gruntworks.aws</code>. How do I differentiate the environments in this model?</p>","answer":{"body":"Private domains can only be resolved from within the VPC that it is associated with. In the Reference Architecture, each environment has its own VPC, and each VPC has its own OpenVPN server. This means that you need to first VPN into the VPC via the OpenVPN server before you can even resolve the private domains. As such, the routing to environments happen first at the OpenVPN layer: you first decide which environment to connect to, and then from there you resolve the domain for that environment.\r\n\r\nNote that the private domains are intended for services that are only accessible within the VPC (not publicly exposed), which is why the Reference Architecture opts to use private route53 domains to manage them.\r\n\r\nIf you have an alternative networking scenario where you have a central network that is peering into all the VPCs (e.g., a single VPC with its own OpenVPN server that peers into all your environments' network), then it might make more sense to set up the service domains as public domains so that they are resolvable anywhere you call out. In the Reference Architecture, you can point the route 53 domain/hosted zone for each service to the public one instead of the private one to create the domains there.","bodyHTML":"<p dir=\"auto\">Private domains can only be resolved from within the VPC that it is associated with. In the Reference Architecture, each environment has its own VPC, and each VPC has its own OpenVPN server. This means that you need to first VPN into the VPC via the OpenVPN server before you can even resolve the private domains. As such, the routing to environments happen first at the OpenVPN layer: you first decide which environment to connect to, and then from there you resolve the domain for that environment.</p>\n<p dir=\"auto\">Note that the private domains are intended for services that are only accessible within the VPC (not publicly exposed), which is why the Reference Architecture opts to use private route53 domains to manage them.</p>\n<p dir=\"auto\">If you have an alternative networking scenario where you have a central network that is peering into all the VPCs (e.g., a single VPC with its own OpenVPN server that peers into all your environments' network), then it might make more sense to set up the service domains as public domains so that they are resolvable anywhere you call out. In the Reference Architecture, you can point the route 53 domain/hosted zone for each service to the public one instead of the private one to create the domains there.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "1c723cdb0516dc47705e52132ab0ad45"
}
##DOCS-SOURCER-END -->
