---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/348" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Deploying my first app to the Reference Architecture</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84APQ_v","number":348,"author":{"login":"pete0emerson"},"title":"Deploying my first app to the Reference Architecture","body":"I'm trying to deploy my first app, the simple-web-app, and I'm running into problems.\r\n\r\nI've completed up to and including the section `03-deploy-apps.md#deploying-to-an-eks-cluster`, and to deploy I'm not using a command line terragrunt apply of the section `03-deploy-apps.md#deploying-your-configuration` but I'm making a PR to the infrastructure-live repo, and this is where the problem occurs.\r\n\r\nSet up job, Run actions/checkout@v2,....,Notify Slack of upcoming deploy all compete without a problem. However, run deploy fails with:\r\n\r\n```\r\n    ...\r\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] │ Error: timed out waiting for the condition\r\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] │\r\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] │   with helm_release.application,\r\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] │   on [main.tf](http://main.tf/) line 28, in resource \"helm_release\" \"application\":\r\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] │   28: resource \"helm_release\" \"application\" {\r\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] │\r\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] ╵\r\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] time=2022-04-09T10:50:57Z level=error msg=Module /tmp/tmp2nh7tfnm/dev/us-east-1/dev/services/simple-web-app has finished with an error: 1 error occurred:\r\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] * exit status 1\r\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000]  prefix=[/tmp/tmp2nh7tfnm/dev/us-east-1/dev/services/simple-web-app]\r\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] time=2022-04-09T10:50:57Z level=error msg=1 error occurred:\r\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] * exit status 1\r\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] [INFO] [infrastructure-deploy-script] 2022-04-09 10:50:57  \"terragrunt apply-all\" exited with code 1\r\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] Error: Could not run \"terragrunt apply-all\"\r\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] exit status 1\r\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] ERROR: exit status 1\r\n```\r\n\r\nDoes this ring any bells for common problems?","bodyHTML":"<p dir=\"auto\">I'm trying to deploy my first app, the simple-web-app, and I'm running into problems.</p>\n<p dir=\"auto\">I've completed up to and including the section <code class=\"notranslate\">03-deploy-apps.md#deploying-to-an-eks-cluster</code>, and to deploy I'm not using a command line terragrunt apply of the section <code class=\"notranslate\">03-deploy-apps.md#deploying-your-configuration</code> but I'm making a PR to the infrastructure-live repo, and this is where the problem occurs.</p>\n<p dir=\"auto\">Set up job, Run actions/checkout@v2,....,Notify Slack of upcoming deploy all compete without a problem. However, run deploy fails with:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"    ...\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] │ Error: timed out waiting for the condition\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] │\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] │   with helm_release.application,\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] │   on [main.tf](http://main.tf/) line 28, in resource &quot;helm_release&quot; &quot;application&quot;:\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] │   28: resource &quot;helm_release&quot; &quot;application&quot; {\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] │\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] ╵\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] time=2022-04-09T10:50:57Z level=error msg=Module /tmp/tmp2nh7tfnm/dev/us-east-1/dev/services/simple-web-app has finished with an error: 1 error occurred:\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] * exit status 1\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000]  prefix=[/tmp/tmp2nh7tfnm/dev/us-east-1/dev/services/simple-web-app]\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] time=2022-04-09T10:50:57Z level=error msg=1 error occurred:\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] * exit status 1\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] [INFO] [infrastructure-deploy-script] 2022-04-09 10:50:57  &quot;terragrunt apply-all&quot; exited with code 1\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] Error: Could not run &quot;terragrunt apply-all&quot;\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] exit status 1\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] ERROR: exit status 1\"><pre class=\"notranslate\"><code class=\"notranslate\">    ...\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] │ Error: timed out waiting for the condition\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] │\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] │   with helm_release.application,\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] │   on [main.tf](http://main.tf/) line 28, in resource \"helm_release\" \"application\":\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] │   28: resource \"helm_release\" \"application\" {\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] │\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] ╵\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] time=2022-04-09T10:50:57Z level=error msg=Module /tmp/tmp2nh7tfnm/dev/us-east-1/dev/services/simple-web-app has finished with an error: 1 error occurred:\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] * exit status 1\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000]  prefix=[/tmp/tmp2nh7tfnm/dev/us-east-1/dev/services/simple-web-app]\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] time=2022-04-09T10:50:57Z level=error msg=1 error occurred:\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] * exit status 1\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] [INFO] [infrastructure-deploy-script] 2022-04-09 10:50:57  \"terragrunt apply-all\" exited with code 1\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] Error: Could not run \"terragrunt apply-all\"\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] exit status 1\n    [ecs-deploy-runner][2022-04-09T10:50:57+0000] ERROR: exit status 1\n</code></pre></div>\n<p dir=\"auto\">Does this ring any bells for common problems?</p>","answer":{"body":"I think we found part of the problem.\r\n\r\nThe sample-web-app as presented in `03-deploy-apps.md#the-app` exposes itself on port 8080\r\n\r\n```\r\nconst express = require('express');\r\n\r\n// Constants\r\nconst PORT = 8080;\r\nconst HOST = '0.0.0.0';\r\n\r\n// App\r\nconst app = express();\r\napp.get('/simple-web-app', (req, res) => {\r\n  res.send('Hello world\\n');\r\n});\r\n\r\napp.listen(PORT, HOST);\r\nconsole.log(`Running on http://${HOST}:${PORT}`);\r\n```\r\n\r\nHowever, the discussion of how to deploy the app in `03-deploy-apps.md#deploying-to-an-eks-cluster` doesn't mention anything about updating the container_port or service_port in k8s-simple-web-app.hcl to 8080 or changing the protocol of the health checks to http instead of https.\r\n\r\nWhen we make these changes we can get the app to deploy, which wasn't the case before these changes.","bodyHTML":"<p dir=\"auto\">I think we found part of the problem.</p>\n<p dir=\"auto\">The sample-web-app as presented in <code class=\"notranslate\">03-deploy-apps.md#the-app</code> exposes itself on port 8080</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"const express = require('express');\n\n// Constants\nconst PORT = 8080;\nconst HOST = '0.0.0.0';\n\n// App\nconst app = express();\napp.get('/simple-web-app', (req, res) =&gt; {\n  res.send('Hello world\\n');\n});\n\napp.listen(PORT, HOST);\nconsole.log(`Running on http://${HOST}:${PORT}`);\"><pre class=\"notranslate\"><code class=\"notranslate\">const express = require('express');\n\n// Constants\nconst PORT = 8080;\nconst HOST = '0.0.0.0';\n\n// App\nconst app = express();\napp.get('/simple-web-app', (req, res) =&gt; {\n  res.send('Hello world\\n');\n});\n\napp.listen(PORT, HOST);\nconsole.log(`Running on http://${HOST}:${PORT}`);\n</code></pre></div>\n<p dir=\"auto\">However, the discussion of how to deploy the app in <code class=\"notranslate\">03-deploy-apps.md#deploying-to-an-eks-cluster</code> doesn't mention anything about updating the container_port or service_port in k8s-simple-web-app.hcl to 8080 or changing the protocol of the health checks to http instead of https.</p>\n<p dir=\"auto\">When we make these changes we can get the app to deploy, which wasn't the case before these changes.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "da91610ba7002af12979b9d900889322"
}
##DOCS-SOURCER-END -->
