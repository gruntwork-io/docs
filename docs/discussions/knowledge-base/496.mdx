---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/496" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Ref Arch: How to connect to an OpenVPN server from a Linux machine</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AQBsO","number":496,"author":{"login":"zackproser"},"title":"Ref Arch: How to connect to an OpenVPN server from a Linux machine","body":"\nA customer asked: \r\n> How can I connect to one of the OpenVPN servers in the Ref Arch from a Linux machine?\n\n---\n\n<ins datetime=\"2022-07-07T21:19:08Z\">\n  <p><a href=\"https://support.gruntwork.io/hc/requests/108941\">Tracked in ticket #108941</a></p>\n</ins>\n","bodyHTML":"<p dir=\"auto\">A customer asked:</p>\n<blockquote>\n<p dir=\"auto\">How can I connect to one of the OpenVPN servers in the Ref Arch from a Linux machine?</p>\n</blockquote>\n<hr>\n<ins datetime=\"2022-07-07T21:19:08Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/108941\" rel=\"nofollow\">Tracked in ticket #108941</a></p>\n</ins>","answer":{"body":"# How to access a RefArch OpenVPN server from a Linux machine\r\n\r\n### Install openvpn3 client\r\n\r\nFollow [these instructions](https://openvpn.net/cloud-docs/openvpn-3-client-for-linux/) to install the `openvpn3` client on your Linux machine. \r\n\r\n### Join the OpenVPN IAM Group\r\n\r\nTo get access to an OpenVPN server, your IAM User needs access to SQS queues used by that OpenVPN server. \r\n\r\nSince our IAM Users are defined in one AWS account (security) and the OpenVPN servers are defined in separate AWS accounts\r\n(stage, prod, etc), that means you need to \"switch\" to the accounts with the OpenVPN servers by assuming an IAM Role\r\nthat has access to the SQS queues in those accounts.\r\n\r\nTo be able to assume an IAM Role, your IAM User needs to be part of an IAM Group with the proper permissions, such as\r\n`_account.xxx-full-access` or `_account.xxx-openvpn-users`, where `xxx` is the name of the account you want to access\r\n(`stage`, `prod`, etc). See [Configure other IAM Users](https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/docs/02-authenticate.md#configure-other-iam-users) for instructions on adding users to\r\nIAM Groups.\r\n\r\n### Use openvpn-admin to generate a configuration file\r\n\r\nTo connect to an OpenVPN server, you need an OpenVPN configuration file, which includes a certificate that you can use\r\nto authenticate. To generate this configuration file, do the following:\r\n\r\n1. Install the latest [openvpn-admin binary](https://github.com/gruntwork-io/terraform-aws-openvpn/releases) for your OS.\r\n2. [Authenticate to AWS via the CLI](https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/docs/02-authenticate.md#authenticate-to-aws-via-the-cli). You will need to assume an IAM Role in the AWS\r\naccount with the OpenVPN server you're trying to connect to. This IAM Role must have access to the SQS queues used\r\nby OpenVPN server. Typically, the `allow-full-access-from-other-accounts` or\r\n`openvpn-server-allow-certificate-requests-for-external-accounts` IAM Role is what you want.\r\n3. Run `openvpn-admin request --aws-region <AWS REGION> --username <YOUR IAM USERNAME>`. Note that this command will work whether or not you have a valid IAM user \r\n4. This will create your OpenVPN configuration file in the current folder. It will be named `<YOUR IAM USERNAME YOU SUPPLIED>.ovpn` . \r\n\r\n### Load your config file into openvpn3 client and connect\r\n\r\n1. Load this configuration file into your OpenVPN client by running `openvpn3 config-import --config ${MY_CONFIGURATION_FILE}` where `MY_CONFIGURATION_FILE` is the path to your `<your-name>.ovpn` file\r\n2. Start a session using this configuration (connect to the VPN server) by running `openvpn3 session-start --config ${CONFIGURATION_PROFILE_NAME}` \r\n3. Once your session has been established, you’ll see `Connected` printed out to your terminal. You can now also interrogate your sessions by running `openvpn3 sessions-list`\r\n\r\n### Resolve hostnames, and connect to private IP addresses\r\nThis following section will explain how to connect to a private Jenkins instance that you might have running in a private subnet behind your OpenVPN server, for example. This will only be true if you selected to have Jenkins deployed when you initially configured your Reference Architecture.\r\n\r\n1. Grab the private SSH key for the Jenkins machine. During deployment, this was automatically stored in your shared account’s secrets manager. Be sure you are viewing the exact region you have set as your `PrimaryRegion` in your `reference-architecure-form.yml` form. The secret will be named `jenkins-admin-v1` and its description will indicate it is the Back up SSH key for EC2 instances of class jenkins-admin-v1\r\n1. Save the key to your `~/.ssh/` directory and give it a unique name, such as `~/.ssh/jenkins-key` \r\n1. Run `chmod 0400 ~/.ssh/jenkins-key` so that it can only be read by your user \r\n1. Run `ssh-add ~/.ssh/jenkins-key` . If you get an error about your `ssh-agent` not being available, run  `eval $(ssh-agent)` and then try running your `ssh-add` command again. Once you see a message about the identity being successfully added, and when you can see your key loaded when running `ssh-add -l`, you’re good to go, as your SSH agent will present this key to the server when attempting to negotiate an SSH connection. \r\n1. Now that you are connected to the OpenVPN server, you can resolve any hostnames that are private to this network, as well as resolve any hosts by their private IP. This means you can now look up your Jenkins instance, for example - if you selected Jenkins - on your AWS Web console’s EC2 page and use its private IP address when SSH’ing to it: `ssh ubuntu@<private-ip-address>`","bodyHTML":"<h1 dir=\"auto\">How to access a RefArch OpenVPN server from a Linux machine</h1>\n<h3 dir=\"auto\">Install openvpn3 client</h3>\n<p dir=\"auto\">Follow <a href=\"https://openvpn.net/cloud-docs/openvpn-3-client-for-linux/\" rel=\"nofollow\">these instructions</a> to install the <code class=\"notranslate\">openvpn3</code> client on your Linux machine.</p>\n<h3 dir=\"auto\">Join the OpenVPN IAM Group</h3>\n<p dir=\"auto\">To get access to an OpenVPN server, your IAM User needs access to SQS queues used by that OpenVPN server.</p>\n<p dir=\"auto\">Since our IAM Users are defined in one AWS account (security) and the OpenVPN servers are defined in separate AWS accounts<br>\n(stage, prod, etc), that means you need to \"switch\" to the accounts with the OpenVPN servers by assuming an IAM Role<br>\nthat has access to the SQS queues in those accounts.</p>\n<p dir=\"auto\">To be able to assume an IAM Role, your IAM User needs to be part of an IAM Group with the proper permissions, such as<br>\n<code class=\"notranslate\">_account.xxx-full-access</code> or <code class=\"notranslate\">_account.xxx-openvpn-users</code>, where <code class=\"notranslate\">xxx</code> is the name of the account you want to access<br>\n(<code class=\"notranslate\">stage</code>, <code class=\"notranslate\">prod</code>, etc). See <a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/docs/02-authenticate.md#configure-other-iam-users\">Configure other IAM Users</a> for instructions on adding users to<br>\nIAM Groups.</p>\n<h3 dir=\"auto\">Use openvpn-admin to generate a configuration file</h3>\n<p dir=\"auto\">To connect to an OpenVPN server, you need an OpenVPN configuration file, which includes a certificate that you can use<br>\nto authenticate. To generate this configuration file, do the following:</p>\n<ol dir=\"auto\">\n<li>Install the latest <a href=\"https://github.com/gruntwork-io/terraform-aws-openvpn/releases\">openvpn-admin binary</a> for your OS.</li>\n<li><a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/docs/02-authenticate.md#authenticate-to-aws-via-the-cli\">Authenticate to AWS via the CLI</a>. You will need to assume an IAM Role in the AWS<br>\naccount with the OpenVPN server you're trying to connect to. This IAM Role must have access to the SQS queues used<br>\nby OpenVPN server. Typically, the <code class=\"notranslate\">allow-full-access-from-other-accounts</code> or<br>\n<code class=\"notranslate\">openvpn-server-allow-certificate-requests-for-external-accounts</code> IAM Role is what you want.</li>\n<li>Run <code class=\"notranslate\">openvpn-admin request --aws-region &lt;AWS REGION&gt; --username &lt;YOUR IAM USERNAME&gt;</code>. Note that this command will work whether or not you have a valid IAM user</li>\n<li>This will create your OpenVPN configuration file in the current folder. It will be named <code class=\"notranslate\">&lt;YOUR IAM USERNAME YOU SUPPLIED&gt;.ovpn</code> .</li>\n</ol>\n<h3 dir=\"auto\">Load your config file into openvpn3 client and connect</h3>\n<ol dir=\"auto\">\n<li>Load this configuration file into your OpenVPN client by running <code class=\"notranslate\">openvpn3 config-import --config ${MY_CONFIGURATION_FILE}</code> where <code class=\"notranslate\">MY_CONFIGURATION_FILE</code> is the path to your <code class=\"notranslate\">&lt;your-name&gt;.ovpn</code> file</li>\n<li>Start a session using this configuration (connect to the VPN server) by running <code class=\"notranslate\">openvpn3 session-start --config ${CONFIGURATION_PROFILE_NAME}</code></li>\n<li>Once your session has been established, you’ll see <code class=\"notranslate\">Connected</code> printed out to your terminal. You can now also interrogate your sessions by running <code class=\"notranslate\">openvpn3 sessions-list</code></li>\n</ol>\n<h3 dir=\"auto\">Resolve hostnames, and connect to private IP addresses</h3>\n<p dir=\"auto\">This following section will explain how to connect to a private Jenkins instance that you might have running in a private subnet behind your OpenVPN server, for example. This will only be true if you selected to have Jenkins deployed when you initially configured your Reference Architecture.</p>\n<ol dir=\"auto\">\n<li>Grab the private SSH key for the Jenkins machine. During deployment, this was automatically stored in your shared account’s secrets manager. Be sure you are viewing the exact region you have set as your <code class=\"notranslate\">PrimaryRegion</code> in your <code class=\"notranslate\">reference-architecure-form.yml</code> form. The secret will be named <code class=\"notranslate\">jenkins-admin-v1</code> and its description will indicate it is the Back up SSH key for EC2 instances of class jenkins-admin-v1</li>\n<li>Save the key to your <code class=\"notranslate\">~/.ssh/</code> directory and give it a unique name, such as <code class=\"notranslate\">~/.ssh/jenkins-key</code></li>\n<li>Run <code class=\"notranslate\">chmod 0400 ~/.ssh/jenkins-key</code> so that it can only be read by your user</li>\n<li>Run <code class=\"notranslate\">ssh-add ~/.ssh/jenkins-key</code> . If you get an error about your <code class=\"notranslate\">ssh-agent</code> not being available, run  <code class=\"notranslate\">eval $(ssh-agent)</code> and then try running your <code class=\"notranslate\">ssh-add</code> command again. Once you see a message about the identity being successfully added, and when you can see your key loaded when running <code class=\"notranslate\">ssh-add -l</code>, you’re good to go, as your SSH agent will present this key to the server when attempting to negotiate an SSH connection.</li>\n<li>Now that you are connected to the OpenVPN server, you can resolve any hostnames that are private to this network, as well as resolve any hosts by their private IP. This means you can now look up your Jenkins instance, for example - if you selected Jenkins - on your AWS Web console’s EC2 page and use its private IP address when SSH’ing to it: <code class=\"notranslate\">ssh ubuntu@&lt;private-ip-address&gt;</code></li>\n</ol>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "8a35594791a5625df2cbf2d6be22953b"
}
##DOCS-SOURCER-END -->
