---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/491" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Permissions in the CI/CD Pipeline</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AQBBS","number":491,"author":{"login":"pete0emerson"},"title":"Permissions in the CI/CD Pipeline","body":"\nHow do I control who can do what in the CI/CD pipeline?\r\n\r\nFor example, suppose I want to allow some developers to deploy any infrastructure they want in the `dev` account, but in the `stage` account, I want to enforce peer approval of a PR, and in the `prod` account, I want only a select group of people to be able to approve and merge the PR.\r\n\r\nDoes this require breaking each of the accounts into separate Github repositories, so that each repository can have its own Github workflow and CircleCI (in our case) configuration?\r\n\r\nDo you have examples of this in action?\n\n---\n\n<ins datetime=\"2022-07-06T19:51:55Z\">\n  <p><a href=\"https://support.gruntwork.io/hc/requests/108931\">Tracked in ticket #108931</a></p>\n</ins>\n","bodyHTML":"<p dir=\"auto\">How do I control who can do what in the CI/CD pipeline?</p>\n<p dir=\"auto\">For example, suppose I want to allow some developers to deploy any infrastructure they want in the <code class=\"notranslate\">dev</code> account, but in the <code class=\"notranslate\">stage</code> account, I want to enforce peer approval of a PR, and in the <code class=\"notranslate\">prod</code> account, I want only a select group of people to be able to approve and merge the PR.</p>\n<p dir=\"auto\">Does this require breaking each of the accounts into separate Github repositories, so that each repository can have its own Github workflow and CircleCI (in our case) configuration?</p>\n<p dir=\"auto\">Do you have examples of this in action?</p>\n<hr>\n<ins datetime=\"2022-07-06T19:51:55Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/108931\" rel=\"nofollow\">Tracked in ticket #108931</a></p>\n</ins>","answer":{"body":"In general, it is very hard to restrict the CI/CD flow when someone has write access to a repository. While the various VCS systems have some form of branch protection feature, these features are generally fairly limited in what you can limit.\r\n\r\nIn most cases, if you have advanced use cases with ACLs and CI/CD, it is best to break apart the code for each of the environment subsets into separate repos so that you only grant write access to the users that are allowed to freely deploy.\r\n\r\nNote that depending on the VCS system, you may be able to craft a branch protection rule that allows implementation of the flow you would like. For example, on GitHub, you can implement branch protection with `CODEOWNERS` such that you must have a PR to merge into `main`, and every PR requires an approval from a `CODEOWNER`. Then, you can implement code owner rules such that `prod` and `stage` have a different set of users who can approve the code to deploy.\r\n\r\nBe aware that even this has limitation, as you can't dynamically adjust the number of reviews that are required. So you wouldn't be able to specify that changes to the `dev` folder are allowed to be merged without approval.","bodyHTML":"<p dir=\"auto\">In general, it is very hard to restrict the CI/CD flow when someone has write access to a repository. While the various VCS systems have some form of branch protection feature, these features are generally fairly limited in what you can limit.</p>\n<p dir=\"auto\">In most cases, if you have advanced use cases with ACLs and CI/CD, it is best to break apart the code for each of the environment subsets into separate repos so that you only grant write access to the users that are allowed to freely deploy.</p>\n<p dir=\"auto\">Note that depending on the VCS system, you may be able to craft a branch protection rule that allows implementation of the flow you would like. For example, on GitHub, you can implement branch protection with <code class=\"notranslate\">CODEOWNERS</code> such that you must have a PR to merge into <code class=\"notranslate\">main</code>, and every PR requires an approval from a <code class=\"notranslate\">CODEOWNER</code>. Then, you can implement code owner rules such that <code class=\"notranslate\">prod</code> and <code class=\"notranslate\">stage</code> have a different set of users who can approve the code to deploy.</p>\n<p dir=\"auto\">Be aware that even this has limitation, as you can't dynamically adjust the number of reviews that are required. So you wouldn't be able to specify that changes to the <code class=\"notranslate\">dev</code> folder are allowed to be merged without approval.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "f61e1392536c35453c969bb18a4495e7"
}
##DOCS-SOURCER-END -->
