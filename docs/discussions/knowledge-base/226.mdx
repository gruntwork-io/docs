---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/226" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Recommended approach to updating terraform, terragrunt, and Service Catalog modules?</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AO4G7","number":226,"author":{"login":"yorinasub17"},"title":"Recommended approach to updating terraform, terragrunt, and Service Catalog modules?","body":"Hello, we are looking to modernize our infrastructure code and want to upgrade our `terraform`, `terragrunt`, and service catalog module versions. We are currently on versions `0.12.29`, `0.26`, and `0.11.2`. Any recommendations on how to approach this? Should I update a particular tool first?","bodyHTML":"<p dir=\"auto\">Hello, we are looking to modernize our infrastructure code and want to upgrade our <code class=\"notranslate\">terraform</code>, <code class=\"notranslate\">terragrunt</code>, and service catalog module versions. We are currently on versions <code class=\"notranslate\">0.12.29</code>, <code class=\"notranslate\">0.26</code>, and <code class=\"notranslate\">0.11.2</code>. Any recommendations on how to approach this? Should I update a particular tool first?</p>","answer":{"body":"In general, the strategy described in https://github.com/gruntwork-io/knowledge-base/discussions/43 is the best approach for managing an upgrade of `terraform` and `terragrunt`.\r\n\r\nHowever, this is complicated by the introduction of upgrading the service catalog, which itself may have backward incompatibilities, especially when going from terraform version 0.12.\r\n\r\nGiven that, I recommend the following approach to updating the three together:\r\n\r\n1. Upgrade `terragrunt` to the latest version first, and make sure your configuration is compatible by running a `terragrunt run-all validate` and `terragrunt run-all plan`. Since `terragrunt` updates are mostly isolated to the `terragrunt` configuration, it is the least disruptive to your infrastructure to update `terragrunt`.\r\n1. Next, you will want to upgrade `terraform-aws-service-catalog` to the last version supported before the next `terraform` version bump. Note that you will want to pay attention to the release notes in each backward incompatible version bump as you upgrade (the `x` in `0.x.y`) to make sure you take care of all the migration settings to avoid recreating resources. If you are starting with terraform `0.12`, then this will be `v0.16.0` of the service catalog.\r\n2. Once you update to `v0.16.0`, you can start to upgrade the `terraform` version.\r\n    - You will want to update one minor terraform version at a time, all the way up to `1.0.x`. To update each module, first install the next minor version on your local machine, and then run `terragrunt run-all init && terragrunt run-all plan` to make sure no changes are being made. Once you verify no changes are made, run `terragrunt run-all apply` to commit the version update to the state.\r\n    - Note that when upgrading from 0.12 to 0.13, you will run into an issue with the provider versioning due to a change in how providers are labeled in the state file. To fix this, for each provider required by the module, run `terragrunt run-all state replace-provider -- -/PROVIDER_NAME hashicorp/PROVIDER_NAME` (e.g., for `aws`, the command is `terragrunt run-all state replace-provider -- -/aws hashicorp/aws`). **You will want to run this after the `terragrunt run-all init` call.**\r\n3. At this point, you should be on terraform `1.0.x` and the latest terragrunt version. You are now free to upgrade the service catalog as far up as you would like.\r\n\r\nNOTE: If you are using the `ecs-deploy-runner`, you will also want to make sure the `deploy-runner` container is using the same versions of `terraform` and `terragrunt` as you are upgrading to.","bodyHTML":"<p dir=\"auto\">In general, the strategy described in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"3652834\" data-permission-text=\"Title is private\" data-url=\"https://github.com/gruntwork-io/knowledge-base/discussions/43\" data-hovercard-type=\"discussion\" data-hovercard-url=\"/gruntwork-io/knowledge-base/discussions/43/hovercard\" href=\"https://github.com/orgs/gruntwork-io/discussions/43\">#43</a> is the best approach for managing an upgrade of <code class=\"notranslate\">terraform</code> and <code class=\"notranslate\">terragrunt</code>.</p>\n<p dir=\"auto\">However, this is complicated by the introduction of upgrading the service catalog, which itself may have backward incompatibilities, especially when going from terraform version 0.12.</p>\n<p dir=\"auto\">Given that, I recommend the following approach to updating the three together:</p>\n<ol dir=\"auto\">\n<li>Upgrade <code class=\"notranslate\">terragrunt</code> to the latest version first, and make sure your configuration is compatible by running a <code class=\"notranslate\">terragrunt run-all validate</code> and <code class=\"notranslate\">terragrunt run-all plan</code>. Since <code class=\"notranslate\">terragrunt</code> updates are mostly isolated to the <code class=\"notranslate\">terragrunt</code> configuration, it is the least disruptive to your infrastructure to update <code class=\"notranslate\">terragrunt</code>.</li>\n<li>Next, you will want to upgrade <code class=\"notranslate\">terraform-aws-service-catalog</code> to the last version supported before the next <code class=\"notranslate\">terraform</code> version bump. Note that you will want to pay attention to the release notes in each backward incompatible version bump as you upgrade (the <code class=\"notranslate\">x</code> in <code class=\"notranslate\">0.x.y</code>) to make sure you take care of all the migration settings to avoid recreating resources. If you are starting with terraform <code class=\"notranslate\">0.12</code>, then this will be <code class=\"notranslate\">v0.16.0</code> of the service catalog.</li>\n<li>Once you update to <code class=\"notranslate\">v0.16.0</code>, you can start to upgrade the <code class=\"notranslate\">terraform</code> version.\n<ul dir=\"auto\">\n<li>You will want to update one minor terraform version at a time, all the way up to <code class=\"notranslate\">1.0.x</code>. To update each module, first install the next minor version on your local machine, and then run <code class=\"notranslate\">terragrunt run-all init &amp;&amp; terragrunt run-all plan</code> to make sure no changes are being made. Once you verify no changes are made, run <code class=\"notranslate\">terragrunt run-all apply</code> to commit the version update to the state.</li>\n<li>Note that when upgrading from 0.12 to 0.13, you will run into an issue with the provider versioning due to a change in how providers are labeled in the state file. To fix this, for each provider required by the module, run <code class=\"notranslate\">terragrunt run-all state replace-provider -- -/PROVIDER_NAME hashicorp/PROVIDER_NAME</code> (e.g., for <code class=\"notranslate\">aws</code>, the command is <code class=\"notranslate\">terragrunt run-all state replace-provider -- -/aws hashicorp/aws</code>). <strong>You will want to run this after the <code class=\"notranslate\">terragrunt run-all init</code> call.</strong></li>\n</ul>\n</li>\n<li>At this point, you should be on terraform <code class=\"notranslate\">1.0.x</code> and the latest terragrunt version. You are now free to upgrade the service catalog as far up as you would like.</li>\n</ol>\n<p dir=\"auto\">NOTE: If you are using the <code class=\"notranslate\">ecs-deploy-runner</code>, you will also want to make sure the <code class=\"notranslate\">deploy-runner</code> container is using the same versions of <code class=\"notranslate\">terraform</code> and <code class=\"notranslate\">terragrunt</code> as you are upgrading to.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "fb97d61ce0edff2469d5a3f300017b96"
}
##DOCS-SOURCER-END -->
