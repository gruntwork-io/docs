---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/148" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Seamless removal of resources through CI ?</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AOmxN","number":148,"author":{"login":"rgarrigue"},"title":"Seamless removal of resources through CI ?","body":"Hi there\r\n\r\nTo create resources with our Gitlab CI we just add the folder/subfolder/terragrunt.hcl. During the MR phase, the pipeline will run-all plan, once merged it'll run-all apply, all good.\r\n\r\nBut how do we remove resources ? If we make a MR removing the folder, then nothing happens, the plan-all / run-all will juste ignore the folder/subfolder/terraform.tfstate (we're using the `key = \"${path_relative_to_include()}/terraform.tfstate\"\r\n` configuration) in our S3 remote state storage forever.\r\n\r\nSo far we could think of three ways\r\n- Merge all the .tfstate, to work like raw terraform would I guess, with a single global state. Not ideal, would defeat one of the point of using Terragrunt.\r\n- Remove it manually, the MR just reflecting the live state of the infra. We will do that for a while, but we'ld really like to avoid operators doing stuff on their workstations, so it's just temporary.\r\n- Add a `create_stuff = true` argument to our terraform modules, and the removal takes place in 2 MRs, first `create_stuff = false`, then remove the file. Maybe the best solution, but it'll requires some work, and that's one more argument to propagate between modules & submodules etc.\r\n\r\nI read the documentation but I saw no recommended way for this. Did I missed something like a \"compare my whole directory structure with the remote state bucket structure and destroy missing stuff\" command ? Or a recommended CI workflow ? Maybe a third party tool like Atlantis is relevant here ?\r\n\r\nThanks in advance for any suggestions","bodyHTML":"<p dir=\"auto\">Hi there</p>\n<p dir=\"auto\">To create resources with our Gitlab CI we just add the folder/subfolder/terragrunt.hcl. During the MR phase, the pipeline will run-all plan, once merged it'll run-all apply, all good.</p>\n<p dir=\"auto\">But how do we remove resources ? If we make a MR removing the folder, then nothing happens, the plan-all / run-all will juste ignore the folder/subfolder/terraform.tfstate (we're using the <code class=\"notranslate\">key = \"${path_relative_to_include()}/terraform.tfstate\" </code> configuration) in our S3 remote state storage forever.</p>\n<p dir=\"auto\">So far we could think of three ways</p>\n<ul dir=\"auto\">\n<li>Merge all the .tfstate, to work like raw terraform would I guess, with a single global state. Not ideal, would defeat one of the point of using Terragrunt.</li>\n<li>Remove it manually, the MR just reflecting the live state of the infra. We will do that for a while, but we'ld really like to avoid operators doing stuff on their workstations, so it's just temporary.</li>\n<li>Add a <code class=\"notranslate\">create_stuff = true</code> argument to our terraform modules, and the removal takes place in 2 MRs, first <code class=\"notranslate\">create_stuff = false</code>, then remove the file. Maybe the best solution, but it'll requires some work, and that's one more argument to propagate between modules &amp; submodules etc.</li>\n</ul>\n<p dir=\"auto\">I read the documentation but I saw no recommended way for this. Did I missed something like a \"compare my whole directory structure with the remote state bucket structure and destroy missing stuff\" command ? Or a recommended CI workflow ? Maybe a third party tool like Atlantis is relevant here ?</p>\n<p dir=\"auto\">Thanks in advance for any suggestions</p>","answer":{"body":"Here's a write-up of how we run `apply` and `destroy` in our pipelines: https://blog.gruntwork.io/a-ci-cd-pipeline-for-terraform-and-terragrunt-5fd346e90c89","bodyHTML":"<p dir=\"auto\">Here's a write-up of how we run <code class=\"notranslate\">apply</code> and <code class=\"notranslate\">destroy</code> in our pipelines: <a href=\"https://blog.gruntwork.io/a-ci-cd-pipeline-for-terraform-and-terragrunt-5fd346e90c89\" rel=\"nofollow\">https://blog.gruntwork.io/a-ci-cd-pipeline-for-terraform-and-terragrunt-5fd346e90c89</a></p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "741420ee5fc57e5504c203c6c3879a57"
}
##DOCS-SOURCER-END -->
