---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/841" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>for_each in generate block</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AbMy_","number":841,"author":{"login":"kcadorin-alpha"},"title":"for_each in generate block","body":"Having a hard time trying to make this work.\r\n\r\nI'm trying to use the generate block to add a for_each and run the module multiple times depending on how much entries I have in the variable s3, but having lots of trouble making it right.\r\n\r\nThis are the important parts of the terragrunt.hcl file\r\n\r\n```\r\nlocals {\r\n  s3 = {\r\n    \"companies-data-service\" = {\r\n      enable_cloudfront        = true\r\n      cloudfront_allowed_paths = [\"logos/*\"]\r\n      cors_rules = {\r\n        \"local\" = {\r\n          methods = [\"POST\", \"HEAD\", \"PUT\", \"GET\"]\r\n          origins = [\"http://localhost:*\", \"https://*.test.io\"]\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\ngenerate \"cdn\" {\r\n  path      = \"cdn.tf\"\r\n  if_exists = \"overwrite\"\r\n  contents  = <<EOF\r\nmodule \"cdn\" {\r\n  source = \"git::git@github.com:my-org/terraform-modules.git//s3?ref=v0.0.21\"\r\n  for_each = { for $${k}, $${v} in \"${local.s3}\" : $${k} => $${v} }\r\n\r\n  name                     = \"${local.s3}\" != {} ? $${each.value} : \"\"\r\n  environment              = \"${local.parent.inputs.core_env_name}\"\r\n  cors_rules               = try($${each.value.cors_rules}, {})\r\n  enable_cloudfront        = try($${each.value.enable_cloudfront}, false)\r\n  enable_versioning        = try($${each.value.enable_versioning}, false)\r\n  cloudfront_allowed_paths = try($${each.value.cloudfront_allowed_paths}, [])\r\n  acm_certificate_arn      = \"${dependency.acm.outputs.acm_certificate_arn}\"\r\n  aliases                  = [\"$${each.key}-static.test.com\"]\r\n\r\n  enable_lifecycle_rules = try($${each.value.enable_lifecycle_rules}, false)\r\n  s3_lifecycle_rules     = try($${each.value.lifecycle_rules}, [])\r\n  bucket_policies        = try($${each.value.bucket_policies}, {})\r\n}\r\nEOF\r\n}\r\n```\r\n\r\nHaving these errors\r\n```\r\nlocal.s3 as object with 1 attribute \"companies-data-service\" \r\nERRO[0010] .\r\n                                           \r\nERRO[0010] Cannot include the given value in a string template: string required.\r\n \r\nERRO[0010] Error: Invalid template interpolation value\r\n```\r\n\r\nAlso tried the local.s3 variable like this:\r\n```\r\ns3 = {\r\n    companies = {\r\n      name = \"companies\"\r\n      enable_cloudfront        = true\r\n      cloudfront_allowed_paths = [\"logos/*\"]\r\n      cors_rules = {\r\n        \"local\" = {\r\n          methods = [\"POST\", \"HEAD\", \"PUT\", \"GET\"]\r\n          origins = [\"http://localhost:*\", \"https://*.test.io\"]\r\n        }\r\n      }\r\n    },\r\n    companies2 = {\r\n      name = \"companies-2\"\r\n      enable_cloudfront        = true\r\n      cloudfront_allowed_paths = [\"logos/*\"]\r\n      cors_rules = {\r\n        \"local\" = {\r\n          methods = [\"POST\", \"HEAD\", \"PUT\", \"GET\"]\r\n          origins = [\"http://localhost:*\", \"https://*.test.io\"]\r\n        }\r\n      }\r\n    }\r\n  }\r\n```\r\n\r\nAnd block generate like this:\r\n```\r\ngenerate \"cdn\" {\r\n  path      = \"cdn.tf\"\r\n  if_exists = \"overwrite\"\r\n  contents  = <<EOF\r\nmodule \"cdn\" {\r\n  source = \"git::git@github.com:my-org/terraform-modules.git//s3?ref=v0.0.21\"\r\n  for_each = \"${local.s3}\"\r\n\r\n  name                     = $${each.value.name}\r\n  environment              = \"${local.parent.inputs.core_env_name}\"\r\n  cors_rules               = try($${each.value.cors_rules}, {})\r\n  enable_cloudfront        = try($${each.value.enable_cloudfront}, false)\r\n  enable_versioning        = try($${each.value.enable_versioning}, false)\r\n  cloudfront_allowed_paths = try($${each.value.cloudfront_allowed_paths}, [])\r\n  acm_certificate_arn      = \"${dependency.acm.outputs.acm_certificate_arn}\"\r\n  aliases                  = [\"$${each.value.name}-static.test.com\"]\r\n\r\n  enable_lifecycle_rules = try($${each.value.enable_lifecycle_rules}, false)\r\n  s3_lifecycle_rules     = try($${each.value.lifecycle_rules}, [])\r\n  bucket_policies        = try($${each.value.bucket_policies}, {})\r\n}\r\nEOF\r\n}\r\n```\r\n\r\nTo validate my changes I tried to pass the locals inside the generate block like pure terraform code, that way it works.\r\n\r\n```\r\ngenerate \"cdn\" {\r\n  path      = \"cdn.tf\"\r\n  if_exists = \"overwrite\"\r\n  contents  = <<EOF\r\nlocals {\r\n  s3 = {\r\n    companies = {\r\n      name = \"companies\"\r\n      enable_cloudfront        = true\r\n      cloudfront_allowed_paths = [\"logos/*\"]\r\n      cors_rules = {\r\n        \"local\" = {\r\n          methods = [\"POST\", \"HEAD\", \"PUT\", \"GET\"]\r\n          origins = [\"http://localhost:*\", \"https://*.test.io\"]\r\n        }\r\n      }\r\n    },\r\n    companies2 = {\r\n      name = \"companies-2\"\r\n      enable_cloudfront        = true\r\n      cloudfront_allowed_paths = [\"logos/*\"]\r\n      cors_rules = {\r\n        \"local\" = {\r\n          methods = [\"POST\", \"HEAD\", \"PUT\", \"GET\"]\r\n          origins = [\"http://localhost:*\", \"https://*.test.io\"]\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\nmodule \"cdn\" {\r\n  source = \"git::git@github.com:my-org/terraform-modules.git//s3?ref=v0.0.21\"\r\n  for_each = local.s3\r\n\r\n  name                     = each.value.name\r\n  environment              = \"${local.parent.inputs.core_env_name}\"\r\n  cors_rules               = try(each.value.cors_rules, {})\r\n  enable_cloudfront        = try(each.value.enable_cloudfront, false)\r\n  enable_versioning        = try(each.value.enable_versioning, false)\r\n  cloudfront_allowed_paths = try(each.value.cloudfront_allowed_paths, [])\r\n  acm_certificate_arn      = \"${dependency.acm.outputs.acm_certificate_arn}\"\r\n  aliases                  = [\"$${each.value.name}-static.test.com\"]\r\n  enable_lifecycle_rules = try(each.value.enable_lifecycle_rules, false)\r\n  s3_lifecycle_rules     = try(each.value.lifecycle_rules, [])\r\n  bucket_policies        = try(each.value.bucket_policies, {})\r\n}\r\nEOF\r\n}\r\n```\r\n\r\nSo the issue is clearly with how terragrunt is passing the variable to the generate block, but I don't what is happening because terragrunt don't output anything I can use to debug that variable.\r\n\r\nAny help will be much appreciated.","bodyHTML":"<p dir=\"auto\">Having a hard time trying to make this work.</p>\n<p dir=\"auto\">I'm trying to use the generate block to add a for_each and run the module multiple times depending on how much entries I have in the variable s3, but having lots of trouble making it right.</p>\n<p dir=\"auto\">This are the important parts of the terragrunt.hcl file</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"locals {\n  s3 = {\n    &quot;companies-data-service&quot; = {\n      enable_cloudfront        = true\n      cloudfront_allowed_paths = [&quot;logos/*&quot;]\n      cors_rules = {\n        &quot;local&quot; = {\n          methods = [&quot;POST&quot;, &quot;HEAD&quot;, &quot;PUT&quot;, &quot;GET&quot;]\n          origins = [&quot;http://localhost:*&quot;, &quot;https://*.test.io&quot;]\n        }\n      }\n    }\n  }\n}\n\ngenerate &quot;cdn&quot; {\n  path      = &quot;cdn.tf&quot;\n  if_exists = &quot;overwrite&quot;\n  contents  = &lt;&lt;EOF\nmodule &quot;cdn&quot; {\n  source = &quot;git::git@github.com:my-org/terraform-modules.git//s3?ref=v0.0.21&quot;\n  for_each = { for $${k}, $${v} in &quot;${local.s3}&quot; : $${k} =&gt; $${v} }\n\n  name                     = &quot;${local.s3}&quot; != {} ? $${each.value} : &quot;&quot;\n  environment              = &quot;${local.parent.inputs.core_env_name}&quot;\n  cors_rules               = try($${each.value.cors_rules}, {})\n  enable_cloudfront        = try($${each.value.enable_cloudfront}, false)\n  enable_versioning        = try($${each.value.enable_versioning}, false)\n  cloudfront_allowed_paths = try($${each.value.cloudfront_allowed_paths}, [])\n  acm_certificate_arn      = &quot;${dependency.acm.outputs.acm_certificate_arn}&quot;\n  aliases                  = [&quot;$${each.key}-static.test.com&quot;]\n\n  enable_lifecycle_rules = try($${each.value.enable_lifecycle_rules}, false)\n  s3_lifecycle_rules     = try($${each.value.lifecycle_rules}, [])\n  bucket_policies        = try($${each.value.bucket_policies}, {})\n}\nEOF\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">locals {\n  s3 = {\n    \"companies-data-service\" = {\n      enable_cloudfront        = true\n      cloudfront_allowed_paths = [\"logos/*\"]\n      cors_rules = {\n        \"local\" = {\n          methods = [\"POST\", \"HEAD\", \"PUT\", \"GET\"]\n          origins = [\"http://localhost:*\", \"https://*.test.io\"]\n        }\n      }\n    }\n  }\n}\n\ngenerate \"cdn\" {\n  path      = \"cdn.tf\"\n  if_exists = \"overwrite\"\n  contents  = &lt;&lt;EOF\nmodule \"cdn\" {\n  source = \"git::git@github.com:my-org/terraform-modules.git//s3?ref=v0.0.21\"\n  for_each = { for $${k}, $${v} in \"${local.s3}\" : $${k} =&gt; $${v} }\n\n  name                     = \"${local.s3}\" != {} ? $${each.value} : \"\"\n  environment              = \"${local.parent.inputs.core_env_name}\"\n  cors_rules               = try($${each.value.cors_rules}, {})\n  enable_cloudfront        = try($${each.value.enable_cloudfront}, false)\n  enable_versioning        = try($${each.value.enable_versioning}, false)\n  cloudfront_allowed_paths = try($${each.value.cloudfront_allowed_paths}, [])\n  acm_certificate_arn      = \"${dependency.acm.outputs.acm_certificate_arn}\"\n  aliases                  = [\"$${each.key}-static.test.com\"]\n\n  enable_lifecycle_rules = try($${each.value.enable_lifecycle_rules}, false)\n  s3_lifecycle_rules     = try($${each.value.lifecycle_rules}, [])\n  bucket_policies        = try($${each.value.bucket_policies}, {})\n}\nEOF\n}\n</code></pre></div>\n<p dir=\"auto\">Having these errors</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"local.s3 as object with 1 attribute &quot;companies-data-service&quot; \nERRO[0010] .\n                                           \nERRO[0010] Cannot include the given value in a string template: string required.\n \nERRO[0010] Error: Invalid template interpolation value\"><pre class=\"notranslate\"><code class=\"notranslate\">local.s3 as object with 1 attribute \"companies-data-service\" \nERRO[0010] .\n                                           \nERRO[0010] Cannot include the given value in a string template: string required.\n \nERRO[0010] Error: Invalid template interpolation value\n</code></pre></div>\n<p dir=\"auto\">Also tried the local.s3 variable like this:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"s3 = {\n    companies = {\n      name = &quot;companies&quot;\n      enable_cloudfront        = true\n      cloudfront_allowed_paths = [&quot;logos/*&quot;]\n      cors_rules = {\n        &quot;local&quot; = {\n          methods = [&quot;POST&quot;, &quot;HEAD&quot;, &quot;PUT&quot;, &quot;GET&quot;]\n          origins = [&quot;http://localhost:*&quot;, &quot;https://*.test.io&quot;]\n        }\n      }\n    },\n    companies2 = {\n      name = &quot;companies-2&quot;\n      enable_cloudfront        = true\n      cloudfront_allowed_paths = [&quot;logos/*&quot;]\n      cors_rules = {\n        &quot;local&quot; = {\n          methods = [&quot;POST&quot;, &quot;HEAD&quot;, &quot;PUT&quot;, &quot;GET&quot;]\n          origins = [&quot;http://localhost:*&quot;, &quot;https://*.test.io&quot;]\n        }\n      }\n    }\n  }\"><pre class=\"notranslate\"><code class=\"notranslate\">s3 = {\n    companies = {\n      name = \"companies\"\n      enable_cloudfront        = true\n      cloudfront_allowed_paths = [\"logos/*\"]\n      cors_rules = {\n        \"local\" = {\n          methods = [\"POST\", \"HEAD\", \"PUT\", \"GET\"]\n          origins = [\"http://localhost:*\", \"https://*.test.io\"]\n        }\n      }\n    },\n    companies2 = {\n      name = \"companies-2\"\n      enable_cloudfront        = true\n      cloudfront_allowed_paths = [\"logos/*\"]\n      cors_rules = {\n        \"local\" = {\n          methods = [\"POST\", \"HEAD\", \"PUT\", \"GET\"]\n          origins = [\"http://localhost:*\", \"https://*.test.io\"]\n        }\n      }\n    }\n  }\n</code></pre></div>\n<p dir=\"auto\">And block generate like this:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"generate &quot;cdn&quot; {\n  path      = &quot;cdn.tf&quot;\n  if_exists = &quot;overwrite&quot;\n  contents  = &lt;&lt;EOF\nmodule &quot;cdn&quot; {\n  source = &quot;git::git@github.com:my-org/terraform-modules.git//s3?ref=v0.0.21&quot;\n  for_each = &quot;${local.s3}&quot;\n\n  name                     = $${each.value.name}\n  environment              = &quot;${local.parent.inputs.core_env_name}&quot;\n  cors_rules               = try($${each.value.cors_rules}, {})\n  enable_cloudfront        = try($${each.value.enable_cloudfront}, false)\n  enable_versioning        = try($${each.value.enable_versioning}, false)\n  cloudfront_allowed_paths = try($${each.value.cloudfront_allowed_paths}, [])\n  acm_certificate_arn      = &quot;${dependency.acm.outputs.acm_certificate_arn}&quot;\n  aliases                  = [&quot;$${each.value.name}-static.test.com&quot;]\n\n  enable_lifecycle_rules = try($${each.value.enable_lifecycle_rules}, false)\n  s3_lifecycle_rules     = try($${each.value.lifecycle_rules}, [])\n  bucket_policies        = try($${each.value.bucket_policies}, {})\n}\nEOF\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">generate \"cdn\" {\n  path      = \"cdn.tf\"\n  if_exists = \"overwrite\"\n  contents  = &lt;&lt;EOF\nmodule \"cdn\" {\n  source = \"git::git@github.com:my-org/terraform-modules.git//s3?ref=v0.0.21\"\n  for_each = \"${local.s3}\"\n\n  name                     = $${each.value.name}\n  environment              = \"${local.parent.inputs.core_env_name}\"\n  cors_rules               = try($${each.value.cors_rules}, {})\n  enable_cloudfront        = try($${each.value.enable_cloudfront}, false)\n  enable_versioning        = try($${each.value.enable_versioning}, false)\n  cloudfront_allowed_paths = try($${each.value.cloudfront_allowed_paths}, [])\n  acm_certificate_arn      = \"${dependency.acm.outputs.acm_certificate_arn}\"\n  aliases                  = [\"$${each.value.name}-static.test.com\"]\n\n  enable_lifecycle_rules = try($${each.value.enable_lifecycle_rules}, false)\n  s3_lifecycle_rules     = try($${each.value.lifecycle_rules}, [])\n  bucket_policies        = try($${each.value.bucket_policies}, {})\n}\nEOF\n}\n</code></pre></div>\n<p dir=\"auto\">To validate my changes I tried to pass the locals inside the generate block like pure terraform code, that way it works.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"generate &quot;cdn&quot; {\n  path      = &quot;cdn.tf&quot;\n  if_exists = &quot;overwrite&quot;\n  contents  = &lt;&lt;EOF\nlocals {\n  s3 = {\n    companies = {\n      name = &quot;companies&quot;\n      enable_cloudfront        = true\n      cloudfront_allowed_paths = [&quot;logos/*&quot;]\n      cors_rules = {\n        &quot;local&quot; = {\n          methods = [&quot;POST&quot;, &quot;HEAD&quot;, &quot;PUT&quot;, &quot;GET&quot;]\n          origins = [&quot;http://localhost:*&quot;, &quot;https://*.test.io&quot;]\n        }\n      }\n    },\n    companies2 = {\n      name = &quot;companies-2&quot;\n      enable_cloudfront        = true\n      cloudfront_allowed_paths = [&quot;logos/*&quot;]\n      cors_rules = {\n        &quot;local&quot; = {\n          methods = [&quot;POST&quot;, &quot;HEAD&quot;, &quot;PUT&quot;, &quot;GET&quot;]\n          origins = [&quot;http://localhost:*&quot;, &quot;https://*.test.io&quot;]\n        }\n      }\n    }\n  }\n}\nmodule &quot;cdn&quot; {\n  source = &quot;git::git@github.com:my-org/terraform-modules.git//s3?ref=v0.0.21&quot;\n  for_each = local.s3\n\n  name                     = each.value.name\n  environment              = &quot;${local.parent.inputs.core_env_name}&quot;\n  cors_rules               = try(each.value.cors_rules, {})\n  enable_cloudfront        = try(each.value.enable_cloudfront, false)\n  enable_versioning        = try(each.value.enable_versioning, false)\n  cloudfront_allowed_paths = try(each.value.cloudfront_allowed_paths, [])\n  acm_certificate_arn      = &quot;${dependency.acm.outputs.acm_certificate_arn}&quot;\n  aliases                  = [&quot;$${each.value.name}-static.test.com&quot;]\n  enable_lifecycle_rules = try(each.value.enable_lifecycle_rules, false)\n  s3_lifecycle_rules     = try(each.value.lifecycle_rules, [])\n  bucket_policies        = try(each.value.bucket_policies, {})\n}\nEOF\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">generate \"cdn\" {\n  path      = \"cdn.tf\"\n  if_exists = \"overwrite\"\n  contents  = &lt;&lt;EOF\nlocals {\n  s3 = {\n    companies = {\n      name = \"companies\"\n      enable_cloudfront        = true\n      cloudfront_allowed_paths = [\"logos/*\"]\n      cors_rules = {\n        \"local\" = {\n          methods = [\"POST\", \"HEAD\", \"PUT\", \"GET\"]\n          origins = [\"http://localhost:*\", \"https://*.test.io\"]\n        }\n      }\n    },\n    companies2 = {\n      name = \"companies-2\"\n      enable_cloudfront        = true\n      cloudfront_allowed_paths = [\"logos/*\"]\n      cors_rules = {\n        \"local\" = {\n          methods = [\"POST\", \"HEAD\", \"PUT\", \"GET\"]\n          origins = [\"http://localhost:*\", \"https://*.test.io\"]\n        }\n      }\n    }\n  }\n}\nmodule \"cdn\" {\n  source = \"git::git@github.com:my-org/terraform-modules.git//s3?ref=v0.0.21\"\n  for_each = local.s3\n\n  name                     = each.value.name\n  environment              = \"${local.parent.inputs.core_env_name}\"\n  cors_rules               = try(each.value.cors_rules, {})\n  enable_cloudfront        = try(each.value.enable_cloudfront, false)\n  enable_versioning        = try(each.value.enable_versioning, false)\n  cloudfront_allowed_paths = try(each.value.cloudfront_allowed_paths, [])\n  acm_certificate_arn      = \"${dependency.acm.outputs.acm_certificate_arn}\"\n  aliases                  = [\"$${each.value.name}-static.test.com\"]\n  enable_lifecycle_rules = try(each.value.enable_lifecycle_rules, false)\n  s3_lifecycle_rules     = try(each.value.lifecycle_rules, [])\n  bucket_policies        = try(each.value.bucket_policies, {})\n}\nEOF\n}\n</code></pre></div>\n<p dir=\"auto\">So the issue is clearly with how terragrunt is passing the variable to the generate block, but I don't what is happening because terragrunt don't output anything I can use to debug that variable.</p>\n<p dir=\"auto\">Any help will be much appreciated.</p>","answer":{"body":"I solved similar issue and came up with following solution which based on `%{ ... }` [directives](https://developer.hashicorp.com/terraform/language/expressions/strings#directives).\r\n\r\n```\r\nlocals {\r\n  [...]\r\n  conf                = yamldecode(file(find_in_parent_folders(\"conf.yaml\")))\r\n}\r\n\r\n# Generate AWS providers\r\ngenerate \"aws_providers\" {\r\n  path      = \"aws_providers.tf\"\r\n  if_exists = \"overwrite_terragrunt\"\r\n  contents  = <<EOF\r\nterraform { required_version = \">= 1.0.0, < 2.0.0\" }\r\n\r\n%{for item in slice(local.conf[\"workload_aws_providers\"][local.env], 1, length(local.conf[\"workload_aws_providers\"][local.env]))~}\r\nprovider \"aws\" {\r\n  alias  = \"${keys(item)[0]}_${replace(values(item)[0], \"-\", \"_\")}\"\r\n  region = \"${values(item)[0]}\"\r\n  assume_role { role_arn = \"${local.aws_provider_roles[keys(item)[0]]}\" }\r\n  default_tags { tags = merge(var.tags, {\r\n    \"workload\"           = \"${local.workload}\",\r\n    \"env\"                = \"${local.env}\",\r\n    \"workload_component\" = \"${local.workload_component}\"\r\n  }) }\r\n}\r\n%{endfor~}\r\n\r\nEOF\r\n}\r\n```","bodyHTML":"<p dir=\"auto\">I solved similar issue and came up with following solution which based on <code class=\"notranslate\">%{ ... }</code> <a href=\"https://developer.hashicorp.com/terraform/language/expressions/strings#directives\" rel=\"nofollow\">directives</a>.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"locals {\n  [...]\n  conf                = yamldecode(file(find_in_parent_folders(&quot;conf.yaml&quot;)))\n}\n\n# Generate AWS providers\ngenerate &quot;aws_providers&quot; {\n  path      = &quot;aws_providers.tf&quot;\n  if_exists = &quot;overwrite_terragrunt&quot;\n  contents  = &lt;&lt;EOF\nterraform { required_version = &quot;&gt;= 1.0.0, &lt; 2.0.0&quot; }\n\n%{for item in slice(local.conf[&quot;workload_aws_providers&quot;][local.env], 1, length(local.conf[&quot;workload_aws_providers&quot;][local.env]))~}\nprovider &quot;aws&quot; {\n  alias  = &quot;${keys(item)[0]}_${replace(values(item)[0], &quot;-&quot;, &quot;_&quot;)}&quot;\n  region = &quot;${values(item)[0]}&quot;\n  assume_role { role_arn = &quot;${local.aws_provider_roles[keys(item)[0]]}&quot; }\n  default_tags { tags = merge(var.tags, {\n    &quot;workload&quot;           = &quot;${local.workload}&quot;,\n    &quot;env&quot;                = &quot;${local.env}&quot;,\n    &quot;workload_component&quot; = &quot;${local.workload_component}&quot;\n  }) }\n}\n%{endfor~}\n\nEOF\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">locals {\n  [...]\n  conf                = yamldecode(file(find_in_parent_folders(\"conf.yaml\")))\n}\n\n# Generate AWS providers\ngenerate \"aws_providers\" {\n  path      = \"aws_providers.tf\"\n  if_exists = \"overwrite_terragrunt\"\n  contents  = &lt;&lt;EOF\nterraform { required_version = \"&gt;= 1.0.0, &lt; 2.0.0\" }\n\n%{for item in slice(local.conf[\"workload_aws_providers\"][local.env], 1, length(local.conf[\"workload_aws_providers\"][local.env]))~}\nprovider \"aws\" {\n  alias  = \"${keys(item)[0]}_${replace(values(item)[0], \"-\", \"_\")}\"\n  region = \"${values(item)[0]}\"\n  assume_role { role_arn = \"${local.aws_provider_roles[keys(item)[0]]}\" }\n  default_tags { tags = merge(var.tags, {\n    \"workload\"           = \"${local.workload}\",\n    \"env\"                = \"${local.env}\",\n    \"workload_component\" = \"${local.workload_component}\"\n  }) }\n}\n%{endfor~}\n\nEOF\n}\n</code></pre></div>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "c37d7d56024f260248e706cc2674eb92"
}
##DOCS-SOURCER-END -->
