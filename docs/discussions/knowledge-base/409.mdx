---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/409" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Mock_Outputs Not Working</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84APehK","number":409,"author":{"login":"Robb1202"},"title":"Mock_Outputs Not Working","body":"I am still relatively new to Terragrunt and am having difficulty getting the `mock_outputs` function within my `Dependency` block to function correctly. We are using Terraform within a Gitlab CI/CD pipeline to deploy our code.\r\n\r\nMy pipeline's file structure is below with the `gateway/terragrunt.hcl` and `keyvault/terragrunt.hcl` source their respective modules.\r\n```\r\nroot\r\n├── terragrunt.hcl\r\n├── vars.yaml\r\n├── eastus\r\n  ├── services\r\n    ├── sdm\r\n      ├── gateways\r\n         └── terragrunt.hcl\r\n      ├── keyvault\r\n         └── terragrunt.hcl\r\n```\r\n<br>\r\n\r\nI am needing to utilize outputs from the **_gateways_** module to be injected into the **_keyvault_** module during the pipeline run. Therefore, \r\n- I have set a `dependencies` block to allow the **_gateways_** module to run before the **_keyvault_** module. \r\n- I have set a `dependency` block to pass the **_gateways_** outputs to the **_keyvault_** inputs. \r\n- Since this is a completely new setup where no infrastructure has been deployed, I've elected to use `mock_outputs` to handle the dependency outputs in the **_keyvault_** module. \r\n\r\nThe code for the **_keyvault_** terragrunt file is below:\r\n\r\n<br>\r\n\r\n```terragrunt\r\nterraform {\r\n  source = \"....\"\r\n}\r\n\r\n# Include all settings from the root terragrunt.hcl file\r\ninclude {\r\n  path = find_in_parent_folders()\r\n}\r\n\r\nlocals {\r\n  environment = \"snd\" # Choices here are: snd, dev, prd\r\n  vars   = yamldecode(file(find_in_parent_folders(\"vars.yaml\")))\r\n}\r\n\r\ndependencies {\r\n  paths = [\"../gateways\"]\r\n}\r\n\r\ndependency \"sdmvms_depends\" {\r\n  config_path  = \"../gateways\"\r\n  mock_outputs = {\r\n    kv_prefix = \"temp-dummy-prefix\"\r\n    vm_pid    = \"temp-dummy-pid\"\r\n  }\r\n  mock_outputs_allowed_terraform_commands = [\"init\", \"validate\", \"plan\"]\r\n}\r\n\r\ninputs = merge(\r\n  yamldecode(file(\"${find_in_parent_folders(\"global.yaml\", \"empty.yaml\")}\")),\r\n  yamldecode(file(\"${find_in_parent_folders(\"vars.yaml\", \"empty.yaml\")}\")),\r\n  {\r\n  region           = local.region\r\n  env              = local.environment  \r\n  subpx_keyvault   = dependency.sdmvms_depends.outputs.kv_prefix\r\n  vm_principalid   = dependency.sdmvms_depends.outputs.vm_pid\r\n\r\n  tags = {....}\r\n  }\r\n)\r\n```\r\n<br>\r\n\r\nWhat's occurring is that the `run-all plan` phase errors out with the following:\r\n\r\n<br>\r\n\r\n```\r\n╷\r\n│ Error: expected \"access_policy.0.object_id\" to be a valid UUID, got temp-dummy-pid\r\n│ \r\n│   with azurerm_key_vault.sdm_keyvault,\r\n│   on keyvault.tf line 34, in resource \"azurerm_key_vault\" \"sdm_keyvault\":\r\n│   34:     object_id               = var.vm_principalid\r\n│ \r\n╵\r\n```\r\n<br>\r\n\r\nHave done a ton of Googling on this issue and can't find what it is I'm doing wrong. I've tried utilizing several other functions within the `dependency` block (`skip_outputs = true`, `mock_outputs_merge_strategy_with_state`), but with no luck in getting things past PLAN.\r\n\r\nAny insight or suggestions would be greatly appreciated.\r\n\r\nMany thanks!\r\n\r\n\r\n---\r\n\r\n<ins datetime=\"2022-05-06T18:11:43Z\">\r\n  <p><a href=\"https://support.gruntwork.io/hc/requests/108565\">Tracked in ticket #108565</a></p>\r\n</ins>\r\n","bodyHTML":"<p dir=\"auto\">I am still relatively new to Terragrunt and am having difficulty getting the <code class=\"notranslate\">mock_outputs</code> function within my <code class=\"notranslate\">Dependency</code> block to function correctly. We are using Terraform within a Gitlab CI/CD pipeline to deploy our code.</p>\n<p dir=\"auto\">My pipeline's file structure is below with the <code class=\"notranslate\">gateway/terragrunt.hcl</code> and <code class=\"notranslate\">keyvault/terragrunt.hcl</code> source their respective modules.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"root\n├── terragrunt.hcl\n├── vars.yaml\n├── eastus\n  ├── services\n    ├── sdm\n      ├── gateways\n         └── terragrunt.hcl\n      ├── keyvault\n         └── terragrunt.hcl\"><pre class=\"notranslate\"><code>root\n├── terragrunt.hcl\n├── vars.yaml\n├── eastus\n  ├── services\n    ├── sdm\n      ├── gateways\n         └── terragrunt.hcl\n      ├── keyvault\n         └── terragrunt.hcl\n</code></pre></div>\n<br>\n<p dir=\"auto\">I am needing to utilize outputs from the <strong><em>gateways</em></strong> module to be injected into the <strong><em>keyvault</em></strong> module during the pipeline run. Therefore,</p>\n<ul dir=\"auto\">\n<li>I have set a <code class=\"notranslate\">dependencies</code> block to allow the <strong><em>gateways</em></strong> module to run before the <strong><em>keyvault</em></strong> module.</li>\n<li>I have set a <code class=\"notranslate\">dependency</code> block to pass the <strong><em>gateways</em></strong> outputs to the <strong><em>keyvault</em></strong> inputs.</li>\n<li>Since this is a completely new setup where no infrastructure has been deployed, I've elected to use <code class=\"notranslate\">mock_outputs</code> to handle the dependency outputs in the <strong><em>keyvault</em></strong> module.</li>\n</ul>\n<p dir=\"auto\">The code for the <strong><em>keyvault</em></strong> terragrunt file is below:</p>\n<br>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"terraform {\n  source = &quot;....&quot;\n}\n\n# Include all settings from the root terragrunt.hcl file\ninclude {\n  path = find_in_parent_folders()\n}\n\nlocals {\n  environment = &quot;snd&quot; # Choices here are: snd, dev, prd\n  vars   = yamldecode(file(find_in_parent_folders(&quot;vars.yaml&quot;)))\n}\n\ndependencies {\n  paths = [&quot;../gateways&quot;]\n}\n\ndependency &quot;sdmvms_depends&quot; {\n  config_path  = &quot;../gateways&quot;\n  mock_outputs = {\n    kv_prefix = &quot;temp-dummy-prefix&quot;\n    vm_pid    = &quot;temp-dummy-pid&quot;\n  }\n  mock_outputs_allowed_terraform_commands = [&quot;init&quot;, &quot;validate&quot;, &quot;plan&quot;]\n}\n\ninputs = merge(\n  yamldecode(file(&quot;${find_in_parent_folders(&quot;global.yaml&quot;, &quot;empty.yaml&quot;)}&quot;)),\n  yamldecode(file(&quot;${find_in_parent_folders(&quot;vars.yaml&quot;, &quot;empty.yaml&quot;)}&quot;)),\n  {\n  region           = local.region\n  env              = local.environment  \n  subpx_keyvault   = dependency.sdmvms_depends.outputs.kv_prefix\n  vm_principalid   = dependency.sdmvms_depends.outputs.vm_pid\n\n  tags = {....}\n  }\n)\"><pre lang=\"terragrunt\" class=\"notranslate\"><code>terraform {\n  source = \"....\"\n}\n\n# Include all settings from the root terragrunt.hcl file\ninclude {\n  path = find_in_parent_folders()\n}\n\nlocals {\n  environment = \"snd\" # Choices here are: snd, dev, prd\n  vars   = yamldecode(file(find_in_parent_folders(\"vars.yaml\")))\n}\n\ndependencies {\n  paths = [\"../gateways\"]\n}\n\ndependency \"sdmvms_depends\" {\n  config_path  = \"../gateways\"\n  mock_outputs = {\n    kv_prefix = \"temp-dummy-prefix\"\n    vm_pid    = \"temp-dummy-pid\"\n  }\n  mock_outputs_allowed_terraform_commands = [\"init\", \"validate\", \"plan\"]\n}\n\ninputs = merge(\n  yamldecode(file(\"${find_in_parent_folders(\"global.yaml\", \"empty.yaml\")}\")),\n  yamldecode(file(\"${find_in_parent_folders(\"vars.yaml\", \"empty.yaml\")}\")),\n  {\n  region           = local.region\n  env              = local.environment  \n  subpx_keyvault   = dependency.sdmvms_depends.outputs.kv_prefix\n  vm_principalid   = dependency.sdmvms_depends.outputs.vm_pid\n\n  tags = {....}\n  }\n)\n</code></pre></div>\n<br>\n<p dir=\"auto\">What's occurring is that the <code class=\"notranslate\">run-all plan</code> phase errors out with the following:</p>\n<br>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"╷\n│ Error: expected &quot;access_policy.0.object_id&quot; to be a valid UUID, got temp-dummy-pid\n│ \n│   with azurerm_key_vault.sdm_keyvault,\n│   on keyvault.tf line 34, in resource &quot;azurerm_key_vault&quot; &quot;sdm_keyvault&quot;:\n│   34:     object_id               = var.vm_principalid\n│ \n╵\"><pre class=\"notranslate\"><code>╷\n│ Error: expected \"access_policy.0.object_id\" to be a valid UUID, got temp-dummy-pid\n│ \n│   with azurerm_key_vault.sdm_keyvault,\n│   on keyvault.tf line 34, in resource \"azurerm_key_vault\" \"sdm_keyvault\":\n│   34:     object_id               = var.vm_principalid\n│ \n╵\n</code></pre></div>\n<br>\n<p dir=\"auto\">Have done a ton of Googling on this issue and can't find what it is I'm doing wrong. I've tried utilizing several other functions within the <code class=\"notranslate\">dependency</code> block (<code class=\"notranslate\">skip_outputs = true</code>, <code class=\"notranslate\">mock_outputs_merge_strategy_with_state</code>), but with no luck in getting things past PLAN.</p>\n<p dir=\"auto\">Any insight or suggestions would be greatly appreciated.</p>\n<p dir=\"auto\">Many thanks!</p>\n<hr>\n<ins datetime=\"2022-05-06T18:11:43Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/108565\" rel=\"nofollow\">Tracked in ticket #108565</a></p>\n</ins>","answer":{"body":"The `mock_outputs` is actually working correctly here to feed to `azurerm_key_vault`. In the error, you will see that it is properly using the mock value of `temp-dummy-pid`.\r\n\r\nHowever, the issue is that the terraform module you are calling can't accept the mock value for the input you are setting. This is expected if the underlying module uses a data source or has internal validation on the input value (which is what is happening in this case). You need to update the mock value to ensure it passes all the validation that the module expects.\r\n\r\nIn this case, based on the error message, I believe you can resolve this if you update `temp-dummy-pid` to be a valid UUID, which you can generate using python:\r\n\r\n```\r\npython3 -c \"import uuid; print(uuid.uuid4())\"\r\n```","bodyHTML":"<p dir=\"auto\">The <code class=\"notranslate\">mock_outputs</code> is actually working correctly here to feed to <code class=\"notranslate\">azurerm_key_vault</code>. In the error, you will see that it is properly using the mock value of <code class=\"notranslate\">temp-dummy-pid</code>.</p>\n<p dir=\"auto\">However, the issue is that the terraform module you are calling can't accept the mock value for the input you are setting. This is expected if the underlying module uses a data source or has internal validation on the input value (which is what is happening in this case). You need to update the mock value to ensure it passes all the validation that the module expects.</p>\n<p dir=\"auto\">In this case, based on the error message, I believe you can resolve this if you update <code class=\"notranslate\">temp-dummy-pid</code> to be a valid UUID, which you can generate using python:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"python3 -c &quot;import uuid; print(uuid.uuid4())&quot;\"><pre class=\"notranslate\"><code>python3 -c \"import uuid; print(uuid.uuid4())\"\n</code></pre></div>"}}} />

</CenterLayout>
  

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "5198bf118fa067c375c9db1a9e70f3f0"
}
##DOCS-SOURCER-END -->
