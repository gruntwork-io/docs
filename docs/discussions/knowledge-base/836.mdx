---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/836" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>How do you override provider versions in child modules?</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AaYAL","number":836,"author":{"login":"ShankyJS"},"title":"How do you override provider versions in child modules?","body":"\nContext: https://github.com/gruntwork-io/terragrunt/issues/2530\r\n\r\nThis is related to using mono-repo like environments where providers might not be the same for all your configurations, e.g\r\n\r\n````\r\n└── aws\r\n    ├── dev\r\n    │   ├── account.hcl\r\n    │   └── infra\r\n    │       ├── eks\r\n    │       │   └── terragrunt.hcl\r\n    │       ├── eks_addons\r\n    │       │   └── terragrunt.hcl\r\n    │       └── vpc\r\n    │           └── terragrunt.hcl\r\n    ├── prod\r\n    │   ├── account.hcl\r\n    │   ├── infra\r\n    │   │   ├── eks\r\n    │   │   │   └── terragrunt.hcl\r\n    │   │   └── eks_addons\r\n    │   │       └── terragrunt.hcl\r\n    │   └── networking\r\n    │       └── vpc\r\n    │           └── terragrunt.hcl\r\n    | └── terragrunt.hcl\r\n````\r\n\r\nSo let's say that terragrunt.hcl (root level) includes the following providers:\r\n\r\n```\r\ngenerate \"versions\" {\r\n  path      = \"versions.tf\"\r\n  if_exists = \"overwrite_terragrunt\"\r\n  contents  = <<EOF\r\nterraform {\r\n  required_providers {\r\n    aws = {\r\n      source = \"hashicorp/aws\"\r\n      version = \"5.46.0\"\r\n    }\r\n    random = {\r\n      source = \"hashicorp/random\"\r\n      version = \"3.5.1\"\r\n    }\r\n  }\r\n}\r\nEOF\r\n}\r\n```\r\n\r\nAnd let's say that the eks_addons needs\r\n\r\n````\r\ngenerate \"versions_overwrite\" {\r\n  path      = \"versions.tf\"\r\n  if_exists = \"overwrite\"\r\n  contents  = <<EOF\r\n    terraform {\r\n      required_providers {\r\n        aws = {\r\n          source  = \"hashicorp/aws\"\r\n          version = \">= 5.0\"\r\n        }\r\n        helm = {\r\n          source  = \"hashicorp/helm\"\r\n          version = \">= 2.9\"\r\n        }\r\n        kubernetes = {\r\n          source  = \"hashicorp/kubernetes\"\r\n          version = \">= 2.20\"\r\n        }\r\n        time = {\r\n          source  = \"hashicorp/time\"\r\n          version = \">= 0.9\"\r\n        }\r\n      }\r\n    }\r\nEOF\r\n}\r\n````\r\n\r\nBecause I have the overwrite in both places; Terragrunt actually is fighting over which overwrites at the end which sometimes results in errors like:\r\n\r\n````\r\n╷\r\n│ Error: Failed to query available provider packages\r\n│\r\n│ Could not retrieve the list of available versions for provider\r\n````\r\n\r\nOr \r\n\r\n````\r\n│ Error: Failed to query available provider packages\r\n│\r\n│ Could not retrieve the list of available versions for provider\r\n│ hashicorp/random: locked provider registry.terraform.io/hashicorp/random\r\n│ 3.6.2 does not match configured version constraint 3.5.1; must use\r\n│ terraform init -upgrade to allow selection of new versions\r\n````\r\n\r\nJust because a single module requires more providers it shouldn't mean that I need to add the provider to the root terragrunt, then that means all my modules require now to use the same providers, even if they don't need it and the worst case is that we can't properly test provider upgrades if we can't successfully override versions on child modules.\r\n\r\nHow do y'all handle this?\n\n---\n\n<ins datetime=\"2024-07-09T06:36:14Z\">\n  <p><a href=\"https://support.gruntwork.io/hc/requests/111329\">Tracked in ticket #111329</a></p>\n</ins>\n","bodyHTML":"<p dir=\"auto\">Context: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1668931815\" data-permission-text=\"Title is private\" data-url=\"https://github.com/gruntwork-io/terragrunt/issues/2530\" data-hovercard-type=\"issue\" data-hovercard-url=\"/gruntwork-io/terragrunt/issues/2530/hovercard\" href=\"https://github.com/gruntwork-io/terragrunt/issues/2530\">gruntwork-io/terragrunt#2530</a></p>\n<p dir=\"auto\">This is related to using mono-repo like environments where providers might not be the same for all your configurations, e.g</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"└── aws\n    ├── dev\n    │   ├── account.hcl\n    │   └── infra\n    │       ├── eks\n    │       │   └── terragrunt.hcl\n    │       ├── eks_addons\n    │       │   └── terragrunt.hcl\n    │       └── vpc\n    │           └── terragrunt.hcl\n    ├── prod\n    │   ├── account.hcl\n    │   ├── infra\n    │   │   ├── eks\n    │   │   │   └── terragrunt.hcl\n    │   │   └── eks_addons\n    │   │       └── terragrunt.hcl\n    │   └── networking\n    │       └── vpc\n    │           └── terragrunt.hcl\n    | └── terragrunt.hcl\"><pre class=\"notranslate\"><code class=\"notranslate\">└── aws\n    ├── dev\n    │   ├── account.hcl\n    │   └── infra\n    │       ├── eks\n    │       │   └── terragrunt.hcl\n    │       ├── eks_addons\n    │       │   └── terragrunt.hcl\n    │       └── vpc\n    │           └── terragrunt.hcl\n    ├── prod\n    │   ├── account.hcl\n    │   ├── infra\n    │   │   ├── eks\n    │   │   │   └── terragrunt.hcl\n    │   │   └── eks_addons\n    │   │       └── terragrunt.hcl\n    │   └── networking\n    │       └── vpc\n    │           └── terragrunt.hcl\n    | └── terragrunt.hcl\n</code></pre></div>\n<p dir=\"auto\">So let's say that terragrunt.hcl (root level) includes the following providers:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"generate &quot;versions&quot; {\n  path      = &quot;versions.tf&quot;\n  if_exists = &quot;overwrite_terragrunt&quot;\n  contents  = &lt;&lt;EOF\nterraform {\n  required_providers {\n    aws = {\n      source = &quot;hashicorp/aws&quot;\n      version = &quot;5.46.0&quot;\n    }\n    random = {\n      source = &quot;hashicorp/random&quot;\n      version = &quot;3.5.1&quot;\n    }\n  }\n}\nEOF\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">generate \"versions\" {\n  path      = \"versions.tf\"\n  if_exists = \"overwrite_terragrunt\"\n  contents  = &lt;&lt;EOF\nterraform {\n  required_providers {\n    aws = {\n      source = \"hashicorp/aws\"\n      version = \"5.46.0\"\n    }\n    random = {\n      source = \"hashicorp/random\"\n      version = \"3.5.1\"\n    }\n  }\n}\nEOF\n}\n</code></pre></div>\n<p dir=\"auto\">And let's say that the eks_addons needs</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"generate &quot;versions_overwrite&quot; {\n  path      = &quot;versions.tf&quot;\n  if_exists = &quot;overwrite&quot;\n  contents  = &lt;&lt;EOF\n    terraform {\n      required_providers {\n        aws = {\n          source  = &quot;hashicorp/aws&quot;\n          version = &quot;&gt;= 5.0&quot;\n        }\n        helm = {\n          source  = &quot;hashicorp/helm&quot;\n          version = &quot;&gt;= 2.9&quot;\n        }\n        kubernetes = {\n          source  = &quot;hashicorp/kubernetes&quot;\n          version = &quot;&gt;= 2.20&quot;\n        }\n        time = {\n          source  = &quot;hashicorp/time&quot;\n          version = &quot;&gt;= 0.9&quot;\n        }\n      }\n    }\nEOF\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">generate \"versions_overwrite\" {\n  path      = \"versions.tf\"\n  if_exists = \"overwrite\"\n  contents  = &lt;&lt;EOF\n    terraform {\n      required_providers {\n        aws = {\n          source  = \"hashicorp/aws\"\n          version = \"&gt;= 5.0\"\n        }\n        helm = {\n          source  = \"hashicorp/helm\"\n          version = \"&gt;= 2.9\"\n        }\n        kubernetes = {\n          source  = \"hashicorp/kubernetes\"\n          version = \"&gt;= 2.20\"\n        }\n        time = {\n          source  = \"hashicorp/time\"\n          version = \"&gt;= 0.9\"\n        }\n      }\n    }\nEOF\n}\n</code></pre></div>\n<p dir=\"auto\">Because I have the overwrite in both places; Terragrunt actually is fighting over which overwrites at the end which sometimes results in errors like:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"╷\n│ Error: Failed to query available provider packages\n│\n│ Could not retrieve the list of available versions for provider\"><pre class=\"notranslate\"><code class=\"notranslate\">╷\n│ Error: Failed to query available provider packages\n│\n│ Could not retrieve the list of available versions for provider\n</code></pre></div>\n<p dir=\"auto\">Or</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"│ Error: Failed to query available provider packages\n│\n│ Could not retrieve the list of available versions for provider\n│ hashicorp/random: locked provider registry.terraform.io/hashicorp/random\n│ 3.6.2 does not match configured version constraint 3.5.1; must use\n│ terraform init -upgrade to allow selection of new versions\"><pre class=\"notranslate\"><code class=\"notranslate\">│ Error: Failed to query available provider packages\n│\n│ Could not retrieve the list of available versions for provider\n│ hashicorp/random: locked provider registry.terraform.io/hashicorp/random\n│ 3.6.2 does not match configured version constraint 3.5.1; must use\n│ terraform init -upgrade to allow selection of new versions\n</code></pre></div>\n<p dir=\"auto\">Just because a single module requires more providers it shouldn't mean that I need to add the provider to the root terragrunt, then that means all my modules require now to use the same providers, even if they don't need it and the worst case is that we can't properly test provider upgrades if we can't successfully override versions on child modules.</p>\n<p dir=\"auto\">How do y'all handle this?</p>\n<hr>\n<ins datetime=\"2024-07-09T06:36:14Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/111329\" rel=\"nofollow\">Tracked in ticket #111329</a></p>\n</ins>","answer":{"body":"Hello Jhan! Terraform actually has something to handle this built in. You're looking for [override files](https://developer.hashicorp.com/terraform/language/files/override).\r\n\r\nIn this case, your versions.tf for eks_addons just needs to be named \"versions_override.tf\". From there terraform/tofu will do a block level merge of all of that blocks parameters. The specifics for how the terraform block gets merged is at the bottom of the docs [here](https://developer.hashicorp.com/terraform/language/files/override#merging-terraform-blocks).\r\n\r\nDoes that solve your problem?\r\n\r\n","bodyHTML":"<p dir=\"auto\">Hello Jhan! Terraform actually has something to handle this built in. You're looking for <a href=\"https://developer.hashicorp.com/terraform/language/files/override\" rel=\"nofollow\">override files</a>.</p>\n<p dir=\"auto\">In this case, your versions.tf for eks_addons just needs to be named \"versions_override.tf\". From there terraform/tofu will do a block level merge of all of that blocks parameters. The specifics for how the terraform block gets merged is at the bottom of the docs <a href=\"https://developer.hashicorp.com/terraform/language/files/override#merging-terraform-blocks\" rel=\"nofollow\">here</a>.</p>\n<p dir=\"auto\">Does that solve your problem?</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "b69fd36cbf2d45796d1dafd1ba1c8f9e"
}
##DOCS-SOURCER-END -->
