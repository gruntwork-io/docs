---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/19" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Provider error while trying to configure terragrunt in Atlantis CI</h1>
<GitHub discussion={{"id":"MDEwOkRpc2N1c3Npb24zNTQ5MjU3","number":19,"author":{"login":"gruntwork-support"},"title":"Provider error while trying to configure terragrunt in Atlantis CI","body":"_This message was extracted from a discussion that originally took place in Gruntwork Community Slack. Names and URLs have been removed where appropriate_\n\n**From a customer**\n\nGood morning. A basic question, sorry. I get errors using some of your account-baseline modules, due to an aws provider block embedded in the code that does not have any profile information. I assume the credentials should be taken from the root module (where the profile is defined) but it seems this doesn't happen. How would you expect me to pass the right credentials to that child module?\n\n```\n╷\n│ Error: error configuring Terraform AWS Provider: no valid credential sources for Terraform AWS Provider found.\n│\n│ Please see https://registry.terraform.io/providers/hashicorp/aws\n│ for more information about providing credentials.\n│\n│ Error: NoCredentialProviders: no valid providers in chain. Deprecated.\n│ \tFor verbose messaging see aws.Config.CredentialsChainVerboseErrors\n│\n│\n│   with module.account-baseline-app.module.config.provider[\"http://registry.terraform.io/hashicorp/aws\"].seed,\n│   on .terraform/modules/account-baseline-app.config/modules/aws-config-multi-region/main.tf line 25, in provider \"aws\":\n│   25: provider \"aws\" {\n```\n\nIn your module repo: https://github.com/gruntwork-io/terraform-aws-security/blob/master/modules/aws-config-multi-region/main.tf\n\n```\n# Set up a seed provider to query for the list of available regions\nprovider \"aws\" {\n  alias = \"seed\"\n\n  region = var.seed_region\n}\n```\n\nI am a bit confused since from the documentation it looks like no provider should be defined in a module:\n\n```\nEach resource in the configuration must be associated with one provider configuration. Provider configurations, unlike most other concepts in Terraform, are global to an entire Terraform configuration and can be shared across module boundaries. Provider configurations can be defined only in a root Terraform module.\nA module intended to be called by one or more other modules must not contain any provider blocks.\n```","bodyHTML":"<p dir=\"auto\"><em>This message was extracted from a discussion that originally took place in Gruntwork Community Slack. Names and URLs have been removed where appropriate</em></p>\n<p dir=\"auto\"><strong>From a customer</strong></p>\n<p dir=\"auto\">Good morning. A basic question, sorry. I get errors using some of your account-baseline modules, due to an aws provider block embedded in the code that does not have any profile information. I assume the credentials should be taken from the root module (where the profile is defined) but it seems this doesn't happen. How would you expect me to pass the right credentials to that child module?</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"╷\n│ Error: error configuring Terraform AWS Provider: no valid credential sources for Terraform AWS Provider found.\n│\n│ Please see https://registry.terraform.io/providers/hashicorp/aws\n│ for more information about providing credentials.\n│\n│ Error: NoCredentialProviders: no valid providers in chain. Deprecated.\n│ \tFor verbose messaging see aws.Config.CredentialsChainVerboseErrors\n│\n│\n│   with module.account-baseline-app.module.config.provider[&quot;http://registry.terraform.io/hashicorp/aws&quot;].seed,\n│   on .terraform/modules/account-baseline-app.config/modules/aws-config-multi-region/main.tf line 25, in provider &quot;aws&quot;:\n│   25: provider &quot;aws&quot; {\"><pre class=\"notranslate\"><code class=\"notranslate\">╷\n│ Error: error configuring Terraform AWS Provider: no valid credential sources for Terraform AWS Provider found.\n│\n│ Please see https://registry.terraform.io/providers/hashicorp/aws\n│ for more information about providing credentials.\n│\n│ Error: NoCredentialProviders: no valid providers in chain. Deprecated.\n│ \tFor verbose messaging see aws.Config.CredentialsChainVerboseErrors\n│\n│\n│   with module.account-baseline-app.module.config.provider[\"http://registry.terraform.io/hashicorp/aws\"].seed,\n│   on .terraform/modules/account-baseline-app.config/modules/aws-config-multi-region/main.tf line 25, in provider \"aws\":\n│   25: provider \"aws\" {\n</code></pre></div>\n<p dir=\"auto\">In your module repo: <a href=\"https://github.com/gruntwork-io/terraform-aws-security/blob/master/modules/aws-config-multi-region/main.tf\">https://github.com/gruntwork-io/terraform-aws-security/blob/master/modules/aws-config-multi-region/main.tf</a></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"# Set up a seed provider to query for the list of available regions\nprovider &quot;aws&quot; {\n  alias = &quot;seed&quot;\n\n  region = var.seed_region\n}\"><pre class=\"notranslate\"><code class=\"notranslate\"># Set up a seed provider to query for the list of available regions\nprovider \"aws\" {\n  alias = \"seed\"\n\n  region = var.seed_region\n}\n</code></pre></div>\n<p dir=\"auto\">I am a bit confused since from the documentation it looks like no provider should be defined in a module:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Each resource in the configuration must be associated with one provider configuration. Provider configurations, unlike most other concepts in Terraform, are global to an entire Terraform configuration and can be shared across module boundaries. Provider configurations can be defined only in a root Terraform module.\nA module intended to be called by one or more other modules must not contain any provider blocks.\"><pre class=\"notranslate\"><code class=\"notranslate\">Each resource in the configuration must be associated with one provider configuration. Provider configurations, unlike most other concepts in Terraform, are global to an entire Terraform configuration and can be shared across module boundaries. Provider configurations can be defined only in a root Terraform module.\nA module intended to be called by one or more other modules must not contain any provider blocks.\n</code></pre></div>","answer":{"body":"**From a grunt**\n\nAh so with our Landing Zone modules, because there are resources that need to be deployed in every region, we need to define the providers inside the modules so that the user doesn’t have the burden of defining R providers, one for each region.\n\nThis is indeed an anti-pattern according to terraform, and we are working on refactoring the multi-region approach to not need this (which is now possible thanks to new features in terraform 0.15).\n\nIn general, we recommend using an external tool that handles the AWS credentials and feeds it to the CLI via environment variables (e.g., [aws-vault](https://github.com/99designs/aws-vault)).\n\nIf you do wish to use the credentials file with profiles, you should be able to make it work if you set the `AWS_PROFILE` environment variable\n\nBTW, feel free to ask basic questions as well! It's perfectly reasonable. We're working on a way to make it easier to find answers.","bodyHTML":"<p dir=\"auto\"><strong>From a grunt</strong></p>\n<p dir=\"auto\">Ah so with our Landing Zone modules, because there are resources that need to be deployed in every region, we need to define the providers inside the modules so that the user doesn’t have the burden of defining R providers, one for each region.</p>\n<p dir=\"auto\">This is indeed an anti-pattern according to terraform, and we are working on refactoring the multi-region approach to not need this (which is now possible thanks to new features in terraform 0.15).</p>\n<p dir=\"auto\">In general, we recommend using an external tool that handles the AWS credentials and feeds it to the CLI via environment variables (e.g., <a href=\"https://github.com/99designs/aws-vault\">aws-vault</a>).</p>\n<p dir=\"auto\">If you do wish to use the credentials file with profiles, you should be able to make it work if you set the <code class=\"notranslate\">AWS_PROFILE</code> environment variable</p>\n<p dir=\"auto\">BTW, feel free to ask basic questions as well! It's perfectly reasonable. We're working on a way to make it easier to find answers.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "37103dab29c67d6a9b3c36e50a944da5"
}
##DOCS-SOURCER-END -->
