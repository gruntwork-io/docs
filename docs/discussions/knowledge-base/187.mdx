---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/187" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>AWS provider version 4.0.0 issues: How do I lock the version in the Reference Architecture (or Terragrunt for that matter)?</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AOwjD","number":187,"author":{"login":"yorinasub17"},"title":"AWS provider version 4.0.0 issues: How do I lock the version in the Reference Architecture (or Terragrunt for that matter)?","body":"When using `terragrunt` with the Service Catalog, I can't lock the provider version because injecting a `terraform` block with `required_providers` (e.g., via `generate`) results in an error:\r\n\r\n```\r\n╷\r\n│ Error: Duplicate required providers configuration\r\n│\r\n│   on provider_version.tf line 3, in terraform:\r\n│    3:   required_providers {\r\n│\r\n│ A module may have only one required providers configuration. The required\r\n│ providers were previously configured at main.tf:11,3-21.\r\n╵\r\n```\r\n\r\nThis is especially problematic now that AWS provider version 4.0 is released and it is breaking all the modules. How do I work around this and lock my provider version to 3.x series?","bodyHTML":"<p dir=\"auto\">When using <code class=\"notranslate\">terragrunt</code> with the Service Catalog, I can't lock the provider version because injecting a <code class=\"notranslate\">terraform</code> block with <code class=\"notranslate\">required_providers</code> (e.g., via <code class=\"notranslate\">generate</code>) results in an error:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"╷\n│ Error: Duplicate required providers configuration\n│\n│   on provider_version.tf line 3, in terraform:\n│    3:   required_providers {\n│\n│ A module may have only one required providers configuration. The required\n│ providers were previously configured at main.tf:11,3-21.\n╵\"><pre class=\"notranslate\"><code class=\"notranslate\">╷\n│ Error: Duplicate required providers configuration\n│\n│   on provider_version.tf line 3, in terraform:\n│    3:   required_providers {\n│\n│ A module may have only one required providers configuration. The required\n│ providers were previously configured at main.tf:11,3-21.\n╵\n</code></pre></div>\n<p dir=\"auto\">This is especially problematic now that AWS provider version 4.0 is released and it is breaking all the modules. How do I work around this and lock my provider version to 3.x series?</p>","answer":{"body":"You can work around this by using an [override file](https://www.terraform.io/language/files/override) in the `generate` block. The following `generate` block is confirmed to properly lock the version and work around this error. You can add this to the root `terragrunt.hcl` file to ensure all your modules use the 3.x series of the `aws` provider.\r\n\r\n```hcl\r\n# Use an override file to lock the provider version, regardless of if required_providers is defined in the modules.\r\ngenerate \"provider_version\" {\r\n  path      = \"provider_version_override.tf\"\r\n  if_exists = \"overwrite_terragrunt\"\r\n  contents  = <<EOF\r\nterraform {\r\n  required_providers {\r\n    aws = {\r\n      source  = \"hashicorp/aws\"\r\n      version = \"~> 3.0\"\r\n    }\r\n  }\r\n}\r\nEOF\r\n}\r\n```\r\n\r\nNote that you may have to remove the `.terraform.lock.hcl` file to ensure `terraform` downloads the proper provider version.","bodyHTML":"<p dir=\"auto\">You can work around this by using an <a href=\"https://www.terraform.io/language/files/override\" rel=\"nofollow\">override file</a> in the <code class=\"notranslate\">generate</code> block. The following <code class=\"notranslate\">generate</code> block is confirmed to properly lock the version and work around this error. You can add this to the root <code class=\"notranslate\">terragrunt.hcl</code> file to ensure all your modules use the 3.x series of the <code class=\"notranslate\">aws</code> provider.</p>\n<div class=\"highlight highlight-source-hcl notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# Use an override file to lock the provider version, regardless of if required_providers is defined in the modules.\ngenerate &quot;provider_version&quot; {\n  path      = &quot;provider_version_override.tf&quot;\n  if_exists = &quot;overwrite_terragrunt&quot;\n  contents  = &lt;&lt;EOF\nterraform {\n  required_providers {\n    aws = {\n      source  = &quot;hashicorp/aws&quot;\n      version = &quot;~&gt; 3.0&quot;\n    }\n  }\n}\nEOF\n}\"><pre class=\"notranslate\"><span class=\"pl-c\"><span class=\"pl-c\">#</span> Use an override file to lock the provider version, regardless of if required_providers is defined in the modules.<span class=\"pl-c\"></span></span>\n<span class=\"pl-en\">generate</span> <span class=\"pl-smi\">\"provider_version\"</span> {\n  <span class=\"pl-v\"><span class=\"pl-smi\">path</span>      <span class=\"pl-k\">=</span> </span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>provider_version_override.tf<span class=\"pl-pds\">\"</span></span>\n  <span class=\"pl-v\"><span class=\"pl-smi\">if_exists</span> <span class=\"pl-k\">=</span> </span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>overwrite_terragrunt<span class=\"pl-pds\">\"</span></span>\n  <span class=\"pl-v\"><span class=\"pl-smi\">contents</span>  <span class=\"pl-k\">=</span> </span><span class=\"pl-s\"><span class=\"pl-k\">&lt;&lt;</span><span class=\"pl-k\">EOF</span></span>\n<span class=\"pl-s\">terraform {</span>\n<span class=\"pl-s\">  required_providers {</span>\n<span class=\"pl-s\">    aws = {</span>\n<span class=\"pl-s\">      source  = \"hashicorp/aws\"</span>\n<span class=\"pl-s\">      version = \"~&gt; 3.0\"</span>\n<span class=\"pl-s\">    }</span>\n<span class=\"pl-s\">  }</span>\n<span class=\"pl-s\">}</span>\n<span class=\"pl-s\"><span class=\"pl-k\">EOF</span></span>\n}</pre></div>\n<p dir=\"auto\">Note that you may have to remove the <code class=\"notranslate\">.terraform.lock.hcl</code> file to ensure <code class=\"notranslate\">terraform</code> downloads the proper provider version.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "ab5f00617a00faea5588eccadb7927e0"
}
##DOCS-SOURCER-END -->
