---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/330" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Terraform stuck on creating resource</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84APMb5","number":330,"author":{"login":"Etiene"},"title":"Terraform stuck on creating resource","body":"Running the elasticsearch alarms example is timing out locally after ~1h. It gets stuck waiting for the elasticsearch cluster to be created `aws_elasticsearch_domain.cluster: Still creating... [XXmXXs elapsed]` and then fails with a timeout error. Increasing timeout on `go tests` didn't make a difference because there's a 1h creation timeout limit on the terraform resource itself, which isn't configurable on provider version < 4.8.0. (https://github.com/hashicorp/terraform-provider-aws/pull/17513)\r\n\r\nAdditional context: the elastic search domain does take a while to be created, but creation time should be around ~20min for this example. I am using `aws-vault` v4.4.1 for [AWS authentication](https://blog.gruntwork.io/authenticating-to-aws-with-environment-variables-e793d6f6d02e) to our sandbox account through the `allow-full-access-from-other-accounts` iam role. \r\n","bodyHTML":"<p dir=\"auto\">Running the elasticsearch alarms example is timing out locally after ~1h. It gets stuck waiting for the elasticsearch cluster to be created <code class=\"notranslate\">aws_elasticsearch_domain.cluster: Still creating... [XXmXXs elapsed]</code> and then fails with a timeout error. Increasing timeout on <code class=\"notranslate\">go tests</code> didn't make a difference because there's a 1h creation timeout limit on the terraform resource itself, which isn't configurable on provider version &lt; 4.8.0. (<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"803864302\" data-permission-text=\"Title is private\" data-url=\"https://github.com/hashicorp/terraform-provider-aws/issues/17513\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/hashicorp/terraform-provider-aws/pull/17513/hovercard\" href=\"https://github.com/hashicorp/terraform-provider-aws/pull/17513\">hashicorp/terraform-provider-aws#17513</a>)</p>\n<p dir=\"auto\">Additional context: the elastic search domain does take a while to be created, but creation time should be around ~20min for this example. I am using <code class=\"notranslate\">aws-vault</code> v4.4.1 for <a href=\"https://blog.gruntwork.io/authenticating-to-aws-with-environment-variables-e793d6f6d02e\" rel=\"nofollow\">AWS authentication</a> to our sandbox account through the <code class=\"notranslate\">allow-full-access-from-other-accounts</code> iam role.</p>","answer":{"body":"After running the example with TF LOG trace I found the issue: an expired token exception (see below). It seems that `aws-vault` has a timeout to assume roles of 15 minutes (see `--help` output below). Adjusting the `--assume-role-ttl` flag solved the issue.\r\n\r\nIf I run it like this, example tests now run without issues:\r\n`aws-vault exec sandbox --assume-role-ttl=1h -- go test -v -timeout 120m -parallel 128 -run TestElasticsearchAlarms`\r\n\r\n```\r\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: -----------------------------------------------------: timestamp=2022-03-29T15:21:01.150+0200\r\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: 2022-03-29T15:21:01.774+0200 [INFO]  provider.terraform-provider-aws_v3.75.1_x5: 2022/03/29 15:21:01 [DEBUG] [aws-sdk-go] DEBUG: Response es/DescribeElasticsearchDomain Details:\r\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: ---[ RESPONSE ]--------------------------------------\r\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: HTTP/1.1 403\r\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: Connection: close\r\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: Content-Length: 67\r\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: Content-Type: application/json\r\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: Date: Tue, 29 Mar 2022 13:21:01 GMT\r\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: Keep-Alive: timeout=5\r\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: X-Amzn-Errortype: ExpiredTokenException\r\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66:\r\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66:\r\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: -----------------------------------------------------: timestamp=2022-03-29T15:21:01.773+0200\r\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: 2022-03-29T15:21:01.774+0200 [INFO]  provider.terraform-provider-aws_v3.75.1_x5: 2022/03/29 15:21:01 [DEBUG] [aws-sdk-go]: timestamp=2022-03-29T15:21:01.773+0200\r\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: 2022-03-29T15:21:01.774+0200 [INFO]  provider.terraform-provider-aws_v3.75.1_x5: 2022/03/29 15:21:01 [DEBUG] [aws-sdk-go] DEBUG: Validate Response es/DescribeElasticsearchDomain failed, attempt 12/25, error ExpiredTokenException\r\n```\r\n\r\n\r\n```\r\naws-vault exec --help\r\nusage: aws-vault exec [<flags>] <profile> [<cmd>] [<args>...]\r\n\r\nExecutes a command with AWS credentials in the environment\r\n\r\nFlags:\r\n      --help                  Show context-sensitive help (also try --help-long and\r\n                              --help-man).\r\n      --version               Show application version.\r\n      --debug                 Show debugging output\r\n      --backend=BACKEND       Secret backend to use [keychain file]\r\n      --prompt=terminal       Prompt driver to use [terminal osascript]\r\n      --keychain=\"aws-vault\"  Name of macOS keychain to use, if it doesn't exist it will be\r\n                              created\r\n  -n, --no-session            Use root credentials, no session created\r\n  -t, --session-ttl=4h        Expiration time for aws session\r\n      --assume-role-ttl=15m   Expiration time for aws assumed role\r\n  -m, --mfa-token=MFA-TOKEN   The mfa token to use\r\n  -s, --server                Run the server in the background for credentials\r\n\r\nArgs:\r\n  <profile>  Name of the profile\r\n  [<cmd>]    Command to execute\r\n  [<args>]   Command arguments\r\n ```\r\n","bodyHTML":"<p dir=\"auto\">After running the example with TF LOG trace I found the issue: an expired token exception (see below). It seems that <code class=\"notranslate\">aws-vault</code> has a timeout to assume roles of 15 minutes (see <code class=\"notranslate\">--help</code> output below). Adjusting the <code class=\"notranslate\">--assume-role-ttl</code> flag solved the issue.</p>\n<p dir=\"auto\">If I run it like this, example tests now run without issues:<br>\n<code class=\"notranslate\">aws-vault exec sandbox --assume-role-ttl=1h -- go test -v -timeout 120m -parallel 128 -run TestElasticsearchAlarms</code></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"TestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: -----------------------------------------------------: timestamp=2022-03-29T15:21:01.150+0200\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: 2022-03-29T15:21:01.774+0200 [INFO]  provider.terraform-provider-aws_v3.75.1_x5: 2022/03/29 15:21:01 [DEBUG] [aws-sdk-go] DEBUG: Response es/DescribeElasticsearchDomain Details:\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: ---[ RESPONSE ]--------------------------------------\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: HTTP/1.1 403\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: Connection: close\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: Content-Length: 67\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: Content-Type: application/json\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: Date: Tue, 29 Mar 2022 13:21:01 GMT\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: Keep-Alive: timeout=5\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: X-Amzn-Errortype: ExpiredTokenException\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66:\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66:\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: -----------------------------------------------------: timestamp=2022-03-29T15:21:01.773+0200\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: 2022-03-29T15:21:01.774+0200 [INFO]  provider.terraform-provider-aws_v3.75.1_x5: 2022/03/29 15:21:01 [DEBUG] [aws-sdk-go]: timestamp=2022-03-29T15:21:01.773+0200\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: 2022-03-29T15:21:01.774+0200 [INFO]  provider.terraform-provider-aws_v3.75.1_x5: 2022/03/29 15:21:01 [DEBUG] [aws-sdk-go] DEBUG: Validate Response es/DescribeElasticsearchDomain failed, attempt 12/25, error ExpiredTokenException\"><pre class=\"notranslate\"><code class=\"notranslate\">TestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: -----------------------------------------------------: timestamp=2022-03-29T15:21:01.150+0200\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: 2022-03-29T15:21:01.774+0200 [INFO]  provider.terraform-provider-aws_v3.75.1_x5: 2022/03/29 15:21:01 [DEBUG] [aws-sdk-go] DEBUG: Response es/DescribeElasticsearchDomain Details:\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: ---[ RESPONSE ]--------------------------------------\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: HTTP/1.1 403\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: Connection: close\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: Content-Length: 67\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: Content-Type: application/json\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: Date: Tue, 29 Mar 2022 13:21:01 GMT\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: Keep-Alive: timeout=5\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: X-Amzn-Errortype: ExpiredTokenException\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66:\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66:\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: -----------------------------------------------------: timestamp=2022-03-29T15:21:01.773+0200\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: 2022-03-29T15:21:01.774+0200 [INFO]  provider.terraform-provider-aws_v3.75.1_x5: 2022/03/29 15:21:01 [DEBUG] [aws-sdk-go]: timestamp=2022-03-29T15:21:01.773+0200\nTestElasticsearchAlarms 2022-03-29T15:21:01+02:00 logger.go:66: 2022-03-29T15:21:01.774+0200 [INFO]  provider.terraform-provider-aws_v3.75.1_x5: 2022/03/29 15:21:01 [DEBUG] [aws-sdk-go] DEBUG: Validate Response es/DescribeElasticsearchDomain failed, attempt 12/25, error ExpiredTokenException\n</code></pre></div>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"aws-vault exec --help\nusage: aws-vault exec [&lt;flags&gt;] &lt;profile&gt; [&lt;cmd&gt;] [&lt;args&gt;...]\n\nExecutes a command with AWS credentials in the environment\n\nFlags:\n      --help                  Show context-sensitive help (also try --help-long and\n                              --help-man).\n      --version               Show application version.\n      --debug                 Show debugging output\n      --backend=BACKEND       Secret backend to use [keychain file]\n      --prompt=terminal       Prompt driver to use [terminal osascript]\n      --keychain=&quot;aws-vault&quot;  Name of macOS keychain to use, if it doesn't exist it will be\n                              created\n  -n, --no-session            Use root credentials, no session created\n  -t, --session-ttl=4h        Expiration time for aws session\n      --assume-role-ttl=15m   Expiration time for aws assumed role\n  -m, --mfa-token=MFA-TOKEN   The mfa token to use\n  -s, --server                Run the server in the background for credentials\n\nArgs:\n  &lt;profile&gt;  Name of the profile\n  [&lt;cmd&gt;]    Command to execute\n  [&lt;args&gt;]   Command arguments\"><pre class=\"notranslate\"><code class=\"notranslate\">aws-vault exec --help\nusage: aws-vault exec [&lt;flags&gt;] &lt;profile&gt; [&lt;cmd&gt;] [&lt;args&gt;...]\n\nExecutes a command with AWS credentials in the environment\n\nFlags:\n      --help                  Show context-sensitive help (also try --help-long and\n                              --help-man).\n      --version               Show application version.\n      --debug                 Show debugging output\n      --backend=BACKEND       Secret backend to use [keychain file]\n      --prompt=terminal       Prompt driver to use [terminal osascript]\n      --keychain=\"aws-vault\"  Name of macOS keychain to use, if it doesn't exist it will be\n                              created\n  -n, --no-session            Use root credentials, no session created\n  -t, --session-ttl=4h        Expiration time for aws session\n      --assume-role-ttl=15m   Expiration time for aws assumed role\n  -m, --mfa-token=MFA-TOKEN   The mfa token to use\n  -s, --server                Run the server in the background for credentials\n\nArgs:\n  &lt;profile&gt;  Name of the profile\n  [&lt;cmd&gt;]    Command to execute\n  [&lt;args&gt;]   Command arguments\n</code></pre></div>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "9c03429160436e88a8c61695ce97092f"
}
##DOCS-SOURCER-END -->
