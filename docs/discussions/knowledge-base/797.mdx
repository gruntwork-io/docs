---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/797" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>How do I close AWS accounts created using Gruntwork&apos;s Devops Foundations product and pipelines?</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AXELy","number":797,"author":{"login":"oredavids"},"title":"How do I close AWS accounts created using Gruntwork's Devops Foundations product and pipelines?","body":"\nPosting a commonly asked question here, and then I'll add an answer.\n\n---\n\n<ins datetime=\"2024-01-08T23:26:09Z\">\n  <p><a href=\"https://support.gruntwork.io/hc/requests/110686\">Tracked in ticket #110686</a></p>\n</ins>\n","bodyHTML":"<p dir=\"auto\">Posting a commonly asked question here, and then I'll add an answer.</p>\n<hr>\n<ins datetime=\"2024-01-08T23:26:09Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/110686\" rel=\"nofollow\">Tracked in ticket #110686</a></p>\n</ins>","answer":{"body":"We recommend using AWS Organizations for closing an account and destroying all of its resources for a smooth experience. Below are the complete set of steps to take:\r\n\r\n> [!CAUTION]\r\n> Before proceeding, take note of the resources that are currently provisioned within the AWS account you are about to close. If you have any billable resources within them, you may want to destroy them before initiating this process to reduce the amount you will be billed in the duration before the account is closed. \r\n>\r\n>  You may also run into issues with coordination between different accounts if resources remain present in the account to be closed that are referenced in other accounts (e.g. AWS Macie invites may make it so that resources in the `logs` account cannot be destroyed if the closing account has resources related to it still provisioned in the account baselines). If this is the case, you may want to ensure that your account baselines for the account are also destroyed before proceeding. \r\n\r\n### 1. Remove Account Info\r\n\r\n1. Navigate to the `_new-account-requests` folder in the central infra-live repository.\r\n2. Delete the account request file corresponding to each account slated for removal.\r\n\r\n> [!WARNING]\r\n> Do not attempt to delete more than 5 accounts at once because [Control Tower has concurrent operations limit of 5](https://github.com/gruntwork-io/terraform-aws-control-tower/tree/main/modules/landingzone/control-tower-account-factory#resourceinuseexception).\r\n\r\n3. Locate and update the `accounts.yml` file in the central infra-live repository, removing any data associated with the targeted accounts.\r\n\r\n### 2. Remove AWS Transit Gateway(TGW) attachments (Optional)\r\n\r\nIf an account being removed uses AWS TGW, you will need to remove the attachments by running the following commands sequentially:\r\n\r\n```bash\r\n  cd <NETWORK-ACCOUNT>/_global/transit_gateway_attachments/\r\n  terragrunt plan\r\n  terragrunt apply\r\n```\r\n\r\n### 3. Remove Control-tower module's management of targeted accounts (Optional)\r\n\r\nOne of the reasons you might be closing an account that was created using pipelines is that it failed to create correctly. In this event, you will have to do some local Terragrunt operations to remove the offending configuration from state to make it so that proceeding plans/applies are able to proceed without error.\r\n\r\nTo handle this, run the following commands sequentially:\r\n\r\n```bash\r\ncd management/_global/control-tower-multi-account-factory/\r\nterragrunt plan # Observe that targeted accounts are set for destruction\r\nterragrunt state rm 'module.accounts[\"<ACCOUNT_NAME>\"].aws_servicecatalog_provisioned_product.control_tower_factory' # Optionally, use 'rm -dry-run' to preview the removal.\r\nterragrunt plan # Verify no accounts are set for destruction but outputs are updated\r\nterragrunt apply # Apply the changes.\r\n```\r\n\r\n### 4. Infrastructure as Code(IAC) cleanup in central Infra-live:\r\n\r\n1. Remove the respective account folders from the central infra-live repository.\r\n2. Commit all changes on a branch, ensuring to include `[skip ci]` in the commit message to prevent Gruntwork Pipelines from initiating any destruction processes.\r\n4. Open a Pull Request, observe that `Pipelines Plan` is absent, approve and **squash-merge** the Pull Request, again ensuring to include `[skip ci]` in the commit message to prevent Gruntwork Pipelines from initiating any destruction processes.\r\n\r\n### 5. AWS Organization Account(s) Closure:\r\n\r\n1. Authenticate to your Management Account's AWS console.\r\n2. Visit the AWS Organizations page.\r\n3. For each account targeted for deletion, select the \"close\" option. In 90 days, AWS will delete the account.\r\n\r\n### 6. Infrastructure as Code(IAC) cleanup in team Infra-live(Optional):\r\n\r\nIf targeted accounts were created as part of a separate infra-live-team repository:\r\n1. If all the accounts in a team-repo have been closed; delete the entire repository else delete the accounts folders for only the closed accounts and follow the CI steps documented in **step 4.**\r\n2. If team repositories were removed above, complete the cleanup process by removing the deleted repository references from the Gruntwork Pipelines configuration in `.gruntwork/config` file located in the `infra-pipelines` repository via a PR and merge it into the `main` branch.","bodyHTML":"<p dir=\"auto\">We recommend using AWS Organizations for closing an account and destroying all of its resources for a smooth experience. Below are the complete set of steps to take:</p>\n<div class=\"markdown-alert markdown-alert-caution\" dir=\"auto\"><p class=\"markdown-alert-title\" dir=\"auto\"><svg class=\"octicon octicon-stop mr-2\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z\"></path></svg>Caution</p><p dir=\"auto\">Before proceeding, take note of the resources that are currently provisioned within the AWS account you are about to close. If you have any billable resources within them, you may want to destroy them before initiating this process to reduce the amount you will be billed in the duration before the account is closed.</p>\n<p dir=\"auto\">You may also run into issues with coordination between different accounts if resources remain present in the account to be closed that are referenced in other accounts (e.g. AWS Macie invites may make it so that resources in the <code class=\"notranslate\">logs</code> account cannot be destroyed if the closing account has resources related to it still provisioned in the account baselines). If this is the case, you may want to ensure that your account baselines for the account are also destroyed before proceeding.</p>\n</div>\n<h3 dir=\"auto\">1. Remove Account Info</h3>\n<ol dir=\"auto\">\n<li>Navigate to the <code class=\"notranslate\">_new-account-requests</code> folder in the central infra-live repository.</li>\n<li>Delete the account request file corresponding to each account slated for removal.</li>\n</ol>\n<div class=\"markdown-alert markdown-alert-warning\" dir=\"auto\"><p class=\"markdown-alert-title\" dir=\"auto\"><svg class=\"octicon octicon-alert mr-2\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z\"></path></svg>Warning</p><p dir=\"auto\">Do not attempt to delete more than 5 accounts at once because <a href=\"https://github.com/gruntwork-io/terraform-aws-control-tower/tree/main/modules/landingzone/control-tower-account-factory#resourceinuseexception\">Control Tower has concurrent operations limit of 5</a>.</p>\n</div>\n<ol start=\"3\" dir=\"auto\">\n<li>Locate and update the <code class=\"notranslate\">accounts.yml</code> file in the central infra-live repository, removing any data associated with the targeted accounts.</li>\n</ol>\n<h3 dir=\"auto\">2. Remove AWS Transit Gateway(TGW) attachments (Optional)</h3>\n<p dir=\"auto\">If an account being removed uses AWS TGW, you will need to remove the attachments by running the following commands sequentially:</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"  cd &lt;NETWORK-ACCOUNT&gt;/_global/transit_gateway_attachments/\n  terragrunt plan\n  terragrunt apply\"><pre class=\"notranslate\">  <span class=\"pl-c1\">cd</span> <span class=\"pl-k\">&lt;</span>NETWORK-ACCOUNT<span class=\"pl-k\">&gt;</span>/_global/transit_gateway_attachments/\n  terragrunt plan\n  terragrunt apply</pre></div>\n<h3 dir=\"auto\">3. Remove Control-tower module's management of targeted accounts (Optional)</h3>\n<p dir=\"auto\">One of the reasons you might be closing an account that was created using pipelines is that it failed to create correctly. In this event, you will have to do some local Terragrunt operations to remove the offending configuration from state to make it so that proceeding plans/applies are able to proceed without error.</p>\n<p dir=\"auto\">To handle this, run the following commands sequentially:</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"cd management/_global/control-tower-multi-account-factory/\nterragrunt plan # Observe that targeted accounts are set for destruction\nterragrunt state rm 'module.accounts[&quot;&lt;ACCOUNT_NAME&gt;&quot;].aws_servicecatalog_provisioned_product.control_tower_factory' # Optionally, use 'rm -dry-run' to preview the removal.\nterragrunt plan # Verify no accounts are set for destruction but outputs are updated\nterragrunt apply # Apply the changes.\"><pre class=\"notranslate\"><span class=\"pl-c1\">cd</span> management/_global/control-tower-multi-account-factory/\nterragrunt plan <span class=\"pl-c\"><span class=\"pl-c\">#</span> Observe that targeted accounts are set for destruction</span>\nterragrunt state rm <span class=\"pl-s\"><span class=\"pl-pds\">'</span>module.accounts[\"&lt;ACCOUNT_NAME&gt;\"].aws_servicecatalog_provisioned_product.control_tower_factory<span class=\"pl-pds\">'</span></span> <span class=\"pl-c\"><span class=\"pl-c\">#</span> Optionally, use 'rm -dry-run' to preview the removal.</span>\nterragrunt plan <span class=\"pl-c\"><span class=\"pl-c\">#</span> Verify no accounts are set for destruction but outputs are updated</span>\nterragrunt apply <span class=\"pl-c\"><span class=\"pl-c\">#</span> Apply the changes.</span></pre></div>\n<h3 dir=\"auto\">4. Infrastructure as Code(IAC) cleanup in central Infra-live:</h3>\n<ol dir=\"auto\">\n<li>Remove the respective account folders from the central infra-live repository.</li>\n<li>Commit all changes on a branch, ensuring to include <code class=\"notranslate\">[skip ci]</code> in the commit message to prevent Gruntwork Pipelines from initiating any destruction processes.</li>\n<li>Open a Pull Request, observe that <code class=\"notranslate\">Pipelines Plan</code> is absent, approve and <strong>squash-merge</strong> the Pull Request, again ensuring to include <code class=\"notranslate\">[skip ci]</code> in the commit message to prevent Gruntwork Pipelines from initiating any destruction processes.</li>\n</ol>\n<h3 dir=\"auto\">5. AWS Organization Account(s) Closure:</h3>\n<ol dir=\"auto\">\n<li>Authenticate to your Management Account's AWS console.</li>\n<li>Visit the AWS Organizations page.</li>\n<li>For each account targeted for deletion, select the \"close\" option. In 90 days, AWS will delete the account.</li>\n</ol>\n<h3 dir=\"auto\">6. Infrastructure as Code(IAC) cleanup in team Infra-live(Optional):</h3>\n<p dir=\"auto\">If targeted accounts were created as part of a separate infra-live-team repository:</p>\n<ol dir=\"auto\">\n<li>If all the accounts in a team-repo have been closed; delete the entire repository else delete the accounts folders for only the closed accounts and follow the CI steps documented in <strong>step 4.</strong></li>\n<li>If team repositories were removed above, complete the cleanup process by removing the deleted repository references from the Gruntwork Pipelines configuration in <code class=\"notranslate\">.gruntwork/config</code> file located in the <code class=\"notranslate\">infra-pipelines</code> repository via a PR and merge it into the <code class=\"notranslate\">main</code> branch.</li>\n</ol>"}}} />

</CenterLayout>
  

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "cb2de6c0927d480e29e159a0352c6f71"
}
##DOCS-SOURCER-END -->
