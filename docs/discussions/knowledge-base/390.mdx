---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/390" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>How do I set secrets manager entries as environment variables in the ECS service?</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84APWxK","number":390,"author":{"login":"yorinasub17"},"title":"How do I set secrets manager entries as environment variables in the ECS service?","body":"I am using the reference infrastructure with ecs module. What do I need to do to load a secrets manager entry as environment variables on the ECS service?","bodyHTML":"<p dir=\"auto\">I am using the reference infrastructure with ecs module. What do I need to do to load a secrets manager entry as environment variables on the ECS service?</p>","answer":{"body":"To share a secrets manager entry with an ECS service, you need to do the following:\r\n\r\n- Set the `secrets_manager_arns` to include the ARN of the secrets manager entry. This grants access to the secrets manager entry to the execution IAM role (NOT the IAM role of the task).\r\n- In the container definition for the service, include the necessary references to inject the secrets manager entry into the container. Refer to the [aws docs](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/specifying-sensitive-data-secrets.html) for an example of how to encode it. E.g.:\r\n```hcl\r\ncontainer_definitions = [{\r\n  name        = \"nginx\"\r\n  image       = \"nginx:1.17\"\r\n  memory      = 512\r\n  essential   = true\r\n  Environment = [{ name : \"TEST_NAME\", value : \"TEST_VALUE\" }]\r\n  secrets = [{\r\n    name = \"environment_variable_name\",\r\n    valueFrom = \"arn:aws:secretsmanager:region:aws_account_id:secret:secret_name-AbCdEf\"\r\n  }]\r\n  portMappings = [\r\n    {\r\n     \"hostPort\"      = 80\r\n      \"containerPort\" = 80\r\n      \"protocol\"      = \"tcp\"\r\n    }\r\n  ]\r\n}]\r\n```","bodyHTML":"<p dir=\"auto\">To share a secrets manager entry with an ECS service, you need to do the following:</p>\n<ul dir=\"auto\">\n<li>Set the <code class=\"notranslate\">secrets_manager_arns</code> to include the ARN of the secrets manager entry. This grants access to the secrets manager entry to the execution IAM role (NOT the IAM role of the task).</li>\n<li>In the container definition for the service, include the necessary references to inject the secrets manager entry into the container. Refer to the <a href=\"https://docs.aws.amazon.com/AmazonECS/latest/developerguide/specifying-sensitive-data-secrets.html\" rel=\"nofollow\">aws docs</a> for an example of how to encode it. E.g.:</li>\n</ul>\n<div class=\"highlight highlight-source-terraform notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"container_definitions = [{\n  name        = &quot;nginx&quot;\n  image       = &quot;nginx:1.17&quot;\n  memory      = 512\n  essential   = true\n  Environment = [{ name : &quot;TEST_NAME&quot;, value : &quot;TEST_VALUE&quot; }]\n  secrets = [{\n    name = &quot;environment_variable_name&quot;,\n    valueFrom = &quot;arn:aws:secretsmanager:region:aws_account_id:secret:secret_name-AbCdEf&quot;\n  }]\n  portMappings = [\n    {\n     &quot;hostPort&quot;      = 80\n      &quot;containerPort&quot; = 80\n      &quot;protocol&quot;      = &quot;tcp&quot;\n    }\n  ]\n}]\"><pre><span class=\"pl-v\"><span class=\"pl-smi\">container_definitions</span> <span class=\"pl-k\">= </span></span>[{\n  name        <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>nginx<span class=\"pl-pds\">\"</span></span>\n  image       <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>nginx:1.17<span class=\"pl-pds\">\"</span></span>\n  memory      <span class=\"pl-k\">=</span> <span class=\"pl-c1\">512</span>\n  essential   <span class=\"pl-k\">=</span> <span class=\"pl-c1\">true</span>\n  Environment <span class=\"pl-k\">=</span> [{ name <span class=\"pl-k\">:</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>TEST_NAME<span class=\"pl-pds\">\"</span></span>, value <span class=\"pl-k\">:</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>TEST_VALUE<span class=\"pl-pds\">\"</span></span> }]\n  secrets <span class=\"pl-k\">=</span> [{\n    name <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>environment_variable_name<span class=\"pl-pds\">\"</span></span>,\n    valueFrom <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>arn:aws:secretsmanager:region:aws_account_id:secret:secret_name-AbCdEf<span class=\"pl-pds\">\"</span></span>\n  }]\n  portMappings <span class=\"pl-k\">=</span> [\n    {\n     <span class=\"pl-pds\">\"</span>hostPort<span class=\"pl-pds\">\"</span>      <span class=\"pl-k\">=</span> <span class=\"pl-c1\">80</span>\n      <span class=\"pl-pds\">\"</span>containerPort<span class=\"pl-pds\">\"</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">80</span>\n      <span class=\"pl-pds\">\"</span>protocol<span class=\"pl-pds\">\"</span>      <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>tcp<span class=\"pl-pds\">\"</span></span>\n    }\n  ]\n}]</pre></div>"}}} />

</CenterLayout>
  

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "dfaac2cae0f09caeb1b3478020653e25"
}
##DOCS-SOURCER-END -->
