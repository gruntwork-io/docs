---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/846" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Issue connecting to OpenVPN server for certificate request</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84Ab2P2","number":846,"author":{"login":"erictompkins"},"title":"Issue connecting to OpenVPN server for certificate request","body":"We had to rebuild our [OpenVPN server](https://github.com/gruntwork-io/terraform-aws-openvpn) and we're now having timeout issues connecting to the server to set up a connection.\r\n\r\n[r:terraform-aws-openvpn](https://github.com/gruntwork-io/terraform-aws-openvpn)\r\n\r\nBelow is the connection attempt.\r\n\r\n```bash\r\naws-vault exec dev -- openvpn-admin request --aws-region us-east-1 --username xxx@xxxxx.com \r\n[openvpn-admin] INFO[2024-10-09T14:15:57-04:00] Looking up AWS username                      \r\n[openvpn-admin] INFO[2024-10-09T14:15:57-04:00] Looking up SQS queue                         \r\n[] INFO[2024-10-09T14:15:58-04:00] Running command: ping -D -v -s 1400 -t 2 -c 1 1.1.1.1 \r\nPING 1.1.1.1 (1.1.1.1): 1400 data bytes\r\n1408 bytes from 1.1.1.1: icmp_seq=0 ttl=54 time=16.473 ms\r\n\r\n--- 1.1.1.1 ping statistics ---\r\n1 packets transmitted, 1 packets received, 0.0% packet loss\r\nround-trip min/avg/max/stddev = 16.473/16.473/16.473/nan ms\r\n[] INFO[2024-10-09T14:15:58-04:00] Running command: ping -D -v -s 1500 -t 2 -c 1 1.1.1.1 \r\nPING 1.1.1.1 (1.1.1.1): 1500 data bytes\r\nping: sendto: Message too long\r\n\r\n--- 1.1.1.1 ping statistics ---\r\n1 packets transmitted, 0 packets received, 100.0% packet loss\r\n[] INFO[2024-10-09T14:16:00-04:00] Running command: ping -D -v -s 1450 -t 2 -c 1 1.1.1.1 \r\nPING 1.1.1.1 (1.1.1.1): 1450 data bytes\r\n1458 bytes from 1.1.1.1: icmp_seq=0 ttl=54 time=16.862 ms\r\n\r\n--- 1.1.1.1 ping statistics ---\r\n1 packets transmitted, 1 packets received, 0.0% packet loss\r\nround-trip min/avg/max/stddev = 16.862/16.862/16.862/0.000 ms\r\n[] INFO[2024-10-09T14:16:00-04:00] Running command: ping -D -v -s 1470 -t 2 -c 1 1.1.1.1 \r\nPING 1.1.1.1 (1.1.1.1): 1470 data bytes\r\n1478 bytes from 1.1.1.1: icmp_seq=0 ttl=54 time=19.388 ms\r\n\r\n--- 1.1.1.1 ping statistics ---\r\n1 packets transmitted, 1 packets received, 0.0% packet loss\r\nround-trip min/avg/max/stddev = 19.388/19.388/19.388/nan ms\r\n[] INFO[2024-10-09T14:16:00-04:00] Running command: ping -D -v -s 1480 -t 2 -c 1 1.1.1.1 \r\nPING 1.1.1.1 (1.1.1.1): 1480 data bytes\r\nping: sendto: Message too long\r\n\r\n--- 1.1.1.1 ping statistics ---\r\n1 packets transmitted, 0 packets received, 100.0% packet loss\r\n[openvpn-admin] INFO[2024-10-09T14:16:02-04:00] Submitting request for new certificate to https://sqs.us-east-1.amazonaws.com/xxxxxxxxxx/openvpn-response-8aa1ce0a-866a-11ef-a8e4-faa922a1daff \r\n[openvpn-admin] INFO[2024-10-09T14:16:02-04:00] Waiting for response from OpenVPN server     \r\nERROR: Failed to receive messages on https://sqs.us-east-1.amazonaws.com/xxxxxxxxx/openvpn-response-8aa1ce0a-866a-11ef-a8e4-faa922a1daff within 300 seconds\r\n```\r\n\r\nI checked the system log for the instance through the AWS console under Actions -> Monitor & Troubleshoot -> Get system log and I noticed that there was an issue with setting up the cloudwatch logs.\r\n\r\n```bash\r\nip-10-10-6-160 login: [   17.154357] cloud-init[792]: Cloud-init v. 22.2-0ubuntu1~20.04.3 running 'modules:config' at Wed, 09 Oct 2024 18:11:54 +0000. Up 16.67 seconds.\r\n\r\n<13>Oct  9 18:11:55 user-data: Starting CloudWatch Logs Agent in VPC mgmt\r\n\r\n<13>Oct  9 18:11:55 user-data: /var/lib/cloud/instance/scripts/part-001: line 19: /etc/user-data/cloudwatch-log-aggregation/run-cloudwatch-logs-agent.sh: No such file or directory\r\n```\r\n\r\nI also noticed this in the log:\r\n\r\n```bash\r\n[   17.714899] cloud-init[813]: Cloud-init v. 22.2-0ubuntu1~20.04.3 running 'modules:final' at Wed, 09 Oct 2024 18:11:55 +0000. Up 17.49 seconds.\r\n\r\n[   17.716443] cloud-init[813]: 2024-10-09 18:11:55,395 - cc_scripts_user.py[WARNING]: Failed to run module scripts-user (scripts in /var/lib/cloud/instance/scripts)\r\n\r\n[   17.718651] cloud-init[813]: 2024-10-09 18:11:55,395 - util.py[WARNING]: Running module scripts-user (<module 'cloudinit.config.cc_scripts_user' from '/usr/lib/python3/dist-packages/cloudinit/config/cc_scripts_user.py'>) failed\r\n```\r\n\r\nCould that be the cause? If so, any suggestions on how to fix this?\r\n\r\nThe instance is t2.medium","bodyHTML":"<p dir=\"auto\">We had to rebuild our <a href=\"https://github.com/gruntwork-io/terraform-aws-openvpn\">OpenVPN server</a> and we're now having timeout issues connecting to the server to set up a connection.</p>\n<p dir=\"auto\"><a href=\"https://github.com/gruntwork-io/terraform-aws-openvpn\">r:terraform-aws-openvpn</a></p>\n<p dir=\"auto\">Below is the connection attempt.</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"aws-vault exec dev -- openvpn-admin request --aws-region us-east-1 --username xxx@xxxxx.com \n[openvpn-admin] INFO[2024-10-09T14:15:57-04:00] Looking up AWS username                      \n[openvpn-admin] INFO[2024-10-09T14:15:57-04:00] Looking up SQS queue                         \n[] INFO[2024-10-09T14:15:58-04:00] Running command: ping -D -v -s 1400 -t 2 -c 1 1.1.1.1 \nPING 1.1.1.1 (1.1.1.1): 1400 data bytes\n1408 bytes from 1.1.1.1: icmp_seq=0 ttl=54 time=16.473 ms\n\n--- 1.1.1.1 ping statistics ---\n1 packets transmitted, 1 packets received, 0.0% packet loss\nround-trip min/avg/max/stddev = 16.473/16.473/16.473/nan ms\n[] INFO[2024-10-09T14:15:58-04:00] Running command: ping -D -v -s 1500 -t 2 -c 1 1.1.1.1 \nPING 1.1.1.1 (1.1.1.1): 1500 data bytes\nping: sendto: Message too long\n\n--- 1.1.1.1 ping statistics ---\n1 packets transmitted, 0 packets received, 100.0% packet loss\n[] INFO[2024-10-09T14:16:00-04:00] Running command: ping -D -v -s 1450 -t 2 -c 1 1.1.1.1 \nPING 1.1.1.1 (1.1.1.1): 1450 data bytes\n1458 bytes from 1.1.1.1: icmp_seq=0 ttl=54 time=16.862 ms\n\n--- 1.1.1.1 ping statistics ---\n1 packets transmitted, 1 packets received, 0.0% packet loss\nround-trip min/avg/max/stddev = 16.862/16.862/16.862/0.000 ms\n[] INFO[2024-10-09T14:16:00-04:00] Running command: ping -D -v -s 1470 -t 2 -c 1 1.1.1.1 \nPING 1.1.1.1 (1.1.1.1): 1470 data bytes\n1478 bytes from 1.1.1.1: icmp_seq=0 ttl=54 time=19.388 ms\n\n--- 1.1.1.1 ping statistics ---\n1 packets transmitted, 1 packets received, 0.0% packet loss\nround-trip min/avg/max/stddev = 19.388/19.388/19.388/nan ms\n[] INFO[2024-10-09T14:16:00-04:00] Running command: ping -D -v -s 1480 -t 2 -c 1 1.1.1.1 \nPING 1.1.1.1 (1.1.1.1): 1480 data bytes\nping: sendto: Message too long\n\n--- 1.1.1.1 ping statistics ---\n1 packets transmitted, 0 packets received, 100.0% packet loss\n[openvpn-admin] INFO[2024-10-09T14:16:02-04:00] Submitting request for new certificate to https://sqs.us-east-1.amazonaws.com/xxxxxxxxxx/openvpn-response-8aa1ce0a-866a-11ef-a8e4-faa922a1daff \n[openvpn-admin] INFO[2024-10-09T14:16:02-04:00] Waiting for response from OpenVPN server     \nERROR: Failed to receive messages on https://sqs.us-east-1.amazonaws.com/xxxxxxxxx/openvpn-response-8aa1ce0a-866a-11ef-a8e4-faa922a1daff within 300 seconds\"><pre class=\"notranslate\">aws-vault <span class=\"pl-c1\">exec</span> dev -- openvpn-admin request --aws-region us-east-1 --username xxx@xxxxx.com \n[openvpn-admin] INFO[2024-10-09T14:15:57-04:00] Looking up AWS username                      \n[openvpn-admin] INFO[2024-10-09T14:15:57-04:00] Looking up SQS queue                         \n[] INFO[2024-10-09T14:15:58-04:00] Running command: ping -D -v -s 1400 -t 2 -c 1 1.1.1.1 \nPING 1.1.1.1 (1.1.1.1): 1400 data bytes\n1408 bytes from 1.1.1.1: icmp_seq=0 ttl=54 time=16.473 ms\n\n--- 1.1.1.1 ping statistics ---\n1 packets transmitted, 1 packets received, 0.0% packet loss\nround-trip min/avg/max/stddev = 16.473/16.473/16.473/nan ms\n[] INFO[2024-10-09T14:15:58-04:00] Running command: ping -D -v -s 1500 -t 2 -c 1 1.1.1.1 \nPING 1.1.1.1 (1.1.1.1): 1500 data bytes\nping: sendto: Message too long\n\n--- 1.1.1.1 ping statistics ---\n1 packets transmitted, 0 packets received, 100.0% packet loss\n[] INFO[2024-10-09T14:16:00-04:00] Running command: ping -D -v -s 1450 -t 2 -c 1 1.1.1.1 \nPING 1.1.1.1 (1.1.1.1): 1450 data bytes\n1458 bytes from 1.1.1.1: icmp_seq=0 ttl=54 time=16.862 ms\n\n--- 1.1.1.1 ping statistics ---\n1 packets transmitted, 1 packets received, 0.0% packet loss\nround-trip min/avg/max/stddev = 16.862/16.862/16.862/0.000 ms\n[] INFO[2024-10-09T14:16:00-04:00] Running command: ping -D -v -s 1470 -t 2 -c 1 1.1.1.1 \nPING 1.1.1.1 (1.1.1.1): 1470 data bytes\n1478 bytes from 1.1.1.1: icmp_seq=0 ttl=54 time=19.388 ms\n\n--- 1.1.1.1 ping statistics ---\n1 packets transmitted, 1 packets received, 0.0% packet loss\nround-trip min/avg/max/stddev = 19.388/19.388/19.388/nan ms\n[] INFO[2024-10-09T14:16:00-04:00] Running command: ping -D -v -s 1480 -t 2 -c 1 1.1.1.1 \nPING 1.1.1.1 (1.1.1.1): 1480 data bytes\nping: sendto: Message too long\n\n--- 1.1.1.1 ping statistics ---\n1 packets transmitted, 0 packets received, 100.0% packet loss\n[openvpn-admin] INFO[2024-10-09T14:16:02-04:00] Submitting request <span class=\"pl-k\">for</span> new certificate to https://sqs.us-east-1.amazonaws.com/xxxxxxxxxx/openvpn-response-8aa1ce0a-866a-11ef-a8e4-faa922a1daff \n[openvpn-admin] INFO[2024-10-09T14:16:02-04:00] Waiting <span class=\"pl-k\">for</span> response from OpenVPN server     \nERROR: Failed to receive messages on https://sqs.us-east-1.amazonaws.com/xxxxxxxxx/openvpn-response-8aa1ce0a-866a-11ef-a8e4-faa922a1daff within 300 seconds</pre></div>\n<p dir=\"auto\">I checked the system log for the instance through the AWS console under Actions -&gt; Monitor &amp; Troubleshoot -&gt; Get system log and I noticed that there was an issue with setting up the cloudwatch logs.</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"ip-10-10-6-160 login: [   17.154357] cloud-init[792]: Cloud-init v. 22.2-0ubuntu1~20.04.3 running 'modules:config' at Wed, 09 Oct 2024 18:11:54 +0000. Up 16.67 seconds.\n\n&lt;13&gt;Oct  9 18:11:55 user-data: Starting CloudWatch Logs Agent in VPC mgmt\n\n&lt;13&gt;Oct  9 18:11:55 user-data: /var/lib/cloud/instance/scripts/part-001: line 19: /etc/user-data/cloudwatch-log-aggregation/run-cloudwatch-logs-agent.sh: No such file or directory\"><pre class=\"notranslate\">ip-10-10-6-160 login: [   17.154357] cloud-init[792]: Cloud-init v. 22.2-0ubuntu1~20.04.3 running <span class=\"pl-s\"><span class=\"pl-pds\">'</span>modules:config<span class=\"pl-pds\">'</span></span> at Wed, 09 Oct 2024 18:11:54 +0000. Up 16.67 seconds.\n\n<span class=\"pl-k\">&lt;</span>1<span class=\"pl-k\">3&gt;</span>Oct  9 18:11:55 user-data: Starting CloudWatch Logs Agent <span class=\"pl-k\">in</span> VPC mgmt\n\n<span class=\"pl-k\">&lt;</span>1<span class=\"pl-k\">3&gt;</span>Oct  9 18:11:55 user-data: /var/lib/cloud/instance/scripts/part-001: line 19: /etc/user-data/cloudwatch-log-aggregation/run-cloudwatch-logs-agent.sh: No such file or directory</pre></div>\n<p dir=\"auto\">I also noticed this in the log:</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"[   17.714899] cloud-init[813]: Cloud-init v. 22.2-0ubuntu1~20.04.3 running 'modules:final' at Wed, 09 Oct 2024 18:11:55 +0000. Up 17.49 seconds.\n\n[   17.716443] cloud-init[813]: 2024-10-09 18:11:55,395 - cc_scripts_user.py[WARNING]: Failed to run module scripts-user (scripts in /var/lib/cloud/instance/scripts)\n\n[   17.718651] cloud-init[813]: 2024-10-09 18:11:55,395 - util.py[WARNING]: Running module scripts-user (&lt;module 'cloudinit.config.cc_scripts_user' from '/usr/lib/python3/dist-packages/cloudinit/config/cc_scripts_user.py'&gt;) failed\"><pre class=\"notranslate\">[   17.714899] cloud-init[813]: Cloud-init v. 22.2-0ubuntu1~20.04.3 running <span class=\"pl-s\"><span class=\"pl-pds\">'</span>modules:final<span class=\"pl-pds\">'</span></span> at Wed, 09 Oct 2024 18:11:55 +0000. Up 17.49 seconds.\n\n[   17.716443] cloud-init[813]: 2024-10-09 18:11:55,395 - cc_scripts_user.py[WARNING]: Failed to run module scripts-user (scripts <span class=\"pl-k\">in</span> /var/lib/cloud/instance/scripts)\n\n[   17.718651] cloud-init[813]: 2024-10-09 18:11:55,395 - util.py[WARNING]: Running module scripts-user (<span class=\"pl-k\">&lt;</span>module <span class=\"pl-s\"><span class=\"pl-pds\">'</span>cloudinit.config.cc_scripts_user<span class=\"pl-pds\">'</span></span> from <span class=\"pl-s\"><span class=\"pl-pds\">'</span>/usr/lib/python3/dist-packages/cloudinit/config/cc_scripts_user.py<span class=\"pl-pds\">'</span></span><span class=\"pl-k\">&gt;</span>) failed</pre></div>\n<p dir=\"auto\">Could that be the cause? If so, any suggestions on how to fix this?</p>\n<p dir=\"auto\">The instance is t2.medium</p>","answer":{"body":"The issue was that our Openvpn module was old and needed updating. We updated to use the [Service Catalog OpenVPN module](https://docs.gruntwork.io/reference/services/security/open-vpn/) and that solved our issue.","bodyHTML":"<p dir=\"auto\">The issue was that our Openvpn module was old and needed updating. We updated to use the <a href=\"https://docs.gruntwork.io/reference/services/security/open-vpn/\" rel=\"nofollow\">Service Catalog OpenVPN module</a> and that solved our issue.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "ebc7954bb9b5252c0c4385a31e29e99a"
}
##DOCS-SOURCER-END -->
