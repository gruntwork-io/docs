---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/13" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>VPC CIDRS for cross-region peering</h1>
<GitHub discussion={{"id":"MDEwOkRpc2N1c3Npb24zNTQzNDAz","number":13,"author":{"login":"gruntwork-support"},"title":"VPC CIDRS for cross-region peering","body":"_This message was extracted from a discussion that originally took place in Gruntwork Community Slack. Names and URLs have been removed where appropriate_\n\n**From a customer**\n\nPicking through our new reference architecture deployment, I have a strategic question about VPC CIDRs related to cross-region peering:  the `app_vpc_cidrs` variable in `common.hcl` is not region-aware so if we add a new regions to an env, each `app` VPC will have the same CIDR - so we can't cross-region-peer them. How have others handled this in the reference architecture?\n\nI guess we could change:\n\n\n```\n  app_vpc_cidrs = {\n    development = \"10.0.0.0/16\"\n    production  = \"10.4.0.0/16\"\n    staging     = \"10.2.0.0/16\"\n  }\n```\n\nto\n\n\n```\n  app_vpc_cidrs = {\n    \"eu-central-1\" = {\n      development = \"10.0.0.0/16\"\n      staging     = \"10.2.0.0/16\"\n      production  = \"10.4.0.0/16\"\n    }\n    \"eu-north-1\" = {\n      development = \"10.1.0.0/16\"\n      staging     = \"10.3.0.0/16\"\n      production  = \"10.5.0.0/16\"\n    }\n  }\n```\n\nand update all the Terragrunt code accordingly, but would that send us down a bad path of messing too deeply with the base of the reference architecture?","bodyHTML":"<p dir=\"auto\"><em>This message was extracted from a discussion that originally took place in Gruntwork Community Slack. Names and URLs have been removed where appropriate</em></p>\n<p dir=\"auto\"><strong>From a customer</strong></p>\n<p dir=\"auto\">Picking through our new reference architecture deployment, I have a strategic question about VPC CIDRs related to cross-region peering:  the <code class=\"notranslate\">app_vpc_cidrs</code> variable in <code class=\"notranslate\">common.hcl</code> is not region-aware so if we add a new regions to an env, each <code class=\"notranslate\">app</code> VPC will have the same CIDR - so we can't cross-region-peer them. How have others handled this in the reference architecture?</p>\n<p dir=\"auto\">I guess we could change:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  app_vpc_cidrs = {\n    development = &quot;10.0.0.0/16&quot;\n    production  = &quot;10.4.0.0/16&quot;\n    staging     = &quot;10.2.0.0/16&quot;\n  }\"><pre class=\"notranslate\"><code class=\"notranslate\">  app_vpc_cidrs = {\n    development = \"10.0.0.0/16\"\n    production  = \"10.4.0.0/16\"\n    staging     = \"10.2.0.0/16\"\n  }\n</code></pre></div>\n<p dir=\"auto\">to</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  app_vpc_cidrs = {\n    &quot;eu-central-1&quot; = {\n      development = &quot;10.0.0.0/16&quot;\n      staging     = &quot;10.2.0.0/16&quot;\n      production  = &quot;10.4.0.0/16&quot;\n    }\n    &quot;eu-north-1&quot; = {\n      development = &quot;10.1.0.0/16&quot;\n      staging     = &quot;10.3.0.0/16&quot;\n      production  = &quot;10.5.0.0/16&quot;\n    }\n  }\"><pre class=\"notranslate\"><code class=\"notranslate\">  app_vpc_cidrs = {\n    \"eu-central-1\" = {\n      development = \"10.0.0.0/16\"\n      staging     = \"10.2.0.0/16\"\n      production  = \"10.4.0.0/16\"\n    }\n    \"eu-north-1\" = {\n      development = \"10.1.0.0/16\"\n      staging     = \"10.3.0.0/16\"\n      production  = \"10.5.0.0/16\"\n    }\n  }\n</code></pre></div>\n<p dir=\"auto\">and update all the Terragrunt code accordingly, but would that send us down a bad path of messing too deeply with the base of the reference architecture?</p>","answer":{"body":"**From a grunt**\n\nHey, Adam! So I’ve actually asked for some help from our subject matter experts on the Ref Arch &amp; here’s the answer:\n- You can nest the structure of `app_vpc_cidrs` to include the region, and then update the references to inject the region accordingly.\n- You can change the `common.hcl`  in whatever shape works for you!\nHere’s the example steps:\n\n1) Update `app_vpc_cidrs` to look like the following:\n\n\n```\napp_vpc_cidrs = {\n  dev = {\n    \"us-east-1\" = \"10.0.0.0/16\"\n    \"us-west-1\" = \"10.1.0.0/16\"\n  }\n  stage = {\n    \"us-east-1\" = \"10.2.0.0/16\"\n    \"us-west-1\" = \"10.3.0.0/16\"\n  }\n}\n```\n\n2) Update the reference to `app_vpc_cidrs`` to include the region. E.g., dev currently references the block like the following:\n\n```\ncidr_block = local.common_vars.locals.app_vpc_cidrs[local.account_name]\n```\n\n(see https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/dev/us-west-2/dev/networking/vpc/terragrunt.hcl#L49)\nThis should be updated to:\n\n```\ncidr_block = local.common_vars.locals.app_vpc_cidrs[local.account_name][local.aws_region]\n```\n\nmake sure that you’re not missing any references as well (e.g. `grep` to see what the references there are to `app_vpc_cidrs`","bodyHTML":"<p dir=\"auto\"><strong>From a grunt</strong></p>\n<p dir=\"auto\">Hey, Adam! So I’ve actually asked for some help from our subject matter experts on the Ref Arch &amp; here’s the answer:</p>\n<ul dir=\"auto\">\n<li>You can nest the structure of <code class=\"notranslate\">app_vpc_cidrs</code> to include the region, and then update the references to inject the region accordingly.</li>\n<li>You can change the <code class=\"notranslate\">common.hcl</code>  in whatever shape works for you!<br>\nHere’s the example steps:</li>\n</ul>\n<ol dir=\"auto\">\n<li>Update <code class=\"notranslate\">app_vpc_cidrs</code> to look like the following:</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"app_vpc_cidrs = {\n  dev = {\n    &quot;us-east-1&quot; = &quot;10.0.0.0/16&quot;\n    &quot;us-west-1&quot; = &quot;10.1.0.0/16&quot;\n  }\n  stage = {\n    &quot;us-east-1&quot; = &quot;10.2.0.0/16&quot;\n    &quot;us-west-1&quot; = &quot;10.3.0.0/16&quot;\n  }\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">app_vpc_cidrs = {\n  dev = {\n    \"us-east-1\" = \"10.0.0.0/16\"\n    \"us-west-1\" = \"10.1.0.0/16\"\n  }\n  stage = {\n    \"us-east-1\" = \"10.2.0.0/16\"\n    \"us-west-1\" = \"10.3.0.0/16\"\n  }\n}\n</code></pre></div>\n<ol start=\"2\" dir=\"auto\">\n<li>Update the reference to `app_vpc_cidrs`` to include the region. E.g., dev currently references the block like the following:</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"cidr_block = local.common_vars.locals.app_vpc_cidrs[local.account_name]\"><pre class=\"notranslate\"><code class=\"notranslate\">cidr_block = local.common_vars.locals.app_vpc_cidrs[local.account_name]\n</code></pre></div>\n<p dir=\"auto\">(see <a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/dev/us-west-2/dev/networking/vpc/terragrunt.hcl#L49\">https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/dev/us-west-2/dev/networking/vpc/terragrunt.hcl#L49</a>)<br>\nThis should be updated to:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"cidr_block = local.common_vars.locals.app_vpc_cidrs[local.account_name][local.aws_region]\"><pre class=\"notranslate\"><code class=\"notranslate\">cidr_block = local.common_vars.locals.app_vpc_cidrs[local.account_name][local.aws_region]\n</code></pre></div>\n<p dir=\"auto\">make sure that you’re not missing any references as well (e.g. <code class=\"notranslate\">grep</code> to see what the references there are to <code class=\"notranslate\">app_vpc_cidrs</code></p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "f886e575dfb5cad8d06b2191df842508"
}
##DOCS-SOURCER-END -->
