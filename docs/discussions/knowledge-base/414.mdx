---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/414" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>How should I setup OpenVPN for multiple regions in the reference architecture?</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84APhHe","number":414,"author":{"login":"yorinasub17"},"title":"How should I setup OpenVPN for multiple regions in the reference architecture?","body":"\nIn a multi-region setup, I will have multiple app VPCs. Should I deploy another OpenVPN server in that VPC? This can lead to collision of the IAM roles and global resources, so how should I handle that?\n\n---\n\n<ins datetime=\"2022-05-11T21:25:46Z\">\n  <p><a href=\"https://support.gruntwork.io/hc/requests/108580\">Tracked in ticket #108580</a></p>\n</ins>\n","bodyHTML":"<p dir=\"auto\">In a multi-region setup, I will have multiple app VPCs. Should I deploy another OpenVPN server in that VPC? This can lead to collision of the IAM roles and global resources, so how should I handle that?</p>\n<hr>\n<ins datetime=\"2022-05-11T21:25:46Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/108580\" rel=\"nofollow\">Tracked in ticket #108580</a></p>\n</ins>","answer":{"body":"If you are adding a 2nd region, then it is recommended to deploy a `mgmt` VPC to act as the network gateway for the additional VPCs. In this setup, the `mgmt` VPC is configured with a one way peering connection into each of the `app` VPCs (see [this diagram](https://camo.githubusercontent.com/45ac939c7e1db13491a171dd65c0048f283e810dc72cf0da56cec8a09725d817/687474703a2f2f692e696d6775722e636f6d2f4b43304f4b5a4c2e706e67)). This allows the `mgmt` VPC to connect to resources in the `app` VPC, without having a direct network route between the `app` VPCs to each other.\r\n\r\nThe steps to do this in the Reference Architecture are:\r\n\r\n1. Decide on a primary region where the `mgmt` VPC will be deployed. \r\n2. Deploy the `mgmt` VPC using the [vpc-mgmt module](https://docs.gruntwork.io/reference/services/networking/management-vpc). You can also reuse the existing one from the Reference Architecture if you can tolerate the network connectivity from the ECS Deploy Runner to your private resources.\r\n3. Setup the peering connection.\r\n    - If the `app` VPC is in the same region as the `mgmt` VPC, you can use the variables in the [vpc module](https://docs.gruntwork.io/reference/services/networking/virtual-private-cloud-vpc) to configure the peering connection.\r\n    - For the `app` VPC in the alternative region, you will want to use the [vpc-peering-cross-accounts-requester](https://github.com/gruntwork-io/terraform-aws-vpc/tree/master/modules/vpc-peering-cross-accounts-requester) and [vpc-peering-cross-accounts-accepter](https://github.com/gruntwork-io/terraform-aws-vpc/tree/master/modules/vpc-peering-cross-accounts-accepter) modules directly. You want to deploy the requester in the `mgmt` VPC region, while the accepter should be deployed in the `app` VPC region.\r\n4. Deploy the OpenVPN server in the mgmt VPC.\r\n5. Update all the NACL and security group rules to accept connections from the OpenVPN server CIDR block.\r\n\r\nAt the end of this, you should have VPN access to both `app` VPCs via the single OpenVPN server in the `mgmt` VPC, made possible by the peering connection.","bodyHTML":"<p dir=\"auto\">If you are adding a 2nd region, then it is recommended to deploy a <code class=\"notranslate\">mgmt</code> VPC to act as the network gateway for the additional VPCs. In this setup, the <code class=\"notranslate\">mgmt</code> VPC is configured with a one way peering connection into each of the <code class=\"notranslate\">app</code> VPCs (see <a href=\"https://camo.githubusercontent.com/45ac939c7e1db13491a171dd65c0048f283e810dc72cf0da56cec8a09725d817/687474703a2f2f692e696d6775722e636f6d2f4b43304f4b5a4c2e706e67\" rel=\"nofollow\">this diagram</a>). This allows the <code class=\"notranslate\">mgmt</code> VPC to connect to resources in the <code class=\"notranslate\">app</code> VPC, without having a direct network route between the <code class=\"notranslate\">app</code> VPCs to each other.</p>\n<p dir=\"auto\">The steps to do this in the Reference Architecture are:</p>\n<ol dir=\"auto\">\n<li>Decide on a primary region where the <code class=\"notranslate\">mgmt</code> VPC will be deployed.</li>\n<li>Deploy the <code class=\"notranslate\">mgmt</code> VPC using the <a href=\"https://docs.gruntwork.io/reference/services/networking/management-vpc\" rel=\"nofollow\">vpc-mgmt module</a>. You can also reuse the existing one from the Reference Architecture if you can tolerate the network connectivity from the ECS Deploy Runner to your private resources.</li>\n<li>Setup the peering connection.\n<ul dir=\"auto\">\n<li>If the <code class=\"notranslate\">app</code> VPC is in the same region as the <code class=\"notranslate\">mgmt</code> VPC, you can use the variables in the <a href=\"https://docs.gruntwork.io/reference/services/networking/virtual-private-cloud-vpc\" rel=\"nofollow\">vpc module</a> to configure the peering connection.</li>\n<li>For the <code class=\"notranslate\">app</code> VPC in the alternative region, you will want to use the <a href=\"https://github.com/gruntwork-io/terraform-aws-vpc/tree/master/modules/vpc-peering-cross-accounts-requester\">vpc-peering-cross-accounts-requester</a> and <a href=\"https://github.com/gruntwork-io/terraform-aws-vpc/tree/master/modules/vpc-peering-cross-accounts-accepter\">vpc-peering-cross-accounts-accepter</a> modules directly. You want to deploy the requester in the <code class=\"notranslate\">mgmt</code> VPC region, while the accepter should be deployed in the <code class=\"notranslate\">app</code> VPC region.</li>\n</ul>\n</li>\n<li>Deploy the OpenVPN server in the mgmt VPC.</li>\n<li>Update all the NACL and security group rules to accept connections from the OpenVPN server CIDR block.</li>\n</ol>\n<p dir=\"auto\">At the end of this, you should have VPN access to both <code class=\"notranslate\">app</code> VPCs via the single OpenVPN server in the <code class=\"notranslate\">mgmt</code> VPC, made possible by the peering connection.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "7acd8b277dab65faf33eda657230a74c"
}
##DOCS-SOURCER-END -->
