---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Attach Service Control Policy to AWS Organizations</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AO9gs","number":258,"author":{"login":"pete0emerson"},"title":"Attach Service Control Policy to AWS Organizations","body":"I am wondering how we may attach SCPs to OUs in the Gruntwork codebase.\r\n\r\nMy understanding is that we would need to use this module (https://github.com/gruntwork-io/terraform-aws-security/tree/v0.22.2/modules/aws-organizations), create the OU, create the SCP and attach an aws_organizations_policy (https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/organizations_policy). \r\n\r\nWe also need to add SCP as an enabled policy type.\r\n\r\nAny recommendations on how we might approach this?","bodyHTML":"<p dir=\"auto\">I am wondering how we may attach SCPs to OUs in the Gruntwork codebase.</p>\n<p dir=\"auto\">My understanding is that we would need to use this module (<a href=\"https://github.com/gruntwork-io/terraform-aws-security/tree/v0.22.2/modules/aws-organizations\">https://github.com/gruntwork-io/terraform-aws-security/tree/v0.22.2/modules/aws-organizations</a>), create the OU, create the SCP and attach an aws_organizations_policy (<a href=\"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/organizations_policy\" rel=\"nofollow\">https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/organizations_policy</a>).</p>\n<p dir=\"auto\">We also need to add SCP as an enabled policy type.</p>\n<p dir=\"auto\">Any recommendations on how we might approach this?</p>","answer":{"body":"We currently don't offer a module to manage organizational units (OU) or SCPs, so what you have laid out in your understanding is correct: you will need to create a terraform module that uses the raw terraform resources to manage the OUs and SCPs.\r\n\r\nHowever, this is a gap in our module catalog that we can address, so I have filed https://github.com/gruntwork-io/terraform-aws-security/issues/633 for us to consider implementing a dedicated module for managing OUs with child accounts and SCPs.\r\n\r\n---\r\n\r\nIn the meantime, the best approach to implement this would be to create a module that manages the OU with SCP and which takes in the AWS Organization root ID to hook the OU to. The following is a skeleton that you can use:\r\n\r\n```hcl\r\nmodule \"organization\" {\r\n  source = \"git::git@github.com:gruntwork-io/module-security.git//modules/aws-organizations?ref=v0.62.3\"\r\n\r\n  organizations_feature_set = \"ALL\"\r\n  organizations_enabled_policy_types = [\"SERVICE_CONTROL_POLICY\"] \r\n\r\n  # ... other args omitted for brevity ...\r\n}\r\n\r\nresource \"aws_organizations_organizational_unit\" \"unit\" {\r\n  name = var.org_unit_name\r\n  parent_id = module.organization.root_id\r\n}\r\n\r\n# Replicate for any accounts you wish to invite under the OU\r\nresource \"aws_organizations_account\" \"unit_child\" {\r\n  parent_id = aws_organizations_organizational_unit.unit.id\r\n  # ... other args omitted for brevity ...\r\n}\r\n\r\n# Replicate the following for any SCPs you wish to attach to the OU\r\nresource \"aws_organizations_policy\" \"scp_policy\" {\r\n  name        = \"Policy Name\"\r\n  description = \"Policy description\"\r\n\r\n  content = data.aws_iam_policy_document.scp_policy.json\r\n}\r\n\r\nresource \"aws_organizations_policy_attachment\" \"scp_policy\" {\r\n  policy_id = aws_organizations_policy.scp_policy.id\r\n  target_id = aws_organizations_organizational_unit.unit.id\r\n}\r\n\r\ndata \"aws_iam_policy_document\" \"scp_policy\" {\r\n  # ... args omitted for brevity ...\r\n}\r\n```","bodyHTML":"<p dir=\"auto\">We currently don't offer a module to manage organizational units (OU) or SCPs, so what you have laid out in your understanding is correct: you will need to create a terraform module that uses the raw terraform resources to manage the OUs and SCPs.</p>\n<p dir=\"auto\">However, this is a gap in our module catalog that we can address, so I have filed <a href=\"https://github.com/gruntwork-io/terraform-aws-security/issues/633\">https://github.com/gruntwork-io/terraform-aws-security/issues/633</a> for us to consider implementing a dedicated module for managing OUs with child accounts and SCPs.</p>\n<hr>\n<p dir=\"auto\">In the meantime, the best approach to implement this would be to create a module that manages the OU with SCP and which takes in the AWS Organization root ID to hook the OU to. The following is a skeleton that you can use:</p>\n<div class=\"highlight highlight-source-terraform notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"module &quot;organization&quot; {\n  source = &quot;git::git@github.com:gruntwork-io/module-security.git//modules/aws-organizations?ref=v0.62.3&quot;\n\n  organizations_feature_set = &quot;ALL&quot;\n  organizations_enabled_policy_types = [&quot;SERVICE_CONTROL_POLICY&quot;] \n\n  # ... other args omitted for brevity ...\n}\n\nresource &quot;aws_organizations_organizational_unit&quot; &quot;unit&quot; {\n  name = var.org_unit_name\n  parent_id = module.organization.root_id\n}\n\n# Replicate for any accounts you wish to invite under the OU\nresource &quot;aws_organizations_account&quot; &quot;unit_child&quot; {\n  parent_id = aws_organizations_organizational_unit.unit.id\n  # ... other args omitted for brevity ...\n}\n\n# Replicate the following for any SCPs you wish to attach to the OU\nresource &quot;aws_organizations_policy&quot; &quot;scp_policy&quot; {\n  name        = &quot;Policy Name&quot;\n  description = &quot;Policy description&quot;\n\n  content = data.aws_iam_policy_document.scp_policy.json\n}\n\nresource &quot;aws_organizations_policy_attachment&quot; &quot;scp_policy&quot; {\n  policy_id = aws_organizations_policy.scp_policy.id\n  target_id = aws_organizations_organizational_unit.unit.id\n}\n\ndata &quot;aws_iam_policy_document&quot; &quot;scp_policy&quot; {\n  # ... args omitted for brevity ...\n}\"><pre><span class=\"pl-k\">module</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>organization<span class=\"pl-pds\">\"</span></span> {\n  source <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>git::git@github.com:gruntwork-io/module-security.git//modules/aws-organizations?ref=v0.62.3<span class=\"pl-pds\">\"</span></span>\n\n  organizations_feature_set <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>ALL<span class=\"pl-pds\">\"</span></span>\n  organizations_enabled_policy_types <span class=\"pl-k\">=</span> [<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>SERVICE_CONTROL_POLICY<span class=\"pl-pds\">\"</span></span>] \n\n  <span class=\"pl-c\"><span class=\"pl-c\">#</span> ... other args omitted for brevity ...</span>\n}\n\n<span class=\"pl-k\">resource</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>aws_organizations_organizational_unit<span class=\"pl-pds\">\"</span></span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>unit<span class=\"pl-pds\">\"</span></span> {\n  name <span class=\"pl-k\">=</span> <span class=\"pl-c1\">var</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">org_unit_name</span>\n  parent_id <span class=\"pl-k\">=</span> <span class=\"pl-c1\">module</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">organization</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">root_id</span>\n}\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> Replicate for any accounts you wish to invite under the OU</span>\n<span class=\"pl-k\">resource</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>aws_organizations_account<span class=\"pl-pds\">\"</span></span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>unit_child<span class=\"pl-pds\">\"</span></span> {\n  parent_id <span class=\"pl-k\">=</span> aws_organizations_organizational_unit<span class=\"pl-k\">.</span><span class=\"pl-smi\">unit</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">id</span>\n  <span class=\"pl-c\"><span class=\"pl-c\">#</span> ... other args omitted for brevity ...</span>\n}\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> Replicate the following for any SCPs you wish to attach to the OU</span>\n<span class=\"pl-k\">resource</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>aws_organizations_policy<span class=\"pl-pds\">\"</span></span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>scp_policy<span class=\"pl-pds\">\"</span></span> {\n  name        <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Policy Name<span class=\"pl-pds\">\"</span></span>\n  description <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Policy description<span class=\"pl-pds\">\"</span></span>\n\n  content <span class=\"pl-k\">=</span> <span class=\"pl-c1\">data</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">aws_iam_policy_document</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">scp_policy</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">json</span>\n}\n\n<span class=\"pl-k\">resource</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>aws_organizations_policy_attachment<span class=\"pl-pds\">\"</span></span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>scp_policy<span class=\"pl-pds\">\"</span></span> {\n  policy_id <span class=\"pl-k\">=</span> aws_organizations_policy<span class=\"pl-k\">.</span><span class=\"pl-smi\">scp_policy</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">id</span>\n  target_id <span class=\"pl-k\">=</span> aws_organizations_organizational_unit<span class=\"pl-k\">.</span><span class=\"pl-smi\">unit</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">id</span>\n}\n\n<span class=\"pl-k\">data</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>aws_iam_policy_document<span class=\"pl-pds\">\"</span></span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>scp_policy<span class=\"pl-pds\">\"</span></span> {\n  <span class=\"pl-c\"><span class=\"pl-c\">#</span> ... args omitted for brevity ...</span>\n}</pre></div>"}}} />

</CenterLayout>
  

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "9d160f2e0fa6238a01145fb4f323aaf4"
}
##DOCS-SOURCER-END -->
