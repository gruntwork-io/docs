---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>How do I resolve permissions issues with building containers in ECS Deploy Runner?</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AO3hP","number":223,"author":{"login":"yorinasub17"},"title":"How do I resolve permissions issues with building containers in ECS Deploy Runner?","body":"I am getting the following error when trying to run build scripts for building containers:\r\n\r\n```\r\n[ecs-deploy-runner][2022-02-23T18:50:04+0000] [] time=\"2022-02-23T18:50:04Z\" level=info msg=\"Running command: /kaniko\r\n/executor --force --context-sub-path modules/ecs-deploy-runner/docker/deploy-runner --destination xxxx.dkr.ecr.us-\r\nwest-2.amazonaws.com/ecs-deploy-runner:v0.38.1 --context git://github.com/gruntwork-io/terraform-aws-ci.git \r\n--git branch=v0.38.1 --build-arg GITHUB_OAUTH_TOKEN\"\r\n[ecs-deploy-runner][2022-02-23T18:50:06+0000] Error: error resolving source context: authentication required\r\n```","bodyHTML":"<p dir=\"auto\">I am getting the following error when trying to run build scripts for building containers:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"[ecs-deploy-runner][2022-02-23T18:50:04+0000] [] time=&quot;2022-02-23T18:50:04Z&quot; level=info msg=&quot;Running command: /kaniko\n/executor --force --context-sub-path modules/ecs-deploy-runner/docker/deploy-runner --destination xxxx.dkr.ecr.us-\nwest-2.amazonaws.com/ecs-deploy-runner:v0.38.1 --context git://github.com/gruntwork-io/terraform-aws-ci.git \n--git branch=v0.38.1 --build-arg GITHUB_OAUTH_TOKEN&quot;\n[ecs-deploy-runner][2022-02-23T18:50:06+0000] Error: error resolving source context: authentication required\"><pre class=\"notranslate\"><code>[ecs-deploy-runner][2022-02-23T18:50:04+0000] [] time=\"2022-02-23T18:50:04Z\" level=info msg=\"Running command: /kaniko\n/executor --force --context-sub-path modules/ecs-deploy-runner/docker/deploy-runner --destination xxxx.dkr.ecr.us-\nwest-2.amazonaws.com/ecs-deploy-runner:v0.38.1 --context git://github.com/gruntwork-io/terraform-aws-ci.git \n--git branch=v0.38.1 --build-arg GITHUB_OAUTH_TOKEN\"\n[ecs-deploy-runner][2022-02-23T18:50:06+0000] Error: error resolving source context: authentication required\n</code></pre></div>","answer":{"body":"This authentication failure is from an attempt to access the `gruntwork-io/terraform-aws-ci` github repo in the container. The authentication is handled using the token configured on the ECS Deploy Runner, via the `docker_image_builder_config.git_config` input variable. So I would double check:\r\n\r\n- Is the token configured on the `ecs-deploy-runner` module?\r\n- Is the token stored in Secrets Manager still valid?\r\n- Is the associated machine user of the token in your subscription?\r\n- Has the associated machine user accepted the invite for the gruntwork-io org?\r\n\r\nNote that the most common error is when using alternative VCS systems (e.g., not GitHub but GitLab) while the ECS Deploy Runner authentication is configured for that VCS. In this scenario, the docker image builder only supports building images from GitLab and not GitHub. As of this writing (Feb 23, 2022), `ecs-deploy-runner` doesn’t support a single docker image builder container with multiple secrets. However, we have an [issue to add support](https://github.com/gruntwork-io/terraform-aws-ci/issues/394) for multiple secrets in a single docker image builder container.\r\n\r\nUntil then, to workaround this, you could do one of the following:\r\n\r\n- Swap out the secrets for the docker image builder to be calibrated to GitHub. This would only work if you don’t intend on using the `ecs-deploy-runner` to build docker images in your repos.\r\n- Deploy a new ECS deploy runner dedicated to building docker images from Gruntwork. This can be done by copying and pasting the config for `ecs-deploy-runner`, but setting `ami_builder_config`, `terraform_planner_config`, and `terraform_applier_config` config to `null`. This way only `docker_image_builder_config` is configured.\r\n    - Note that you will want to use a different name, which will produce a different lambda function identifier. You can then select this particular `ecs-deploy-runner` from the `infrastructure-deployer` command line by passing in the `--invoker-function-id` flag. This can be done in the `build_*.sh` script.","bodyHTML":"<p dir=\"auto\">This authentication failure is from an attempt to access the <code class=\"notranslate\">gruntwork-io/terraform-aws-ci</code> github repo in the container. The authentication is handled using the token configured on the ECS Deploy Runner, via the <code class=\"notranslate\">docker_image_builder_config.git_config</code> input variable. So I would double check:</p>\n<ul dir=\"auto\">\n<li>Is the token configured on the <code class=\"notranslate\">ecs-deploy-runner</code> module?</li>\n<li>Is the token stored in Secrets Manager still valid?</li>\n<li>Is the associated machine user of the token in your subscription?</li>\n<li>Has the associated machine user accepted the invite for the gruntwork-io org?</li>\n</ul>\n<p dir=\"auto\">Note that the most common error is when using alternative VCS systems (e.g., not GitHub but GitLab) while the ECS Deploy Runner authentication is configured for that VCS. In this scenario, the docker image builder only supports building images from GitLab and not GitHub. As of this writing (Feb 23, 2022), <code class=\"notranslate\">ecs-deploy-runner</code> doesn’t support a single docker image builder container with multiple secrets. However, we have an <a href=\"https://github.com/gruntwork-io/terraform-aws-ci/issues/394\">issue to add support</a> for multiple secrets in a single docker image builder container.</p>\n<p dir=\"auto\">Until then, to workaround this, you could do one of the following:</p>\n<ul dir=\"auto\">\n<li>Swap out the secrets for the docker image builder to be calibrated to GitHub. This would only work if you don’t intend on using the <code class=\"notranslate\">ecs-deploy-runner</code> to build docker images in your repos.</li>\n<li>Deploy a new ECS deploy runner dedicated to building docker images from Gruntwork. This can be done by copying and pasting the config for <code class=\"notranslate\">ecs-deploy-runner</code>, but setting <code class=\"notranslate\">ami_builder_config</code>, <code class=\"notranslate\">terraform_planner_config</code>, and <code class=\"notranslate\">terraform_applier_config</code> config to <code class=\"notranslate\">null</code>. This way only <code class=\"notranslate\">docker_image_builder_config</code> is configured.\n<ul dir=\"auto\">\n<li>Note that you will want to use a different name, which will produce a different lambda function identifier. You can then select this particular <code class=\"notranslate\">ecs-deploy-runner</code> from the <code class=\"notranslate\">infrastructure-deployer</code> command line by passing in the <code class=\"notranslate\">--invoker-function-id</code> flag. This can be done in the <code class=\"notranslate\">build_*.sh</code> script.</li>\n</ul>\n</li>\n</ul>"}}} />

</CenterLayout>
  

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "60a4eaa47069ee5f853c8d6be7ebb156"
}
##DOCS-SOURCER-END -->
