---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/169" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Issue retrieving the full ARN in Secret Managers without the random suffix</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AOsdT","number":169,"author":{"login":"fsanzdev"},"title":"Issue retrieving the full ARN in Secret Managers without the random suffix","body":"Hi, \r\n\r\nUsing the reference architecture deployed by GW, I'm trying to modify the `terragrunt.hcl` file in `services\\myservice` to add a reference to a secret without the random suffix. My code is:\r\n\r\n```\r\nlocals {\r\n  manual_secrets_manager_arn = \"arn:aws:secretsmanager:${include.envcommon.locals.aws_region}:${include.envcommon.locals.account_id}:secret:br-dev/manual-created/test-secret\"\r\n\r\n  # List of environment variables and container images for each container that are specific to this environment. The map\r\n  # key here should correspond to the map keys of the _container_definitions_map input defined in envcommon.\r\n  service_environment_variables = {\r\n    (include.envcommon.locals.service_name) = [\r\n      {\r\n        name = \"MANUAL_SUPER_SECRET\"\r\n        value = format(\"%s:%s::\",local.manual_secrets_manager_arn,\"MANUAL_SUPER_SECRET\")\r\n      }\r\n    ]\r\n  }\r\n  container_images = {\r\n    (include.envcommon.locals.service_name) = \"${include.envcommon.locals.container_image}:${local.tag}\"\r\n  }\r\n\r\n  # Specify the app image tag here so that it can be overridden in a CI/CD pipeline.\r\n  tag = \"latest\"\r\n}\r\n.\r\n.\r\n.\r\nsecrets_access = [\r\n     local.manual_secrets_manager_arn\r\n  ]\r\n}\r\n```\r\n\r\nBut when I try to apply these changes I get this error:\r\n\r\n```\r\nError: Secrets Manager Secret \"arn:aws:secretsmanager:us-east-2:XXXXXXXXXX:secret:br-dev/manual-created/test-secret\" not found\r\nâ”‚ \r\nâ”‚   with data.aws_secretsmanager_secret.secrets_arn_exchange[\"arn:aws:secretsmanager:us-east-2:XXXXXXXXXX:secret:br-dev/manual-created/test-secret\"],\r\nâ”‚   on main.tf line 219, in data \"aws_secretsmanager_secret\" \"secrets_arn_exchange\":\r\nâ”‚  219: data \"aws_secretsmanager_secret\" \"secrets_arn_exchange\" {\r\n```\r\n\r\nAnd looking into the error line in the module, it looks like it's trying to do what I need to (use arn secret without random fix)\r\n\r\n```\r\n# This allows the user to pass either the full ARN of a Secrets Manager secret (including the randomly generated\r\n# suffix) or the ARN without the random suffix. The data source will find the full ARN for use in the IAM policy.\r\ndata \"aws_secretsmanager_secret\" \"secrets_arn_exchange\" {\r\n  for_each = { for secret in var.secrets_access : secret => secret }\r\n  arn      = each.value\r\n}\r\n``` \r\n\r\nBut unfortunately, it's only working when I add the random fix in `manual_secrets_manager_arn`\r\n\r\nAnything am I missing? \r\n\r\nThanks.","bodyHTML":"<p dir=\"auto\">Hi,</p>\n<p dir=\"auto\">Using the reference architecture deployed by GW, I'm trying to modify the <code class=\"notranslate\">terragrunt.hcl</code> file in <code class=\"notranslate\">services\\myservice</code> to add a reference to a secret without the random suffix. My code is:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"locals {\n  manual_secrets_manager_arn = &quot;arn:aws:secretsmanager:${include.envcommon.locals.aws_region}:${include.envcommon.locals.account_id}:secret:br-dev/manual-created/test-secret&quot;\n\n  # List of environment variables and container images for each container that are specific to this environment. The map\n  # key here should correspond to the map keys of the _container_definitions_map input defined in envcommon.\n  service_environment_variables = {\n    (include.envcommon.locals.service_name) = [\n      {\n        name = &quot;MANUAL_SUPER_SECRET&quot;\n        value = format(&quot;%s:%s::&quot;,local.manual_secrets_manager_arn,&quot;MANUAL_SUPER_SECRET&quot;)\n      }\n    ]\n  }\n  container_images = {\n    (include.envcommon.locals.service_name) = &quot;${include.envcommon.locals.container_image}:${local.tag}&quot;\n  }\n\n  # Specify the app image tag here so that it can be overridden in a CI/CD pipeline.\n  tag = &quot;latest&quot;\n}\n.\n.\n.\nsecrets_access = [\n     local.manual_secrets_manager_arn\n  ]\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">locals {\n  manual_secrets_manager_arn = \"arn:aws:secretsmanager:${include.envcommon.locals.aws_region}:${include.envcommon.locals.account_id}:secret:br-dev/manual-created/test-secret\"\n\n  # List of environment variables and container images for each container that are specific to this environment. The map\n  # key here should correspond to the map keys of the _container_definitions_map input defined in envcommon.\n  service_environment_variables = {\n    (include.envcommon.locals.service_name) = [\n      {\n        name = \"MANUAL_SUPER_SECRET\"\n        value = format(\"%s:%s::\",local.manual_secrets_manager_arn,\"MANUAL_SUPER_SECRET\")\n      }\n    ]\n  }\n  container_images = {\n    (include.envcommon.locals.service_name) = \"${include.envcommon.locals.container_image}:${local.tag}\"\n  }\n\n  # Specify the app image tag here so that it can be overridden in a CI/CD pipeline.\n  tag = \"latest\"\n}\n.\n.\n.\nsecrets_access = [\n     local.manual_secrets_manager_arn\n  ]\n}\n</code></pre></div>\n<p dir=\"auto\">But when I try to apply these changes I get this error:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Error: Secrets Manager Secret &quot;arn:aws:secretsmanager:us-east-2:XXXXXXXXXX:secret:br-dev/manual-created/test-secret&quot; not found\nâ”‚ \nâ”‚   with data.aws_secretsmanager_secret.secrets_arn_exchange[&quot;arn:aws:secretsmanager:us-east-2:XXXXXXXXXX:secret:br-dev/manual-created/test-secret&quot;],\nâ”‚   on main.tf line 219, in data &quot;aws_secretsmanager_secret&quot; &quot;secrets_arn_exchange&quot;:\nâ”‚  219: data &quot;aws_secretsmanager_secret&quot; &quot;secrets_arn_exchange&quot; {\"><pre class=\"notranslate\"><code class=\"notranslate\">Error: Secrets Manager Secret \"arn:aws:secretsmanager:us-east-2:XXXXXXXXXX:secret:br-dev/manual-created/test-secret\" not found\nâ”‚ \nâ”‚   with data.aws_secretsmanager_secret.secrets_arn_exchange[\"arn:aws:secretsmanager:us-east-2:XXXXXXXXXX:secret:br-dev/manual-created/test-secret\"],\nâ”‚   on main.tf line 219, in data \"aws_secretsmanager_secret\" \"secrets_arn_exchange\":\nâ”‚  219: data \"aws_secretsmanager_secret\" \"secrets_arn_exchange\" {\n</code></pre></div>\n<p dir=\"auto\">And looking into the error line in the module, it looks like it's trying to do what I need to (use arn secret without random fix)</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"# This allows the user to pass either the full ARN of a Secrets Manager secret (including the randomly generated\n# suffix) or the ARN without the random suffix. The data source will find the full ARN for use in the IAM policy.\ndata &quot;aws_secretsmanager_secret&quot; &quot;secrets_arn_exchange&quot; {\n  for_each = { for secret in var.secrets_access : secret =&gt; secret }\n  arn      = each.value\n}\"><pre class=\"notranslate\"><code class=\"notranslate\"># This allows the user to pass either the full ARN of a Secrets Manager secret (including the randomly generated\n# suffix) or the ARN without the random suffix. The data source will find the full ARN for use in the IAM policy.\ndata \"aws_secretsmanager_secret\" \"secrets_arn_exchange\" {\n  for_each = { for secret in var.secrets_access : secret =&gt; secret }\n  arn      = each.value\n}\n</code></pre></div>\n<p dir=\"auto\">But unfortunately, it's only working when I add the random fix in <code class=\"notranslate\">manual_secrets_manager_arn</code></p>\n<p dir=\"auto\">Anything am I missing?</p>\n<p dir=\"auto\">Thanks.</p>","answer":{"body":"Hello,\r\nAFAIK secret lookup will fail if name ends with a dash followed by exactly 6 characters ðŸ¤·\r\n\r\nhttps://github.com/aws/aws-cdk/issues/11526#issuecomment-729596165\r\n\r\nhttps://awscli.amazonaws.com/v2/documentation/api/2.1.30/reference/secretsmanager/describe-secret.html#options\r\n\r\n> To avoid this situation, we recommend that you donâ€™t create secret names ending with a hyphen followed by six characters.\r\n","bodyHTML":"<p dir=\"auto\">Hello,<br>\nAFAIK secret lookup will fail if name ends with a dash followed by exactly 6 characters ðŸ¤·</p>\n<p dir=\"auto\"><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"745025983\" data-permission-text=\"Title is private\" data-url=\"https://github.com/aws/aws-cdk/issues/11526\" data-hovercard-type=\"issue\" data-hovercard-url=\"/aws/aws-cdk/issues/11526/hovercard?comment_id=729596165&amp;comment_type=issue_comment\" href=\"https://github.com/aws/aws-cdk/issues/11526#issuecomment-729596165\">aws/aws-cdk#11526 (comment)</a></p>\n<p dir=\"auto\"><a href=\"https://awscli.amazonaws.com/v2/documentation/api/2.1.30/reference/secretsmanager/describe-secret.html#options\" rel=\"nofollow\">https://awscli.amazonaws.com/v2/documentation/api/2.1.30/reference/secretsmanager/describe-secret.html#options</a></p>\n<blockquote>\n<p dir=\"auto\">To avoid this situation, we recommend that you donâ€™t create secret names ending with a hyphen followed by six characters.</p>\n</blockquote>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "092f02e246feadff2fa1cfe4ba9ea9d3"
}
##DOCS-SOURCER-END -->
