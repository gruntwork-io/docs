---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/137" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Passing variables between Terragrunt and Terraform</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AOfwF","number":137,"author":{"login":"ulankford"},"title":"Passing variables between Terragrunt and Terraform","body":"I am trying to create an EC2 instance with an EBS volume attached to the said instance.\r\nI have the code to create the EC2 instance using terragrunt, and it works fine.\r\n\r\nHowever, to create the EBS volume and attach it to the instance I need to use some terraform code.\r\n\r\ne.g.\r\n\r\nLayout tree is:\r\n\r\ndev\r\n-ec2\r\n--terragrunt.hcl\r\n--ebs.tf\r\n\r\nIn the ebs.tf file we can have\r\n\r\n> resource \"aws_ebs_volume\" \"this\" {\r\n>   availability_zone = \"ap-southeast-2a\"\r\n>   size              = 20\r\n> }\r\n> \r\n> resource \"aws_volume_attachment\" \"this\" {\r\n>   device_name = \"/dev/sdh\"\r\n>   volume_id   = aws_ebs_volume.this.id\r\n>   instance_id = <instance.parameter.from.terragrunt>\r\n> }\r\n> \r\n\r\nterragrunt.hcl\r\n\r\n> locals {\r\n>   environment_vars = read_terragrunt_config(find_in_parent_folders(\"env.hcl\"))\r\n>   env              = local.environment_vars.locals.environment\r\n> \r\n>   project_vars = read_terragrunt_config(find_in_parent_folders(\"project.hcl\"))\r\n>   project      = local.project_vars.locals.project_name\r\n>   application  = local.project_vars.locals.application_name\r\n> \r\n> }\r\n> \r\n> include {\r\n>   path = find_in_parent_folders()\r\n> }\r\n> \r\n> terraform {\r\n>   source = \"git::git@github.com:terraform-aws-modules/terraform-aws-ec2-instance.git?ref=v3.3.0\"\r\n> }\r\n> ``\r\n> dependency \"sg\" {\r\n>   config_path = \"../sg-ec2\"\r\n> \r\n>   mock_outputs = {\r\n>     security_group_id = \"sg-xxxxxxxxxxxx\"\r\n>   }\r\n> }\r\n> \r\n> inputs = {\r\n> \r\n> \r\n>   name        = \"ui01-${local.project}-${local.application}-${local.env}\"\r\n>   description = \"UI 01 ${local.project} ${local.application} Instance for ${local.env}\"\r\n> \r\n> \r\n>   ami                  = \"ami-0bd2230cfb28832f7\" # Amazon Linux kernel 5.10\r\n>   instance_type        = \"c5.large\"\r\n>   key_name             = \"key-test\" # This key is manually created\r\n>   monitoring           = true\r\n>   iam_instance_profile = \"AmazonSSMRoleForInstancesQuickSetup\"\r\n> \r\n> \r\n>   vpc_id    = \"vpc-xxxxxxx\"    \r\n>   subnet_id = \"subnet-xxxxxxxx\" \r\n> \r\n> \r\n>   vpc_security_group_ids = [\"${dependency.sg.outputs.security_group_id}\"]\r\n> \r\n> }\r\n\r\n\r\n\r\nIs it possible to use the output of the instance and pass this parameter/object to the ebs.tf file so that the ebs volume gets attached to the instance on the fly?\r\n\r\nAnother question is, is it possible for the *.tf files to use the variables defined in the .hcl files?\r\n\r\ne.g.\r\nIf you call in terragrunt \r\n\r\n> locals {\r\n>   environment_vars = read_terragrunt_config(find_in_parent_folders(\"env.hcl\"))\r\n>   env              = local.environment_vars.locals.environment\r\n> }\r\n> \r\n> env.hcl is:\r\n> locals {\r\n>   environment = \"dev\"\r\n> }\r\n> \r\n\r\nyou can use the variable env as ${local.env} for your inputs\r\nCan you call this variable in the .tf file in some way?\r\n","bodyHTML":"<p dir=\"auto\">I am trying to create an EC2 instance with an EBS volume attached to the said instance.<br>\nI have the code to create the EC2 instance using terragrunt, and it works fine.</p>\n<p dir=\"auto\">However, to create the EBS volume and attach it to the instance I need to use some terraform code.</p>\n<p dir=\"auto\">e.g.</p>\n<p dir=\"auto\">Layout tree is:</p>\n<p dir=\"auto\">dev<br>\n-ec2<br>\n--terragrunt.hcl<br>\n--ebs.tf</p>\n<p dir=\"auto\">In the ebs.tf file we can have</p>\n<blockquote>\n<p dir=\"auto\">resource \"aws_ebs_volume\" \"this\" {<br>\navailability_zone = \"ap-southeast-2a\"<br>\nsize              = 20<br>\n}</p>\n<p dir=\"auto\">resource \"aws_volume_attachment\" \"this\" {<br>\ndevice_name = \"/dev/sdh\"<br>\nvolume_id   = aws_ebs_volume.this.id<br>\ninstance_id = &lt;instance.parameter.from.terragrunt&gt;<br>\n}</p>\n</blockquote>\n<p dir=\"auto\">terragrunt.hcl</p>\n<blockquote>\n<p dir=\"auto\">locals {<br>\nenvironment_vars = read_terragrunt_config(find_in_parent_folders(\"env.hcl\"))<br>\nenv              = local.environment_vars.locals.environment</p>\n<p dir=\"auto\">project_vars = read_terragrunt_config(find_in_parent_folders(\"project.hcl\"))<br>\nproject      = local.project_vars.locals.project_name<br>\napplication  = local.project_vars.locals.application_name</p>\n<p dir=\"auto\">}</p>\n<p dir=\"auto\">include {<br>\npath = find_in_parent_folders()<br>\n}</p>\n<p dir=\"auto\">terraform {<br>\nsource = \"git::<a href=\"mailto:git@github.com\">git@github.com</a>:terraform-aws-modules/terraform-aws-ec2-instance.git?ref=v3.3.0\"<br>\n}<br>\n``<br>\ndependency \"sg\" {<br>\nconfig_path = \"../sg-ec2\"</p>\n<p dir=\"auto\">mock_outputs = {<br>\nsecurity_group_id = \"sg-xxxxxxxxxxxx\"<br>\n}<br>\n}</p>\n<p dir=\"auto\">inputs = {</p>\n<p dir=\"auto\">name        = \"ui01-${local.project}-${local.application}-${local.env}\"<br>\ndescription = \"UI 01 ${local.project} ${local.application} Instance for ${local.env}\"</p>\n<p dir=\"auto\">ami                  = \"ami-0bd2230cfb28832f7\" # Amazon Linux kernel 5.10<br>\ninstance_type        = \"c5.large\"<br>\nkey_name             = \"key-test\" # This key is manually created<br>\nmonitoring           = true<br>\niam_instance_profile = \"AmazonSSMRoleForInstancesQuickSetup\"</p>\n<p dir=\"auto\">vpc_id    = \"vpc-xxxxxxx\"<br>\nsubnet_id = \"subnet-xxxxxxxx\"</p>\n<p dir=\"auto\">vpc_security_group_ids = [\"${dependency.sg.outputs.security_group_id}\"]</p>\n<p dir=\"auto\">}</p>\n</blockquote>\n<p dir=\"auto\">Is it possible to use the output of the instance and pass this parameter/object to the ebs.tf file so that the ebs volume gets attached to the instance on the fly?</p>\n<p dir=\"auto\">Another question is, is it possible for the *.tf files to use the variables defined in the .hcl files?</p>\n<p dir=\"auto\">e.g.<br>\nIf you call in terragrunt</p>\n<blockquote>\n<p dir=\"auto\">locals {<br>\nenvironment_vars = read_terragrunt_config(find_in_parent_folders(\"env.hcl\"))<br>\nenv              = local.environment_vars.locals.environment<br>\n}</p>\n<p dir=\"auto\">env.hcl is:<br>\nlocals {<br>\nenvironment = \"dev\"<br>\n}</p>\n</blockquote>\n<p dir=\"auto\">you can use the variable env as ${local.env} for your inputs<br>\nCan you call this variable in the .tf file in some way?</p>","answer":{"body":"OK so I have this almost working fully, well in fact it does work, I can grab the instance id and attach an ebs volume to this instance, but at the same time the ebs directory tries to create a new ec2 instance. This is not what I want as I have a ec2 directory looking after the entire ec2 instance creation.\r\n\r\n\r\n├── ebs\r\n│   ├── ebs.tf\r\n│   └── terragrunt.hcl\r\n└── ec2-instance\r\n    └── terragrunt.hcl\r\n\r\n\r\nebs.tf\r\n```\r\nvariable \"instance_id\" {\r\n  type = string\r\n}\r\n\r\nresource \"aws_ebs_volume\" \"this\" {\r\n  availability_zone = \"ap-southeast-2a\"\r\n  size              = 20\r\n}\r\n\r\nresource \"aws_volume_attachment\" \"this\" {\r\n  device_name = \"/dev/sdh\"\r\n  volume_id   = aws_ebs_volume.this.id\r\n  instance_id = \"${var.instance_id}\"\r\n}\r\n```\r\n\r\n\r\nterragrunt.hcl\r\n\r\n```\r\nlocals { }\r\n\r\ninclude {\r\n  path = find_in_parent_folders()\r\n}\r\n\r\nterraform {\r\n  source = \"git::git@github.com:terraform-aws-modules/terraform-aws-ec2-instance.git?ref=v3.3.0\"\r\n}\r\n\r\ndependency \"ec2-linux-ui\" {\r\n  config_path = \"../ec2-linux-ui\"\r\n  mock_outputs = {\r\n    instance_id = \"12345\"\r\n  }\r\n}\r\n\r\ninputs = {\r\n      instance_id = dependency.ec2-linux-ui.outputs.id\r\n}\r\n```\r\n\r\n\r\n\r\nterragrunt.hcl for the ec2 instance\r\n\r\n```\r\nlocals {\r\n  environment_vars = read_terragrunt_config(find_in_parent_folders(\"env.hcl\"))\r\n  env              = local.environment_vars.locals.environment\r\n  project_vars = read_terragrunt_config(find_in_parent_folders(\"project.hcl\"))\r\n  project      = local.project_vars.locals.project_name\r\n  application  = local.project_vars.locals.application_name\r\n}\r\n\r\ninclude {\r\n  path = find_in_parent_folders()\r\n}\r\n\r\nterraform {\r\n  source = \"git::git@github.com:terraform-aws-modules/terraform-aws-ec2-instance.git?ref=v3.3.0\"\r\n}\r\n\r\n# Need the output of the correct Security Group ID to attach to the RDS instance\r\ndependency \"sg\" {\r\n  config_path = \"../sg-ec2\"\r\n\r\n  mock_outputs = {\r\n    security_group_id = \"sg-xxxxxxxxxx\"\r\n  }\r\n}\r\n\r\ninputs = {\r\n\r\n  # Naming\r\n  name        = \"ui01-${local.project}-${local.application}-${local.env}\"\r\n  description = \"UI 01 ${local.project} ${local.application} Instance for ${local.env}\"\r\n\r\n  # EC2 Config\r\n  ami                  = \"ami-0bd2230cfb28832f7\" # Amazon Linux kernel 5.10\r\n  instance_type        = \"c5.large\"\r\n  key_name             = \"xxxxxxx\" \r\n  monitoring           = true\r\n\r\n\r\n  # Networking\r\n  vpc_id    = \"xxxxxxx\"   \r\n  subnet_id = \"xxxxxxxx\"\r\n\r\n  # Security Group\r\n  vpc_security_group_ids = [\"${dependency.sg.outputs.security_group_id}\"]\r\n\r\n}\r\n```\r\n\r\nNot sure why the ebs/terragrunt.hcl file wants to create a new instance when I can successfully get the instance id returned from the ec2-linux-ui dependency? If I can fix that, we are done.","bodyHTML":"<p dir=\"auto\">OK so I have this almost working fully, well in fact it does work, I can grab the instance id and attach an ebs volume to this instance, but at the same time the ebs directory tries to create a new ec2 instance. This is not what I want as I have a ec2 directory looking after the entire ec2 instance creation.</p>\n<p dir=\"auto\">├── ebs<br>\n│   ├── ebs.tf<br>\n│   └── terragrunt.hcl<br>\n└── ec2-instance<br>\n└── terragrunt.hcl</p>\n<p dir=\"auto\">ebs.tf</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"variable &quot;instance_id&quot; {\n  type = string\n}\n\nresource &quot;aws_ebs_volume&quot; &quot;this&quot; {\n  availability_zone = &quot;ap-southeast-2a&quot;\n  size              = 20\n}\n\nresource &quot;aws_volume_attachment&quot; &quot;this&quot; {\n  device_name = &quot;/dev/sdh&quot;\n  volume_id   = aws_ebs_volume.this.id\n  instance_id = &quot;${var.instance_id}&quot;\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">variable \"instance_id\" {\n  type = string\n}\n\nresource \"aws_ebs_volume\" \"this\" {\n  availability_zone = \"ap-southeast-2a\"\n  size              = 20\n}\n\nresource \"aws_volume_attachment\" \"this\" {\n  device_name = \"/dev/sdh\"\n  volume_id   = aws_ebs_volume.this.id\n  instance_id = \"${var.instance_id}\"\n}\n</code></pre></div>\n<p dir=\"auto\">terragrunt.hcl</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"locals { }\n\ninclude {\n  path = find_in_parent_folders()\n}\n\nterraform {\n  source = &quot;git::git@github.com:terraform-aws-modules/terraform-aws-ec2-instance.git?ref=v3.3.0&quot;\n}\n\ndependency &quot;ec2-linux-ui&quot; {\n  config_path = &quot;../ec2-linux-ui&quot;\n  mock_outputs = {\n    instance_id = &quot;12345&quot;\n  }\n}\n\ninputs = {\n      instance_id = dependency.ec2-linux-ui.outputs.id\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">locals { }\n\ninclude {\n  path = find_in_parent_folders()\n}\n\nterraform {\n  source = \"git::git@github.com:terraform-aws-modules/terraform-aws-ec2-instance.git?ref=v3.3.0\"\n}\n\ndependency \"ec2-linux-ui\" {\n  config_path = \"../ec2-linux-ui\"\n  mock_outputs = {\n    instance_id = \"12345\"\n  }\n}\n\ninputs = {\n      instance_id = dependency.ec2-linux-ui.outputs.id\n}\n</code></pre></div>\n<p dir=\"auto\">terragrunt.hcl for the ec2 instance</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"locals {\n  environment_vars = read_terragrunt_config(find_in_parent_folders(&quot;env.hcl&quot;))\n  env              = local.environment_vars.locals.environment\n  project_vars = read_terragrunt_config(find_in_parent_folders(&quot;project.hcl&quot;))\n  project      = local.project_vars.locals.project_name\n  application  = local.project_vars.locals.application_name\n}\n\ninclude {\n  path = find_in_parent_folders()\n}\n\nterraform {\n  source = &quot;git::git@github.com:terraform-aws-modules/terraform-aws-ec2-instance.git?ref=v3.3.0&quot;\n}\n\n# Need the output of the correct Security Group ID to attach to the RDS instance\ndependency &quot;sg&quot; {\n  config_path = &quot;../sg-ec2&quot;\n\n  mock_outputs = {\n    security_group_id = &quot;sg-xxxxxxxxxx&quot;\n  }\n}\n\ninputs = {\n\n  # Naming\n  name        = &quot;ui01-${local.project}-${local.application}-${local.env}&quot;\n  description = &quot;UI 01 ${local.project} ${local.application} Instance for ${local.env}&quot;\n\n  # EC2 Config\n  ami                  = &quot;ami-0bd2230cfb28832f7&quot; # Amazon Linux kernel 5.10\n  instance_type        = &quot;c5.large&quot;\n  key_name             = &quot;xxxxxxx&quot; \n  monitoring           = true\n\n\n  # Networking\n  vpc_id    = &quot;xxxxxxx&quot;   \n  subnet_id = &quot;xxxxxxxx&quot;\n\n  # Security Group\n  vpc_security_group_ids = [&quot;${dependency.sg.outputs.security_group_id}&quot;]\n\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">locals {\n  environment_vars = read_terragrunt_config(find_in_parent_folders(\"env.hcl\"))\n  env              = local.environment_vars.locals.environment\n  project_vars = read_terragrunt_config(find_in_parent_folders(\"project.hcl\"))\n  project      = local.project_vars.locals.project_name\n  application  = local.project_vars.locals.application_name\n}\n\ninclude {\n  path = find_in_parent_folders()\n}\n\nterraform {\n  source = \"git::git@github.com:terraform-aws-modules/terraform-aws-ec2-instance.git?ref=v3.3.0\"\n}\n\n# Need the output of the correct Security Group ID to attach to the RDS instance\ndependency \"sg\" {\n  config_path = \"../sg-ec2\"\n\n  mock_outputs = {\n    security_group_id = \"sg-xxxxxxxxxx\"\n  }\n}\n\ninputs = {\n\n  # Naming\n  name        = \"ui01-${local.project}-${local.application}-${local.env}\"\n  description = \"UI 01 ${local.project} ${local.application} Instance for ${local.env}\"\n\n  # EC2 Config\n  ami                  = \"ami-0bd2230cfb28832f7\" # Amazon Linux kernel 5.10\n  instance_type        = \"c5.large\"\n  key_name             = \"xxxxxxx\" \n  monitoring           = true\n\n\n  # Networking\n  vpc_id    = \"xxxxxxx\"   \n  subnet_id = \"xxxxxxxx\"\n\n  # Security Group\n  vpc_security_group_ids = [\"${dependency.sg.outputs.security_group_id}\"]\n\n}\n</code></pre></div>\n<p dir=\"auto\">Not sure why the ebs/terragrunt.hcl file wants to create a new instance when I can successfully get the instance id returned from the ec2-linux-ui dependency? If I can fix that, we are done.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "775c6b94e5a97760ecbc858516d16d44"
}
##DOCS-SOURCER-END -->
