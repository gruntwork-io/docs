---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>How to create a lambda with the code zip file stored in S3?</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AO3aB","number":220,"author":{"login":"KOConchobhair"},"title":"How to create a lambda with the code zip file stored in S3?","body":"Using the lambda module from terraform-aws-service catalog, I was getting the following error:\r\n```\r\n│ Error: error creating Lambda Function (1): ValidationException: \r\n│ \tstatus code: 400, request id: 3523c3f6-c01a-480e-b8bf-c3112a71fb50\r\n│ \r\n│   with module.kinesis_lambda.module.lambda_function.aws_lambda_function.function[0],\r\n│   on .terraform/modules/kinesis_lambda.lambda_function/modules/lambda/main.tf line 31, in resource \"aws_lambda_function\" \"function\":\r\n│   31: resource \"aws_lambda_function\" \"function\" {\r\n```\r\n\r\nHere is a sample of the terraform code:\r\n```hcl\r\nmodule \"kinesis_lambda\" {\r\n  source = \"git::git@github.com:gruntwork-io/terraform-aws-service-catalog.git//modules/services/lambda?ref=v0.73.2\"\r\n\r\n  name        = \"name\"\r\n  description = \"desc\"\r\n  timeout     = 300\r\n  memory_size = 512\r\n  runtime     = \"dotnetcore3.1\"\r\n  handler     = \"KinesisLambda::KinesisLambda.Function::FunctionHandler\"\r\n\r\n  s3_bucket         = \"arn:aws:s3:::${local.org}-shared\"\r\n  s3_key            = \"lambda/${var.lambda_version}.zip\"\r\n  s3_object_version = null # bucket versioning not enabled in this bucket\r\n\r\n  environment_variables = {\r\n    ENVIRONMENT      = var.env_name\r\n  }\r\n\r\n  alarm_sns_topic_arns = [data.terraform_remote_state.monitoring.outputs.sns_topic_arn]\r\n  tags                 = { Environment : var.env_name }\r\n}\r\n```","bodyHTML":"<p dir=\"auto\">Using the lambda module from terraform-aws-service catalog, I was getting the following error:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"│ Error: error creating Lambda Function (1): ValidationException: \n│ \tstatus code: 400, request id: 3523c3f6-c01a-480e-b8bf-c3112a71fb50\n│ \n│   with module.kinesis_lambda.module.lambda_function.aws_lambda_function.function[0],\n│   on .terraform/modules/kinesis_lambda.lambda_function/modules/lambda/main.tf line 31, in resource &quot;aws_lambda_function&quot; &quot;function&quot;:\n│   31: resource &quot;aws_lambda_function&quot; &quot;function&quot; {\"><pre class=\"notranslate\"><code>│ Error: error creating Lambda Function (1): ValidationException: \n│ \tstatus code: 400, request id: 3523c3f6-c01a-480e-b8bf-c3112a71fb50\n│ \n│   with module.kinesis_lambda.module.lambda_function.aws_lambda_function.function[0],\n│   on .terraform/modules/kinesis_lambda.lambda_function/modules/lambda/main.tf line 31, in resource \"aws_lambda_function\" \"function\":\n│   31: resource \"aws_lambda_function\" \"function\" {\n</code></pre></div>\n<p dir=\"auto\">Here is a sample of the terraform code:</p>\n<div class=\"highlight highlight-source-terraform notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"module &quot;kinesis_lambda&quot; {\n  source = &quot;git::git@github.com:gruntwork-io/terraform-aws-service-catalog.git//modules/services/lambda?ref=v0.73.2&quot;\n\n  name        = &quot;name&quot;\n  description = &quot;desc&quot;\n  timeout     = 300\n  memory_size = 512\n  runtime     = &quot;dotnetcore3.1&quot;\n  handler     = &quot;KinesisLambda::KinesisLambda.Function::FunctionHandler&quot;\n\n  s3_bucket         = &quot;arn:aws:s3:::${local.org}-shared&quot;\n  s3_key            = &quot;lambda/${var.lambda_version}.zip&quot;\n  s3_object_version = null # bucket versioning not enabled in this bucket\n\n  environment_variables = {\n    ENVIRONMENT      = var.env_name\n  }\n\n  alarm_sns_topic_arns = [data.terraform_remote_state.monitoring.outputs.sns_topic_arn]\n  tags                 = { Environment : var.env_name }\n}\"><pre><span class=\"pl-k\">module</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>kinesis_lambda<span class=\"pl-pds\">\"</span></span> {\n  source <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>git::git@github.com:gruntwork-io/terraform-aws-service-catalog.git//modules/services/lambda?ref=v0.73.2<span class=\"pl-pds\">\"</span></span>\n\n  name        <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>name<span class=\"pl-pds\">\"</span></span>\n  description <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>desc<span class=\"pl-pds\">\"</span></span>\n  timeout     <span class=\"pl-k\">=</span> <span class=\"pl-c1\">300</span>\n  memory_size <span class=\"pl-k\">=</span> <span class=\"pl-c1\">512</span>\n  runtime     <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>dotnetcore3.1<span class=\"pl-pds\">\"</span></span>\n  handler     <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>KinesisLambda::KinesisLambda.Function::FunctionHandler<span class=\"pl-pds\">\"</span></span>\n\n  s3_bucket         <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>arn:aws:s3:::<span class=\"pl-k\">${</span><span class=\"pl-c1\">local</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">org</span><span class=\"pl-k\">}</span>-shared<span class=\"pl-pds\">\"</span></span>\n  s3_key            <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>lambda/<span class=\"pl-k\">${</span><span class=\"pl-c1\">var</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">lambda_version</span><span class=\"pl-k\">}</span>.zip<span class=\"pl-pds\">\"</span></span>\n  s3_object_version <span class=\"pl-k\">=</span> <span class=\"pl-c1\">null</span> <span class=\"pl-c\"><span class=\"pl-c\">#</span> bucket versioning not enabled in this bucket</span>\n\n  environment_variables <span class=\"pl-k\">=</span> {\n    ENVIRONMENT      <span class=\"pl-k\">=</span> <span class=\"pl-c1\">var</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">env_name</span>\n  }\n\n  alarm_sns_topic_arns <span class=\"pl-k\">=</span> [<span class=\"pl-c1\">data</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">terraform_remote_state</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">monitoring</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">outputs</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">sns_topic_arn</span>]\n  tags                 <span class=\"pl-k\">=</span> { Environment <span class=\"pl-k\">:</span> <span class=\"pl-c1\">var</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">env_name</span> }\n}</pre></div>","answer":{"body":"**Solution**: if bucket versioning is NOT enabled in the S3 bucket, then the `s3_object_version` variable cannot be null. It should be `\"\"`. Also note that `s3_bucket` should be the bucket NAME (not full ARN).\r\n\r\nAn easier way to fix this detail is to always use an `aws_s3_bucket_object` data source like so:\r\n\r\n```hcl\r\ndata \"aws_s3_bucket_object\" \"lambda\" {\r\n  bucket = \"${local.org}-shared\"\r\n  key    = \"lambda/${var.lambda_version}.zip\"\r\n  # bucket versioning not enabled in this bucket\r\n}\r\n\r\nmodule \"kinesis_lambda\" {\r\n  source = \"git::git@github.com:gruntwork-io/terraform-aws-service-catalog.git//modules/services/lambda?ref=v0.73.2\"\r\n  ...\r\n  s3_bucket         = data.aws_s3_bucket_object.lambda.bucket\r\n  s3_key            = data.aws_s3_bucket_object.lambda.key\r\n  s3_object_version = data.aws_s3_bucket_object.lambda.version_id\r\n  ...\r\n}\r\n```","bodyHTML":"<p dir=\"auto\"><strong>Solution</strong>: if bucket versioning is NOT enabled in the S3 bucket, then the <code class=\"notranslate\">s3_object_version</code> variable cannot be null. It should be <code class=\"notranslate\">\"\"</code>. Also note that <code class=\"notranslate\">s3_bucket</code> should be the bucket NAME (not full ARN).</p>\n<p dir=\"auto\">An easier way to fix this detail is to always use an <code class=\"notranslate\">aws_s3_bucket_object</code> data source like so:</p>\n<div class=\"highlight highlight-source-terraform notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"data &quot;aws_s3_bucket_object&quot; &quot;lambda&quot; {\n  bucket = &quot;${local.org}-shared&quot;\n  key    = &quot;lambda/${var.lambda_version}.zip&quot;\n  # bucket versioning not enabled in this bucket\n}\n\nmodule &quot;kinesis_lambda&quot; {\n  source = &quot;git::git@github.com:gruntwork-io/terraform-aws-service-catalog.git//modules/services/lambda?ref=v0.73.2&quot;\n  ...\n  s3_bucket         = data.aws_s3_bucket_object.lambda.bucket\n  s3_key            = data.aws_s3_bucket_object.lambda.key\n  s3_object_version = data.aws_s3_bucket_object.lambda.version_id\n  ...\n}\"><pre><span class=\"pl-k\">data</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>aws_s3_bucket_object<span class=\"pl-pds\">\"</span></span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>lambda<span class=\"pl-pds\">\"</span></span> {\n  bucket <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-k\">${</span><span class=\"pl-c1\">local</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">org</span><span class=\"pl-k\">}</span>-shared<span class=\"pl-pds\">\"</span></span>\n  key    <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>lambda/<span class=\"pl-k\">${</span><span class=\"pl-c1\">var</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">lambda_version</span><span class=\"pl-k\">}</span>.zip<span class=\"pl-pds\">\"</span></span>\n  <span class=\"pl-c\"><span class=\"pl-c\">#</span> bucket versioning not enabled in this bucket</span>\n}\n\n<span class=\"pl-k\">module</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>kinesis_lambda<span class=\"pl-pds\">\"</span></span> {\n  source <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>git::git@github.com:gruntwork-io/terraform-aws-service-catalog.git//modules/services/lambda?ref=v0.73.2<span class=\"pl-pds\">\"</span></span>\n  <span class=\"pl-k\">...</span>\n  s3_bucket         <span class=\"pl-k\">=</span> <span class=\"pl-c1\">data</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">aws_s3_bucket_object</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">lambda</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">bucket</span>\n  s3_key            <span class=\"pl-k\">=</span> <span class=\"pl-c1\">data</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">aws_s3_bucket_object</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">lambda</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">key</span>\n  s3_object_version <span class=\"pl-k\">=</span> <span class=\"pl-c1\">data</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">aws_s3_bucket_object</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">lambda</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">version_id</span>\n  <span class=\"pl-k\">...</span>\n}</pre></div>"}}} />

</CenterLayout>
  

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "f1fd6331931a8d564a658a13f451207c"
}
##DOCS-SOURCER-END -->
