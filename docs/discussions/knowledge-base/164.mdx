---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/164" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>How do I have account specific SSH grunt IAM roles?</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AOq20","number":164,"author":{"login":"yorinasub17"},"title":"How do I have account specific SSH grunt IAM roles?","body":"I’m currently working with something that looks like this in `security/_global/account-baseline/users.yml`:\r\n\r\n```\r\nuserwithlowaccess:\r\n  create_access_keys: false\r\n  create_login_profile: true\r\n  groups:\r\n  - _account.dev-full-access\r\n  - _account.logs-read-only\r\n  - _account.shared-read-only\r\n  - _account.prod-read-only\r\n  - _account.stage-read-only\r\n  - ssh-grunt-sudo-users\r\n```\r\n\r\nThe problem I’m running into is that `ssh-grunt-sudo-users` is creating ssh+sudo-able accounts across the whole environment.\r\nThe state I’m trying to get to would look (theoreticaly) something like this instead:\r\n\r\n```\r\n...\r\n  groups:\r\n  - _account.dev-full-access\r\n  - _account.logs-read-only\r\n  - _account.shared-read-only\r\n  - _account.prod-read-only\r\n  - _account.stage-read-only\r\n  - _account.dev-ssh-grunt-sudo-users\r\n```\r\n  \r\n(User has ssh+sudo only in a specified tenancy/role)\r\n\r\nWhat’s the correct way to get there?","bodyHTML":"<p dir=\"auto\">I’m currently working with something that looks like this in <code class=\"notranslate\">security/_global/account-baseline/users.yml</code>:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"userwithlowaccess:\n  create_access_keys: false\n  create_login_profile: true\n  groups:\n  - _account.dev-full-access\n  - _account.logs-read-only\n  - _account.shared-read-only\n  - _account.prod-read-only\n  - _account.stage-read-only\n  - ssh-grunt-sudo-users\"><pre class=\"notranslate\"><code class=\"notranslate\">userwithlowaccess:\n  create_access_keys: false\n  create_login_profile: true\n  groups:\n  - _account.dev-full-access\n  - _account.logs-read-only\n  - _account.shared-read-only\n  - _account.prod-read-only\n  - _account.stage-read-only\n  - ssh-grunt-sudo-users\n</code></pre></div>\n<p dir=\"auto\">The problem I’m running into is that <code class=\"notranslate\">ssh-grunt-sudo-users</code> is creating ssh+sudo-able accounts across the whole environment.<br>\nThe state I’m trying to get to would look (theoreticaly) something like this instead:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"...\n  groups:\n  - _account.dev-full-access\n  - _account.logs-read-only\n  - _account.shared-read-only\n  - _account.prod-read-only\n  - _account.stage-read-only\n  - _account.dev-ssh-grunt-sudo-users\"><pre class=\"notranslate\"><code class=\"notranslate\">...\n  groups:\n  - _account.dev-full-access\n  - _account.logs-read-only\n  - _account.shared-read-only\n  - _account.prod-read-only\n  - _account.stage-read-only\n  - _account.dev-ssh-grunt-sudo-users\n</code></pre></div>\n<p dir=\"auto\">(User has ssh+sudo only in a specified tenancy/role)</p>\n<p dir=\"auto\">What’s the correct way to get there?</p>","answer":{"body":"To achieve individual account level SSH access, you need to first configure it in each account in ssh-grunt on the servers. In each server module, there are variables `ssh_grunt_iam_group` and `ssh_grunt_iam_group_sudo` which specifies which IAM group to look for when allowing SSH access (e.g., in OpenVPN server, [here is the definition](https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/modules/mgmt/openvpn-server/variables.tf#L170-L180)). You can specify this to be any IAM group you like. You can have fine grained access by specifying a different value for each account.\r\n\r\nOnce that IAM group is specified in each account, you can then construct blank IAM groups in the security account that has those names. Note that SSH grunt doesn’t require any permissions in those IAM groups.\r\n\r\nTo create the IAM group, you can use the [custom-iam-entity](https://github.com/gruntwork-io/terraform-aws-security/tree/master/modules/custom-iam-entity) module.","bodyHTML":"<p dir=\"auto\">To achieve individual account level SSH access, you need to first configure it in each account in ssh-grunt on the servers. In each server module, there are variables <code class=\"notranslate\">ssh_grunt_iam_group</code> and <code class=\"notranslate\">ssh_grunt_iam_group_sudo</code> which specifies which IAM group to look for when allowing SSH access (e.g., in OpenVPN server, <a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/modules/mgmt/openvpn-server/variables.tf#L170-L180\">here is the definition</a>). You can specify this to be any IAM group you like. You can have fine grained access by specifying a different value for each account.</p>\n<p dir=\"auto\">Once that IAM group is specified in each account, you can then construct blank IAM groups in the security account that has those names. Note that SSH grunt doesn’t require any permissions in those IAM groups.</p>\n<p dir=\"auto\">To create the IAM group, you can use the <a href=\"https://github.com/gruntwork-io/terraform-aws-security/tree/master/modules/custom-iam-entity\">custom-iam-entity</a> module.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "3ca89032fce77acbe6ec0bd18d5be205"
}
##DOCS-SOURCER-END -->
