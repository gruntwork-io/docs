---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/615" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Need help debugging a failed gruntworks-pipeline</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84ARwgv","number":615,"author":{"login":"umm0n"},"title":"Need help debugging a failed gruntworks-pipeline","body":"\nHello! Some context: We're using the Gruntworks ref arq and the Gruntworks pipeline, in GHA.\r\n\r\nWe recently tried to delete our openvpn module and all its dependencies. To do so, we created a big PR that:\r\n- Deletes the entire openvpn directory in .../networking/openvpn\r\n- Deletes all dependency blocks that refer to this module across our entire repo\r\n- Deletes all calls to the dependency block outputs\r\n\r\nUpon creating the PR, the plan ran okay. All the Openvpn resources were flagged for deletion. \r\n\r\nHowever, when running the deploy itself, it fails with the following:\r\n\r\n```\r\nThe following modules were deleted:\r\n<EDITED>/networking/openvpn-server\r\nRunning apply  on each deleted module.\r\nDestroying <EDITED>/networking/openvpn-server\r\nAssuming role arn:aws:iam::************:role/allow-auto-deploy-from-other-accounts. These creds will expire after 3600 seconds.\r\nSuccess!\r\nRunning infrastructure-deployer with args: --aws-region ****** -- terraform-applier infrastructure-deploy-script --ref master --binary terragrunt --command apply --command-args -destroy --deploy-path <EDITED>/networking/openvpn-server --repo https://github.com/*******--force-https true --apply-ref-for-destroy HEAD^\r\nlevel=info msg=\"Successfully invoked Lambda function ecs-deploy-runner-invoker to trigger deployment.\"\r\ntime=\"2022-12-12T19:15:39Z\" level=info msg=\"Waiting for ECS task arn:aws:ecs:*****:***********:task/ecs-deploy-runner/************** to start\"\r\nlevel=info msg=\"Deployment ECS Task arn:aws:ecs:*****:***********:task/ecs-deploy-runner/**************  has started. Streaming logs.\"\r\nERROR: Deployment failed\r\n```\r\n\r\nAnd then:\r\n\r\n```\r\nError: Expected path /tmp/tmp753wship/<EDITED>/networking/openvpn-server to exist\r\nexit status 1\r\nERROR: exit status 1\r\nERROR: Deployment failed\r\n```\r\n\r\nThere's nothing else in the logs and we haven't got a clue what this error means. This is hardly the first time we delete a module via the pipeline. Could somebody lend us a hand?\n\n---\n\n<ins datetime=\"2022-12-12T20:07:55Z\">\n  <p><a href=\"https://support.gruntwork.io/hc/requests/109721\">Tracked in ticket #109721</a></p>\n</ins>\n","bodyHTML":"<p dir=\"auto\">Hello! Some context: We're using the Gruntworks ref arq and the Gruntworks pipeline, in GHA.</p>\n<p dir=\"auto\">We recently tried to delete our openvpn module and all its dependencies. To do so, we created a big PR that:</p>\n<ul dir=\"auto\">\n<li>Deletes the entire openvpn directory in .../networking/openvpn</li>\n<li>Deletes all dependency blocks that refer to this module across our entire repo</li>\n<li>Deletes all calls to the dependency block outputs</li>\n</ul>\n<p dir=\"auto\">Upon creating the PR, the plan ran okay. All the Openvpn resources were flagged for deletion.</p>\n<p dir=\"auto\">However, when running the deploy itself, it fails with the following:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"The following modules were deleted:\n&lt;EDITED&gt;/networking/openvpn-server\nRunning apply  on each deleted module.\nDestroying &lt;EDITED&gt;/networking/openvpn-server\nAssuming role arn:aws:iam::************:role/allow-auto-deploy-from-other-accounts. These creds will expire after 3600 seconds.\nSuccess!\nRunning infrastructure-deployer with args: --aws-region ****** -- terraform-applier infrastructure-deploy-script --ref master --binary terragrunt --command apply --command-args -destroy --deploy-path &lt;EDITED&gt;/networking/openvpn-server --repo https://github.com/*******--force-https true --apply-ref-for-destroy HEAD^\nlevel=info msg=&quot;Successfully invoked Lambda function ecs-deploy-runner-invoker to trigger deployment.&quot;\ntime=&quot;2022-12-12T19:15:39Z&quot; level=info msg=&quot;Waiting for ECS task arn:aws:ecs:*****:***********:task/ecs-deploy-runner/************** to start&quot;\nlevel=info msg=&quot;Deployment ECS Task arn:aws:ecs:*****:***********:task/ecs-deploy-runner/**************  has started. Streaming logs.&quot;\nERROR: Deployment failed\"><pre class=\"notranslate\"><code class=\"notranslate\">The following modules were deleted:\n&lt;EDITED&gt;/networking/openvpn-server\nRunning apply  on each deleted module.\nDestroying &lt;EDITED&gt;/networking/openvpn-server\nAssuming role arn:aws:iam::************:role/allow-auto-deploy-from-other-accounts. These creds will expire after 3600 seconds.\nSuccess!\nRunning infrastructure-deployer with args: --aws-region ****** -- terraform-applier infrastructure-deploy-script --ref master --binary terragrunt --command apply --command-args -destroy --deploy-path &lt;EDITED&gt;/networking/openvpn-server --repo https://github.com/*******--force-https true --apply-ref-for-destroy HEAD^\nlevel=info msg=\"Successfully invoked Lambda function ecs-deploy-runner-invoker to trigger deployment.\"\ntime=\"2022-12-12T19:15:39Z\" level=info msg=\"Waiting for ECS task arn:aws:ecs:*****:***********:task/ecs-deploy-runner/************** to start\"\nlevel=info msg=\"Deployment ECS Task arn:aws:ecs:*****:***********:task/ecs-deploy-runner/**************  has started. Streaming logs.\"\nERROR: Deployment failed\n</code></pre></div>\n<p dir=\"auto\">And then:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Error: Expected path /tmp/tmp753wship/&lt;EDITED&gt;/networking/openvpn-server to exist\nexit status 1\nERROR: exit status 1\nERROR: Deployment failed\"><pre class=\"notranslate\"><code class=\"notranslate\">Error: Expected path /tmp/tmp753wship/&lt;EDITED&gt;/networking/openvpn-server to exist\nexit status 1\nERROR: exit status 1\nERROR: Deployment failed\n</code></pre></div>\n<p dir=\"auto\">There's nothing else in the logs and we haven't got a clue what this error means. This is hardly the first time we delete a module via the pipeline. Could somebody lend us a hand?</p>\n<hr>\n<ins datetime=\"2022-12-12T20:07:55Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/109721\" rel=\"nofollow\">Tracked in ticket #109721</a></p>\n</ins>","answer":{"body":"Nevermind, we seem to have found the problem. We merged another PR after this one, which finished before the first one. When the first one ran deploy, HEAD^ fetched the last commit that no longer had the modules, which is why it failed.","bodyHTML":"<p dir=\"auto\">Nevermind, we seem to have found the problem. We merged another PR after this one, which finished before the first one. When the first one ran deploy, HEAD^ fetched the last commit that no longer had the modules, which is why it failed.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "57b6eff1e5a01396329161c7e96e3303"
}
##DOCS-SOURCER-END -->
