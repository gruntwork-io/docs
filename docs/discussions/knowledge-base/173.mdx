---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/173" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>How do I get S3 bucket folder structure using Terratest?</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AOupc","number":173,"author":{"login":"rhoboat"},"title":"How do I get S3 bucket folder structure using Terratest?","body":"### Requesting an approach to get S3 bucket details from terratest methods\r\nI am writing terratest go lang script for the automated validation of S3 bucket , hence requesting for the scripts/link to scripts or suitable methods to achieve below requirement which is pretty straight-forward for validating any S3 bucket\r\n### What am i able to do ?:\r\nI am able to create S3 bucket [func CreateS3Bucket(t testing.TestingT, region string, name string)](https://pkg.go.dev/github.com/gruntwork-io/terratest/modules/aws#CreateS3Bucket) , Assert S3 bucket [func AssertS3BucketExists(t testing.TestingT, region string, name string)](https://pkg.go.dev/github.com/gruntwork-io/terratest/modules/aws#AssertS3BucketExists) to make sure it is created and get the length of content [func GetS3ObjectContentsE(t testing.TestingT, awsRegion string, bucket string, key string) (string, error)](https://pkg.go.dev/github.com/gruntwork-io/terratest/modules/aws#GetS3ObjectContentsE) provided content name is provided\r\n### What i am NOT able to do or what i am seeking from you ?:\r\n\r\nI would like to know\r\n- how many folders got created in my S3 bucket\r\n- how many files are present in my S3 bucket\r\n- basically folder structure of my S3 bucket\r\n\r\nIf i get a clear folder structure , folder names , sub folder names , file names present in my S3 bucket then i can assert the same with requirement and i can validate S3 bucket functionality completely\r\n\r\nI am not able achieve my requirement using  [func GetS3ObjectContentsE(t testing.TestingT, awsRegion string, bucket string, key string) (string, error)](https://pkg.go.dev/github.com/gruntwork-io/terratest/modules/aws#GetS3ObjectContentsE) as it returned whole content in some unreadable format\r\n\r\nPlease help me to get this validation  done as it is pretty straight forward and i have many test cases pipelined to accomplish the same in current sprint\r\n\r\nNote : I inserted a code as well here  where i am calling terraform function to create S3 bucket == > t.Run(\"reports3\", func(t *testing.T) ,load a content into S3 bucket ==> t.Run(\"s3config\", func(t *testing.T)\r\n\r\nI am able to validate S3 bucket creation using AssertS3BucketExists function but i am NOT getting any approach/hook to validate what folders have been created in my S3 bucket\r\n```go\r\n\r\n\r\npackage test\r\n\r\nimport (\r\n\t\"fmt\"\r\n\t\"os\"\r\n\t\"path/filepath\"\r\n\t\"strings\"\r\n\t\"testing\"\r\n\t\"time\"\r\n\r\n\t\"github.com/fatih/color\"\r\n\t\"github.com/gruntwork-io/terratest/modules/aws\"\r\n\t\"github.com/gruntwork-io/terratest/modules/random\"\r\n\t\"github.com/gruntwork-io/terratest/modules/terraform\"\r\n\ttest_structure \"github.com/gruntwork-io/terratest/modules/test-structure\"\r\n\t\"github.com/magiconair/properties\"\r\n\t\"github.com/stretchr/testify/assert\"\r\n)\r\n\r\nvar (\r\n\trootFolder                     = \"../..\"                                //Root folder where terraform files should be (relative to the test folder)\r\n\tterraformFolderRelativeToRoot1 = \"/modules/reporting-service-s3-bucket\" //Relative path to reporting-service-s3 terraform module being tested from the root folder\r\n\tterraformFolderRelativeToRoot2 = \"/modules/reporting-service-config\"    //Relative path to reporting-service-config terraform module being tested from the root folder\r\n\r\n\tblue            = color.New(color.FgBlue) //Blue foreground color for printing result\r\n\tboldBlue        = blue.Add(color.Bold)\r\n\tgreenBackground = boldBlue.Add(color.BgGreen) //Green background color for printing the result\r\n\r\n\trandomId    = random.UniqueId()\r\n\tstateBucket = strings.ToLower(fmt.Sprintf(\"test-s3backend-%s\", randomId)) // Backend bucket\r\n\r\n\tp                  = properties.MustLoadFile(\"../config.properties\", properties.UTF8) //Creating propery file Object\r\n\tawsRegion          = p.MustGetString(\"awsRegion\")                                     // Reading awsRegion from property file and assigning value to local variable\r\n\texpectedBucketName = string(strings.ToLower(fmt.Sprintf(\"reportauto-s3-%s\", randomId))[:17])\r\n\tartifactoryurl     = p.MustGetString(\"artifactoryurl\") // Reading artifactoryurl from property file and assigning value to local variable\r\n\trepo               = p.MustGetString(\"repo\")           // Reading repo from property file and assigning value to local variable\r\n\t// snapshotrepository   = p.MustGetString(\"snapshotrepository\") // Reading snapshotrepository from property file and assigning value to local variable\r\n\tconfigzipForAssetion = \"config/config_v1.0.0.zip\" // For comparing with Actual version\r\n)\r\n\r\n// Basic test of the private-s3-bucket and report service config module that runs 'apply', 'destroy' and validate\r\nfunc TestReportingServiceConfig(t *testing.T) {\r\n\tt.Parallel()\r\n\r\n\ttempTestFolder1 := test_structure.CopyTerraformFolderToTemp(t, rootFolder, terraformFolderRelativeToRoot1) //Copy the terraform folder to a temp folder\r\n\ttempTestFolder2 := test_structure.CopyTerraformFolderToTemp(t, rootFolder, terraformFolderRelativeToRoot2) //Copy the terraform folder to a temp folder\r\n\taws.CreateS3Bucket(t, awsRegion, stateBucket)                                                              // Creating state bucket\r\n\ttime.Sleep(1 * 50 * time.Second)\r\n\r\n\tt.Run(\"reports3\", func(t *testing.T) {\r\n\t\tterraformOptions := terraform.WithDefaultRetryableErrors(t, &terraform.Options{\r\n\t\t\tTerraformDir: tempTestFolder1,\r\n\t\t\tVars: map[string]interface{}{\r\n\t\t\t\t\"aws_region\":                    awsRegion,\r\n\t\t\t\t\"reporting_service_bucket_name\": expectedBucketName,\r\n\t\t\t},\r\n\t\t\t// Storing state files remotely in Backend S3 bucket\r\n\t\t\tBackendConfig: map[string]interface{}{\r\n\t\t\t\t\"bucket\": stateBucket,\r\n\t\t\t\t\"key\":    awsRegion + \"/report-s3/terraform.tfstate\",\r\n\t\t\t\t\"region\": awsRegion,\r\n\t\t\t},\r\n\t\t\tUpgrade: false,\r\n\t\t})\r\n\t\tdefer test_structure.RunTestStage(t, \"cleanup\", func() {\r\n\t\t\tterraform.Destroy(t, terraformOptions)\r\n\t\t\taws.EmptyS3Bucket(t, awsRegion, stateBucket)\r\n\t\t\taws.DeleteS3Bucket(t, awsRegion, stateBucket)\r\n\t\t\tcleaningTemp(\"/tmp/TestReportingServiceConfig*\")\r\n\t\t\tcleaningTemp(\"go.*\")\r\n\t\t})\r\n\t\ttest_structure.RunTestStage(t, \"deploy\", func() {\r\n\t\t\tterraform.InitAndApply(t, terraformOptions)\r\n\t\t})\r\n\t\treportingservicebucketname := terraform.Output(t, terraformOptions, \"reporting_service_bucket_name\")\r\n\t\ttest_structure.RunTestStage(t, \"validate\", func() {\r\n\t\t\tactualS3BucketName := reportingservicebucketname\r\n\t\t\taws.AssertS3BucketExists(t, awsRegion, actualS3BucketName)\r\n\t\t\tgreenBackground.Printf(\"Expected reporting-service-s3-bucket %s is matching with Actual reporting-service-s3-bucket %s in terratest assertion ==> %t\\n\", expectedBucketName, actualS3BucketName, assert.Equal(t, expectedBucketName, actualS3BucketName))\r\n\t\t})\r\n\t\tt.Run(\"s3config\", func(t *testing.T) {\r\n\t\t\ttest_structure.RunTestStage(t, \"deploy\", func() {\r\n\t\t\t\tterraformOptions := terraform.WithDefaultRetryableErrors(t, &terraform.Options{\r\n\t\t\t\t\t// Set the path to the Terraform code that will be tested.\r\n\t\t\t\t\tTerraformDir: tempTestFolder2,\r\n\t\t\t\t\tVars: map[string]interface{}{\r\n\t\t\t\t\t\t\"aws_region\":                       awsRegion,\r\n\t\t\t\t\t\t\"reporting_service_s3_bucket_name\": reportingservicebucketname,\r\n\t\t\t\t\t\t\"artifactory_url\":                  artifactoryurl,\r\n\t\t\t\t\t\t\"repository\":                       repo,\r\n\t\t\t\t\t\t//\"snapshot_repository\":              snapshotrepository,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t// Storing state files remotely in Backend S3 bucket\r\n\t\t\t\t\tBackendConfig: map[string]interface{}{\r\n\t\t\t\t\t\t\"bucket\": stateBucket,\r\n\t\t\t\t\t\t\"key\":    awsRegion + \"/report-config/terraform.tfstate\",\r\n\t\t\t\t\t\t\"region\": awsRegion,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tUpgrade: false,\r\n\t\t\t\t})\r\n\t\t\t\ttest_structure.SaveTerraformOptions(t, tempTestFolder2, terraformOptions)\r\n\t\t\t})\r\n\t\t\tdefer test_structure.RunTestStage(t, \"cleanup_reporting_service_config\", func() {\r\n\t\t\t\tterraformOptions := test_structure.LoadTerraformOptions(t, tempTestFolder2)\r\n\t\t\t\tterraform.Destroy(t, terraformOptions)\r\n\t\t\t})\r\n\t\t\ttest_structure.RunTestStage(t, \"deploy_reporting_service_config\", func() {\r\n\t\t\t\tterraformOptions := test_structure.LoadTerraformOptions(t, tempTestFolder2)\r\n\t\t\t\tterraform.InitAndApply(t, terraformOptions)\r\n\t\t\t})\r\n\t\t\ttest_structure.RunTestStage(t, \"validate_reporting_service_config\", func() {\r\n\t\t\t\ts3Content, _ := aws.GetS3ObjectContentsE(t, awsRegion, expectedBucketName, configzipForAssetion)\r\n\t\t\t\tprint(\"s3Content here:\", s3Content)\r\n\t\t\t\tif len(s3Content) > 1 {\r\n\t\t\t\t\tgreenBackground.Printf(\"S3 Bucket has contnent with size %d\\n\", len(s3Content))\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tterraformOptions := test_structure.LoadTerraformOptions(t, tempTestFolder2)\r\n\t\t\treportingserviceconfigversion := terraform.Output(t, terraformOptions, \"reporting_service_config_version\")\r\n\t\t\tgreenBackground.Printf(\"S3 CONFIG output IS HERE with version %s\\n\", reportingserviceconfigversion)\r\n\t\t})\r\n\t})\r\n}\r\n\r\nfunc cleaningTemp(tempPath string) {\r\n\tfiles, err := filepath.Glob(tempPath)\r\n\tif err != nil {\r\n\t\tpanic(err)\r\n\t}\r\n\tfor _, f := range files {\r\n\t\tif err := os.RemoveAll(f); err != nil {\r\n\t\t\tpanic(err)\r\n\t\t}\r\n\t}\r\n\tgreenBackground.Printf(\"Cleared Temp directory %s\\n\", tempPath)\r\n}\r\n```","bodyHTML":"<h3 dir=\"auto\">Requesting an approach to get S3 bucket details from terratest methods</h3>\n<p dir=\"auto\">I am writing terratest go lang script for the automated validation of S3 bucket , hence requesting for the scripts/link to scripts or suitable methods to achieve below requirement which is pretty straight-forward for validating any S3 bucket</p>\n<h3 dir=\"auto\">What am i able to do ?:</h3>\n<p dir=\"auto\">I am able to create S3 bucket <a href=\"https://pkg.go.dev/github.com/gruntwork-io/terratest/modules/aws#CreateS3Bucket\" rel=\"nofollow\">func CreateS3Bucket(t testing.TestingT, region string, name string)</a> , Assert S3 bucket <a href=\"https://pkg.go.dev/github.com/gruntwork-io/terratest/modules/aws#AssertS3BucketExists\" rel=\"nofollow\">func AssertS3BucketExists(t testing.TestingT, region string, name string)</a> to make sure it is created and get the length of content <a href=\"https://pkg.go.dev/github.com/gruntwork-io/terratest/modules/aws#GetS3ObjectContentsE\" rel=\"nofollow\">func GetS3ObjectContentsE(t testing.TestingT, awsRegion string, bucket string, key string) (string, error)</a> provided content name is provided</p>\n<h3 dir=\"auto\">What i am NOT able to do or what i am seeking from you ?:</h3>\n<p dir=\"auto\">I would like to know</p>\n<ul dir=\"auto\">\n<li>how many folders got created in my S3 bucket</li>\n<li>how many files are present in my S3 bucket</li>\n<li>basically folder structure of my S3 bucket</li>\n</ul>\n<p dir=\"auto\">If i get a clear folder structure , folder names , sub folder names , file names present in my S3 bucket then i can assert the same with requirement and i can validate S3 bucket functionality completely</p>\n<p dir=\"auto\">I am not able achieve my requirement using  <a href=\"https://pkg.go.dev/github.com/gruntwork-io/terratest/modules/aws#GetS3ObjectContentsE\" rel=\"nofollow\">func GetS3ObjectContentsE(t testing.TestingT, awsRegion string, bucket string, key string) (string, error)</a> as it returned whole content in some unreadable format</p>\n<p dir=\"auto\">Please help me to get this validation  done as it is pretty straight forward and i have many test cases pipelined to accomplish the same in current sprint</p>\n<p dir=\"auto\">Note : I inserted a code as well here  where i am calling terraform function to create S3 bucket == &gt; t.Run(\"reports3\", func(t *testing.T) ,load a content into S3 bucket ==&gt; t.Run(\"s3config\", func(t *testing.T)</p>\n<p dir=\"auto\">I am able to validate S3 bucket creation using AssertS3BucketExists function but i am NOT getting any approach/hook to validate what folders have been created in my S3 bucket</p>\n<div class=\"highlight highlight-source-go notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"\n\npackage test\n\nimport (\n\t&quot;fmt&quot;\n\t&quot;os&quot;\n\t&quot;path/filepath&quot;\n\t&quot;strings&quot;\n\t&quot;testing&quot;\n\t&quot;time&quot;\n\n\t&quot;github.com/fatih/color&quot;\n\t&quot;github.com/gruntwork-io/terratest/modules/aws&quot;\n\t&quot;github.com/gruntwork-io/terratest/modules/random&quot;\n\t&quot;github.com/gruntwork-io/terratest/modules/terraform&quot;\n\ttest_structure &quot;github.com/gruntwork-io/terratest/modules/test-structure&quot;\n\t&quot;github.com/magiconair/properties&quot;\n\t&quot;github.com/stretchr/testify/assert&quot;\n)\n\nvar (\n\trootFolder                     = &quot;../..&quot;                                //Root folder where terraform files should be (relative to the test folder)\n\tterraformFolderRelativeToRoot1 = &quot;/modules/reporting-service-s3-bucket&quot; //Relative path to reporting-service-s3 terraform module being tested from the root folder\n\tterraformFolderRelativeToRoot2 = &quot;/modules/reporting-service-config&quot;    //Relative path to reporting-service-config terraform module being tested from the root folder\n\n\tblue            = color.New(color.FgBlue) //Blue foreground color for printing result\n\tboldBlue        = blue.Add(color.Bold)\n\tgreenBackground = boldBlue.Add(color.BgGreen) //Green background color for printing the result\n\n\trandomId    = random.UniqueId()\n\tstateBucket = strings.ToLower(fmt.Sprintf(&quot;test-s3backend-%s&quot;, randomId)) // Backend bucket\n\n\tp                  = properties.MustLoadFile(&quot;../config.properties&quot;, properties.UTF8) //Creating propery file Object\n\tawsRegion          = p.MustGetString(&quot;awsRegion&quot;)                                     // Reading awsRegion from property file and assigning value to local variable\n\texpectedBucketName = string(strings.ToLower(fmt.Sprintf(&quot;reportauto-s3-%s&quot;, randomId))[:17])\n\tartifactoryurl     = p.MustGetString(&quot;artifactoryurl&quot;) // Reading artifactoryurl from property file and assigning value to local variable\n\trepo               = p.MustGetString(&quot;repo&quot;)           // Reading repo from property file and assigning value to local variable\n\t// snapshotrepository   = p.MustGetString(&quot;snapshotrepository&quot;) // Reading snapshotrepository from property file and assigning value to local variable\n\tconfigzipForAssetion = &quot;config/config_v1.0.0.zip&quot; // For comparing with Actual version\n)\n\n// Basic test of the private-s3-bucket and report service config module that runs 'apply', 'destroy' and validate\nfunc TestReportingServiceConfig(t *testing.T) {\n\tt.Parallel()\n\n\ttempTestFolder1 := test_structure.CopyTerraformFolderToTemp(t, rootFolder, terraformFolderRelativeToRoot1) //Copy the terraform folder to a temp folder\n\ttempTestFolder2 := test_structure.CopyTerraformFolderToTemp(t, rootFolder, terraformFolderRelativeToRoot2) //Copy the terraform folder to a temp folder\n\taws.CreateS3Bucket(t, awsRegion, stateBucket)                                                              // Creating state bucket\n\ttime.Sleep(1 * 50 * time.Second)\n\n\tt.Run(&quot;reports3&quot;, func(t *testing.T) {\n\t\tterraformOptions := terraform.WithDefaultRetryableErrors(t, &amp;terraform.Options{\n\t\t\tTerraformDir: tempTestFolder1,\n\t\t\tVars: map[string]interface{}{\n\t\t\t\t&quot;aws_region&quot;:                    awsRegion,\n\t\t\t\t&quot;reporting_service_bucket_name&quot;: expectedBucketName,\n\t\t\t},\n\t\t\t// Storing state files remotely in Backend S3 bucket\n\t\t\tBackendConfig: map[string]interface{}{\n\t\t\t\t&quot;bucket&quot;: stateBucket,\n\t\t\t\t&quot;key&quot;:    awsRegion + &quot;/report-s3/terraform.tfstate&quot;,\n\t\t\t\t&quot;region&quot;: awsRegion,\n\t\t\t},\n\t\t\tUpgrade: false,\n\t\t})\n\t\tdefer test_structure.RunTestStage(t, &quot;cleanup&quot;, func() {\n\t\t\tterraform.Destroy(t, terraformOptions)\n\t\t\taws.EmptyS3Bucket(t, awsRegion, stateBucket)\n\t\t\taws.DeleteS3Bucket(t, awsRegion, stateBucket)\n\t\t\tcleaningTemp(&quot;/tmp/TestReportingServiceConfig*&quot;)\n\t\t\tcleaningTemp(&quot;go.*&quot;)\n\t\t})\n\t\ttest_structure.RunTestStage(t, &quot;deploy&quot;, func() {\n\t\t\tterraform.InitAndApply(t, terraformOptions)\n\t\t})\n\t\treportingservicebucketname := terraform.Output(t, terraformOptions, &quot;reporting_service_bucket_name&quot;)\n\t\ttest_structure.RunTestStage(t, &quot;validate&quot;, func() {\n\t\t\tactualS3BucketName := reportingservicebucketname\n\t\t\taws.AssertS3BucketExists(t, awsRegion, actualS3BucketName)\n\t\t\tgreenBackground.Printf(&quot;Expected reporting-service-s3-bucket %s is matching with Actual reporting-service-s3-bucket %s in terratest assertion ==&gt; %t\\n&quot;, expectedBucketName, actualS3BucketName, assert.Equal(t, expectedBucketName, actualS3BucketName))\n\t\t})\n\t\tt.Run(&quot;s3config&quot;, func(t *testing.T) {\n\t\t\ttest_structure.RunTestStage(t, &quot;deploy&quot;, func() {\n\t\t\t\tterraformOptions := terraform.WithDefaultRetryableErrors(t, &amp;terraform.Options{\n\t\t\t\t\t// Set the path to the Terraform code that will be tested.\n\t\t\t\t\tTerraformDir: tempTestFolder2,\n\t\t\t\t\tVars: map[string]interface{}{\n\t\t\t\t\t\t&quot;aws_region&quot;:                       awsRegion,\n\t\t\t\t\t\t&quot;reporting_service_s3_bucket_name&quot;: reportingservicebucketname,\n\t\t\t\t\t\t&quot;artifactory_url&quot;:                  artifactoryurl,\n\t\t\t\t\t\t&quot;repository&quot;:                       repo,\n\t\t\t\t\t\t//&quot;snapshot_repository&quot;:              snapshotrepository,\n\t\t\t\t\t},\n\t\t\t\t\t// Storing state files remotely in Backend S3 bucket\n\t\t\t\t\tBackendConfig: map[string]interface{}{\n\t\t\t\t\t\t&quot;bucket&quot;: stateBucket,\n\t\t\t\t\t\t&quot;key&quot;:    awsRegion + &quot;/report-config/terraform.tfstate&quot;,\n\t\t\t\t\t\t&quot;region&quot;: awsRegion,\n\t\t\t\t\t},\n\t\t\t\t\tUpgrade: false,\n\t\t\t\t})\n\t\t\t\ttest_structure.SaveTerraformOptions(t, tempTestFolder2, terraformOptions)\n\t\t\t})\n\t\t\tdefer test_structure.RunTestStage(t, &quot;cleanup_reporting_service_config&quot;, func() {\n\t\t\t\tterraformOptions := test_structure.LoadTerraformOptions(t, tempTestFolder2)\n\t\t\t\tterraform.Destroy(t, terraformOptions)\n\t\t\t})\n\t\t\ttest_structure.RunTestStage(t, &quot;deploy_reporting_service_config&quot;, func() {\n\t\t\t\tterraformOptions := test_structure.LoadTerraformOptions(t, tempTestFolder2)\n\t\t\t\tterraform.InitAndApply(t, terraformOptions)\n\t\t\t})\n\t\t\ttest_structure.RunTestStage(t, &quot;validate_reporting_service_config&quot;, func() {\n\t\t\t\ts3Content, _ := aws.GetS3ObjectContentsE(t, awsRegion, expectedBucketName, configzipForAssetion)\n\t\t\t\tprint(&quot;s3Content here:&quot;, s3Content)\n\t\t\t\tif len(s3Content) &gt; 1 {\n\t\t\t\t\tgreenBackground.Printf(&quot;S3 Bucket has contnent with size %d\\n&quot;, len(s3Content))\n\t\t\t\t}\n\t\t\t})\n\t\t\tterraformOptions := test_structure.LoadTerraformOptions(t, tempTestFolder2)\n\t\t\treportingserviceconfigversion := terraform.Output(t, terraformOptions, &quot;reporting_service_config_version&quot;)\n\t\t\tgreenBackground.Printf(&quot;S3 CONFIG output IS HERE with version %s\\n&quot;, reportingserviceconfigversion)\n\t\t})\n\t})\n}\n\nfunc cleaningTemp(tempPath string) {\n\tfiles, err := filepath.Glob(tempPath)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tfor _, f := range files {\n\t\tif err := os.RemoveAll(f); err != nil {\n\t\t\tpanic(err)\n\t\t}\n\t}\n\tgreenBackground.Printf(&quot;Cleared Temp directory %s\\n&quot;, tempPath)\n}\"><pre class=\"notranslate\"><span class=\"pl-k\">package</span> test\n\n<span class=\"pl-k\">import</span> (\n\t<span class=\"pl-s\">\"fmt\"</span>\n\t<span class=\"pl-s\">\"os\"</span>\n\t<span class=\"pl-s\">\"path/filepath\"</span>\n\t<span class=\"pl-s\">\"strings\"</span>\n\t<span class=\"pl-s\">\"testing\"</span>\n\t<span class=\"pl-s\">\"time\"</span>\n\n\t<span class=\"pl-s\">\"github.com/fatih/color\"</span>\n\t<span class=\"pl-s\">\"github.com/gruntwork-io/terratest/modules/aws\"</span>\n\t<span class=\"pl-s\">\"github.com/gruntwork-io/terratest/modules/random\"</span>\n\t<span class=\"pl-s\">\"github.com/gruntwork-io/terratest/modules/terraform\"</span>\n\ttest_structure <span class=\"pl-s\">\"github.com/gruntwork-io/terratest/modules/test-structure\"</span>\n\t<span class=\"pl-s\">\"github.com/magiconair/properties\"</span>\n\t<span class=\"pl-s\">\"github.com/stretchr/testify/assert\"</span>\n)\n\n<span class=\"pl-k\">var</span> (\n\t<span class=\"pl-s1\">rootFolder</span>                     <span class=\"pl-c1\">=</span> <span class=\"pl-s\">\"../..\"</span>                                <span class=\"pl-c\">//Root folder where terraform files should be (relative to the test folder)</span>\n\t<span class=\"pl-s1\">terraformFolderRelativeToRoot1</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">\"/modules/reporting-service-s3-bucket\"</span> <span class=\"pl-c\">//Relative path to reporting-service-s3 terraform module being tested from the root folder</span>\n\t<span class=\"pl-s1\">terraformFolderRelativeToRoot2</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">\"/modules/reporting-service-config\"</span>    <span class=\"pl-c\">//Relative path to reporting-service-config terraform module being tested from the root folder</span>\n\n\t<span class=\"pl-s1\">blue</span>            <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">color</span>.<span class=\"pl-en\">New</span>(<span class=\"pl-s1\">color</span>.<span class=\"pl-c1\">FgBlue</span>) <span class=\"pl-c\">//Blue foreground color for printing result</span>\n\t<span class=\"pl-s1\">boldBlue</span>        <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">blue</span>.<span class=\"pl-en\">Add</span>(<span class=\"pl-s1\">color</span>.<span class=\"pl-c1\">Bold</span>)\n\t<span class=\"pl-s1\">greenBackground</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">boldBlue</span>.<span class=\"pl-en\">Add</span>(<span class=\"pl-s1\">color</span>.<span class=\"pl-c1\">BgGreen</span>) <span class=\"pl-c\">//Green background color for printing the result</span>\n\n\t<span class=\"pl-s1\">randomId</span>    <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">random</span>.<span class=\"pl-en\">UniqueId</span>()\n\t<span class=\"pl-s1\">stateBucket</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">strings</span>.<span class=\"pl-en\">ToLower</span>(<span class=\"pl-s1\">fmt</span>.<span class=\"pl-en\">Sprintf</span>(<span class=\"pl-s\">\"test-s3backend-%s\"</span>, <span class=\"pl-s1\">randomId</span>)) <span class=\"pl-c\">// Backend bucket</span>\n\n\t<span class=\"pl-s1\">p</span>                  <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">properties</span>.<span class=\"pl-en\">MustLoadFile</span>(<span class=\"pl-s\">\"../config.properties\"</span>, <span class=\"pl-s1\">properties</span>.<span class=\"pl-c1\">UTF8</span>) <span class=\"pl-c\">//Creating propery file Object</span>\n\t<span class=\"pl-s1\">awsRegion</span>          <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">p</span>.<span class=\"pl-en\">MustGetString</span>(<span class=\"pl-s\">\"awsRegion\"</span>)                                     <span class=\"pl-c\">// Reading awsRegion from property file and assigning value to local variable</span>\n\t<span class=\"pl-s1\">expectedBucketName</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">string</span>(<span class=\"pl-s1\">strings</span>.<span class=\"pl-en\">ToLower</span>(<span class=\"pl-s1\">fmt</span>.<span class=\"pl-en\">Sprintf</span>(<span class=\"pl-s\">\"reportauto-s3-%s\"</span>, <span class=\"pl-s1\">randomId</span>))[:<span class=\"pl-c1\">17</span>])\n\t<span class=\"pl-s1\">artifactoryurl</span>     <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">p</span>.<span class=\"pl-en\">MustGetString</span>(<span class=\"pl-s\">\"artifactoryurl\"</span>) <span class=\"pl-c\">// Reading artifactoryurl from property file and assigning value to local variable</span>\n\t<span class=\"pl-s1\">repo</span>               <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">p</span>.<span class=\"pl-en\">MustGetString</span>(<span class=\"pl-s\">\"repo\"</span>)           <span class=\"pl-c\">// Reading repo from property file and assigning value to local variable</span>\n\t<span class=\"pl-c\">// snapshotrepository   = p.MustGetString(\"snapshotrepository\") // Reading snapshotrepository from property file and assigning value to local variable</span>\n\t<span class=\"pl-s1\">configzipForAssetion</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">\"config/config_v1.0.0.zip\"</span> <span class=\"pl-c\">// For comparing with Actual version</span>\n)\n\n<span class=\"pl-c\">// Basic test of the private-s3-bucket and report service config module that runs 'apply', 'destroy' and validate</span>\n<span class=\"pl-k\">func</span> <span class=\"pl-en\">TestReportingServiceConfig</span>(<span class=\"pl-s1\">t</span> <span class=\"pl-c1\">*</span>testing.<span class=\"pl-smi\">T</span>) {\n\t<span class=\"pl-s1\">t</span>.<span class=\"pl-en\">Parallel</span>()\n\n\t<span class=\"pl-s1\">tempTestFolder1</span> <span class=\"pl-c1\">:=</span> <span class=\"pl-s1\">test_structure</span>.<span class=\"pl-en\">CopyTerraformFolderToTemp</span>(<span class=\"pl-s1\">t</span>, <span class=\"pl-s1\">rootFolder</span>, <span class=\"pl-s1\">terraformFolderRelativeToRoot1</span>) <span class=\"pl-c\">//Copy the terraform folder to a temp folder</span>\n\t<span class=\"pl-s1\">tempTestFolder2</span> <span class=\"pl-c1\">:=</span> <span class=\"pl-s1\">test_structure</span>.<span class=\"pl-en\">CopyTerraformFolderToTemp</span>(<span class=\"pl-s1\">t</span>, <span class=\"pl-s1\">rootFolder</span>, <span class=\"pl-s1\">terraformFolderRelativeToRoot2</span>) <span class=\"pl-c\">//Copy the terraform folder to a temp folder</span>\n\t<span class=\"pl-s1\">aws</span>.<span class=\"pl-en\">CreateS3Bucket</span>(<span class=\"pl-s1\">t</span>, <span class=\"pl-s1\">awsRegion</span>, <span class=\"pl-s1\">stateBucket</span>)                                                              <span class=\"pl-c\">// Creating state bucket</span>\n\t<span class=\"pl-s1\">time</span>.<span class=\"pl-en\">Sleep</span>(<span class=\"pl-c1\">1</span> <span class=\"pl-c1\">*</span> <span class=\"pl-c1\">50</span> <span class=\"pl-c1\">*</span> <span class=\"pl-s1\">time</span>.<span class=\"pl-c1\">Second</span>)\n\n\t<span class=\"pl-s1\">t</span>.<span class=\"pl-en\">Run</span>(<span class=\"pl-s\">\"reports3\"</span>, <span class=\"pl-k\">func</span>(<span class=\"pl-s1\">t</span> <span class=\"pl-c1\">*</span>testing.<span class=\"pl-smi\">T</span>) {\n\t\t<span class=\"pl-s1\">terraformOptions</span> <span class=\"pl-c1\">:=</span> <span class=\"pl-s1\">terraform</span>.<span class=\"pl-en\">WithDefaultRetryableErrors</span>(<span class=\"pl-s1\">t</span>, <span class=\"pl-c1\">&amp;</span>terraform.<span class=\"pl-smi\">Options</span>{\n\t\t\t<span class=\"pl-s1\">TerraformDir</span>: <span class=\"pl-s1\">tempTestFolder1</span>,\n\t\t\t<span class=\"pl-s1\">Vars</span>: <span class=\"pl-k\">map</span>[<span class=\"pl-smi\">string</span>]<span class=\"pl-k\">interface</span>{}{\n\t\t\t\t<span class=\"pl-s\">\"aws_region\"</span>:                    <span class=\"pl-s1\">awsRegion</span>,\n\t\t\t\t<span class=\"pl-s\">\"reporting_service_bucket_name\"</span>: <span class=\"pl-s1\">expectedBucketName</span>,\n\t\t\t},\n\t\t\t<span class=\"pl-c\">// Storing state files remotely in Backend S3 bucket</span>\n\t\t\t<span class=\"pl-s1\">BackendConfig</span>: <span class=\"pl-k\">map</span>[<span class=\"pl-smi\">string</span>]<span class=\"pl-k\">interface</span>{}{\n\t\t\t\t<span class=\"pl-s\">\"bucket\"</span>: <span class=\"pl-s1\">stateBucket</span>,\n\t\t\t\t<span class=\"pl-s\">\"key\"</span>:    <span class=\"pl-s1\">awsRegion</span> <span class=\"pl-c1\">+</span> <span class=\"pl-s\">\"/report-s3/terraform.tfstate\"</span>,\n\t\t\t\t<span class=\"pl-s\">\"region\"</span>: <span class=\"pl-s1\">awsRegion</span>,\n\t\t\t},\n\t\t\t<span class=\"pl-s1\">Upgrade</span>: <span class=\"pl-c1\">false</span>,\n\t\t})\n\t\t<span class=\"pl-k\">defer</span> <span class=\"pl-s1\">test_structure</span>.<span class=\"pl-en\">RunTestStage</span>(<span class=\"pl-s1\">t</span>, <span class=\"pl-s\">\"cleanup\"</span>, <span class=\"pl-k\">func</span>() {\n\t\t\t<span class=\"pl-s1\">terraform</span>.<span class=\"pl-en\">Destroy</span>(<span class=\"pl-s1\">t</span>, <span class=\"pl-s1\">terraformOptions</span>)\n\t\t\t<span class=\"pl-s1\">aws</span>.<span class=\"pl-en\">EmptyS3Bucket</span>(<span class=\"pl-s1\">t</span>, <span class=\"pl-s1\">awsRegion</span>, <span class=\"pl-s1\">stateBucket</span>)\n\t\t\t<span class=\"pl-s1\">aws</span>.<span class=\"pl-en\">DeleteS3Bucket</span>(<span class=\"pl-s1\">t</span>, <span class=\"pl-s1\">awsRegion</span>, <span class=\"pl-s1\">stateBucket</span>)\n\t\t\t<span class=\"pl-en\">cleaningTemp</span>(<span class=\"pl-s\">\"/tmp/TestReportingServiceConfig*\"</span>)\n\t\t\t<span class=\"pl-en\">cleaningTemp</span>(<span class=\"pl-s\">\"go.*\"</span>)\n\t\t})\n\t\t<span class=\"pl-s1\">test_structure</span>.<span class=\"pl-en\">RunTestStage</span>(<span class=\"pl-s1\">t</span>, <span class=\"pl-s\">\"deploy\"</span>, <span class=\"pl-k\">func</span>() {\n\t\t\t<span class=\"pl-s1\">terraform</span>.<span class=\"pl-en\">InitAndApply</span>(<span class=\"pl-s1\">t</span>, <span class=\"pl-s1\">terraformOptions</span>)\n\t\t})\n\t\t<span class=\"pl-s1\">reportingservicebucketname</span> <span class=\"pl-c1\">:=</span> <span class=\"pl-s1\">terraform</span>.<span class=\"pl-en\">Output</span>(<span class=\"pl-s1\">t</span>, <span class=\"pl-s1\">terraformOptions</span>, <span class=\"pl-s\">\"reporting_service_bucket_name\"</span>)\n\t\t<span class=\"pl-s1\">test_structure</span>.<span class=\"pl-en\">RunTestStage</span>(<span class=\"pl-s1\">t</span>, <span class=\"pl-s\">\"validate\"</span>, <span class=\"pl-k\">func</span>() {\n\t\t\t<span class=\"pl-s1\">actualS3BucketName</span> <span class=\"pl-c1\">:=</span> <span class=\"pl-s1\">reportingservicebucketname</span>\n\t\t\t<span class=\"pl-s1\">aws</span>.<span class=\"pl-en\">AssertS3BucketExists</span>(<span class=\"pl-s1\">t</span>, <span class=\"pl-s1\">awsRegion</span>, <span class=\"pl-s1\">actualS3BucketName</span>)\n\t\t\t<span class=\"pl-s1\">greenBackground</span>.<span class=\"pl-en\">Printf</span>(<span class=\"pl-s\">\"Expected reporting-service-s3-bucket %s is matching with Actual reporting-service-s3-bucket %s in terratest assertion ==&gt; %t<span class=\"pl-cce\">\\n</span>\"</span>, <span class=\"pl-s1\">expectedBucketName</span>, <span class=\"pl-s1\">actualS3BucketName</span>, <span class=\"pl-s1\">assert</span>.<span class=\"pl-en\">Equal</span>(<span class=\"pl-s1\">t</span>, <span class=\"pl-s1\">expectedBucketName</span>, <span class=\"pl-s1\">actualS3BucketName</span>))\n\t\t})\n\t\t<span class=\"pl-s1\">t</span>.<span class=\"pl-en\">Run</span>(<span class=\"pl-s\">\"s3config\"</span>, <span class=\"pl-k\">func</span>(<span class=\"pl-s1\">t</span> <span class=\"pl-c1\">*</span>testing.<span class=\"pl-smi\">T</span>) {\n\t\t\t<span class=\"pl-s1\">test_structure</span>.<span class=\"pl-en\">RunTestStage</span>(<span class=\"pl-s1\">t</span>, <span class=\"pl-s\">\"deploy\"</span>, <span class=\"pl-k\">func</span>() {\n\t\t\t\t<span class=\"pl-s1\">terraformOptions</span> <span class=\"pl-c1\">:=</span> <span class=\"pl-s1\">terraform</span>.<span class=\"pl-en\">WithDefaultRetryableErrors</span>(<span class=\"pl-s1\">t</span>, <span class=\"pl-c1\">&amp;</span>terraform.<span class=\"pl-smi\">Options</span>{\n\t\t\t\t\t<span class=\"pl-c\">// Set the path to the Terraform code that will be tested.</span>\n\t\t\t\t\t<span class=\"pl-s1\">TerraformDir</span>: <span class=\"pl-s1\">tempTestFolder2</span>,\n\t\t\t\t\t<span class=\"pl-s1\">Vars</span>: <span class=\"pl-k\">map</span>[<span class=\"pl-smi\">string</span>]<span class=\"pl-k\">interface</span>{}{\n\t\t\t\t\t\t<span class=\"pl-s\">\"aws_region\"</span>:                       <span class=\"pl-s1\">awsRegion</span>,\n\t\t\t\t\t\t<span class=\"pl-s\">\"reporting_service_s3_bucket_name\"</span>: <span class=\"pl-s1\">reportingservicebucketname</span>,\n\t\t\t\t\t\t<span class=\"pl-s\">\"artifactory_url\"</span>:                  <span class=\"pl-s1\">artifactoryurl</span>,\n\t\t\t\t\t\t<span class=\"pl-s\">\"repository\"</span>:                       <span class=\"pl-s1\">repo</span>,\n\t\t\t\t\t\t<span class=\"pl-c\">//\"snapshot_repository\":              snapshotrepository,</span>\n\t\t\t\t\t},\n\t\t\t\t\t<span class=\"pl-c\">// Storing state files remotely in Backend S3 bucket</span>\n\t\t\t\t\t<span class=\"pl-s1\">BackendConfig</span>: <span class=\"pl-k\">map</span>[<span class=\"pl-smi\">string</span>]<span class=\"pl-k\">interface</span>{}{\n\t\t\t\t\t\t<span class=\"pl-s\">\"bucket\"</span>: <span class=\"pl-s1\">stateBucket</span>,\n\t\t\t\t\t\t<span class=\"pl-s\">\"key\"</span>:    <span class=\"pl-s1\">awsRegion</span> <span class=\"pl-c1\">+</span> <span class=\"pl-s\">\"/report-config/terraform.tfstate\"</span>,\n\t\t\t\t\t\t<span class=\"pl-s\">\"region\"</span>: <span class=\"pl-s1\">awsRegion</span>,\n\t\t\t\t\t},\n\t\t\t\t\t<span class=\"pl-s1\">Upgrade</span>: <span class=\"pl-c1\">false</span>,\n\t\t\t\t})\n\t\t\t\t<span class=\"pl-s1\">test_structure</span>.<span class=\"pl-en\">SaveTerraformOptions</span>(<span class=\"pl-s1\">t</span>, <span class=\"pl-s1\">tempTestFolder2</span>, <span class=\"pl-s1\">terraformOptions</span>)\n\t\t\t})\n\t\t\t<span class=\"pl-k\">defer</span> <span class=\"pl-s1\">test_structure</span>.<span class=\"pl-en\">RunTestStage</span>(<span class=\"pl-s1\">t</span>, <span class=\"pl-s\">\"cleanup_reporting_service_config\"</span>, <span class=\"pl-k\">func</span>() {\n\t\t\t\t<span class=\"pl-s1\">terraformOptions</span> <span class=\"pl-c1\">:=</span> <span class=\"pl-s1\">test_structure</span>.<span class=\"pl-en\">LoadTerraformOptions</span>(<span class=\"pl-s1\">t</span>, <span class=\"pl-s1\">tempTestFolder2</span>)\n\t\t\t\t<span class=\"pl-s1\">terraform</span>.<span class=\"pl-en\">Destroy</span>(<span class=\"pl-s1\">t</span>, <span class=\"pl-s1\">terraformOptions</span>)\n\t\t\t})\n\t\t\t<span class=\"pl-s1\">test_structure</span>.<span class=\"pl-en\">RunTestStage</span>(<span class=\"pl-s1\">t</span>, <span class=\"pl-s\">\"deploy_reporting_service_config\"</span>, <span class=\"pl-k\">func</span>() {\n\t\t\t\t<span class=\"pl-s1\">terraformOptions</span> <span class=\"pl-c1\">:=</span> <span class=\"pl-s1\">test_structure</span>.<span class=\"pl-en\">LoadTerraformOptions</span>(<span class=\"pl-s1\">t</span>, <span class=\"pl-s1\">tempTestFolder2</span>)\n\t\t\t\t<span class=\"pl-s1\">terraform</span>.<span class=\"pl-en\">InitAndApply</span>(<span class=\"pl-s1\">t</span>, <span class=\"pl-s1\">terraformOptions</span>)\n\t\t\t})\n\t\t\t<span class=\"pl-s1\">test_structure</span>.<span class=\"pl-en\">RunTestStage</span>(<span class=\"pl-s1\">t</span>, <span class=\"pl-s\">\"validate_reporting_service_config\"</span>, <span class=\"pl-k\">func</span>() {\n\t\t\t\t<span class=\"pl-s1\">s3Content</span>, <span class=\"pl-s1\">_</span> <span class=\"pl-c1\">:=</span> <span class=\"pl-s1\">aws</span>.<span class=\"pl-en\">GetS3ObjectContentsE</span>(<span class=\"pl-s1\">t</span>, <span class=\"pl-s1\">awsRegion</span>, <span class=\"pl-s1\">expectedBucketName</span>, <span class=\"pl-s1\">configzipForAssetion</span>)\n\t\t\t\t<span class=\"pl-en\">print</span>(<span class=\"pl-s\">\"s3Content here:\"</span>, <span class=\"pl-s1\">s3Content</span>)\n\t\t\t\t<span class=\"pl-k\">if</span> <span class=\"pl-en\">len</span>(<span class=\"pl-s1\">s3Content</span>) <span class=\"pl-c1\">&gt;</span> <span class=\"pl-c1\">1</span> {\n\t\t\t\t\t<span class=\"pl-s1\">greenBackground</span>.<span class=\"pl-en\">Printf</span>(<span class=\"pl-s\">\"S3 Bucket has contnent with size %d<span class=\"pl-cce\">\\n</span>\"</span>, <span class=\"pl-en\">len</span>(<span class=\"pl-s1\">s3Content</span>))\n\t\t\t\t}\n\t\t\t})\n\t\t\t<span class=\"pl-s1\">terraformOptions</span> <span class=\"pl-c1\">:=</span> <span class=\"pl-s1\">test_structure</span>.<span class=\"pl-en\">LoadTerraformOptions</span>(<span class=\"pl-s1\">t</span>, <span class=\"pl-s1\">tempTestFolder2</span>)\n\t\t\t<span class=\"pl-s1\">reportingserviceconfigversion</span> <span class=\"pl-c1\">:=</span> <span class=\"pl-s1\">terraform</span>.<span class=\"pl-en\">Output</span>(<span class=\"pl-s1\">t</span>, <span class=\"pl-s1\">terraformOptions</span>, <span class=\"pl-s\">\"reporting_service_config_version\"</span>)\n\t\t\t<span class=\"pl-s1\">greenBackground</span>.<span class=\"pl-en\">Printf</span>(<span class=\"pl-s\">\"S3 CONFIG output IS HERE with version %s<span class=\"pl-cce\">\\n</span>\"</span>, <span class=\"pl-s1\">reportingserviceconfigversion</span>)\n\t\t})\n\t})\n}\n\n<span class=\"pl-k\">func</span> <span class=\"pl-en\">cleaningTemp</span>(<span class=\"pl-s1\">tempPath</span> <span class=\"pl-smi\">string</span>) {\n\t<span class=\"pl-s1\">files</span>, <span class=\"pl-s1\">err</span> <span class=\"pl-c1\">:=</span> <span class=\"pl-s1\">filepath</span>.<span class=\"pl-en\">Glob</span>(<span class=\"pl-s1\">tempPath</span>)\n\t<span class=\"pl-k\">if</span> <span class=\"pl-s1\">err</span> <span class=\"pl-c1\">!=</span> <span class=\"pl-c1\">nil</span> {\n\t\t<span class=\"pl-en\">panic</span>(<span class=\"pl-s1\">err</span>)\n\t}\n\t<span class=\"pl-k\">for</span> <span class=\"pl-s1\">_</span>, <span class=\"pl-s1\">f</span> <span class=\"pl-c1\">:=</span> <span class=\"pl-k\">range</span> <span class=\"pl-s1\">files</span> {\n\t\t<span class=\"pl-k\">if</span> <span class=\"pl-s1\">err</span> <span class=\"pl-c1\">:=</span> <span class=\"pl-s1\">os</span>.<span class=\"pl-en\">RemoveAll</span>(<span class=\"pl-s1\">f</span>); <span class=\"pl-s1\">err</span> <span class=\"pl-c1\">!=</span> <span class=\"pl-c1\">nil</span> {\n\t\t\t<span class=\"pl-en\">panic</span>(<span class=\"pl-s1\">err</span>)\n\t\t}\n\t}\n\t<span class=\"pl-s1\">greenBackground</span>.<span class=\"pl-en\">Printf</span>(<span class=\"pl-s\">\"Cleared Temp directory %s<span class=\"pl-cce\">\\n</span>\"</span>, <span class=\"pl-s1\">tempPath</span>)\n}</pre></div>","answer":{"body":"Hello,\r\ntry to use \"%v\" format key - it should provide formatted value.\r\nAdditional points:\r\n * `bucketObjects` value can be truncated which will require to do additional request\r\n * \"Prefix\" is optional and can be used to filter \"subdirectories\"\r\n\r\nSimplified example:\r\n\r\n```\r\n\tt.Parallel()\r\n\tregion := \"eu-west-1\"\r\n\ts3BucketName := \"acme-example-stage-eu-west-1-tf-state\"\r\n\ts3Client, err := NewS3ClientE(t, region)\r\n\tif err != nil {\r\n\t\tt.Fatal(err)\r\n\t}\r\n\tlistObjectsParams := &s3.ListObjectsV2Input{\r\n\t\tBucket: aws.String(s3BucketName),\r\n\t}\r\n\tfor {\r\n\t\tbucketObjects, err := s3Client.ListObjectsV2(listObjectsParams)\r\n\t\tif err != nil {\r\n\t\t\tt.Fatal(err)\r\n\t\t}\r\n\t\tfmt.Printf(\"%v\\n\", bucketObjects)\r\n\t\tif !*bucketObjects.IsTruncated {\r\n\t\t\tbreak\r\n\t\t}\r\n\t\tlistObjectsParams.ContinuationToken = bucketObjects.NextContinuationToken\r\n\t}\r\n```\r\n\r\nOutput:\r\n```\r\n{\r\n  Contents: [{\r\n      ETag: \"\\\"aaa\\\"\",\r\n      Key: \"stage/_global/account-baseline/terraform.tfstate\",\r\n      LastModified: 2021-04-27 09:33:06 +0000 UTC,\r\n      Size: 1286,\r\n      StorageClass: \"STANDARD\"\r\n    },{\r\n      ETag: \"\\\"bbb\\\"\",\r\n      Key: \"stage/us-east-1/mysql/terraform.tfstate\",\r\n      LastModified: 2021-04-27 09:33:47 +0000 UTC,\r\n      Size: 1402,\r\n      StorageClass: \"STANDARD\"\r\n    },{\r\n      ETag: \"\\\"ccc\\\"\",\r\n      Key: \"stage/us-east-1/vpc/terraform.tfstate\",\r\n      LastModified: 2021-04-27 09:33:25 +0000 UTC,\r\n      Size: 8667,\r\n      StorageClass: \"STANDARD\"\r\n    }],\r\n  IsTruncated: false,\r\n  KeyCount: 3,\r\n  MaxKeys: 1000,\r\n  Name: \"acme-example-stage-eu-west-1-tf-state\",\r\n  Prefix: \"\"\r\n}\r\n```\r\n\r\nLimit list for \"subdirectories\":\r\n```\r\n...\r\n\tlistObjectsParams := &s3.ListObjectsV2Input{\r\n\t\tBucket: aws.String(s3BucketName),\r\n\t\tPrefix: aws.String(\"stage/us-east-1\"),\r\n\t}\r\n...\r\n```\r\nOutput:\r\n```\r\n{\r\n  Contents: [{\r\n      ETag: \"\\\"bbb\\\"\",\r\n      Key: \"stage/us-east-1/mysql/terraform.tfstate\",\r\n      LastModified: 2021-04-27 09:33:47 +0000 UTC,\r\n      Size: 1402,\r\n      StorageClass: \"STANDARD\"\r\n    },{\r\n      ETag: \"\\\"ccc\\\"\",\r\n      Key: \"stage/us-east-1/vpc/terraform.tfstate\",\r\n      LastModified: 2021-04-27 09:33:25 +0000 UTC,\r\n      Size: 8667,\r\n      StorageClass: \"STANDARD\"\r\n    }],\r\n  IsTruncated: false,\r\n  KeyCount: 2,\r\n  MaxKeys: 1000,\r\n  Name: \"acme-example-stage-eu-west-1-tf-state\",\r\n  Prefix: \"stage/us-east-1\"\r\n}\r\n```\r\n\r\nThe individual objects can be also processed by looping on `Contents` field\r\n\r\n```\r\nfor _, item := range bucketObjects.Contents {\r\n\tfmt.Printf(\"path: %s\\n\", *item.Key)\r\n}\r\n```\r\n\r\nhttps://docs.aws.amazon.com/code-samples/latest/catalog/gov2-s3-ListObjects-ListObjectsv2.go.html\r\n","bodyHTML":"<p dir=\"auto\">Hello,<br>\ntry to use \"%v\" format key - it should provide formatted value.<br>\nAdditional points:</p>\n<ul dir=\"auto\">\n<li><code class=\"notranslate\">bucketObjects</code> value can be truncated which will require to do additional request</li>\n<li>\"Prefix\" is optional and can be used to filter \"subdirectories\"</li>\n</ul>\n<p dir=\"auto\">Simplified example:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"\tt.Parallel()\n\tregion := &quot;eu-west-1&quot;\n\ts3BucketName := &quot;acme-example-stage-eu-west-1-tf-state&quot;\n\ts3Client, err := NewS3ClientE(t, region)\n\tif err != nil {\n\t\tt.Fatal(err)\n\t}\n\tlistObjectsParams := &amp;s3.ListObjectsV2Input{\n\t\tBucket: aws.String(s3BucketName),\n\t}\n\tfor {\n\t\tbucketObjects, err := s3Client.ListObjectsV2(listObjectsParams)\n\t\tif err != nil {\n\t\t\tt.Fatal(err)\n\t\t}\n\t\tfmt.Printf(&quot;%v\\n&quot;, bucketObjects)\n\t\tif !*bucketObjects.IsTruncated {\n\t\t\tbreak\n\t\t}\n\t\tlistObjectsParams.ContinuationToken = bucketObjects.NextContinuationToken\n\t}\"><pre class=\"notranslate\"><code class=\"notranslate\">\tt.Parallel()\n\tregion := \"eu-west-1\"\n\ts3BucketName := \"acme-example-stage-eu-west-1-tf-state\"\n\ts3Client, err := NewS3ClientE(t, region)\n\tif err != nil {\n\t\tt.Fatal(err)\n\t}\n\tlistObjectsParams := &amp;s3.ListObjectsV2Input{\n\t\tBucket: aws.String(s3BucketName),\n\t}\n\tfor {\n\t\tbucketObjects, err := s3Client.ListObjectsV2(listObjectsParams)\n\t\tif err != nil {\n\t\t\tt.Fatal(err)\n\t\t}\n\t\tfmt.Printf(\"%v\\n\", bucketObjects)\n\t\tif !*bucketObjects.IsTruncated {\n\t\t\tbreak\n\t\t}\n\t\tlistObjectsParams.ContinuationToken = bucketObjects.NextContinuationToken\n\t}\n</code></pre></div>\n<p dir=\"auto\">Output:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"{\n  Contents: [{\n      ETag: &quot;\\&quot;aaa\\&quot;&quot;,\n      Key: &quot;stage/_global/account-baseline/terraform.tfstate&quot;,\n      LastModified: 2021-04-27 09:33:06 +0000 UTC,\n      Size: 1286,\n      StorageClass: &quot;STANDARD&quot;\n    },{\n      ETag: &quot;\\&quot;bbb\\&quot;&quot;,\n      Key: &quot;stage/us-east-1/mysql/terraform.tfstate&quot;,\n      LastModified: 2021-04-27 09:33:47 +0000 UTC,\n      Size: 1402,\n      StorageClass: &quot;STANDARD&quot;\n    },{\n      ETag: &quot;\\&quot;ccc\\&quot;&quot;,\n      Key: &quot;stage/us-east-1/vpc/terraform.tfstate&quot;,\n      LastModified: 2021-04-27 09:33:25 +0000 UTC,\n      Size: 8667,\n      StorageClass: &quot;STANDARD&quot;\n    }],\n  IsTruncated: false,\n  KeyCount: 3,\n  MaxKeys: 1000,\n  Name: &quot;acme-example-stage-eu-west-1-tf-state&quot;,\n  Prefix: &quot;&quot;\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">{\n  Contents: [{\n      ETag: \"\\\"aaa\\\"\",\n      Key: \"stage/_global/account-baseline/terraform.tfstate\",\n      LastModified: 2021-04-27 09:33:06 +0000 UTC,\n      Size: 1286,\n      StorageClass: \"STANDARD\"\n    },{\n      ETag: \"\\\"bbb\\\"\",\n      Key: \"stage/us-east-1/mysql/terraform.tfstate\",\n      LastModified: 2021-04-27 09:33:47 +0000 UTC,\n      Size: 1402,\n      StorageClass: \"STANDARD\"\n    },{\n      ETag: \"\\\"ccc\\\"\",\n      Key: \"stage/us-east-1/vpc/terraform.tfstate\",\n      LastModified: 2021-04-27 09:33:25 +0000 UTC,\n      Size: 8667,\n      StorageClass: \"STANDARD\"\n    }],\n  IsTruncated: false,\n  KeyCount: 3,\n  MaxKeys: 1000,\n  Name: \"acme-example-stage-eu-west-1-tf-state\",\n  Prefix: \"\"\n}\n</code></pre></div>\n<p dir=\"auto\">Limit list for \"subdirectories\":</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"...\n\tlistObjectsParams := &amp;s3.ListObjectsV2Input{\n\t\tBucket: aws.String(s3BucketName),\n\t\tPrefix: aws.String(&quot;stage/us-east-1&quot;),\n\t}\n...\"><pre class=\"notranslate\"><code class=\"notranslate\">...\n\tlistObjectsParams := &amp;s3.ListObjectsV2Input{\n\t\tBucket: aws.String(s3BucketName),\n\t\tPrefix: aws.String(\"stage/us-east-1\"),\n\t}\n...\n</code></pre></div>\n<p dir=\"auto\">Output:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"{\n  Contents: [{\n      ETag: &quot;\\&quot;bbb\\&quot;&quot;,\n      Key: &quot;stage/us-east-1/mysql/terraform.tfstate&quot;,\n      LastModified: 2021-04-27 09:33:47 +0000 UTC,\n      Size: 1402,\n      StorageClass: &quot;STANDARD&quot;\n    },{\n      ETag: &quot;\\&quot;ccc\\&quot;&quot;,\n      Key: &quot;stage/us-east-1/vpc/terraform.tfstate&quot;,\n      LastModified: 2021-04-27 09:33:25 +0000 UTC,\n      Size: 8667,\n      StorageClass: &quot;STANDARD&quot;\n    }],\n  IsTruncated: false,\n  KeyCount: 2,\n  MaxKeys: 1000,\n  Name: &quot;acme-example-stage-eu-west-1-tf-state&quot;,\n  Prefix: &quot;stage/us-east-1&quot;\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">{\n  Contents: [{\n      ETag: \"\\\"bbb\\\"\",\n      Key: \"stage/us-east-1/mysql/terraform.tfstate\",\n      LastModified: 2021-04-27 09:33:47 +0000 UTC,\n      Size: 1402,\n      StorageClass: \"STANDARD\"\n    },{\n      ETag: \"\\\"ccc\\\"\",\n      Key: \"stage/us-east-1/vpc/terraform.tfstate\",\n      LastModified: 2021-04-27 09:33:25 +0000 UTC,\n      Size: 8667,\n      StorageClass: \"STANDARD\"\n    }],\n  IsTruncated: false,\n  KeyCount: 2,\n  MaxKeys: 1000,\n  Name: \"acme-example-stage-eu-west-1-tf-state\",\n  Prefix: \"stage/us-east-1\"\n}\n</code></pre></div>\n<p dir=\"auto\">The individual objects can be also processed by looping on <code class=\"notranslate\">Contents</code> field</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"for _, item := range bucketObjects.Contents {\n\tfmt.Printf(&quot;path: %s\\n&quot;, *item.Key)\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">for _, item := range bucketObjects.Contents {\n\tfmt.Printf(\"path: %s\\n\", *item.Key)\n}\n</code></pre></div>\n<p dir=\"auto\"><a href=\"https://docs.aws.amazon.com/code-samples/latest/catalog/gov2-s3-ListObjects-ListObjectsv2.go.html\" rel=\"nofollow\">https://docs.aws.amazon.com/code-samples/latest/catalog/gov2-s3-ListObjects-ListObjectsv2.go.html</a></p>"}}} />

</CenterLayout>
  

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "9ef8f3ea902bca1d886326fa525022d6"
}
##DOCS-SOURCER-END -->
