---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/633" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>In the RefArch Gruntwork pipelines.yml, why are plan and deploy bundled in the same job?</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84ASJFS","number":633,"author":{"login":"umm0n"},"title":"In the RefArch Gruntwork pipelines.yml, why are plan and deploy bundled in the same job?","body":"[r:terraform-aws-ci-pipeline-example](https://github.com/gruntwork-io/terraform-aws-ci-pipeline-example)\r\n\r\nThe Gruntworks pipe for the ref arch has plan and deploy steps bundled in the same job. This causes plan to be run when merging against master, even if it was ran moments ago when pushing the changes against the branch. For large plans, this creates a big overhead in terms of time. For example:\r\n\r\n1. Create PR, push changes. Pipeline runs plan, it takes 30min.\r\n2. Merge PR. Pipeline runs plan, it takes 30min. Then pipe runs deploy, takes another 30mins.\r\n\r\nWhy are we running plan again when merging? We already know the plan, it ran as a result of creating the PR in the first place. Wouldn't it make more sense to have these steps split into separate jobs? For longer plans, the time savings could be huge when merging.\r\n\r\n---\r\n\r\n<ins datetime=\"2023-01-13T18:46:46Z\">\r\n  <p><a href=\"https://support.gruntwork.io/hc/requests/109794\">Tracked in ticket #109794</a></p>\r\n</ins>\r\n","bodyHTML":"<p dir=\"auto\"><a href=\"https://github.com/gruntwork-io/terraform-aws-ci-pipeline-example\">r:terraform-aws-ci-pipeline-example</a></p>\n<p dir=\"auto\">The Gruntworks pipe for the ref arch has plan and deploy steps bundled in the same job. This causes plan to be run when merging against master, even if it was ran moments ago when pushing the changes against the branch. For large plans, this creates a big overhead in terms of time. For example:</p>\n<ol dir=\"auto\">\n<li>Create PR, push changes. Pipeline runs plan, it takes 30min.</li>\n<li>Merge PR. Pipeline runs plan, it takes 30min. Then pipe runs deploy, takes another 30mins.</li>\n</ol>\n<p dir=\"auto\">Why are we running plan again when merging? We already know the plan, it ran as a result of creating the PR in the first place. Wouldn't it make more sense to have these steps split into separate jobs? For longer plans, the time savings could be huge when merging.</p>\n<hr>\n<ins datetime=\"2023-01-13T18:46:46Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/109794\" rel=\"nofollow\">Tracked in ticket #109794</a></p>\n</ins>","answer":{"body":"One of our engineers responded internally with the following:\r\n\r\n> Terraform will run plan under the hood whenever you run apply - unless you give it the path to a saved plan output. It needs to do this in order to have the latest plan before applying. To fully answer this question, we need confirm that this is the same behavior that occurs with the ECS Deploy Runner's (Gruntwork Pipelines') internal usage for deploying new Reference Architectures.\r\n\r\nI'll also add that you're encouraged to re-configure the pipelines configurations however you'd like. If you want to pass a plan output between steps to avoid running plan again, you could use something like [CircleCI Artifacts](https://circleci.com/docs/artifacts/) or [GitHub Actions Artifacts](https://docs.github.com/en/actions/using-workflows/storing-workflow-data-as-artifacts).\r\n\r\nOnce we've completed the internal research, we'll update this thread again.\r\n","bodyHTML":"<p dir=\"auto\">One of our engineers responded internally with the following:</p>\n<blockquote>\n<p dir=\"auto\">Terraform will run plan under the hood whenever you run apply - unless you give it the path to a saved plan output. It needs to do this in order to have the latest plan before applying. To fully answer this question, we need confirm that this is the same behavior that occurs with the ECS Deploy Runner's (Gruntwork Pipelines') internal usage for deploying new Reference Architectures.</p>\n</blockquote>\n<p dir=\"auto\">I'll also add that you're encouraged to re-configure the pipelines configurations however you'd like. If you want to pass a plan output between steps to avoid running plan again, you could use something like <a href=\"https://circleci.com/docs/artifacts/\" rel=\"nofollow\">CircleCI Artifacts</a> or <a href=\"https://docs.github.com/en/actions/using-workflows/storing-workflow-data-as-artifacts\">GitHub Actions Artifacts</a>.</p>\n<p dir=\"auto\">Once we've completed the internal research, we'll update this thread again.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "35bafd177d5b395d7001bcff04f4fcc0"
}
##DOCS-SOURCER-END -->
