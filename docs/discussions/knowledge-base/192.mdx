---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/192" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>ECS Fargate provider confguration errors during terraform init</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AOxEc","number":192,"author":{"login":"rhoboat"},"title":"ECS Fargate provider confguration errors during terraform init","body":"I'm using ECS Fargate modules. When running **`terraform init`**, I get this error.\r\n\r\n```\r\nDownloading git::git@github.com:gruntwork-io/terraform-aws-service-catalog.git?ref=v0.73.2 for fargate_cluster...\r\n- fargate_cluster in .terraform/modules/fargate_cluster/modules/services/ecs-fargate-cluster\r\nThere are some problems with the configuration, described below.\r\nThe Terraform configuration must be valid before initialization so that Terraform can determine which modules and\r\nproviders need to be installed.\r\n╷\r\n│ Error: Module module.fargate_service.module.route53_health_check contains provider configuration\r\n│ \r\n│ Providers cannot be configured within modules using count, for_each or depends_on.\r\n```\r\n╵Terraform v1.0.11\r\n\r\nI'm using:\r\n\r\n```\r\nmodule \"fargate_cluster\" {\r\n  source = \"git::git@github.com:gruntwork-io/terraform-aws-service-catalog.git//modules/services/ecs-fargate-cluster?ref=v0.73.2\"\r\n\r\n...\r\n}\r\n\r\nmodule \"fargate_service\" {\r\n  source = \"git::git@github.com:gruntwork-io/terraform-aws-service-catalog.git//modules/services/ecs-service?ref=v0.73.2\"\r\n\r\n...\r\n}\r\n```\r\n\r\nIn case this might be related to the Terraform AWS provider v4.0.0, my `.terraform.lock.hcl` file\r\n```\r\nprovider \"[registry.terraform.io/hashicorp/aws](http://registry.terraform.io/hashicorp/aws)\" {\r\n  version     = \"3.74.1\"\r\n  constraints = \">= 2.6.0, >= 2.68.0, ~> 3.23, >= 3.27.0\"\r\n  hashes = [\r\n```\r\n\r\nHow do I get past this error?","bodyHTML":"<p dir=\"auto\">I'm using ECS Fargate modules. When running <strong><code class=\"notranslate\">terraform init</code></strong>, I get this error.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Downloading git::git@github.com:gruntwork-io/terraform-aws-service-catalog.git?ref=v0.73.2 for fargate_cluster...\n- fargate_cluster in .terraform/modules/fargate_cluster/modules/services/ecs-fargate-cluster\nThere are some problems with the configuration, described below.\nThe Terraform configuration must be valid before initialization so that Terraform can determine which modules and\nproviders need to be installed.\n╷\n│ Error: Module module.fargate_service.module.route53_health_check contains provider configuration\n│ \n│ Providers cannot be configured within modules using count, for_each or depends_on.\"><pre class=\"notranslate\"><code>Downloading git::git@github.com:gruntwork-io/terraform-aws-service-catalog.git?ref=v0.73.2 for fargate_cluster...\n- fargate_cluster in .terraform/modules/fargate_cluster/modules/services/ecs-fargate-cluster\nThere are some problems with the configuration, described below.\nThe Terraform configuration must be valid before initialization so that Terraform can determine which modules and\nproviders need to be installed.\n╷\n│ Error: Module module.fargate_service.module.route53_health_check contains provider configuration\n│ \n│ Providers cannot be configured within modules using count, for_each or depends_on.\n</code></pre></div>\n<p dir=\"auto\">╵Terraform v1.0.11</p>\n<p dir=\"auto\">I'm using:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"module &quot;fargate_cluster&quot; {\n  source = &quot;git::git@github.com:gruntwork-io/terraform-aws-service-catalog.git//modules/services/ecs-fargate-cluster?ref=v0.73.2&quot;\n\n...\n}\n\nmodule &quot;fargate_service&quot; {\n  source = &quot;git::git@github.com:gruntwork-io/terraform-aws-service-catalog.git//modules/services/ecs-service?ref=v0.73.2&quot;\n\n...\n}\"><pre class=\"notranslate\"><code>module \"fargate_cluster\" {\n  source = \"git::git@github.com:gruntwork-io/terraform-aws-service-catalog.git//modules/services/ecs-fargate-cluster?ref=v0.73.2\"\n\n...\n}\n\nmodule \"fargate_service\" {\n  source = \"git::git@github.com:gruntwork-io/terraform-aws-service-catalog.git//modules/services/ecs-service?ref=v0.73.2\"\n\n...\n}\n</code></pre></div>\n<p dir=\"auto\">In case this might be related to the Terraform AWS provider v4.0.0, my <code class=\"notranslate\">.terraform.lock.hcl</code> file</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"provider &quot;[registry.terraform.io/hashicorp/aws](http://registry.terraform.io/hashicorp/aws)&quot; {\n  version     = &quot;3.74.1&quot;\n  constraints = &quot;&gt;= 2.6.0, &gt;= 2.68.0, ~&gt; 3.23, &gt;= 3.27.0&quot;\n  hashes = [\"><pre class=\"notranslate\"><code>provider \"[registry.terraform.io/hashicorp/aws](http://registry.terraform.io/hashicorp/aws)\" {\n  version     = \"3.74.1\"\n  constraints = \"&gt;= 2.6.0, &gt;= 2.68.0, ~&gt; 3.23, &gt;= 3.27.0\"\n  hashes = [\n</code></pre></div>\n<p dir=\"auto\">How do I get past this error?</p>","answer":{"body":"@KOConchobhair The issue is that the provider is being specified in the monitoring module, so the modules that use that cannot specify `depends_on`. We need to remove nested providers. We shouldn't [specify the provider here](https://github.com/gruntwork-io/terraform-aws-monitoring/blob/3c8d171/modules/alarms/route53-health-check-alarms/main.tf#L18-L30). I've [filed an issue](https://github.com/gruntwork-io/terraform-aws-monitoring/issues/244) for this.\r\n\r\nI think the workaround of removing `depends_on` is reasonable. The `fargate_service` depends on the outputs from `fargate_cluster` within the configuration, so Terraform will figure out that dependency and apply the cluster before the service.","bodyHTML":"<p dir=\"auto\"><a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/KOConchobhair/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/KOConchobhair\">@KOConchobhair</a> The issue is that the provider is being specified in the monitoring module, so the modules that use that cannot specify <code class=\"notranslate\">depends_on</code>. We need to remove nested providers. We shouldn't <a href=\"https://github.com/gruntwork-io/terraform-aws-monitoring/blob/3c8d171/modules/alarms/route53-health-check-alarms/main.tf#L18-L30\">specify the provider here</a>. I've <a href=\"https://github.com/gruntwork-io/terraform-aws-monitoring/issues/244\">filed an issue</a> for this.</p>\n<p dir=\"auto\">I think the workaround of removing <code class=\"notranslate\">depends_on</code> is reasonable. The <code class=\"notranslate\">fargate_service</code> depends on the outputs from <code class=\"notranslate\">fargate_cluster</code> within the configuration, so Terraform will figure out that dependency and apply the cluster before the service.</p>"}}} />

</CenterLayout>
  

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "9f10e44a214b7e65db999633c723d1e6"
}
##DOCS-SOURCER-END -->
