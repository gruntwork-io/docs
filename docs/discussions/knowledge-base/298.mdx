---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/298" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Gruntwork and Instance Metadata Service Version 2 (IMDSv2)</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84APB5B","number":298,"author":{"login":"zackproser"},"title":"Gruntwork and Instance Metadata Service Version 2 (IMDSv2)","body":"What is IMDSv2 and why should I care? Does Gruntwork support IMDSV2?","bodyHTML":"<p dir=\"auto\">What is IMDSv2 and why should I care? Does Gruntwork support IMDSV2?</p>","answer":{"body":"## What is IMDSv2?\r\n\r\nInstance Metadata Service is AWS's special endpoint that is available only to running EC2 instances. It can return things like the running instance's ID, its public or private IPv4 address, IAM profile credentials, etc. \r\n\r\n[As described in the AWS EC2 user guide](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/configuring-instance-metadata-service.html), IMDSv2 introduces a new token based authentication scheme. In short, whereas in IMDSv1 you needed only to call the endpoint, with IMDSv2 you must first request a token from IMDS, and then present that token on all subsequent requests to the Instance Metadata Service endpoints. \r\n\r\nNote that the actual endpoints under IMDSv1 and IMDSv2 are identical. The use of this token is what constitutes whether IMDSv2 or IMDSv1 is being contacted. IMDSv2 always requires the token. \r\n\r\n## Why should I care? \r\n\r\nAlthough AWS explicitly states that Instance Metadata Service Version 1 is fully secure, version 2 is specially hardened against at least 4 known attack vectors. If you have no reason to remain on IMDSv1, or aren't sure which to use, use version 2. \r\n\r\n## Does Gruntwork support IMDSv2? \r\n\r\nGruntwork's bash commons repository supports IMDSv2 as of [release `v0.1.8`](https://github.com/gruntwork-io/bash-commons/releases/tag/v0.1.8).\r\n\r\n## What other resources are there for understanding IMDSv2?\r\n\r\n### Gruntwork Resources \r\n- [Gruntwork Bash Commons release `v0.1.8` (Introduces IMDsv2 support)](https://github.com/gruntwork-io/bash-commons/releases/tag/v0.1.8) \r\n- [Gruntwork module disable-instance-metadata](https://github.com/gruntwork-io/terraform-aws-server/tree/master/modules/disable-instance-metadata) - A script that can remove access to IMDS once its no longer necessary for added security\r\n- [Gruntwork module require-instance-metadata-service-version](https://github.com/gruntwork-io/terraform-aws-server/tree/master/modules/require-instance-metadata-service-version) - A script that can make IMDSv2 access optional or required \r\n\r\n### AWS Resources \r\n- [AWS EC2 User Guide: Use IMDSv2](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/configuring-instance-metadata-service.html)\r\n- [AWS EC2 User Guide: Retrieve instance metadata](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instancedata-data-retrieval.html) ","bodyHTML":"<h2 dir=\"auto\">What is IMDSv2?</h2>\n<p dir=\"auto\">Instance Metadata Service is AWS's special endpoint that is available only to running EC2 instances. It can return things like the running instance's ID, its public or private IPv4 address, IAM profile credentials, etc.</p>\n<p dir=\"auto\"><a href=\"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/configuring-instance-metadata-service.html\" rel=\"nofollow\">As described in the AWS EC2 user guide</a>, IMDSv2 introduces a new token based authentication scheme. In short, whereas in IMDSv1 you needed only to call the endpoint, with IMDSv2 you must first request a token from IMDS, and then present that token on all subsequent requests to the Instance Metadata Service endpoints.</p>\n<p dir=\"auto\">Note that the actual endpoints under IMDSv1 and IMDSv2 are identical. The use of this token is what constitutes whether IMDSv2 or IMDSv1 is being contacted. IMDSv2 always requires the token.</p>\n<h2 dir=\"auto\">Why should I care?</h2>\n<p dir=\"auto\">Although AWS explicitly states that Instance Metadata Service Version 1 is fully secure, version 2 is specially hardened against at least 4 known attack vectors. If you have no reason to remain on IMDSv1, or aren't sure which to use, use version 2.</p>\n<h2 dir=\"auto\">Does Gruntwork support IMDSv2?</h2>\n<p dir=\"auto\">Gruntwork's bash commons repository supports IMDSv2 as of <a href=\"https://github.com/gruntwork-io/bash-commons/releases/tag/v0.1.8\">release <code class=\"notranslate\">v0.1.8</code></a>.</p>\n<h2 dir=\"auto\">What other resources are there for understanding IMDSv2?</h2>\n<h3 dir=\"auto\">Gruntwork Resources</h3>\n<ul dir=\"auto\">\n<li><a href=\"https://github.com/gruntwork-io/bash-commons/releases/tag/v0.1.8\">Gruntwork Bash Commons release <code class=\"notranslate\">v0.1.8</code> (Introduces IMDsv2 support)</a></li>\n<li><a href=\"https://github.com/gruntwork-io/terraform-aws-server/tree/master/modules/disable-instance-metadata\">Gruntwork module disable-instance-metadata</a> - A script that can remove access to IMDS once its no longer necessary for added security</li>\n<li><a href=\"https://github.com/gruntwork-io/terraform-aws-server/tree/master/modules/require-instance-metadata-service-version\">Gruntwork module require-instance-metadata-service-version</a> - A script that can make IMDSv2 access optional or required</li>\n</ul>\n<h3 dir=\"auto\">AWS Resources</h3>\n<ul dir=\"auto\">\n<li><a href=\"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/configuring-instance-metadata-service.html\" rel=\"nofollow\">AWS EC2 User Guide: Use IMDSv2</a></li>\n<li><a href=\"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instancedata-data-retrieval.html\" rel=\"nofollow\">AWS EC2 User Guide: Retrieve instance metadata</a></li>\n</ul>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "19b879aad1411e084a0e018fa9bed31d"
}
##DOCS-SOURCER-END -->
