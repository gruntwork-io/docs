---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/160" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Add ICMP NACL rules on a VPC deployed with VPC module from CIS Service Catalog</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AOpjW","number":160,"author":{"login":"klaphi"},"title":"Add ICMP NACL rules on a VPC deployed with VPC module from CIS Service Catalog","body":"Hi all,\r\n\r\nI am trying to find out howto enable ICMP NACL rules for given network ranges on a VPC created by VPC module of the [CIS catalog](https://github.com/gruntwork-io/terraform-aws-cis-service-catalog).\r\nPossible variables are `nacl_ingress_rules`, `nacl_egress_rules` for the wrapped VPC module or `app_allow_inbound_ports_from_cidr` (CIS NACL module) but the most recent one does not handle egress NACLs. Currently I am not sure what would be the best option and which priority numbers I should use without interfering with the already deployed NACLs.\r\n","bodyHTML":"<p dir=\"auto\">Hi all,</p>\n<p dir=\"auto\">I am trying to find out howto enable ICMP NACL rules for given network ranges on a VPC created by VPC module of the <a href=\"https://github.com/gruntwork-io/terraform-aws-cis-service-catalog\">CIS catalog</a>.<br>\nPossible variables are <code class=\"notranslate\">nacl_ingress_rules</code>, <code class=\"notranslate\">nacl_egress_rules</code> for the wrapped VPC module or <code class=\"notranslate\">app_allow_inbound_ports_from_cidr</code> (CIS NACL module) but the most recent one does not handle egress NACLs. Currently I am not sure what would be the best option and which priority numbers I should use without interfering with the already deployed NACLs.</p>","answer":{"body":"Thanks for the clarification! You can allow inbound traffic to private subnets with input variable `private_app_allow_inbound_ports_from_cidr` in the `terraform-aws-cis-service-catalog/vpc` module, e.g.:\r\n\r\n```\r\n  private_app_allow_inbound_ports_from_cidr = {\r\n    allow_icmp_from_onprem = {\r\n      client_cidr_block = \"10.20.30.40/32\"\r\n      rule_number = 50\r\n      protocol = \"icmp\"\r\n      from_port = -1\r\n      to_port = -1\r\n    }\r\n  }\r\n```\r\nKeep the the `rule_number` below 100 to ensure it get higher precedence over the default `vpc` module rules. The CIS Service Catalog rules are all sub 100, but none of the extra CIS rules interfere or overlap with this rule.\r\n\r\nWRT to the `egress` configuration, the wrapped `terraform-aws-vpc/vpc-app-network-acls` does not support custom `egress` rules. However, you can use [`terraform-aws-vpc/network-acl-outbound`](https://github.com/gruntwork-io/terraform-aws-vpc/tree/master/modules/network-acl-outbound) to create a custom rule. You can also file a feature request to support extra `egress` rules in `vpc-app-network-acls`. ","bodyHTML":"<p dir=\"auto\">Thanks for the clarification! You can allow inbound traffic to private subnets with input variable <code class=\"notranslate\">private_app_allow_inbound_ports_from_cidr</code> in the <code class=\"notranslate\">terraform-aws-cis-service-catalog/vpc</code> module, e.g.:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  private_app_allow_inbound_ports_from_cidr = {\n    allow_icmp_from_onprem = {\n      client_cidr_block = &quot;10.20.30.40/32&quot;\n      rule_number = 50\n      protocol = &quot;icmp&quot;\n      from_port = -1\n      to_port = -1\n    }\n  }\"><pre class=\"notranslate\"><code class=\"notranslate\">  private_app_allow_inbound_ports_from_cidr = {\n    allow_icmp_from_onprem = {\n      client_cidr_block = \"10.20.30.40/32\"\n      rule_number = 50\n      protocol = \"icmp\"\n      from_port = -1\n      to_port = -1\n    }\n  }\n</code></pre></div>\n<p dir=\"auto\">Keep the the <code class=\"notranslate\">rule_number</code> below 100 to ensure it get higher precedence over the default <code class=\"notranslate\">vpc</code> module rules. The CIS Service Catalog rules are all sub 100, but none of the extra CIS rules interfere or overlap with this rule.</p>\n<p dir=\"auto\">WRT to the <code class=\"notranslate\">egress</code> configuration, the wrapped <code class=\"notranslate\">terraform-aws-vpc/vpc-app-network-acls</code> does not support custom <code class=\"notranslate\">egress</code> rules. However, you can use <a href=\"https://github.com/gruntwork-io/terraform-aws-vpc/tree/master/modules/network-acl-outbound\"><code class=\"notranslate\">terraform-aws-vpc/network-acl-outbound</code></a> to create a custom rule. You can also file a feature request to support extra <code class=\"notranslate\">egress</code> rules in <code class=\"notranslate\">vpc-app-network-acls</code>.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "dc5b86e9544903eb10a5eedf7754a565"
}
##DOCS-SOURCER-END -->
