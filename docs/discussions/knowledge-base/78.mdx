---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/78" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>How to configure Gruntwork Pipelines for a setup based on Terragrunt live examples</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AOOqw","number":78,"author":{"login":"zackproser"},"title":"How to configure Gruntwork Pipelines for a setup based on Terragrunt live examples","body":"A customer asked: \r\n\r\n> We've based our current setup on https://github.com/gruntwork-io/terragrunt-infrastructure-live-example - is this close enough to get Gruntwork Pipelines working without having a Reference Architecture deployed for us? ","bodyHTML":"<p dir=\"auto\">A customer asked:</p>\n<blockquote>\n<p dir=\"auto\">We've based our current setup on <a href=\"https://github.com/gruntwork-io/terragrunt-infrastructure-live-example\">https://github.com/gruntwork-io/terragrunt-infrastructure-live-example</a> - is this close enough to get Gruntwork Pipelines working without having a Reference Architecture deployed for us?</p>\n</blockquote>","answer":{"body":"Given your setup and your prior experience with Terragrunt, we recommend that you start by adopting service catalog modules into your current setup. This will likely end up looking like an incremental migration moving component by component. Here's how we'd recommend approaching this:\r\n\r\n1. Start by looking at [the for-production examples](https://github.com/gruntwork-io/terraform-aws-service-catalog/tree/master/examples/for-production) in the service catalog\r\n1. Pick out a service that will be easy to adopt given your current architecture. For example, you could run [terragrunt graph-dependencies](https://terragrunt.gruntwork.io/docs/reference/cli-options/#graph-dependencies) and pick a component from a leaf-node level to begin with. That is, start with a component that has no downstream dependencies that have not already been migrated.\r\n1. Back up your current terraform state for that module using `terragrunt state push backup.tfstate`. This is important! If for any reason the migration of state objects with `terragrunt state mv` commands fails, you can then use `terragrunt state pull > backup.tfstate` to restore your original state and try again.\r\n1. Replace the terraform `source` to point at our service catalog module instead of whatever you're using now.\r\n1. Run `terragrunt plan`. Look at the plan output to see what exactly would change if you were to switch over to using Gruntwork's service catalog modules. Before making any state migrations, try to map destroyed resources to newly created resources. You may be able to match a destroyed resource to a newly created one, and avoid the destroy/create process by using `terragrunt state mv`.\r\n1. Your goal is to get to a point where the `terragrunt plan` output is clean with no changes to be applied. But in your case, you will very likely end up with changes that _must_ be made, since we have no idea what modules and module versions you're starting from. The migration of resources can also end up being difficult if you have resources stored in different object types than what our service catalog modules expect. This may require you to write some logic that will migrate objects into different types.\r\n    - Take a look at the `_scripts/migration_helpers.sh` file in this release: (https://github.com/gruntwork-io/infrastructure-live-multi-account-acme/releases/download/v0.0.1-20210527/refarch-folder-structure.zip). This script contains utilities that perform more complex migrations. Please be aware that we will not support fixes or patches to this frozen artifact. It's offered in this answer only as an example.\r\n\r\nFollowing this pattern, you'd ideally be switching out your current sources in your terragrunt configs for our service catalog source URLs, and continue running plan and doing state migrations until the plan comes out clean or almost clean.\r\n\r\nSpecifically for the Gruntwork Pipelines piece, if you get the Reference Architecture deployed, then everything \"just works\". While we don't believe the exact folder structure should matter much, you may need to tweak some of the configuration once you have pipelines set up in order to accommodate differences in your layout.\r\n\r\nThe good news in your case is that we do have a [guide](https://gruntwork.io/guides/automations/how-to-configure-a-production-grade-ci-cd-setup-for-apps-and-infrastructure-code/#) for configuring Gruntwork Pipelines. You'd be looking to deploy the ECS Deploy Runner stack, which has several components. We also have documentation [for this stack](https://github.com/gruntwork-io/terraform-aws-ci/tree/master/modules/ecs-deploy-runner).\r\n\r\nThen, regardless of whether you're currently using CircleCI, Jenkins or GitLab, you can see the configurations for these CI tools within the for-production infra-live repo, at [the root of that repo](https://github.com/gruntwork-io/terraform-aws-service-catalog/tree/master/examples/for-production/infrastructure-live). The relevant files will be the Jenkinsfile, gitlab-ci.yml, and the .circleci folder.\r\n\r\nWe also have deployment walkthroughs for how to use Pipelines after you've installed it:\r\n\r\n   * [Two minute overview of Pipelines](https://www.youtube.com/watch?v=6mFm-q-8gIs)\r\n   * [Apply walkthrough](https://www.youtube.com/watch?v=C5u0f-F5Znk)\r\n   * [Destroy walkthrough](https://www.youtube.com/watch?v=HspvLZprDXU)\r\n\r\n","bodyHTML":"<p dir=\"auto\">Given your setup and your prior experience with Terragrunt, we recommend that you start by adopting service catalog modules into your current setup. This will likely end up looking like an incremental migration moving component by component. Here's how we'd recommend approaching this:</p>\n<ol dir=\"auto\">\n<li>Start by looking at <a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/tree/master/examples/for-production\">the for-production examples</a> in the service catalog</li>\n<li>Pick out a service that will be easy to adopt given your current architecture. For example, you could run <a href=\"https://terragrunt.gruntwork.io/docs/reference/cli-options/#graph-dependencies\" rel=\"nofollow\">terragrunt graph-dependencies</a> and pick a component from a leaf-node level to begin with. That is, start with a component that has no downstream dependencies that have not already been migrated.</li>\n<li>Back up your current terraform state for that module using <code class=\"notranslate\">terragrunt state push backup.tfstate</code>. This is important! If for any reason the migration of state objects with <code class=\"notranslate\">terragrunt state mv</code> commands fails, you can then use <code class=\"notranslate\">terragrunt state pull &gt; backup.tfstate</code> to restore your original state and try again.</li>\n<li>Replace the terraform <code class=\"notranslate\">source</code> to point at our service catalog module instead of whatever you're using now.</li>\n<li>Run <code class=\"notranslate\">terragrunt plan</code>. Look at the plan output to see what exactly would change if you were to switch over to using Gruntwork's service catalog modules. Before making any state migrations, try to map destroyed resources to newly created resources. You may be able to match a destroyed resource to a newly created one, and avoid the destroy/create process by using <code class=\"notranslate\">terragrunt state mv</code>.</li>\n<li>Your goal is to get to a point where the <code class=\"notranslate\">terragrunt plan</code> output is clean with no changes to be applied. But in your case, you will very likely end up with changes that <em>must</em> be made, since we have no idea what modules and module versions you're starting from. The migration of resources can also end up being difficult if you have resources stored in different object types than what our service catalog modules expect. This may require you to write some logic that will migrate objects into different types.\n<ul dir=\"auto\">\n<li>Take a look at the <code class=\"notranslate\">_scripts/migration_helpers.sh</code> file in this release: (<a href=\"https://github.com/gruntwork-io/infrastructure-live-multi-account-acme/releases/download/v0.0.1-20210527/refarch-folder-structure.zip\">https://github.com/gruntwork-io/infrastructure-live-multi-account-acme/releases/download/v0.0.1-20210527/refarch-folder-structure.zip</a>). This script contains utilities that perform more complex migrations. Please be aware that we will not support fixes or patches to this frozen artifact. It's offered in this answer only as an example.</li>\n</ul>\n</li>\n</ol>\n<p dir=\"auto\">Following this pattern, you'd ideally be switching out your current sources in your terragrunt configs for our service catalog source URLs, and continue running plan and doing state migrations until the plan comes out clean or almost clean.</p>\n<p dir=\"auto\">Specifically for the Gruntwork Pipelines piece, if you get the Reference Architecture deployed, then everything \"just works\". While we don't believe the exact folder structure should matter much, you may need to tweak some of the configuration once you have pipelines set up in order to accommodate differences in your layout.</p>\n<p dir=\"auto\">The good news in your case is that we do have a <a href=\"https://gruntwork.io/guides/automations/how-to-configure-a-production-grade-ci-cd-setup-for-apps-and-infrastructure-code/#\" rel=\"nofollow\">guide</a> for configuring Gruntwork Pipelines. You'd be looking to deploy the ECS Deploy Runner stack, which has several components. We also have documentation <a href=\"https://github.com/gruntwork-io/terraform-aws-ci/tree/master/modules/ecs-deploy-runner\">for this stack</a>.</p>\n<p dir=\"auto\">Then, regardless of whether you're currently using CircleCI, Jenkins or GitLab, you can see the configurations for these CI tools within the for-production infra-live repo, at <a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/tree/master/examples/for-production/infrastructure-live\">the root of that repo</a>. The relevant files will be the Jenkinsfile, gitlab-ci.yml, and the .circleci folder.</p>\n<p dir=\"auto\">We also have deployment walkthroughs for how to use Pipelines after you've installed it:</p>\n<ul dir=\"auto\">\n<li><a href=\"https://www.youtube.com/watch?v=6mFm-q-8gIs\" rel=\"nofollow\">Two minute overview of Pipelines</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=C5u0f-F5Znk\" rel=\"nofollow\">Apply walkthrough</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=HspvLZprDXU\" rel=\"nofollow\">Destroy walkthrough</a></li>\n</ul>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "e2a6ff8bd62235a7e9f76cd471f6144c"
}
##DOCS-SOURCER-END -->
