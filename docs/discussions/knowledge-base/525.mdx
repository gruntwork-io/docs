---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/525" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Permission Policies in the Reference Architecture</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AQSkE","number":525,"author":{"login":"pete0emerson"},"title":"Permission Policies in the Reference Architecture","body":"\nCan you tell me where the permission policies are applied in the code? I’m trying to see what users have access to the secrets manager.\n\n---\n\n<ins datetime=\"2022-08-01T20:27:35Z\">\n  <p><a href=\"https://support.gruntwork.io/hc/requests/109090\">Tracked in ticket #109090</a></p>\n</ins>\n","bodyHTML":"<p dir=\"auto\">Can you tell me where the permission policies are applied in the code? I’m trying to see what users have access to the secrets manager.</p>\n<hr>\n<ins datetime=\"2022-08-01T20:27:35Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/109090\" rel=\"nofollow\">Tracked in ticket #109090</a></p>\n</ins>","answer":{"body":"In the reference architecture in `security/_global/account-baseline/users.yml` we can see the users and IAM groups that they belong to.\r\n\r\nLooking at `security/_global/account-baseline/terragrunt.hcl`, we can see that it is sourcing the service catalog (roughly lines 13 and 65-66):\r\n\r\n```\r\n  source = \"${local.source_base_url}?ref=v0.82.0\"\r\n  ...\r\n  locals {\r\n    source_base_url = \"git::git@github.com:gruntwork-io/terraform-aws-service-catalog.git//modules/landingzone/account-baseline-security\"\r\n```\r\n\r\nLet's jump over to the service catalog, specifically [modules/landingzone/account-baseline-security/main.tf](https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/modules/landingzone/account-baseline-security/main.tf) (about line 200):\r\n\r\n```\r\nmodule \"iam_groups\" {\r\n  source = \"git::git@github.com:gruntwork-io/terraform-aws-security.git//modules/iam-groups?ref=v0.65.8\"\r\n```\r\n\r\nSo we'll dive down to the module level and take a look at [terraform-aws-security/modules/iam-groups/main.tf](https://github.com/gruntwork-io/terraform-aws-security/blob/master/modules/iam-groups/main.tf):\r\n\r\nThe groups are defined here, for example, the `full_access` group on line 52:\r\n\r\n```\r\n# ----------------------------------------------------------------------------------------------------------------------\r\n# CREATE IAM GROUP - FULL ACCESS\r\n# Full Access users have full access to all AWS Resources.\r\n# ----------------------------------------------------------------------------------------------------------------------\r\n\r\nresource \"aws_iam_group\" \"full_access\" {\r\n  count = var.should_create_iam_group_full_access && var.create_resources ? 1 : 0\r\n  name  = var.iam_group_name_full_access\r\n}\r\n\r\n# Enable administrator users to have access to everything\r\nresource \"aws_iam_group_policy\" \"full_access\" {\r\n  count  = var.should_create_iam_group_full_access && var.create_resources ? 1 : 0\r\n  name   = \"full-access\"\r\n  group  = aws_iam_group.full_access[0].id\r\n  policy = module.iam_policies.full_access\r\n}\r\n\r\n# Full-access users should also be able to manage their own IAM User accounts (without MFA), so attach the \"iam-user-self-mgmt\" IAM Policy.\r\nresource \"aws_iam_group_policy_attachment\" \"full_access_iam_user_self_mgmt\" {\r\n  count      = var.should_create_iam_group_full_access && var.create_resources ? 1 : 0\r\n  group      = aws_iam_group.full_access[0].name\r\n  policy_arn = aws_iam_policy.iam_user_self_mgmt[0].arn\r\n}\r\n```\r\n\r\nThe policies are defined on line 35:\r\n\r\n```\r\nmodule \"iam_policies\" {\r\n  source = \"../iam-policies\"\r\n```\r\n\r\nNote that this is loading another module, [iam-policies](https://github.com/gruntwork-io/terraform-aws-security/blob/master/modules/iam-policies/main.tf). In this module we see the policy documents that then get attached and used, for example:\r\n\r\n```\r\ndata \"aws_iam_policy_document\" \"full_access\" {\r\n  statement {\r\n    sid       = \"fullAccess\"\r\n    actions   = [\"*\"]\r\n    resources = [\"*\"]\r\n    effect    = \"Allow\"\r\n...\r\n```\r\n\r\nNote that there are no references specifically to any `secretsmanager:*` resources, and Secrets Manager is not called out in the `read_only` policy. The `full_access` policy has blanket permissions.\r\n\r\nIf you want to create your own policies, you can do that with the [custom-iam-entity module](https://github.com/gruntwork-io/terraform-aws-security/blob/master/examples/custom-iam-entity/main.tf).\r\n","bodyHTML":"<p dir=\"auto\">In the reference architecture in <code class=\"notranslate\">security/_global/account-baseline/users.yml</code> we can see the users and IAM groups that they belong to.</p>\n<p dir=\"auto\">Looking at <code class=\"notranslate\">security/_global/account-baseline/terragrunt.hcl</code>, we can see that it is sourcing the service catalog (roughly lines 13 and 65-66):</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  source = &quot;${local.source_base_url}?ref=v0.82.0&quot;\n  ...\n  locals {\n    source_base_url = &quot;git::git@github.com:gruntwork-io/terraform-aws-service-catalog.git//modules/landingzone/account-baseline-security&quot;\"><pre class=\"notranslate\"><code class=\"notranslate\">  source = \"${local.source_base_url}?ref=v0.82.0\"\n  ...\n  locals {\n    source_base_url = \"git::git@github.com:gruntwork-io/terraform-aws-service-catalog.git//modules/landingzone/account-baseline-security\"\n</code></pre></div>\n<p dir=\"auto\">Let's jump over to the service catalog, specifically <a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/modules/landingzone/account-baseline-security/main.tf\">modules/landingzone/account-baseline-security/main.tf</a> (about line 200):</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"module &quot;iam_groups&quot; {\n  source = &quot;git::git@github.com:gruntwork-io/terraform-aws-security.git//modules/iam-groups?ref=v0.65.8&quot;\"><pre class=\"notranslate\"><code class=\"notranslate\">module \"iam_groups\" {\n  source = \"git::git@github.com:gruntwork-io/terraform-aws-security.git//modules/iam-groups?ref=v0.65.8\"\n</code></pre></div>\n<p dir=\"auto\">So we'll dive down to the module level and take a look at <a href=\"https://github.com/gruntwork-io/terraform-aws-security/blob/master/modules/iam-groups/main.tf\">terraform-aws-security/modules/iam-groups/main.tf</a>:</p>\n<p dir=\"auto\">The groups are defined here, for example, the <code class=\"notranslate\">full_access</code> group on line 52:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"# ----------------------------------------------------------------------------------------------------------------------\n# CREATE IAM GROUP - FULL ACCESS\n# Full Access users have full access to all AWS Resources.\n# ----------------------------------------------------------------------------------------------------------------------\n\nresource &quot;aws_iam_group&quot; &quot;full_access&quot; {\n  count = var.should_create_iam_group_full_access &amp;&amp; var.create_resources ? 1 : 0\n  name  = var.iam_group_name_full_access\n}\n\n# Enable administrator users to have access to everything\nresource &quot;aws_iam_group_policy&quot; &quot;full_access&quot; {\n  count  = var.should_create_iam_group_full_access &amp;&amp; var.create_resources ? 1 : 0\n  name   = &quot;full-access&quot;\n  group  = aws_iam_group.full_access[0].id\n  policy = module.iam_policies.full_access\n}\n\n# Full-access users should also be able to manage their own IAM User accounts (without MFA), so attach the &quot;iam-user-self-mgmt&quot; IAM Policy.\nresource &quot;aws_iam_group_policy_attachment&quot; &quot;full_access_iam_user_self_mgmt&quot; {\n  count      = var.should_create_iam_group_full_access &amp;&amp; var.create_resources ? 1 : 0\n  group      = aws_iam_group.full_access[0].name\n  policy_arn = aws_iam_policy.iam_user_self_mgmt[0].arn\n}\"><pre class=\"notranslate\"><code class=\"notranslate\"># ----------------------------------------------------------------------------------------------------------------------\n# CREATE IAM GROUP - FULL ACCESS\n# Full Access users have full access to all AWS Resources.\n# ----------------------------------------------------------------------------------------------------------------------\n\nresource \"aws_iam_group\" \"full_access\" {\n  count = var.should_create_iam_group_full_access &amp;&amp; var.create_resources ? 1 : 0\n  name  = var.iam_group_name_full_access\n}\n\n# Enable administrator users to have access to everything\nresource \"aws_iam_group_policy\" \"full_access\" {\n  count  = var.should_create_iam_group_full_access &amp;&amp; var.create_resources ? 1 : 0\n  name   = \"full-access\"\n  group  = aws_iam_group.full_access[0].id\n  policy = module.iam_policies.full_access\n}\n\n# Full-access users should also be able to manage their own IAM User accounts (without MFA), so attach the \"iam-user-self-mgmt\" IAM Policy.\nresource \"aws_iam_group_policy_attachment\" \"full_access_iam_user_self_mgmt\" {\n  count      = var.should_create_iam_group_full_access &amp;&amp; var.create_resources ? 1 : 0\n  group      = aws_iam_group.full_access[0].name\n  policy_arn = aws_iam_policy.iam_user_self_mgmt[0].arn\n}\n</code></pre></div>\n<p dir=\"auto\">The policies are defined on line 35:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"module &quot;iam_policies&quot; {\n  source = &quot;../iam-policies&quot;\"><pre class=\"notranslate\"><code class=\"notranslate\">module \"iam_policies\" {\n  source = \"../iam-policies\"\n</code></pre></div>\n<p dir=\"auto\">Note that this is loading another module, <a href=\"https://github.com/gruntwork-io/terraform-aws-security/blob/master/modules/iam-policies/main.tf\">iam-policies</a>. In this module we see the policy documents that then get attached and used, for example:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"data &quot;aws_iam_policy_document&quot; &quot;full_access&quot; {\n  statement {\n    sid       = &quot;fullAccess&quot;\n    actions   = [&quot;*&quot;]\n    resources = [&quot;*&quot;]\n    effect    = &quot;Allow&quot;\n...\"><pre class=\"notranslate\"><code class=\"notranslate\">data \"aws_iam_policy_document\" \"full_access\" {\n  statement {\n    sid       = \"fullAccess\"\n    actions   = [\"*\"]\n    resources = [\"*\"]\n    effect    = \"Allow\"\n...\n</code></pre></div>\n<p dir=\"auto\">Note that there are no references specifically to any <code class=\"notranslate\">secretsmanager:*</code> resources, and Secrets Manager is not called out in the <code class=\"notranslate\">read_only</code> policy. The <code class=\"notranslate\">full_access</code> policy has blanket permissions.</p>\n<p dir=\"auto\">If you want to create your own policies, you can do that with the <a href=\"https://github.com/gruntwork-io/terraform-aws-security/blob/master/examples/custom-iam-entity/main.tf\">custom-iam-entity module</a>.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "0f3c4c0448143317291d311e30bed5fe"
}
##DOCS-SOURCER-END -->
