---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/238" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Cloudwatch can&apos;t send alarms to SNS topic</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AO6Vk","number":238,"author":{"login":"umm0n"},"title":"Cloudwatch can't send alarms to SNS topic","body":"Hello everyone! We receive the following error in Cloudwatch whenever an alarm triggers:\r\n\r\n` Failed to execute action arn:aws:sns:*****:***********:************-sns-cloudwatch-alarms. Received error: \"CloudWatch Alarms does not have authorization to access the SNS topic encryption key.\" `\r\n\r\nWe're using the SNS topic module as configured by default with the ref arch, which seems to encrypt the SNS topic with the default aws key. Is this not the correct key to use? What are we missing?\r\n\r\n[r:terraform-aws-messaging](https://github.com/gruntwork-io/terraform-aws-messaging)","bodyHTML":"<p dir=\"auto\">Hello everyone! We receive the following error in Cloudwatch whenever an alarm triggers:</p>\n<p dir=\"auto\"><code class=\"notranslate\">Failed to execute action arn:aws:sns:*****:***********:************-sns-cloudwatch-alarms. Received error: \"CloudWatch Alarms does not have authorization to access the SNS topic encryption key.\"</code></p>\n<p dir=\"auto\">We're using the SNS topic module as configured by default with the ref arch, which seems to encrypt the SNS topic with the default aws key. Is this not the correct key to use? What are we missing?</p>\n<p dir=\"auto\"><a href=\"https://github.com/gruntwork-io/terraform-aws-messaging\">r:terraform-aws-messaging</a></p>","answer":{"body":"Hello,\r\n\r\n+ If the **default AWS Key Management Service (KMS) key \"alias/aws/sns\"** is used for SNS topic encryption, then CloudWatch alarms **can't publish messages to the SNS topic**. The key policy of the default AWS KMS key for SNS doesn't allow CloudWatch alarms to perform **_\"kms:Decrypt\"_** and **_\"kms:GenerateDataKey\"_** API calls. Because this key is AWS managed, you can't manually edit the policy.\r\n+ You can use a [customer managed key](https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#customer-cmk) that includes the following permissions under the Statement section of the key policy in order to allow the CloudWatch alarms to publish messages to encrypted SNS topics:\r\n```hcl\r\n{\r\n    \"Sid\": \"Allow_CloudWatch_for_CMK\",\r\n    \"Effect\": \"Allow\",\r\n    \"Principal\": {\r\n        \"Service\":[\r\n            \"cloudwatch.amazonaws.com\"\r\n        ]\r\n    },\r\n    \"Action\": [\r\n        \"kms:Decrypt\",\r\n         \"kms:GenerateDataKey*\"\r\n    ],\r\n    # better use your SNS topic ARN instead of \"*\"\r\n    \"Resource\": \"*\"\r\n}\r\n```\r\n\r\nBest,","bodyHTML":"<p dir=\"auto\">Hello,</p>\n<ul dir=\"auto\">\n<li>If the <strong>default AWS Key Management Service (KMS) key \"alias/aws/sns\"</strong> is used for SNS topic encryption, then CloudWatch alarms <strong>can't publish messages to the SNS topic</strong>. The key policy of the default AWS KMS key for SNS doesn't allow CloudWatch alarms to perform <strong><em>\"kms:Decrypt\"</em></strong> and <strong><em>\"kms:GenerateDataKey\"</em></strong> API calls. Because this key is AWS managed, you can't manually edit the policy.</li>\n<li>You can use a <a href=\"https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#customer-cmk\" rel=\"nofollow\">customer managed key</a> that includes the following permissions under the Statement section of the key policy in order to allow the CloudWatch alarms to publish messages to encrypted SNS topics:</li>\n</ul>\n<div class=\"highlight highlight-source-terraform notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{\n    &quot;Sid&quot;: &quot;Allow_CloudWatch_for_CMK&quot;,\n    &quot;Effect&quot;: &quot;Allow&quot;,\n    &quot;Principal&quot;: {\n        &quot;Service&quot;:[\n            &quot;cloudwatch.amazonaws.com&quot;\n        ]\n    },\n    &quot;Action&quot;: [\n        &quot;kms:Decrypt&quot;,\n         &quot;kms:GenerateDataKey*&quot;\n    ],\n    # better use your SNS topic ARN instead of &quot;*&quot;\n    &quot;Resource&quot;: &quot;*&quot;\n}\"><pre>{\n    <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Sid<span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">:</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Allow_CloudWatch_for_CMK<span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Effect<span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">:</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Allow<span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Principal<span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">:</span> {\n        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Service<span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">:</span>[\n            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>cloudwatch.amazonaws.com<span class=\"pl-pds\">\"</span></span>\n        ]\n    },\n    <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Action<span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">:</span> [\n        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>kms:Decrypt<span class=\"pl-pds\">\"</span></span>,\n         <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>kms:GenerateDataKey*<span class=\"pl-pds\">\"</span></span>\n    ],\n    <span class=\"pl-c\"><span class=\"pl-c\">#</span> better use your SNS topic ARN instead of \"*\"</span>\n    <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Resource<span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">:</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>*<span class=\"pl-pds\">\"</span></span>\n}</pre></div>\n<p dir=\"auto\">Best,</p>"}}} />

</CenterLayout>
  

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "c4fdca899514567c749e87ab6caf7bcc"
}
##DOCS-SOURCER-END -->
