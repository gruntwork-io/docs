---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/722" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Issue removing default Rbac roles created by namespace-role module.</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AUDfe","number":722,"author":{"login":"snanjundappa-3as"},"title":"Issue removing default Rbac roles created by namespace-role module.","body":"\r\nHello Team, \r\n\r\n [namespace module](https://github.com/gruntwork-io/terraform-kubernetes-namespace/blob/main/modules/namespace-roles/main.tf#L36) \r\n [parent module](https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/dev/us-west-2/dev/services/eks-applications-namespace/terragrunt.hcl#L9)\r\n\r\nWe are following your example infrastructure-live implementation for our aws services/resource creation linked [here](https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/dev/us-west-2/dev/services/eks-applications-namespace/terragrunt.hcl#L9). I would like to have remove default RBAC roles which has create permission in namespace module.\r\n\r\nI would like to define an input `create_resource = false`  in parent module. However available variables [link](https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/modules/services/k8s-namespace/variables.tf) does not allow me to define this. \r\nCould you please provide me a solution to define this or an workaround to remove default RBAC Roles linked [here](https://github.com/gruntwork-io/terraform-kubernetes-namespace/blob/main/modules/namespace-roles/main.tf#L36).\r\n\r\nExample creation of Default RBAC Roles in k8s Namespace\r\n\r\n ```\r\nCREATE THE DEFAULT RBAC ROLES\r\n This defines four default RBAC roles scoped to the namespace:\r\n - namespace-access-all : Admin level permissions on all resources in the namespace.\r\n - namespace-access-read-only: Read only permissions on all resources in the namespace.\r\n - namespace-helm-metadata-access: Minimal permissions for Helm to manage its metadata in this namespace.\r\n - namespace-helm-resource-access: Minimal permissions for Helm to manage resources in this namespace as Helm charts.\r\n\r\n```\r\n \r\n\r\n\r\n\r\n---\r\n\r\n<ins datetime=\"2023-06-02T07:33:08Z\">\r\n  <p><a href=\"https://support.gruntwork.io/hc/requests/110216\">Tracked in ticket #110216</a></p>\r\n</ins>\r\n","bodyHTML":"<p dir=\"auto\">Hello Team,</p>\n<p dir=\"auto\"><a href=\"https://github.com/gruntwork-io/terraform-kubernetes-namespace/blob/main/modules/namespace-roles/main.tf#L36\">namespace module</a><br>\n<a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/dev/us-west-2/dev/services/eks-applications-namespace/terragrunt.hcl#L9\">parent module</a></p>\n<p dir=\"auto\">We are following your example infrastructure-live implementation for our aws services/resource creation linked <a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/dev/us-west-2/dev/services/eks-applications-namespace/terragrunt.hcl#L9\">here</a>. I would like to have remove default RBAC roles which has create permission in namespace module.</p>\n<p dir=\"auto\">I would like to define an input <code class=\"notranslate\">create_resource = false</code>  in parent module. However available variables <a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/modules/services/k8s-namespace/variables.tf\">link</a> does not allow me to define this.<br>\nCould you please provide me a solution to define this or an workaround to remove default RBAC Roles linked <a href=\"https://github.com/gruntwork-io/terraform-kubernetes-namespace/blob/main/modules/namespace-roles/main.tf#L36\">here</a>.</p>\n<p dir=\"auto\">Example creation of Default RBAC Roles in k8s Namespace</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"CREATE THE DEFAULT RBAC ROLES\nThis defines four default RBAC roles scoped to the namespace:\n- namespace-access-all : Admin level permissions on all resources in the namespace.\n- namespace-access-read-only: Read only permissions on all resources in the namespace.\n- namespace-helm-metadata-access: Minimal permissions for Helm to manage its metadata in this namespace.\n- namespace-helm-resource-access: Minimal permissions for Helm to manage resources in this namespace as Helm charts.\n\"><pre class=\"notranslate\"><code class=\"notranslate\">CREATE THE DEFAULT RBAC ROLES\nThis defines four default RBAC roles scoped to the namespace:\n- namespace-access-all : Admin level permissions on all resources in the namespace.\n- namespace-access-read-only: Read only permissions on all resources in the namespace.\n- namespace-helm-metadata-access: Minimal permissions for Helm to manage its metadata in this namespace.\n- namespace-helm-resource-access: Minimal permissions for Helm to manage resources in this namespace as Helm charts.\n\n</code></pre></div>\n<hr>\n<ins datetime=\"2023-06-02T07:33:08Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/110216\" rel=\"nofollow\">Tracked in ticket #110216</a></p>\n</ins>","answer":{"body":"You are correct that `create_resources` is not threaded all the way through to the service catalog. However, doing so may not have the intended effect that you want. To recap:\r\n\r\nhttps://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/dev/us-west-2/dev/services/eks-applications-namespace/terragrunt.hcl#L10\r\n\r\nincludes:\r\n\r\nhttps://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/_envcommon/services/eks-applications-namespace.hcl#L16\r\n\r\nwhich references the k8s-namespace service:\r\n\r\nhttps://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/modules/services/k8s-namespace/main.tf#L29\r\n\r\nwhich not only creates the RBAC roles, but the namespace itself in:\r\n\r\nhttps://github.com/gruntwork-io/terraform-kubernetes-namespace/blob/main/modules/namespace/main.tf#L41-L66\r\n\r\nPropagating `create_resources` up into the service catalog and then setting it to `false` would then not create the namespace at all, which may not be desirable.\r\n\r\nMy recommendation is to either remove the `k8s-namespace` from `_envcommon` ([here](https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/_envcommon/services/eks-applications-namespace.hcl#L16)), or remove it and replace it with the resources that you need. In other words, you might bring the `kubernetes_namespace` resource out of the terraform-kubernetes-namespace module and pull that directly into `_envcommon`, if that's the only thing you need.\r\n\r\nOn our end, I've filed a ticket in https://github.com/gruntwork-io/terraform-kubernetes-namespace/issues/28 for us to consider separate control of the namespace and the namespace roles.","bodyHTML":"<p dir=\"auto\">You are correct that <code class=\"notranslate\">create_resources</code> is not threaded all the way through to the service catalog. However, doing so may not have the intended effect that you want. To recap:</p>\n<p dir=\"auto\"><a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/dev/us-west-2/dev/services/eks-applications-namespace/terragrunt.hcl#L10\">https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/dev/us-west-2/dev/services/eks-applications-namespace/terragrunt.hcl#L10</a></p>\n<p dir=\"auto\">includes:</p>\n<p dir=\"auto\"><a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/_envcommon/services/eks-applications-namespace.hcl#L16\">https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/_envcommon/services/eks-applications-namespace.hcl#L16</a></p>\n<p dir=\"auto\">which references the k8s-namespace service:</p>\n<p dir=\"auto\"><a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/modules/services/k8s-namespace/main.tf#L29\">https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/modules/services/k8s-namespace/main.tf#L29</a></p>\n<p dir=\"auto\">which not only creates the RBAC roles, but the namespace itself in:</p>\n<p dir=\"auto\"><a href=\"https://github.com/gruntwork-io/terraform-kubernetes-namespace/blob/main/modules/namespace/main.tf#L41-L66\">https://github.com/gruntwork-io/terraform-kubernetes-namespace/blob/main/modules/namespace/main.tf#L41-L66</a></p>\n<p dir=\"auto\">Propagating <code class=\"notranslate\">create_resources</code> up into the service catalog and then setting it to <code class=\"notranslate\">false</code> would then not create the namespace at all, which may not be desirable.</p>\n<p dir=\"auto\">My recommendation is to either remove the <code class=\"notranslate\">k8s-namespace</code> from <code class=\"notranslate\">_envcommon</code> (<a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/_envcommon/services/eks-applications-namespace.hcl#L16\">here</a>), or remove it and replace it with the resources that you need. In other words, you might bring the <code class=\"notranslate\">kubernetes_namespace</code> resource out of the terraform-kubernetes-namespace module and pull that directly into <code class=\"notranslate\">_envcommon</code>, if that's the only thing you need.</p>\n<p dir=\"auto\">On our end, I've filed a ticket in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1741826617\" data-permission-text=\"Title is private\" data-url=\"https://github.com/gruntwork-io/terraform-kubernetes-namespace/issues/28\" data-hovercard-type=\"issue\" data-hovercard-url=\"/gruntwork-io/terraform-kubernetes-namespace/issues/28/hovercard\" href=\"https://github.com/gruntwork-io/terraform-kubernetes-namespace/issues/28\">gruntwork-io/terraform-kubernetes-namespace#28</a> for us to consider separate control of the namespace and the namespace roles.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "84e39b3951b98ebab30a0d81c1b796ef"
}
##DOCS-SOURCER-END -->
