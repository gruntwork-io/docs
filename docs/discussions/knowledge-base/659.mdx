---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/659" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Provisioned Lambda timeout on Loading Secret Manager</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84ASbLX","number":659,"author":{"login":"andi-pangeran"},"title":"Provisioned Lambda timeout on Loading Secret Manager","body":"\r\nNeed help to make lambda able to read secrets.\r\n\r\nGet this error when provisioning lambda from docker \r\n\r\nLog:\r\n```\r\n[run-lambda-entrypoint] time=\"2023-02-07T02:24:55Z\" level=debug msg=\"Loading Secret Manager entry arn:aws:secretsmanager:ap-southeast-3:*****:secret:***-MpQE8U as environment variables.\"\r\n[run-lambda-entrypoint] time=\"2023-02-07T02:25:06Z\" level=debug msg=\"Loading Secret Manager entry arn:aws:secretsmanager:ap-southeast-3:*****:secret:***-MpQE8U as environment variables.\"\r\nSTART RequestId: 90f7d618-8fdf-4d96-b8c8-b31cd8a4e348 Version: $LATEST\r\n2023-02-07T02:25:36.085Z 90f7d618-8fdf-4d96-b8c8-b31cd8a4e348 Task timed out after 30.03 seconds\r\n```\r\n\r\n```\r\n[run-lambda-entrypoint] time=\"2023-02-07T03:02:21Z\" level=error msg=\"FAIL Loading Secret Manager entry arn:aws:secretsmanager:ap-southeast-3:***:secret:***-MpQE8U fail operation error Secrets Manager: GetSecretValue, exceeded maximum number of attempts, 3, https response error StatusCode: 0, RequestID: , request send failed, Post \\\"https://secretsmanager.ap-southeast-3.amazonaws.com/\\\": dial tcp 108.136.159.12:443: i/o timeout.\"\r\n```\r\n\r\nmy configuration: \r\n```\r\n  name      = \"edo-daily-installments-cron\"\r\n  image_uri = local.image\r\n\r\n  run_in_vpc = true\r\n  vpc_id     = dependency.vpc.outputs.vpc_id\r\n  subnet_ids = dependency.vpc.outputs.private_app_subnet_ids\r\n\r\n  environment_variables = merge(\r\n    include.envcommon.locals.environment_variables,\r\n    {\r\n      IMAGE_URI                       = local.image,\r\n      SECRETS_MANAGER_ARN             = local.edo_cron_workers_secrets_manager_arn,\r\n    }\r\n  )\r\n\r\n  iam_policy = {\r\n    SecretsAccess = {\r\n      actions = [\r\n        \"secretsmanager:GetSecretValue\",\r\n        \"secretsmanager:DescribeSecret\",\r\n        \"secretsmanager:ListSecretVersionIds\",\r\n        \"secretsmanager:PutSecretValue\",\r\n        \"secretsmanager:UpdateSecret\",\r\n        \"secretsmanager:TagResource\",\r\n        \"secretsmanager:UntagResource\"\r\n      ],\r\n      resources = [\"${local.edo_cron_workers_secrets_manager_arn}\"]\r\n      effect    = \"Allow\"\r\n    }\r\n  }\r\n\r\n  cloudwatch_log_group_retention_in_days = 14\r\n  ```\r\n  \r\n  seems like related to https://aws.amazon.com/blogs/security/how-to-connect-to-aws-secrets-manager-service-within-a-virtual-private-cloud/\r\n  \r\n  Thank you\r\n  \r\n\r\n---\r\n\r\n<ins datetime=\"2023-02-07T02:34:19Z\">\r\n  <p><a href=\"https://support.gruntwork.io/hc/requests/109873\">Tracked in ticket #109873</a></p>\r\n</ins>\r\n","bodyHTML":"<p dir=\"auto\">Need help to make lambda able to read secrets.</p>\n<p dir=\"auto\">Get this error when provisioning lambda from docker</p>\n<p dir=\"auto\">Log:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"[run-lambda-entrypoint] time=&quot;2023-02-07T02:24:55Z&quot; level=debug msg=&quot;Loading Secret Manager entry arn:aws:secretsmanager:ap-southeast-3:*****:secret:***-MpQE8U as environment variables.&quot;\n[run-lambda-entrypoint] time=&quot;2023-02-07T02:25:06Z&quot; level=debug msg=&quot;Loading Secret Manager entry arn:aws:secretsmanager:ap-southeast-3:*****:secret:***-MpQE8U as environment variables.&quot;\nSTART RequestId: 90f7d618-8fdf-4d96-b8c8-b31cd8a4e348 Version: $LATEST\n2023-02-07T02:25:36.085Z 90f7d618-8fdf-4d96-b8c8-b31cd8a4e348 Task timed out after 30.03 seconds\"><pre class=\"notranslate\"><code class=\"notranslate\">[run-lambda-entrypoint] time=\"2023-02-07T02:24:55Z\" level=debug msg=\"Loading Secret Manager entry arn:aws:secretsmanager:ap-southeast-3:*****:secret:***-MpQE8U as environment variables.\"\n[run-lambda-entrypoint] time=\"2023-02-07T02:25:06Z\" level=debug msg=\"Loading Secret Manager entry arn:aws:secretsmanager:ap-southeast-3:*****:secret:***-MpQE8U as environment variables.\"\nSTART RequestId: 90f7d618-8fdf-4d96-b8c8-b31cd8a4e348 Version: $LATEST\n2023-02-07T02:25:36.085Z 90f7d618-8fdf-4d96-b8c8-b31cd8a4e348 Task timed out after 30.03 seconds\n</code></pre></div>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"[run-lambda-entrypoint] time=&quot;2023-02-07T03:02:21Z&quot; level=error msg=&quot;FAIL Loading Secret Manager entry arn:aws:secretsmanager:ap-southeast-3:***:secret:***-MpQE8U fail operation error Secrets Manager: GetSecretValue, exceeded maximum number of attempts, 3, https response error StatusCode: 0, RequestID: , request send failed, Post \\&quot;https://secretsmanager.ap-southeast-3.amazonaws.com/\\&quot;: dial tcp 108.136.159.12:443: i/o timeout.&quot;\"><pre class=\"notranslate\"><code class=\"notranslate\">[run-lambda-entrypoint] time=\"2023-02-07T03:02:21Z\" level=error msg=\"FAIL Loading Secret Manager entry arn:aws:secretsmanager:ap-southeast-3:***:secret:***-MpQE8U fail operation error Secrets Manager: GetSecretValue, exceeded maximum number of attempts, 3, https response error StatusCode: 0, RequestID: , request send failed, Post \\\"https://secretsmanager.ap-southeast-3.amazonaws.com/\\\": dial tcp 108.136.159.12:443: i/o timeout.\"\n</code></pre></div>\n<p dir=\"auto\">my configuration:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  name      = &quot;edo-daily-installments-cron&quot;\n  image_uri = local.image\n\n  run_in_vpc = true\n  vpc_id     = dependency.vpc.outputs.vpc_id\n  subnet_ids = dependency.vpc.outputs.private_app_subnet_ids\n\n  environment_variables = merge(\n    include.envcommon.locals.environment_variables,\n    {\n      IMAGE_URI                       = local.image,\n      SECRETS_MANAGER_ARN             = local.edo_cron_workers_secrets_manager_arn,\n    }\n  )\n\n  iam_policy = {\n    SecretsAccess = {\n      actions = [\n        &quot;secretsmanager:GetSecretValue&quot;,\n        &quot;secretsmanager:DescribeSecret&quot;,\n        &quot;secretsmanager:ListSecretVersionIds&quot;,\n        &quot;secretsmanager:PutSecretValue&quot;,\n        &quot;secretsmanager:UpdateSecret&quot;,\n        &quot;secretsmanager:TagResource&quot;,\n        &quot;secretsmanager:UntagResource&quot;\n      ],\n      resources = [&quot;${local.edo_cron_workers_secrets_manager_arn}&quot;]\n      effect    = &quot;Allow&quot;\n    }\n  }\n\n  cloudwatch_log_group_retention_in_days = 14\"><pre class=\"notranslate\"><code class=\"notranslate\">  name      = \"edo-daily-installments-cron\"\n  image_uri = local.image\n\n  run_in_vpc = true\n  vpc_id     = dependency.vpc.outputs.vpc_id\n  subnet_ids = dependency.vpc.outputs.private_app_subnet_ids\n\n  environment_variables = merge(\n    include.envcommon.locals.environment_variables,\n    {\n      IMAGE_URI                       = local.image,\n      SECRETS_MANAGER_ARN             = local.edo_cron_workers_secrets_manager_arn,\n    }\n  )\n\n  iam_policy = {\n    SecretsAccess = {\n      actions = [\n        \"secretsmanager:GetSecretValue\",\n        \"secretsmanager:DescribeSecret\",\n        \"secretsmanager:ListSecretVersionIds\",\n        \"secretsmanager:PutSecretValue\",\n        \"secretsmanager:UpdateSecret\",\n        \"secretsmanager:TagResource\",\n        \"secretsmanager:UntagResource\"\n      ],\n      resources = [\"${local.edo_cron_workers_secrets_manager_arn}\"]\n      effect    = \"Allow\"\n    }\n  }\n\n  cloudwatch_log_group_retention_in_days = 14\n</code></pre></div>\n<p dir=\"auto\">seems like related to <a href=\"https://aws.amazon.com/blogs/security/how-to-connect-to-aws-secrets-manager-service-within-a-virtual-private-cloud/\" rel=\"nofollow\">https://aws.amazon.com/blogs/security/how-to-connect-to-aws-secrets-manager-service-within-a-virtual-private-cloud/</a></p>\n<p dir=\"auto\">Thank you</p>\n<hr>\n<ins datetime=\"2023-02-07T02:34:19Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/109873\" rel=\"nofollow\">Tracked in ticket #109873</a></p>\n</ins>","answer":{"body":"Solved:\r\n\r\nsteps:\r\n1. create VPC endpoint \r\n```\r\nterraform {\r\n  source = \"git::git@github.com:gruntwork-io/terraform-aws-vpc.git//modules/vpc-interface-endpoint?ref=v0.22.4\"\r\n}\r\n\r\ninputs = {\r\n  vpc_id             = dependency.vpc.outputs.vpc_id\r\n  subnet_ids         = dependency.vpc.outputs.private_app_subnet_ids\r\n\r\n  create_https_security_group = true\r\n  enable_secretsmanager_endpoint = true\r\n}\r\n```\r\n\r\n2. make sure enable \"should_create_outbound_rule\" on lambda provisioning\r\n```\r\n  run_in_vpc = true\r\n  vpc_id     = dependency.vpc.outputs.vpc_id\r\n  subnet_ids = dependency.vpc.outputs.private_app_subnet_ids\r\n  should_create_outbound_rule = true\r\n ```","bodyHTML":"<p dir=\"auto\">Solved:</p>\n<p dir=\"auto\">steps:</p>\n<ol dir=\"auto\">\n<li>create VPC endpoint</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"terraform {\n  source = &quot;git::git@github.com:gruntwork-io/terraform-aws-vpc.git//modules/vpc-interface-endpoint?ref=v0.22.4&quot;\n}\n\ninputs = {\n  vpc_id             = dependency.vpc.outputs.vpc_id\n  subnet_ids         = dependency.vpc.outputs.private_app_subnet_ids\n\n  create_https_security_group = true\n  enable_secretsmanager_endpoint = true\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">terraform {\n  source = \"git::git@github.com:gruntwork-io/terraform-aws-vpc.git//modules/vpc-interface-endpoint?ref=v0.22.4\"\n}\n\ninputs = {\n  vpc_id             = dependency.vpc.outputs.vpc_id\n  subnet_ids         = dependency.vpc.outputs.private_app_subnet_ids\n\n  create_https_security_group = true\n  enable_secretsmanager_endpoint = true\n}\n</code></pre></div>\n<ol start=\"2\" dir=\"auto\">\n<li>make sure enable \"should_create_outbound_rule\" on lambda provisioning</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  run_in_vpc = true\n  vpc_id     = dependency.vpc.outputs.vpc_id\n  subnet_ids = dependency.vpc.outputs.private_app_subnet_ids\n  should_create_outbound_rule = true\"><pre class=\"notranslate\"><code class=\"notranslate\">  run_in_vpc = true\n  vpc_id     = dependency.vpc.outputs.vpc_id\n  subnet_ids = dependency.vpc.outputs.private_app_subnet_ids\n  should_create_outbound_rule = true\n</code></pre></div>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "1e973adffdf2a2d1ecfad800dbca038d"
}
##DOCS-SOURCER-END -->
