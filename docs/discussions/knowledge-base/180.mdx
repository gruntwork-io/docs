---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/180" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>ECS Deploy Runner permissions errors for new modules</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AOv8K","number":180,"author":{"login":"rhoboat"},"title":"ECS Deploy Runner permissions errors for new modules","body":"Hello! We are attempting to deploy SES on our ref arq, but we get the following error:\r\n\r\n```\r\n[ecs-deploy-runner][2022-02-09T14:12:57+0000] │ Error: Error requesting SES email identity verification: \r\nAccessDenied: User: arn:aws:sts::**********:assumed-role/ecs-deploy-runner-terraform-applier/***************** \r\nis not authorized to perform: ses:VerifyEmailIdentity because no identity-based policy allows the \r\nses:VerifyEmailIdentity action\r\n```\r\n\r\nWe assumed that the deploy runner had broad permissions (first time we get this error), but evidently this is not allowed to do. What would be the correct way of adding these permissions?\r\n\r\nAdding to this, we’re getting similar errors when trying to deploy API Gateway:\r\n\r\n```\r\nError: Error creating API Gateway: AccessDeniedException: \r\n[ecs-deploy-runner][2022-02-09T16:04:27+0000] │ \tstatus code: 403, \r\n```","bodyHTML":"<p dir=\"auto\">Hello! We are attempting to deploy SES on our ref arq, but we get the following error:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"[ecs-deploy-runner][2022-02-09T14:12:57+0000] │ Error: Error requesting SES email identity verification: \nAccessDenied: User: arn:aws:sts::**********:assumed-role/ecs-deploy-runner-terraform-applier/***************** \nis not authorized to perform: ses:VerifyEmailIdentity because no identity-based policy allows the \nses:VerifyEmailIdentity action\"><pre class=\"notranslate\"><code class=\"notranslate\">[ecs-deploy-runner][2022-02-09T14:12:57+0000] │ Error: Error requesting SES email identity verification: \nAccessDenied: User: arn:aws:sts::**********:assumed-role/ecs-deploy-runner-terraform-applier/***************** \nis not authorized to perform: ses:VerifyEmailIdentity because no identity-based policy allows the \nses:VerifyEmailIdentity action\n</code></pre></div>\n<p dir=\"auto\">We assumed that the deploy runner had broad permissions (first time we get this error), but evidently this is not allowed to do. What would be the correct way of adding these permissions?</p>\n<p dir=\"auto\">Adding to this, we’re getting similar errors when trying to deploy API Gateway:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Error: Error creating API Gateway: AccessDeniedException: \n[ecs-deploy-runner][2022-02-09T16:04:27+0000] │ \tstatus code: 403, \"><pre class=\"notranslate\"><code class=\"notranslate\">Error: Error creating API Gateway: AccessDeniedException: \n[ecs-deploy-runner][2022-02-09T16:04:27+0000] │ \tstatus code: 403, \n</code></pre></div>","answer":{"body":"As of now, SES and API Gateway are not part of the original Reference Architecture that Gruntwork deploys, so you must have created modules to hook into your existing Ref Arch. The ECS Deploy Runner can be fitted to handle these new services but doesn't come with those permissions. One of the big features of the ECS Deploy Runner is [guarding against security threats](https://gruntwork.io/guides/automations/how-to-configure-a-production-grade-ci-cd-setup-for-apps-and-infrastructure-code/#threat_model_of_cicd), and therefore we don't recommend deploying it with wider permissions than necessary. \r\n\r\nHere, you'll have to add permissions specific to SES and APIGateway to the `deploy` and `read only` permissions of the ecs-deploy-runner. In the latest revision of the Ref Arch, you can do this by modifying these files: [read_only_permissions.yml](https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/_envcommon/mgmt/read_only_permissions.yml) and [deploy_permissions.yml](https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/_envcommon/mgmt/deploy_permissions.yml). In older versions of the Reference Architecture you would modify the `ecs-deploy-runner/terragrunt.hcl` files directly, looking for where the `iam_policy` is defined.","bodyHTML":"<p dir=\"auto\">As of now, SES and API Gateway are not part of the original Reference Architecture that Gruntwork deploys, so you must have created modules to hook into your existing Ref Arch. The ECS Deploy Runner can be fitted to handle these new services but doesn't come with those permissions. One of the big features of the ECS Deploy Runner is <a href=\"https://gruntwork.io/guides/automations/how-to-configure-a-production-grade-ci-cd-setup-for-apps-and-infrastructure-code/#threat_model_of_cicd\" rel=\"nofollow\">guarding against security threats</a>, and therefore we don't recommend deploying it with wider permissions than necessary.</p>\n<p dir=\"auto\">Here, you'll have to add permissions specific to SES and APIGateway to the <code class=\"notranslate\">deploy</code> and <code class=\"notranslate\">read only</code> permissions of the ecs-deploy-runner. In the latest revision of the Ref Arch, you can do this by modifying these files: <a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/_envcommon/mgmt/read_only_permissions.yml\">read_only_permissions.yml</a> and <a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/_envcommon/mgmt/deploy_permissions.yml\">deploy_permissions.yml</a>. In older versions of the Reference Architecture you would modify the <code class=\"notranslate\">ecs-deploy-runner/terragrunt.hcl</code> files directly, looking for where the <code class=\"notranslate\">iam_policy</code> is defined.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "c19f0b1efac5564bb76c5a3aec852e79"
}
##DOCS-SOURCER-END -->
