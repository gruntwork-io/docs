---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/442" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Advice around pre-seeding plugin cache</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84APr18","number":442,"author":{"login":"jmreicha"},"title":"Advice around pre-seeding plugin cache","body":"\nAttempting to leverage Terraform plugin caching in our Terragrunt environment and running into race conditions with concurrency.\r\n\r\nI saw a few workarounds in https://github.com/gruntwork-io/terragrunt/issues/1212 but was wondering if there are other ways around the problem as that issue is nearly a year old and I’m not sure if there have been any new features that could help.\r\n\r\nI’m thinking maybe an error_hook and/or some kind of retry but could use some other ideas.\n\n---\n\n<ins datetime=\"2022-06-01T02:34:02Z\">\n  <p><a href=\"https://support.gruntwork.io/hc/requests/108687\">Tracked in ticket #108687</a></p>\n</ins>\n","bodyHTML":"<p dir=\"auto\">Attempting to leverage Terraform plugin caching in our Terragrunt environment and running into race conditions with concurrency.</p>\n<p dir=\"auto\">I saw a few workarounds in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"631930933\" data-permission-text=\"Title is private\" data-url=\"https://github.com/gruntwork-io/terragrunt/issues/1212\" data-hovercard-type=\"issue\" data-hovercard-url=\"/gruntwork-io/terragrunt/issues/1212/hovercard\" href=\"https://github.com/gruntwork-io/terragrunt/issues/1212\">gruntwork-io/terragrunt#1212</a> but was wondering if there are other ways around the problem as that issue is nearly a year old and I’m not sure if there have been any new features that could help.</p>\n<p dir=\"auto\">I’m thinking maybe an error_hook and/or some kind of retry but could use some other ideas.</p>\n<hr>\n<ins datetime=\"2022-06-01T02:34:02Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/108687\" rel=\"nofollow\">Tracked in ticket #108687</a></p>\n</ins>","answer":{"body":"If anyone else runs across this we were able to get the configuration working in newer Terragrunt versions (v0.36.12+).\r\n\r\n```\r\nterraform {\r\n    extra_arguments \"cache\" {\r\n      commands = [\r\n        \"init\",\r\n        \"apply\",\r\n        \"refresh\",\r\n        \"import\",\r\n        \"plan\",\r\n        \"taint\",\r\n        \"untaint\",\r\n        \"show\"\r\n      ]\r\n      env_vars = {\r\n        TF_PLUGIN_CACHE_DIR = \"/tmp/plugins\"\r\n      }\r\n    }\r\n\r\n    error_hook \"mirror_providers\" {\r\n      commands = [\"init\", \"plan\"]\r\n      execute  = [\"terragrunt\", \"providers\", \"mirror\", \"/tmp/plugins\"]\r\n      on_errors = [\r\n        \"Required plugins are not installed\",\r\n      ]\r\n    }\r\n  }\r\n\r\n  retryable_errors = [\r\n    \"Required plugins are not installed\",\r\n  ]\r\n\r\n  retry_max_attempts = 3\r\n  retry_sleep_interval_sec = 10\r\n  ...\r\n}\r\n```","bodyHTML":"<p dir=\"auto\">If anyone else runs across this we were able to get the configuration working in newer Terragrunt versions (v0.36.12+).</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"terraform {\n    extra_arguments &quot;cache&quot; {\n      commands = [\n        &quot;init&quot;,\n        &quot;apply&quot;,\n        &quot;refresh&quot;,\n        &quot;import&quot;,\n        &quot;plan&quot;,\n        &quot;taint&quot;,\n        &quot;untaint&quot;,\n        &quot;show&quot;\n      ]\n      env_vars = {\n        TF_PLUGIN_CACHE_DIR = &quot;/tmp/plugins&quot;\n      }\n    }\n\n    error_hook &quot;mirror_providers&quot; {\n      commands = [&quot;init&quot;, &quot;plan&quot;]\n      execute  = [&quot;terragrunt&quot;, &quot;providers&quot;, &quot;mirror&quot;, &quot;/tmp/plugins&quot;]\n      on_errors = [\n        &quot;Required plugins are not installed&quot;,\n      ]\n    }\n  }\n\n  retryable_errors = [\n    &quot;Required plugins are not installed&quot;,\n  ]\n\n  retry_max_attempts = 3\n  retry_sleep_interval_sec = 10\n  ...\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">terraform {\n    extra_arguments \"cache\" {\n      commands = [\n        \"init\",\n        \"apply\",\n        \"refresh\",\n        \"import\",\n        \"plan\",\n        \"taint\",\n        \"untaint\",\n        \"show\"\n      ]\n      env_vars = {\n        TF_PLUGIN_CACHE_DIR = \"/tmp/plugins\"\n      }\n    }\n\n    error_hook \"mirror_providers\" {\n      commands = [\"init\", \"plan\"]\n      execute  = [\"terragrunt\", \"providers\", \"mirror\", \"/tmp/plugins\"]\n      on_errors = [\n        \"Required plugins are not installed\",\n      ]\n    }\n  }\n\n  retryable_errors = [\n    \"Required plugins are not installed\",\n  ]\n\n  retry_max_attempts = 3\n  retry_sleep_interval_sec = 10\n  ...\n}\n</code></pre></div>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "d460e3f6387939cd60f1355149ff62a0"
}
##DOCS-SOURCER-END -->
