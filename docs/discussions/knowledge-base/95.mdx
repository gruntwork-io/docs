---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/95" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>How do I upgrade to Terraform 12 incrementally?</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AOP-_","number":95,"author":{"login":"yorinasub17"},"title":"How do I upgrade to Terraform 12 incrementally?","body":"I am on a legacy project that uses Gruntwork with an old version of Terraform and Terragrunt (0.11.x and 0.18.x). I would like to upgrade to the latest version, but I have too much infrastructure to do it all at once. Is there a way I can incrementally update my projects?","bodyHTML":"<p dir=\"auto\">I am on a legacy project that uses Gruntwork with an old version of Terraform and Terragrunt (0.11.x and 0.18.x). I would like to upgrade to the latest version, but I have too much infrastructure to do it all at once. Is there a way I can incrementally update my projects?</p>","answer":{"body":"There is a process we have identified for a partial migration that has worked well with a few of our customers. It involves upgrading to terragrunt 19+ first, and then taking on the terraform 12 upgrade. The reason for doing this is that the newer terragrunt features allow you to better manage cross module dependencies that are not bound by the terraform version (`terraform_remote_state` has limitations where you can't read state that is written by a different terraform version).\r\n\r\nHere is the rough process:\r\n\r\n**Incrementally upgrade to using terragrunt 0.19+**\r\n\r\nTerragrunt 0.19 has a bunch of features that support mixed terraform versions, so your first step is to upgrade to the latest terragrunt to take advantage of those features. Here is a process for how to do this incrementally in your repo:\r\n\r\n- Prerequisite: Install `tgswitch` and `tfswitch`. These tools have a bunch of nice features that make it easy to manage mixed version repos. See our blog post [How to manage multiple versions of terragrunt and terraform as a team](https://blog.gruntwork.io/how-to-manage-multiple-versions-of-terragrunt-and-terraform-as-a-team-in-your-iac-project-da5b59209f2d) for more info.\r\n\r\n- Prerequisite: Install terragrunt 0.18 and 0.23 using `tgswitch`\r\n    - tgenv 0.18.7\r\n    - tgenv 0.23.31\r\n\r\n- Prerequisite: Install terraform 0.11 and 0.12 using `tfswitch`\r\n    - tfenv 0.11.15\r\n    - tfenv 0.12.31\r\n\r\n- Prerequisite: Add .tgswitchrc​ and .tfswitchrc files at root of repo, pointing to `0.18.7` and `0.11.15` respectively. This ensures that the default version used for your modules will be tf11/tg18.\r\n\r\nOnce the prerequisites are done, you are ready to incrementally switch to tg19+:\r\n\r\n- Make a copy of your root `terraform.tfvars` file, and convert it to `terragrunt.hcl`.\r\n\r\n- Update any `tfvars` in your directory structure (e.g. `region.tfvars`) to use yaml files. Replace the relevant `extra_arguments` subblocks in the root `terragrunt.hcl` with the yaml pattern as described in [our upgrade guide](https://github.com/gruntwork-io/docs/blob/legacy/content/guides/upgrading-to-tf12-tg19/index.md).\r\n\r\n- For each module:\r\n    1. Replace `terraform.tfvars` with `terragrunt.hcl` file.\r\n    1. Add `terraform_version_constraint = \">= 0.11\"​` to `terragrunt.hcl`.\r\n    1. Add `.tgswitchrc`​ in the upgraded module to point to 0.23.31.\r\n    1. Verify `terragrunt plan` works and no changes are reported\r\n    1. Open PR and merge to trunk.\r\n\r\n- Once all modules are upgraded to terragrunt 0.23, replace the root `.tgswitchrc` file to point to `0.23.31`.\r\n\r\n**Switch to using dependency blocks**\r\n\r\nTerragrunt 0.19 introduced a new feature for passing outputs across modules that doesn't depend on the terraform version and remote state: [dependency blocks](https://terragrunt.gruntwork.io/docs/features/execute-terraform-commands-on-multiple-modules-at-once/#passing-outputs-between-modules). Using this feature, it is possible to hook up the outputs of a module using terraform 11 with a module using terraform 12. This is important because, as mentioned above, `terraform_remote_state` data sources are terraform version sensitive.\r\n\r\nHowever, this is a big change for the module so you will want to do this incrementally, in isolation of terraform 12 changes.\r\n\r\n- For each module that has a dependency, update the module to replace `terraform_remote_state` usage to instead take in variables of the ARN/ID of the resources. Use data sources to your advantage to limit the amount of dependency inputs.\r\n\r\n- Introduce `dependency` blocks in `terragrunt.hcl` to pull in the dependency information from other modules. Note that if a module doesn't export the output you need to feed to the data source, you will need to add this into the upstream modules.\r\n\r\n- Run `terragrunt plan`​ and `terragrunt apply` ​to ensure the changes are saved in state.\r\n\r\n- Open PR and merge to trunk.\r\n\r\n- Repeat for every module that has dependencies.\r\n\r\n**Upgrade modules to terraform 12**\r\n\r\nOnce terragrunt is upgraded and the dependency blocks are introduced, you can start to have mixed terraform version modules. At this point, you can start to incrementally upgrade your modules to terraform 0.12, in a similar fashion to terragrunt:\r\n\r\n- Follow https://github.com/gruntwork-io/docs/blob/legacy/content/guides/upgrading-to-tf12-tg19/index.md to upgrade the module to terraform 12\r\n\r\n- Add `.tfswitchrc` ​in the upgraded module to point to `0.12.29`.\r\n\r\n- Remove the `terraform_version_constraint` attribute in `terragrunt.hcl`.\r\n\r\n- Run `terragrunt plan` and `terragrunt apply` to ensure the changes are saved in state.\r\n\r\n- Open PR and merge to trunk.\r\n\r\n- Repeat for every module.","bodyHTML":"<p dir=\"auto\">There is a process we have identified for a partial migration that has worked well with a few of our customers. It involves upgrading to terragrunt 19+ first, and then taking on the terraform 12 upgrade. The reason for doing this is that the newer terragrunt features allow you to better manage cross module dependencies that are not bound by the terraform version (<code class=\"notranslate\">terraform_remote_state</code> has limitations where you can't read state that is written by a different terraform version).</p>\n<p dir=\"auto\">Here is the rough process:</p>\n<p dir=\"auto\"><strong>Incrementally upgrade to using terragrunt 0.19+</strong></p>\n<p dir=\"auto\">Terragrunt 0.19 has a bunch of features that support mixed terraform versions, so your first step is to upgrade to the latest terragrunt to take advantage of those features. Here is a process for how to do this incrementally in your repo:</p>\n<ul dir=\"auto\">\n<li>\n<p dir=\"auto\">Prerequisite: Install <code class=\"notranslate\">tgswitch</code> and <code class=\"notranslate\">tfswitch</code>. These tools have a bunch of nice features that make it easy to manage mixed version repos. See our blog post <a href=\"https://blog.gruntwork.io/how-to-manage-multiple-versions-of-terragrunt-and-terraform-as-a-team-in-your-iac-project-da5b59209f2d\" rel=\"nofollow\">How to manage multiple versions of terragrunt and terraform as a team</a> for more info.</p>\n</li>\n<li>\n<p dir=\"auto\">Prerequisite: Install terragrunt 0.18 and 0.23 using <code class=\"notranslate\">tgswitch</code></p>\n<ul dir=\"auto\">\n<li>tgenv 0.18.7</li>\n<li>tgenv 0.23.31</li>\n</ul>\n</li>\n<li>\n<p dir=\"auto\">Prerequisite: Install terraform 0.11 and 0.12 using <code class=\"notranslate\">tfswitch</code></p>\n<ul dir=\"auto\">\n<li>tfenv 0.11.15</li>\n<li>tfenv 0.12.31</li>\n</ul>\n</li>\n<li>\n<p dir=\"auto\">Prerequisite: Add .tgswitchrc​ and .tfswitchrc files at root of repo, pointing to <code class=\"notranslate\">0.18.7</code> and <code class=\"notranslate\">0.11.15</code> respectively. This ensures that the default version used for your modules will be tf11/tg18.</p>\n</li>\n</ul>\n<p dir=\"auto\">Once the prerequisites are done, you are ready to incrementally switch to tg19+:</p>\n<ul dir=\"auto\">\n<li>\n<p dir=\"auto\">Make a copy of your root <code class=\"notranslate\">terraform.tfvars</code> file, and convert it to <code class=\"notranslate\">terragrunt.hcl</code>.</p>\n</li>\n<li>\n<p dir=\"auto\">Update any <code class=\"notranslate\">tfvars</code> in your directory structure (e.g. <code class=\"notranslate\">region.tfvars</code>) to use yaml files. Replace the relevant <code class=\"notranslate\">extra_arguments</code> subblocks in the root <code class=\"notranslate\">terragrunt.hcl</code> with the yaml pattern as described in <a href=\"https://github.com/gruntwork-io/docs/blob/legacy/content/guides/upgrading-to-tf12-tg19/index.md\">our upgrade guide</a>.</p>\n</li>\n<li>\n<p dir=\"auto\">For each module:</p>\n<ol dir=\"auto\">\n<li>Replace <code class=\"notranslate\">terraform.tfvars</code> with <code class=\"notranslate\">terragrunt.hcl</code> file.</li>\n<li>Add <code class=\"notranslate\">terraform_version_constraint = \"&gt;= 0.11\"​</code> to <code class=\"notranslate\">terragrunt.hcl</code>.</li>\n<li>Add <code class=\"notranslate\">.tgswitchrc</code>​ in the upgraded module to point to 0.23.31.</li>\n<li>Verify <code class=\"notranslate\">terragrunt plan</code> works and no changes are reported</li>\n<li>Open PR and merge to trunk.</li>\n</ol>\n</li>\n<li>\n<p dir=\"auto\">Once all modules are upgraded to terragrunt 0.23, replace the root <code class=\"notranslate\">.tgswitchrc</code> file to point to <code class=\"notranslate\">0.23.31</code>.</p>\n</li>\n</ul>\n<p dir=\"auto\"><strong>Switch to using dependency blocks</strong></p>\n<p dir=\"auto\">Terragrunt 0.19 introduced a new feature for passing outputs across modules that doesn't depend on the terraform version and remote state: <a href=\"https://terragrunt.gruntwork.io/docs/features/execute-terraform-commands-on-multiple-modules-at-once/#passing-outputs-between-modules\" rel=\"nofollow\">dependency blocks</a>. Using this feature, it is possible to hook up the outputs of a module using terraform 11 with a module using terraform 12. This is important because, as mentioned above, <code class=\"notranslate\">terraform_remote_state</code> data sources are terraform version sensitive.</p>\n<p dir=\"auto\">However, this is a big change for the module so you will want to do this incrementally, in isolation of terraform 12 changes.</p>\n<ul dir=\"auto\">\n<li>\n<p dir=\"auto\">For each module that has a dependency, update the module to replace <code class=\"notranslate\">terraform_remote_state</code> usage to instead take in variables of the ARN/ID of the resources. Use data sources to your advantage to limit the amount of dependency inputs.</p>\n</li>\n<li>\n<p dir=\"auto\">Introduce <code class=\"notranslate\">dependency</code> blocks in <code class=\"notranslate\">terragrunt.hcl</code> to pull in the dependency information from other modules. Note that if a module doesn't export the output you need to feed to the data source, you will need to add this into the upstream modules.</p>\n</li>\n<li>\n<p dir=\"auto\">Run <code class=\"notranslate\">terragrunt plan</code>​ and <code class=\"notranslate\">terragrunt apply</code> ​to ensure the changes are saved in state.</p>\n</li>\n<li>\n<p dir=\"auto\">Open PR and merge to trunk.</p>\n</li>\n<li>\n<p dir=\"auto\">Repeat for every module that has dependencies.</p>\n</li>\n</ul>\n<p dir=\"auto\"><strong>Upgrade modules to terraform 12</strong></p>\n<p dir=\"auto\">Once terragrunt is upgraded and the dependency blocks are introduced, you can start to have mixed terraform version modules. At this point, you can start to incrementally upgrade your modules to terraform 0.12, in a similar fashion to terragrunt:</p>\n<ul dir=\"auto\">\n<li>\n<p dir=\"auto\">Follow <a href=\"https://github.com/gruntwork-io/docs/blob/legacy/content/guides/upgrading-to-tf12-tg19/index.md\">https://github.com/gruntwork-io/docs/blob/legacy/content/guides/upgrading-to-tf12-tg19/index.md</a> to upgrade the module to terraform 12</p>\n</li>\n<li>\n<p dir=\"auto\">Add <code class=\"notranslate\">.tfswitchrc</code> ​in the upgraded module to point to <code class=\"notranslate\">0.12.29</code>.</p>\n</li>\n<li>\n<p dir=\"auto\">Remove the <code class=\"notranslate\">terraform_version_constraint</code> attribute in <code class=\"notranslate\">terragrunt.hcl</code>.</p>\n</li>\n<li>\n<p dir=\"auto\">Run <code class=\"notranslate\">terragrunt plan</code> and <code class=\"notranslate\">terragrunt apply</code> to ensure the changes are saved in state.</p>\n</li>\n<li>\n<p dir=\"auto\">Open PR and merge to trunk.</p>\n</li>\n<li>\n<p dir=\"auto\">Repeat for every module.</p>\n</li>\n</ul>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "32fd19619ec6e288b6836fc22e618762"
}
##DOCS-SOURCER-END -->
