---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Error when trying to create node labels with eks-cluster</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AOy5Q","number":202,"author":{"login":"marinalimeira"},"title":"Error when trying to create node labels with eks-cluster","body":"Im having an issue with trying to get node labels and taints working with eks-cluster module (v0.38.0 - `git::git@github.com:gruntwork-io/terraform-aws-service-catalog.git//modules/services/eks-cluster?ref=v0.38.0`).\n\nIf i set the labels inside the `tags` attribute, the label names get prefixed with [http://ec2.amazonaws.com](http://ec2.amazonaws.com) and when I try to use `eks_kubelet_extra_args` attribute inside autoscaling_group_configurations as follows, I get the below error.\n\nconfig:\n```\nautoscaling_group_configurations = {\n  \"ml\" = {\n    min_size               = \"0\"\n    max_size               = \"0\"\n    asg_instance_type      = \"g4dn.12xlarge\"\n    subnet_ids             = dependency.vpc.outputs.private_app_subnet_ids\n\n    eks_kubelet_extra_args = \"--node-labels=k8s.io/cluster-autoscaler/node-template/taint/dedicated='nvidia.com/gpu=true',k8s.io/cluster-autoscaler/node-template/label/nvidia.com/gpu=true,k8s.io/cluster-autoscaler/enabled=true\"\n\n  }\n```\n\nerror:\n```\n╷\n│ Error: Inconsistent conditional result types\n│ \n│   on .terraform/modules/eks_workers/modules/eks-cluster-workers/main.tf line 101, in resource \"aws_launch_configuration\" \"eks_worker\":\n│  101:   for_each                    = var.create_resources ? local.combined_autoscaling_group_configurations : {}\n│     ├────────────────\n│     │ local.combined_autoscaling_group_configurations is object with 3 attributes\n│     │ var.create_resources is true\n│ \n│ The true and false result expressions must have consistent types. The given\n│ expressions are object and object, respectively.\n╵\nReleasing state lock. This may take a few moments...\nERRO[0103] 1 error occurred:\n\t* exit status 1\n```\n          \nI can not try to use a newer version of the eks-cluster module since it sort of tries to recreate the entire infrastructure and even then Im not sure if the error I see would go away. Any thoughts?","bodyHTML":"<p dir=\"auto\">Im having an issue with trying to get node labels and taints working with eks-cluster module (v0.38.0 - <code class=\"notranslate\">git::git@github.com:gruntwork-io/terraform-aws-service-catalog.git//modules/services/eks-cluster?ref=v0.38.0</code>).</p>\n<p dir=\"auto\">If i set the labels inside the <code class=\"notranslate\">tags</code> attribute, the label names get prefixed with <a href=\"http://ec2.amazonaws.com\" rel=\"nofollow\">http://ec2.amazonaws.com</a> and when I try to use <code class=\"notranslate\">eks_kubelet_extra_args</code> attribute inside autoscaling_group_configurations as follows, I get the below error.</p>\n<p dir=\"auto\">config:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"autoscaling_group_configurations = {\n  &quot;ml&quot; = {\n    min_size               = &quot;0&quot;\n    max_size               = &quot;0&quot;\n    asg_instance_type      = &quot;g4dn.12xlarge&quot;\n    subnet_ids             = dependency.vpc.outputs.private_app_subnet_ids\n\n    eks_kubelet_extra_args = &quot;--node-labels=k8s.io/cluster-autoscaler/node-template/taint/dedicated='nvidia.com/gpu=true',k8s.io/cluster-autoscaler/node-template/label/nvidia.com/gpu=true,k8s.io/cluster-autoscaler/enabled=true&quot;\n\n  }\"><pre class=\"notranslate\"><code>autoscaling_group_configurations = {\n  \"ml\" = {\n    min_size               = \"0\"\n    max_size               = \"0\"\n    asg_instance_type      = \"g4dn.12xlarge\"\n    subnet_ids             = dependency.vpc.outputs.private_app_subnet_ids\n\n    eks_kubelet_extra_args = \"--node-labels=k8s.io/cluster-autoscaler/node-template/taint/dedicated='nvidia.com/gpu=true',k8s.io/cluster-autoscaler/node-template/label/nvidia.com/gpu=true,k8s.io/cluster-autoscaler/enabled=true\"\n\n  }\n</code></pre></div>\n<p dir=\"auto\">error:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"╷\n│ Error: Inconsistent conditional result types\n│ \n│   on .terraform/modules/eks_workers/modules/eks-cluster-workers/main.tf line 101, in resource &quot;aws_launch_configuration&quot; &quot;eks_worker&quot;:\n│  101:   for_each                    = var.create_resources ? local.combined_autoscaling_group_configurations : {}\n│     ├────────────────\n│     │ local.combined_autoscaling_group_configurations is object with 3 attributes\n│     │ var.create_resources is true\n│ \n│ The true and false result expressions must have consistent types. The given\n│ expressions are object and object, respectively.\n╵\nReleasing state lock. This may take a few moments...\nERRO[0103] 1 error occurred:\n\t* exit status 1\"><pre class=\"notranslate\"><code>╷\n│ Error: Inconsistent conditional result types\n│ \n│   on .terraform/modules/eks_workers/modules/eks-cluster-workers/main.tf line 101, in resource \"aws_launch_configuration\" \"eks_worker\":\n│  101:   for_each                    = var.create_resources ? local.combined_autoscaling_group_configurations : {}\n│     ├────────────────\n│     │ local.combined_autoscaling_group_configurations is object with 3 attributes\n│     │ var.create_resources is true\n│ \n│ The true and false result expressions must have consistent types. The given\n│ expressions are object and object, respectively.\n╵\nReleasing state lock. This may take a few moments...\nERRO[0103] 1 error occurred:\n\t* exit status 1\n</code></pre></div>\n<p dir=\"auto\">I can not try to use a newer version of the eks-cluster module since it sort of tries to recreate the entire infrastructure and even then Im not sure if the error I see would go away. Any thoughts?</p>","answer":{"body":"This was a bug in the older module version, which was fixed with this PR https://github.com/gruntwork-io/terraform-aws-eks/pull/318\r\n\r\nThis PR was merged into terraform-aws-eks version https://github.com/gruntwork-io/terraform-aws-eks/releases/tag/v0.38.0, which was rolled out to the service catalog in version [0.42.0](https://github.com/gruntwork-io/terraform-aws-service-catalog/releases/tag/v0.42.0). So if you upgrade to at least that version, this bug should be resolved.","bodyHTML":"<p dir=\"auto\">This was a bug in the older module version, which was fixed with this PR <a href=\"https://github.com/gruntwork-io/terraform-aws-eks/pull/318\">https://github.com/gruntwork-io/terraform-aws-eks/pull/318</a></p>\n<p dir=\"auto\">This PR was merged into terraform-aws-eks version <a href=\"https://github.com/gruntwork-io/terraform-aws-eks/releases/tag/v0.38.0\">https://github.com/gruntwork-io/terraform-aws-eks/releases/tag/v0.38.0</a>, which was rolled out to the service catalog in version <a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/releases/tag/v0.42.0\">0.42.0</a>. So if you upgrade to at least that version, this bug should be resolved.</p>"}}} />

</CenterLayout>
  

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "c710f535445ca108f10226eda0289fac"
}
##DOCS-SOURCER-END -->
