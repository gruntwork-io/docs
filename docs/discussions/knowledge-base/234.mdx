---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/234" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Allow connection for DB in EKS cluster and failed auth error</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AO6L-","number":234,"author":{"login":"marinalimeira"},"title":"Allow connection for DB in EKS cluster and failed auth error","body":"hi everyone, I'm trying to connect to aurora db with my deployment, my understanding is that if the following setting is set, I should be able to connect from the eks cluster which is in the private app subnet correct?\r\n\r\n```\r\n  allow_connections_from_cidr_blocks     = dependency.vpc.outputs.private_app_subnet_cidr_blocks\r\n```\r\n\r\nI am currently getting the following error which I am currently [hard coding to the helm chart](https://github.com/IllumiDesk/illumidesk-modules/blob/47a923e42d79e90885b1c25c0257720b82b01956/modules/illumidesk/variables.tf#L121). I checked the **RDSDBConfig** secret from secrets manager as well to verify that the password is correct and copied the value and pasted it.\r\n```\r\nRolling back session due to database error (psycopg2.OperationalError) FATAL:  password authentication failed for user \"gruntwork\"\r\n```\r\nAlso regarding resetting the password for the aurora db, I would need to create a new secret and pass the arn to the aurora db input correct or can I change the password in current secret, **RDSDBConfig**? \r\n\r\nr:terraform-aws-vpc r:terraform-aws-eks","bodyHTML":"<p dir=\"auto\">hi everyone, I'm trying to connect to aurora db with my deployment, my understanding is that if the following setting is set, I should be able to connect from the eks cluster which is in the private app subnet correct?</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  allow_connections_from_cidr_blocks     = dependency.vpc.outputs.private_app_subnet_cidr_blocks\"><pre class=\"notranslate\"><code>  allow_connections_from_cidr_blocks     = dependency.vpc.outputs.private_app_subnet_cidr_blocks\n</code></pre></div>\n<p dir=\"auto\">I am currently getting the following error which I am currently <a href=\"https://github.com/IllumiDesk/illumidesk-modules/blob/47a923e42d79e90885b1c25c0257720b82b01956/modules/illumidesk/variables.tf#L121\">hard coding to the helm chart</a>. I checked the <strong>RDSDBConfig</strong> secret from secrets manager as well to verify that the password is correct and copied the value and pasted it.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Rolling back session due to database error (psycopg2.OperationalError) FATAL:  password authentication failed for user &quot;gruntwork&quot;\"><pre class=\"notranslate\"><code>Rolling back session due to database error (psycopg2.OperationalError) FATAL:  password authentication failed for user \"gruntwork\"\n</code></pre></div>\n<p dir=\"auto\">Also regarding resetting the password for the aurora db, I would need to create a new secret and pass the arn to the aurora db input correct or can I change the password in current secret, <strong>RDSDBConfig</strong>?</p>\n<p dir=\"auto\">r:terraform-aws-vpc r:terraform-aws-eks</p>","answer":{"body":"[Looking at how you are using the password](https://github.com/IllumiDesk/illumidesk-modules/blob/47a923e42d79e90885b1c25c0257720b82b01956/modules/illumidesk/main.tf#L58), my best guess is that this is a character escape/encoding problem. The password most likely contains special characters, and those need to be escaped according to the [postgres URL rules](https://www.postgresql.org/docs/11/libpq-connect.html#id-1.7.3.8.3.6):\r\n\r\n> Percent-encoding may be used to include symbols with special meaning in any of the URI parts, e.g., replace = with %3D.\r\n\r\nTry encoding the password with URI encoding and then use the encoded format for the raw string in your module as a test.\r\n\r\nIf you want an easy way to encode the password, you can use the python shell:\r\n\r\n```python\r\nimport urllib.parse\r\nprint(urllib.parse.quote(\"MY_P@SSWORD\", safe=\"\"))\r\n# Prints out MY_P%40SSWORD\r\n```","bodyHTML":"<p dir=\"auto\"><a href=\"https://github.com/IllumiDesk/illumidesk-modules/blob/47a923e42d79e90885b1c25c0257720b82b01956/modules/illumidesk/main.tf#L58\">Looking at how you are using the password</a>, my best guess is that this is a character escape/encoding problem. The password most likely contains special characters, and those need to be escaped according to the <a href=\"https://www.postgresql.org/docs/11/libpq-connect.html#id-1.7.3.8.3.6\" rel=\"nofollow\">postgres URL rules</a>:</p>\n<blockquote>\n<p dir=\"auto\">Percent-encoding may be used to include symbols with special meaning in any of the URI parts, e.g., replace = with %3D.</p>\n</blockquote>\n<p dir=\"auto\">Try encoding the password with URI encoding and then use the encoded format for the raw string in your module as a test.</p>\n<p dir=\"auto\">If you want an easy way to encode the password, you can use the python shell:</p>\n<div class=\"highlight highlight-source-python notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"import urllib.parse\nprint(urllib.parse.quote(&quot;MY_P@SSWORD&quot;, safe=&quot;&quot;))\n# Prints out MY_P%40SSWORD\"><pre><span class=\"pl-k\">import</span> <span class=\"pl-s1\">urllib</span>.<span class=\"pl-s1\">parse</span>\n<span class=\"pl-en\">print</span>(<span class=\"pl-s1\">urllib</span>.<span class=\"pl-s1\">parse</span>.<span class=\"pl-en\">quote</span>(<span class=\"pl-s\">\"MY_P@SSWORD\"</span>, <span class=\"pl-s1\">safe</span><span class=\"pl-c1\">=</span><span class=\"pl-s\">\"\"</span>))\n<span class=\"pl-c\"># Prints out MY_P%40SSWORD</span></pre></div>"}}} />

</CenterLayout>
  

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "8ba46a5d0062f920e330325c5319fc0b"
}
##DOCS-SOURCER-END -->
