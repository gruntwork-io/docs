---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/121" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>How to update an expired GitHub PAT</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AObtU","number":121,"author":{"login":"zackproser"},"title":"How to update an expired GitHub PAT","body":"A customer asked: \r\n> I'm trying to update an expired GitHub PAT, but apparently during a deployment I used a nonstandard name, so I recreated it. Following the instructions from the gruntwork-cli tool, I used gruntwork secrets create and got an ARN. However, after updating the arn in the shared-secret-resource-policies in the shared account, and then eg updating the arn in the _envcommon/mgmt/ecs-deploy-runner.hcl I can't seem to get the pipeline permissions right. The CI/CD pipeline won't run. It fails with the error\r\n```\r\n[infrastructure-deployer] ERRO[2022-01-05T03:42:17Z] ECS Task failed to start. Reason: Fetching secret data from\r\n AWS Secrets Manager in region us-west-2: secret arn:aws:secretsmanager:us-west-2:-:secret:MachineUserGitHubPAT-aoEEZk: InvalidRequestException:\r\n You can't access a secret from a different AWS account if you encrypt the secret with the default KMS service key.\r\n```","bodyHTML":"<p dir=\"auto\">A customer asked:</p>\n<blockquote>\n<p dir=\"auto\">I'm trying to update an expired GitHub PAT, but apparently during a deployment I used a nonstandard name, so I recreated it. Following the instructions from the gruntwork-cli tool, I used gruntwork secrets create and got an ARN. However, after updating the arn in the shared-secret-resource-policies in the shared account, and then eg updating the arn in the _envcommon/mgmt/ecs-deploy-runner.hcl I can't seem to get the pipeline permissions right. The CI/CD pipeline won't run. It fails with the error</p>\n</blockquote>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"[infrastructure-deployer] ERRO[2022-01-05T03:42:17Z] ECS Task failed to start. Reason: Fetching secret data from\n AWS Secrets Manager in region us-west-2: secret arn:aws:secretsmanager:us-west-2:-:secret:MachineUserGitHubPAT-aoEEZk: InvalidRequestException:\n You can't access a secret from a different AWS account if you encrypt the secret with the default KMS service key.\"><pre class=\"notranslate\"><code class=\"notranslate\">[infrastructure-deployer] ERRO[2022-01-05T03:42:17Z] ECS Task failed to start. Reason: Fetching secret data from\n AWS Secrets Manager in region us-west-2: secret arn:aws:secretsmanager:us-west-2:-:secret:MachineUserGitHubPAT-aoEEZk: InvalidRequestException:\n You can't access a secret from a different AWS account if you encrypt the secret with the default KMS service key.\n</code></pre></div>","answer":{"body":"You can update the github PAT if you use the `gruntwork secrets update` command, which will update the secret in place.\r\n\r\nHowever, if you need to rename the secret and recreate it, there is an extra step after the `secrets create` command. You need to update the secrets manager secret to be encrypted with the shared KMS key instead of the default. The gruntwork CLI in create mode doesn’t automatically use the right KMS key because it is unfortunately designed for pre deployment and isn’t optimized for post deployment secrets rotation.\r\n\r\nSo we recommend doing this via the AWS web console. When you open the page for the secrets manager entry, you should see a drop down with the KMS key used for encryption, and you want to update it to use the key called `shared-secrets`.","bodyHTML":"<p dir=\"auto\">You can update the github PAT if you use the <code class=\"notranslate\">gruntwork secrets update</code> command, which will update the secret in place.</p>\n<p dir=\"auto\">However, if you need to rename the secret and recreate it, there is an extra step after the <code class=\"notranslate\">secrets create</code> command. You need to update the secrets manager secret to be encrypted with the shared KMS key instead of the default. The gruntwork CLI in create mode doesn’t automatically use the right KMS key because it is unfortunately designed for pre deployment and isn’t optimized for post deployment secrets rotation.</p>\n<p dir=\"auto\">So we recommend doing this via the AWS web console. When you open the page for the secrets manager entry, you should see a drop down with the KMS key used for encryption, and you want to update it to use the key called <code class=\"notranslate\">shared-secrets</code>.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "a30b568bb4c9ded2646a9865d8226f82"
}
##DOCS-SOURCER-END -->
