---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/357" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Error: Your query returned no results when deploying ECS deploy runner to new account.</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84APS8o","number":357,"author":{"login":"zackproser"},"title":"Error: Your query returned no results when deploying ECS deploy runner to new account.","body":"A customer asked: \r\n> I'm provisioning a new AWS account to add to our deployed Reference Architecture. I'm currently working on setting up the ECS deploy runner in our new account. Everything is applied except for the ECS deploy runner and Bastion host, but I'm currently getting this error: \r\n```\r\n╷\r\n│ Error: Your query returned no results. Please change your search criteria and try again.\r\n│\r\n│   with module.ec2_baseline.data.aws_ami.existing[0],\r\n│   on ../../base/ec2-baseline/main.tf line 262, in data \"aws_ami\" \"existing\":\r\n│  262: data \"aws_ami\" \"existing\" {\r\n│\r\n╵\r\n```\r\nHow can I resolve this error?","bodyHTML":"<p dir=\"auto\">A customer asked:</p>\n<blockquote>\n<p dir=\"auto\">I'm provisioning a new AWS account to add to our deployed Reference Architecture. I'm currently working on setting up the ECS deploy runner in our new account. Everything is applied except for the ECS deploy runner and Bastion host, but I'm currently getting this error:</p>\n</blockquote>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"╷\n│ Error: Your query returned no results. Please change your search criteria and try again.\n│\n│   with module.ec2_baseline.data.aws_ami.existing[0],\n│   on ../../base/ec2-baseline/main.tf line 262, in data &quot;aws_ami&quot; &quot;existing&quot;:\n│  262: data &quot;aws_ami&quot; &quot;existing&quot; {\n│\n╵\"><pre class=\"notranslate\"><code class=\"notranslate\">╷\n│ Error: Your query returned no results. Please change your search criteria and try again.\n│\n│   with module.ec2_baseline.data.aws_ami.existing[0],\n│   on ../../base/ec2-baseline/main.tf line 262, in data \"aws_ami\" \"existing\":\n│  262: data \"aws_ami\" \"existing\" {\n│\n╵\n</code></pre></div>\n<p dir=\"auto\">How can I resolve this error?</p>","answer":{"body":"You need to ensure the AMIs are shared with the new account, as well as the KMS key. This is managed through packer at AMI build time. If you followed the steps in the guide, then the KMS key should already be accessible by the new account when you applied account-baseline in the shared account, so the last step is to update each of the build_*.sh scripts in the shared/REGION/_regional/amis folder to include the new account ID in the ami_account_ids list: https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/shared/us-west-2/_regional/amis/build_bastion_host.sh#L28\r\n\r\nOnce the script is updated, you have two options for rolling this out:\r\n• Force packer to build a new version of the ami by updating the version_tag flag in each of the scripts, here: https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/shared/us-west-2/_regional/amis/build_bastion_host.sh#L76. For example, you can update this to --var version_tag=\"$PACKER_TEMPLATE_REPO_REF\".1. Note that you will need to update the module references to use that version in the ami filter (e.g., for ecs-deploy-runner, you will need to update https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/_envcommon/mgmt/ecs-deploy-runner.hcl#L205 to be values = [\"ecs-deploy-runner-worker-v0.82.0.1-*\"]).\r\n• Manually update the existing AMIs by using the AWS web console or AWS cli to share the AMI with the new account. Refer to https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/sharingamis-explicit.html for the instructions on how to do this.\r\nNote that you will still want to update the script even if you opt for the manual update approach, since you want to make sure that new AMIs you build (e.g., if you want to update to the latest service catalog version) will share with the new account.","bodyHTML":"<p dir=\"auto\">You need to ensure the AMIs are shared with the new account, as well as the KMS key. This is managed through packer at AMI build time. If you followed the steps in the guide, then the KMS key should already be accessible by the new account when you applied account-baseline in the shared account, so the last step is to update each of the build_*.sh scripts in the shared/REGION/_regional/amis folder to include the new account ID in the ami_account_ids list: <a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/shared/us-west-2/_regional/amis/build_bastion_host.sh#L28\">https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/shared/us-west-2/_regional/amis/build_bastion_host.sh#L28</a></p>\n<p dir=\"auto\">Once the script is updated, you have two options for rolling this out:<br>\n• Force packer to build a new version of the ami by updating the version_tag flag in each of the scripts, here: <a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/shared/us-west-2/_regional/amis/build_bastion_host.sh#L76\">https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/shared/us-west-2/_regional/amis/build_bastion_host.sh#L76</a>. For example, you can update this to --var version_tag=\"$PACKER_TEMPLATE_REPO_REF\".1. Note that you will need to update the module references to use that version in the ami filter (e.g., for ecs-deploy-runner, you will need to update <a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/_envcommon/mgmt/ecs-deploy-runner.hcl#L205\">https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/_envcommon/mgmt/ecs-deploy-runner.hcl#L205</a> to be values = [\"ecs-deploy-runner-worker-v0.82.0.1-*\"]).<br>\n• Manually update the existing AMIs by using the AWS web console or AWS cli to share the AMI with the new account. Refer to <a href=\"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/sharingamis-explicit.html\" rel=\"nofollow\">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/sharingamis-explicit.html</a> for the instructions on how to do this.<br>\nNote that you will still want to update the script even if you opt for the manual update approach, since you want to make sure that new AMIs you build (e.g., if you want to update to the latest service catalog version) will share with the new account.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "09ca9486810f5a96233eb8db272c1c98"
}
##DOCS-SOURCER-END -->
