---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/333" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Cannot connect to endpoint to refresh aws-auth ConfigMap</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84APNch","number":333,"author":{"login":"BrianMusson"},"title":"Cannot connect to endpoint to refresh aws-auth ConfigMap","body":"Hello, I recently started seeing this error message. I checked my kubectl commands (setup with kubergrunt eks) and I can reach the cluster without issue. My config map looks ok. Where is it getting the `http://localhost` host setting from? I am using version `v0.84.3`, and for what it's worth this issue cropped up out of the blue while troubleshooting something else.  Thanks!\r\n\r\n```\r\nmodule.eks_k8s_role_mapping.kubernetes_config_map.eks_to_k8s_role_mapping: Refreshing state... [id=kube-system/aws-auth]\r\n╷\r\n│ Error: Get \"http://localhost/api/v1/namespaces/kube-system/configmaps/aws-auth\": dial tcp [::1]:80: connect: connection refused\r\n│\r\n│   with module.eks_k8s_role_mapping.kubernetes_config_map.eks_to_k8s_role_mapping,\r\n│   on .terraform/modules/eks_k8s_role_mapping/modules/eks-k8s-role-mapping/main.tf line 33, in resource \"kubernetes_config_map\" \"eks_to_k8s_role_mapping\":\r\n│   33: resource \"kubernetes_config_map\" \"eks_to_k8s_role_mapping\" {\r\n│\r\n╵\r\nReleasing state lock. This may take a few moments...\r\nERRO[0116] 1 error occurred:\r\n\t* exit status 1\r\n```\r\n","bodyHTML":"<p dir=\"auto\">Hello, I recently started seeing this error message. I checked my kubectl commands (setup with kubergrunt eks) and I can reach the cluster without issue. My config map looks ok. Where is it getting the <code class=\"notranslate\">http://localhost</code> host setting from? I am using version <code class=\"notranslate\">v0.84.3</code>, and for what it's worth this issue cropped up out of the blue while troubleshooting something else.  Thanks!</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"module.eks_k8s_role_mapping.kubernetes_config_map.eks_to_k8s_role_mapping: Refreshing state... [id=kube-system/aws-auth]\n╷\n│ Error: Get &quot;http://localhost/api/v1/namespaces/kube-system/configmaps/aws-auth&quot;: dial tcp [::1]:80: connect: connection refused\n│\n│   with module.eks_k8s_role_mapping.kubernetes_config_map.eks_to_k8s_role_mapping,\n│   on .terraform/modules/eks_k8s_role_mapping/modules/eks-k8s-role-mapping/main.tf line 33, in resource &quot;kubernetes_config_map&quot; &quot;eks_to_k8s_role_mapping&quot;:\n│   33: resource &quot;kubernetes_config_map&quot; &quot;eks_to_k8s_role_mapping&quot; {\n│\n╵\nReleasing state lock. This may take a few moments...\nERRO[0116] 1 error occurred:\n\t* exit status 1\"><pre class=\"notranslate\"><code class=\"notranslate\">module.eks_k8s_role_mapping.kubernetes_config_map.eks_to_k8s_role_mapping: Refreshing state... [id=kube-system/aws-auth]\n╷\n│ Error: Get \"http://localhost/api/v1/namespaces/kube-system/configmaps/aws-auth\": dial tcp [::1]:80: connect: connection refused\n│\n│   with module.eks_k8s_role_mapping.kubernetes_config_map.eks_to_k8s_role_mapping,\n│   on .terraform/modules/eks_k8s_role_mapping/modules/eks-k8s-role-mapping/main.tf line 33, in resource \"kubernetes_config_map\" \"eks_to_k8s_role_mapping\":\n│   33: resource \"kubernetes_config_map\" \"eks_to_k8s_role_mapping\" {\n│\n╵\nReleasing state lock. This may take a few moments...\nERRO[0116] 1 error occurred:\n\t* exit status 1\n</code></pre></div>","answer":{"body":"This is most likely due to missing / invalid `kubernetes` provider configuration. If you add one - either via `generate` block, `include` or explicit provider configuration, the `kubernetes` provider has correct configuration for API endpoints and auth. \r\nWithout explicit provider configuration, Terraform defaults to localhost and that's why you're seeing the  `http://localhost/api/v1/...` in the output.\r\n\r\nThe provider generator template can be found here: https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/provider_k8s_helm_for_eks.template.hcl","bodyHTML":"<p dir=\"auto\">This is most likely due to missing / invalid <code class=\"notranslate\">kubernetes</code> provider configuration. If you add one - either via <code class=\"notranslate\">generate</code> block, <code class=\"notranslate\">include</code> or explicit provider configuration, the <code class=\"notranslate\">kubernetes</code> provider has correct configuration for API endpoints and auth.<br>\nWithout explicit provider configuration, Terraform defaults to localhost and that's why you're seeing the  <code class=\"notranslate\">http://localhost/api/v1/...</code> in the output.</p>\n<p dir=\"auto\">The provider generator template can be found here: <a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/provider_k8s_helm_for_eks.template.hcl\">https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/provider_k8s_helm_for_eks.template.hcl</a></p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "024a3c90cf467c8fb3835c9401456c3d"
}
##DOCS-SOURCER-END -->
