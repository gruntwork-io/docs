---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/845" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Issue with Github oAuth token to install Gruntwork modules for API with Packer</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84Ab1pa","number":845,"author":{"login":"erictompkins"},"title":"Issue with Github oAuth token to install Gruntwork modules for API with Packer","body":"It's been a while since I've created a new AMI with Packer and I'm having an issue. My packer code has not changed, so that shouldn't be the issue.\r\n\r\nThe issue that I'm having is:\r\n\r\n```bash\r\n==> amazon-ebs.ubuntu: 2024-10-09 21:41:05 [INFO] [gruntwork-install] Installing from bash-commons...\r\n==> amazon-ebs.ubuntu: 2024-10-09 21:41:05 [INFO] [gruntwork-install] Downloading module bash-commons from https://github.com/gruntwork-io/bash-commons\r\n==> amazon-ebs.ubuntu: [fetch] time=\"2024-10-09T21:41:05Z\" level=error msg=\"\\nReceived an HTTP 401 Response when attempting to query the repo for its tags.\\n\\nThis means that either your GitHub oAuth Token is invalid, or that the token is valid but is being used to request access\\nto either a public repo or a private repo to which you don't have access.\\n\\nUnderlying error message:\\nReceived HTTP Response 401 while fetching releases for GitHub URL https://api.github.com/repos/gruntwork-io/bash-commons/tags?per_page=100. Full HTTP response: {\\\"message\\\":\\\"Bad credentials\\\",\\\"documentation_url\\\":\\\"https://docs.github.com/rest\\\",\\\"status\\\":\\\"401\\\"}\\n\\n\"\r\n```\r\n\r\nI use `eval \"$(pass get-github-machine-token)\"` first to set the my Github Personal Access token for our machine user to the `GITHUB_OAUTH_TOKEN` variable.\r\n\r\nThis is the command that I use to build the Packer template: \r\n\r\n```bash\r\naws-vault exec dev -- packer build openvpn-server.pkr.hcl\r\n```\r\n\r\nThis is the bit of HCL code that tries to do the installation:\r\n\r\n```hcl\r\nbuild {\r\nprovisioner \"shell\" {\r\n    environment_vars = [\"GITHUB_OAUTH_TOKEN=${var.github_auth_token}\", \"BASH_COMMONS_VERSION=v0.1.9\", \"MODULE_AWS_MONITORING=v0.35.0\", \"MODULE_SECURITY_VERSION=v0.65.8\", \"PACKAGE_OPENVPN_VERSION=v0.24.1\", \"SSH_GRUNT_ROLE_ARN=arn:aws:iam::142450169083:role/allow-ssh-grunt-access-from-other-accounts\"]\r\n    inline           = [\"gruntwork-install --module-name 'bash-commons' --tag $BASH_COMMONS_VERSION --repo https://github.com/gruntwork-io/bash-commons\", \"gruntwork-install --module-name 'install-openvpn' --tag $PACKAGE_OPENVPN_VERSION --repo https://github.com/gruntwork-io/terraform-aws-openvpn\", \"gruntwork-install --module-name 'init-openvpn' --tag $PACKAGE_OPENVPN_VERSION --repo https://github.com/gruntwork-io/terraform-aws-openvpn\", \"gruntwork-install --module-name 'start-openvpn-admin' --tag $PACKAGE_OPENVPN_VERSION --repo https://github.com/gruntwork-io/terraform-aws-openvpn\", \"gruntwork-install --module-name 'backup-openvpn-pki' --tag $PACKAGE_OPENVPN_VERSION --repo https://github.com/gruntwork-io/terraform-aws-openvpn\", \"gruntwork-install --binary-name 'openvpn-admin' --tag $PACKAGE_OPENVPN_VERSION --repo https://github.com/gruntwork-io/terraform-aws-openvpn\", \"sudo /usr/local/bin/install-openvpn\", \"gruntwork-install --module-name 'auto-update' --tag $MODULE_SECURITY_VERSION --repo https://github.com/gruntwork-io/terraform-aws-security\", \"gruntwork-install --module-name 'fail2ban' --tag $MODULE_SECURITY_VERSION --repo https://github.com/gruntwork-io/terraform-aws-security\", \"gruntwork-install --module-name 'ntp' --tag $MODULE_SECURITY_VERSION --repo https://github.com/gruntwork-io/terraform-aws-security\", \"gruntwork-install --module-name 'ip-lockdown' --tag $MODULE_SECURITY_VERSION --repo https://github.com/gruntwork-io/terraform-aws-security\", \"gruntwork-install --binary-name 'ssh-grunt' --tag $MODULE_SECURITY_VERSION --repo https://github.com/gruntwork-io/terraform-aws-security\", \"sudo /usr/local/bin/ssh-grunt iam install --iam-group bastion-only-ssh-grunt-users --iam-group ssh-grunt-users --iam-group-sudo ssh-grunt-sudo-users --role-arn $SSH_GRUNT_ROLE_ARN\", \"gruntwork-install --module-name 'agents/cloudwatch-agent' --repo https://github.com/gruntwork-io/terraform-aws-monitoring --tag $MODULE_AWS_MONITORING --module-param aws-region=${var.aws_region}\", \"gruntwork-install --module-name 'logs/syslog' --repo https://github.com/gruntwork-io/terraform-aws-monitoring --tag $MODULE_AWS_MONITORING\"]\r\n  }\r\n}\r\n```\r\n\r\nI confirmed that the `GITHUB_OAUTH_TOKEN` is set by echoing it in the Packer template.\r\n\r\nI also tried a few other Packer templates and got the same result with them\r\n\r\nAre Personal Access Tokens still supported to authenticate access to the Gruntwork modules? \r\n\r\nThe Personal Access Token has these permission:\r\n![CleanShot 2024-10-09 at 18 34 22@2x](https://github.com/user-attachments/assets/16149fad-c1cb-48df-bdad-a1b8b136bb69)\r\n\r\nDo you have any ideas why this would not be working?\r\n\r\nThank you","bodyHTML":"<p dir=\"auto\">It's been a while since I've created a new AMI with Packer and I'm having an issue. My packer code has not changed, so that shouldn't be the issue.</p>\n<p dir=\"auto\">The issue that I'm having is:</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"==&gt; amazon-ebs.ubuntu: 2024-10-09 21:41:05 [INFO] [gruntwork-install] Installing from bash-commons...\n==&gt; amazon-ebs.ubuntu: 2024-10-09 21:41:05 [INFO] [gruntwork-install] Downloading module bash-commons from https://github.com/gruntwork-io/bash-commons\n==&gt; amazon-ebs.ubuntu: [fetch] time=&quot;2024-10-09T21:41:05Z&quot; level=error msg=&quot;\\nReceived an HTTP 401 Response when attempting to query the repo for its tags.\\n\\nThis means that either your GitHub oAuth Token is invalid, or that the token is valid but is being used to request access\\nto either a public repo or a private repo to which you don't have access.\\n\\nUnderlying error message:\\nReceived HTTP Response 401 while fetching releases for GitHub URL https://api.github.com/repos/gruntwork-io/bash-commons/tags?per_page=100. Full HTTP response: {\\&quot;message\\&quot;:\\&quot;Bad credentials\\&quot;,\\&quot;documentation_url\\&quot;:\\&quot;https://docs.github.com/rest\\&quot;,\\&quot;status\\&quot;:\\&quot;401\\&quot;}\\n\\n&quot;\"><pre class=\"notranslate\">==<span class=\"pl-k\">&gt;</span> amazon-ebs.ubuntu: 2024-10-09 21:41:05 [INFO] [gruntwork-install] Installing from bash-commons...\n==<span class=\"pl-k\">&gt;</span> amazon-ebs.ubuntu: 2024-10-09 21:41:05 [INFO] [gruntwork-install] Downloading module bash-commons from https://github.com/gruntwork-io/bash-commons\n==<span class=\"pl-k\">&gt;</span> amazon-ebs.ubuntu: [fetch] time=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>2024-10-09T21:41:05Z<span class=\"pl-pds\">\"</span></span> level=error msg=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>\\nReceived an HTTP 401 Response when attempting to query the repo for its tags.\\n\\nThis means that either your GitHub oAuth Token is invalid, or that the token is valid but is being used to request access\\nto either a public repo or a private repo to which you don't have access.\\n\\nUnderlying error message:\\nReceived HTTP Response 401 while fetching releases for GitHub URL https://api.github.com/repos/gruntwork-io/bash-commons/tags?per_page=100. Full HTTP response: {<span class=\"pl-cce\">\\\"</span>message<span class=\"pl-cce\">\\\"</span>:<span class=\"pl-cce\">\\\"</span>Bad credentials<span class=\"pl-cce\">\\\"</span>,<span class=\"pl-cce\">\\\"</span>documentation_url<span class=\"pl-cce\">\\\"</span>:<span class=\"pl-cce\">\\\"</span>https://docs.github.com/rest<span class=\"pl-cce\">\\\"</span>,<span class=\"pl-cce\">\\\"</span>status<span class=\"pl-cce\">\\\"</span>:<span class=\"pl-cce\">\\\"</span>401<span class=\"pl-cce\">\\\"</span>}\\n\\n<span class=\"pl-pds\">\"</span></span></pre></div>\n<p dir=\"auto\">I use <code class=\"notranslate\">eval \"$(pass get-github-machine-token)\"</code> first to set the my Github Personal Access token for our machine user to the <code class=\"notranslate\">GITHUB_OAUTH_TOKEN</code> variable.</p>\n<p dir=\"auto\">This is the command that I use to build the Packer template:</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"aws-vault exec dev -- packer build openvpn-server.pkr.hcl\"><pre class=\"notranslate\">aws-vault <span class=\"pl-c1\">exec</span> dev -- packer build openvpn-server.pkr.hcl</pre></div>\n<p dir=\"auto\">This is the bit of HCL code that tries to do the installation:</p>\n<div class=\"highlight highlight-source-hcl notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"build {\nprovisioner &quot;shell&quot; {\n    environment_vars = [&quot;GITHUB_OAUTH_TOKEN=${var.github_auth_token}&quot;, &quot;BASH_COMMONS_VERSION=v0.1.9&quot;, &quot;MODULE_AWS_MONITORING=v0.35.0&quot;, &quot;MODULE_SECURITY_VERSION=v0.65.8&quot;, &quot;PACKAGE_OPENVPN_VERSION=v0.24.1&quot;, &quot;SSH_GRUNT_ROLE_ARN=arn:aws:iam::142450169083:role/allow-ssh-grunt-access-from-other-accounts&quot;]\n    inline           = [&quot;gruntwork-install --module-name 'bash-commons' --tag $BASH_COMMONS_VERSION --repo https://github.com/gruntwork-io/bash-commons&quot;, &quot;gruntwork-install --module-name 'install-openvpn' --tag $PACKAGE_OPENVPN_VERSION --repo https://github.com/gruntwork-io/terraform-aws-openvpn&quot;, &quot;gruntwork-install --module-name 'init-openvpn' --tag $PACKAGE_OPENVPN_VERSION --repo https://github.com/gruntwork-io/terraform-aws-openvpn&quot;, &quot;gruntwork-install --module-name 'start-openvpn-admin' --tag $PACKAGE_OPENVPN_VERSION --repo https://github.com/gruntwork-io/terraform-aws-openvpn&quot;, &quot;gruntwork-install --module-name 'backup-openvpn-pki' --tag $PACKAGE_OPENVPN_VERSION --repo https://github.com/gruntwork-io/terraform-aws-openvpn&quot;, &quot;gruntwork-install --binary-name 'openvpn-admin' --tag $PACKAGE_OPENVPN_VERSION --repo https://github.com/gruntwork-io/terraform-aws-openvpn&quot;, &quot;sudo /usr/local/bin/install-openvpn&quot;, &quot;gruntwork-install --module-name 'auto-update' --tag $MODULE_SECURITY_VERSION --repo https://github.com/gruntwork-io/terraform-aws-security&quot;, &quot;gruntwork-install --module-name 'fail2ban' --tag $MODULE_SECURITY_VERSION --repo https://github.com/gruntwork-io/terraform-aws-security&quot;, &quot;gruntwork-install --module-name 'ntp' --tag $MODULE_SECURITY_VERSION --repo https://github.com/gruntwork-io/terraform-aws-security&quot;, &quot;gruntwork-install --module-name 'ip-lockdown' --tag $MODULE_SECURITY_VERSION --repo https://github.com/gruntwork-io/terraform-aws-security&quot;, &quot;gruntwork-install --binary-name 'ssh-grunt' --tag $MODULE_SECURITY_VERSION --repo https://github.com/gruntwork-io/terraform-aws-security&quot;, &quot;sudo /usr/local/bin/ssh-grunt iam install --iam-group bastion-only-ssh-grunt-users --iam-group ssh-grunt-users --iam-group-sudo ssh-grunt-sudo-users --role-arn $SSH_GRUNT_ROLE_ARN&quot;, &quot;gruntwork-install --module-name 'agents/cloudwatch-agent' --repo https://github.com/gruntwork-io/terraform-aws-monitoring --tag $MODULE_AWS_MONITORING --module-param aws-region=${var.aws_region}&quot;, &quot;gruntwork-install --module-name 'logs/syslog' --repo https://github.com/gruntwork-io/terraform-aws-monitoring --tag $MODULE_AWS_MONITORING&quot;]\n  }\n}\"><pre class=\"notranslate\"><span class=\"pl-en\">build</span> {\n<span class=\"pl-en\">provisioner</span> <span class=\"pl-smi\">\"shell\"</span> {\n    <span class=\"pl-v\"><span class=\"pl-smi\">environment_vars</span> <span class=\"pl-k\">=</span> </span>[<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>GITHUB_OAUTH_TOKEN=<span class=\"pl-k\">${</span><span class=\"pl-smi\">var</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">github_auth_token</span><span class=\"pl-k\">}</span><span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>BASH_COMMONS_VERSION=v0.1.9<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>MODULE_AWS_MONITORING=v0.35.0<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>MODULE_SECURITY_VERSION=v0.65.8<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>PACKAGE_OPENVPN_VERSION=v0.24.1<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>SSH_GRUNT_ROLE_ARN=arn:aws:iam::142450169083:role/allow-ssh-grunt-access-from-other-accounts<span class=\"pl-pds\">\"</span></span>]\n    inline           = [\"gruntwork-install --module-name 'bash-commons' --tag $BASH_COMMONS_VERSION --repo https://github.com/gruntwork-io/bash-commons\", \"gruntwork-install --module-name 'install-openvpn' --tag $PACKAGE_OPENVPN_VERSION --repo https://github.com/gruntwork-io/terraform-aws-openvpn\", \"gruntwork-install --module-name 'init-openvpn' --tag $PACKAGE_OPENVPN_VERSION --repo https://github.com/gruntwork-io/terraform-aws-openvpn\", \"gruntwork-install --module-name 'start-openvpn-admin' --tag $PACKAGE_OPENVPN_VERSION --repo https://github.com/gruntwork-io/terraform-aws-openvpn\", \"gruntwork-install --module-name 'backup-openvpn-pki' --tag $PACKAGE_OPENVPN_VERSION --repo https://github.com/gruntwork-io/terraform-aws-openvpn\", \"gruntwork-install --binary-name 'openvpn-admin' --tag $PACKAGE_OPENVPN_VERSION --repo https://github.com/gruntwork-io/terraform-aws-openvpn\", \"sudo /usr/local/bin/install-openvpn\", \"gruntwork-install --module-name 'auto-update' --tag $MODULE_SECURITY_VERSION --repo https://github.com/gruntwork-io/terraform-aws-security\", \"gruntwork-install --module-name 'fail2ban' --tag $MODULE_SECURITY_VERSION --repo https://github.com/gruntwork-io/terraform-aws-security\", \"gruntwork-install --module-name 'ntp' --tag $MODULE_SECURITY_VERSION --repo https://github.com/gruntwork-io/terraform-aws-security\", \"gruntwork-install --module-name 'ip-lockdown' --tag $MODULE_SECURITY_VERSION --repo https://github.com/gruntwork-io/terraform-aws-security\", \"gruntwork-install --binary-name 'ssh-grunt' --tag $MODULE_SECURITY_VERSION --repo https://github.com/gruntwork-io/terraform-aws-security\", \"sudo /usr/local/bin/ssh-grunt iam install --iam-group bastion-only-ssh-grunt-users --iam-group ssh-grunt-users --iam-group-sudo ssh-grunt-sudo-users --role-arn $SSH_GRUNT_ROLE_ARN\", \"gruntwork-install --module-name 'agents/cloudwatch-agent' --repo https://github.com/gruntwork-io/terraform-aws-monitoring --tag $MODULE_AWS_MONITORING --module-param aws-region=${var.aws_region}\", \"gruntwork-install --module-name 'logs/syslog' --repo https://github.com/gruntwork-io/terraform-aws-monitoring --tag $MODULE_AWS_MONITORING\"]\n  }\n}</pre></div>\n<p dir=\"auto\">I confirmed that the <code class=\"notranslate\">GITHUB_OAUTH_TOKEN</code> is set by echoing it in the Packer template.</p>\n<p dir=\"auto\">I also tried a few other Packer templates and got the same result with them</p>\n<p dir=\"auto\">Are Personal Access Tokens still supported to authenticate access to the Gruntwork modules?</p>\n<p dir=\"auto\">The Personal Access Token has these permission:<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/4851312/375152389-16149fad-c1cb-48df-bdad-a1b8b136bb69.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3Njc2MDQ1NzksIm5iZiI6MTc2NzYwNDI3OSwicGF0aCI6Ii80ODUxMzEyLzM3NTE1MjM4OS0xNjE0OWZhZC1jMWNiLTQ4ZGYtYmRhZC1hMWI4YjEzNmJiNjkucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI2MDEwNSUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNjAxMDVUMDkxMTE5WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9NDliOGJmMzZkZjE3ZTZlMDAzMGRiMTU4ZWQ0ZDA5Nzg1ZjMzMmRiYjdiYTdlYTBlOTU0MTc3MGE3NjUxOTBlNSZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.ZXdG_D3fX7hquJeOl-m_QocU26LdWail_N78c_vjMBc\"><img src=\"https://private-user-images.githubusercontent.com/4851312/375152389-16149fad-c1cb-48df-bdad-a1b8b136bb69.png?jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3Njc2MDQ1NzksIm5iZiI6MTc2NzYwNDI3OSwicGF0aCI6Ii80ODUxMzEyLzM3NTE1MjM4OS0xNjE0OWZhZC1jMWNiLTQ4ZGYtYmRhZC1hMWI4YjEzNmJiNjkucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI2MDEwNSUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNjAxMDVUMDkxMTE5WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9NDliOGJmMzZkZjE3ZTZlMDAzMGRiMTU4ZWQ0ZDA5Nzg1ZjMzMmRiYjdiYTdlYTBlOTU0MTc3MGE3NjUxOTBlNSZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.ZXdG_D3fX7hquJeOl-m_QocU26LdWail_N78c_vjMBc\" alt=\"CleanShot 2024-10-09 at 18 34 22@2x\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\">Do you have any ideas why this would not be working?</p>\n<p dir=\"auto\">Thank you</p>","answer":{"body":"The solution involved a few things:\r\n\r\n1. Our Github machine user was created before Gruntwork had its developer portal. This Github account didn't have an email associated with it in the developer portal, so it wasn't allowed to be authenticated.\r\n2. We also regenerated the personal access token in GitHub for this user.\r\n3. We updated the permissions for the personal access token in GitHub to include `admin:org -> read:org` and `project`.","bodyHTML":"<p dir=\"auto\">The solution involved a few things:</p>\n<ol dir=\"auto\">\n<li>Our Github machine user was created before Gruntwork had its developer portal. This Github account didn't have an email associated with it in the developer portal, so it wasn't allowed to be authenticated.</li>\n<li>We also regenerated the personal access token in GitHub for this user.</li>\n<li>We updated the permissions for the personal access token in GitHub to include <code class=\"notranslate\">admin:org -&gt; read:org</code> and <code class=\"notranslate\">project</code>.</li>\n</ol>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "c2e9374f6089ea7e1c282e8c9835d602"
}
##DOCS-SOURCER-END -->
