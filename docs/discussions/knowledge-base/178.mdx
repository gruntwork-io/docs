---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/178" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>What does configuring EKS node groups look like with Gruntwork?</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AOvR7","number":178,"author":{"login":"zackproser"},"title":"What does configuring EKS node groups look like with Gruntwork?","body":"A customer asked: \r\n> Can you modify the EKS node groups following a Reference Architecture deployment? Can you provide me some examples of what it looks like to configure node groups using Gruntwork's modules? \r\n\r\n","bodyHTML":"<p dir=\"auto\">A customer asked:</p>\n<blockquote>\n<p dir=\"auto\">Can you modify the EKS node groups following a Reference Architecture deployment? Can you provide me some examples of what it looks like to configure node groups using Gruntwork's modules?</p>\n</blockquote>","answer":{"body":"Firstly, you can definitely modify the EKS cluster node groups following a Reference Architecture deployment. One of the benefits of having a Reference Architecture deployed is that you receive 100% of the code, so you can modify it however you wish. \r\n\r\nSecondly, here's some examples of what it looks like to configure Node groups in terragrunt: \r\n\r\n```\r\nmanaged_node_group_configurations = {\r\n    group = {\r\n      min_size       = 2\r\n      max_size       = 4\r\n      desired_size   = 2\r\n      instance_types = [\"t3.micro\"]\r\n      subnet_ids     = dependency.vpc.outputs.private_app_subnet_ids\r\n    }\r\n  }\r\n  cluster_instance_ami_filters = {\r\n    owners = [local.common_vars.locals.account_ids.shared]\r\n    filters = [\r\n      {\r\n        name   = \"name\"\r\n        values = [\"eks-workers-v0.70.0-*\"]\r\n      },\r\n    ]\r\n  }\r\n```\r\n\r\nHere's the configuration format for Node groups in our eks-cluster module: \r\n\r\n```\r\nvariable \"managed_node_group_configurations\" {\r\n  description = \"Configure one or more Node Groups to manage the EC2 instances in this cluster. Set to empty object ({}) if you do not wish to configure managed node groups.\"\r\n  # Ideally, this would be a map of (string, object), with all the supported properties, but object does not support\r\n  # optional properties. We can't use a map(any) either as that would require the values to all have the same type.\r\n  type = any\r\n\r\n  # Each configuration must be keyed by a unique string that will be used as a suffix for the node group name. The\r\n  # values support the following attributes:\r\n  #\r\n  #\r\n  # OPTIONAL (defaults to value of corresponding module input):\r\n  # - subnet_ids          list(string)       : (Defaults to value from var.node_group_default_subnet_ids) A list of the\r\n  #                                            subnets into which the EKS Cluster's managed nodes will be launched.\r\n  #                                            These should usually be all private subnets and include one in each AWS\r\n  #                                            Availability Zone. NOTE: If using a cluster autoscaler with EBS volumes,\r\n  #                                            each ASG may only belong to a single availability zone.\r\n  # - min_size            number             : (Defaults to value from var.node_group_default_min_size) The minimum\r\n  #                                            number of EC2 Instances representing workers launchable for this EKS\r\n  #                                            Cluster. Useful for auto-scaling limits.\r\n  # - max_size            number             : (Defaults to value from var.node_group_default_max_size) The maximum\r\n  #                                            number of EC2 Instances representing workers that must be running for\r\n  #                                            this EKS Cluster. We recommend making this at least twice the min_size,\r\n  #                                            even if you don't plan on scaling the cluster up and down, as the extra\r\n  #                                            capacity will be used to deploy updates to the cluster.\r\n  # - desired_size        number             : (Defaults to value from var.node_group_default_desired_size) The current\r\n  #                                            desired number of EC2 Instances representing workers that must be running\r\n  #                                            for this EKS Cluster.\r\n  # - instance_types      list(string)       : (Defaults to value from var.node_group_default_instance_types) A list of\r\n  #                                            instance types (e.g., t2.medium) to use for the EKS Cluster's worker\r\n  #                                            nodes. EKS will choose from this list of instance types when launching\r\n  #                                            new instances. When using launch templates, this setting will override\r\n  #                                            the configured instance type of the launch template.\r\n  # - capacity_type       string             : (Defaults to value from var.node_group_default_capacity_type) Type of capacity\r\n  #                                            associated with the EKS Node Group. Valid values: ON_DEMAND, SPOT.\r\n  # - launch_template     LaunchTemplate     : (Defaults to value from var.node_group_default_launch_template)\r\n  #                                            Launch template to use for the node. Specify either Name or ID of launch\r\n  #                                            template. Must include version. Although the API supports using the\r\n  #                                            values \"$Latest\" and \"$Default\" to configure the version, this can lead\r\n  #                                            to a perpetual diff. Use the `latest_version` or `default_version` output\r\n  #                                            of the aws_launch_template data source or resource instead. See\r\n  #                                            https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_node_group#launch_template-configuration-block\r\n  #                                            for more information.\r\n  # - instance_root_volume_size   number     : (Defaults to value from var.node_group_default_instance_root_volume_size)\r\n  #                                            The root volume size of instances to use for the ASG in GB (e.g., 40).\r\n  # - instance_root_volume_type   string     : (Defaults to value from var.node_group_default_instance_root_volume_type)\r\n  #                                            The root volume type of instances to use for the ASG (e.g., \"standard\").\r\n  # - instance_root_volume_encryption  bool  : (Defaults to value from var.node_group_default_instance_root_volume_encryption)\r\n  #                                             Whether or not to enable root volume encryption for instances of the ASG.\r\n  # - tags                map(string)        : (Defaults to value from var.node_group_default_tags) Custom tags to apply\r\n  #                                            to the EC2 Instances in this node group. This should be a key value pair,\r\n  #                                            where the keys are tag keys and values are the tag values. Merged with\r\n  #                                            var.common_tags.\r\n  # - labels              map(string)        : (Defaults to value from var.node_group_default_labels) Custom Kubernetes\r\n  #                                            Labels to apply to the EC2 Instances in this node group. This should be a\r\n  #                                            key value pair, where the keys are label keys and values are the label\r\n  #                                            values. Merged with var.common_labels.\r\n  # - eks_kubelet_extra_args        string   : Extra args to pass to the kubelet process on node boot.\r\n  # - eks_bootstrap_script_options  string   : Extra option args to pass to the bootstrap.sh script. This will be\r\n  #                                            passed through directly to the bootstrap script.\r\n  # - cloud_init_parts    map(string)        : (Defaults to value from var.cloud_init_parts)\r\n  #                                            Per-ASG cloud init scripts to run at boot time on the node.  See var.cloud_init_parts for accepted keys.\r\n  #\r\n  # Structure of LaunchTemplate object:\r\n  # - name     string  : The Name of the Launch Template to use. One of ID or Name should be provided.\r\n  # - id       string  : The ID of the Launch Template to use. One of ID or Name should be provided.\r\n  # - version  string  : The version of the Launch Template to use.\r\n  #\r\n  # Example:\r\n  # managed_node_group_configurations = {\r\n  #   ngroup1 = {\r\n  #     desired_size = 1\r\n  #     min_size     = 1\r\n  #     max_size     = 3\r\n  #     subnet_ids  = [data.terraform_remote_state.vpc.outputs.private_app_subnet_ids[0]]\r\n  #   }\r\n  #   asg2 = {\r\n  #     desired_size   = 1\r\n  #     min_size       = 1\r\n  #     max_size       = 3\r\n  #     subnet_ids     = [data.terraform_remote_state.vpc.outputs.private_app_subnet_ids[0]]\r\n  #     disk_size      = 50\r\n  #   }\r\n  #   ngroup2 = {}  # Only defaults\r\n  # }\r\n  default = {}\r\n}\r\n```","bodyHTML":"<p dir=\"auto\">Firstly, you can definitely modify the EKS cluster node groups following a Reference Architecture deployment. One of the benefits of having a Reference Architecture deployed is that you receive 100% of the code, so you can modify it however you wish.</p>\n<p dir=\"auto\">Secondly, here's some examples of what it looks like to configure Node groups in terragrunt:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"managed_node_group_configurations = {\n    group = {\n      min_size       = 2\n      max_size       = 4\n      desired_size   = 2\n      instance_types = [&quot;t3.micro&quot;]\n      subnet_ids     = dependency.vpc.outputs.private_app_subnet_ids\n    }\n  }\n  cluster_instance_ami_filters = {\n    owners = [local.common_vars.locals.account_ids.shared]\n    filters = [\n      {\n        name   = &quot;name&quot;\n        values = [&quot;eks-workers-v0.70.0-*&quot;]\n      },\n    ]\n  }\"><pre class=\"notranslate\"><code class=\"notranslate\">managed_node_group_configurations = {\n    group = {\n      min_size       = 2\n      max_size       = 4\n      desired_size   = 2\n      instance_types = [\"t3.micro\"]\n      subnet_ids     = dependency.vpc.outputs.private_app_subnet_ids\n    }\n  }\n  cluster_instance_ami_filters = {\n    owners = [local.common_vars.locals.account_ids.shared]\n    filters = [\n      {\n        name   = \"name\"\n        values = [\"eks-workers-v0.70.0-*\"]\n      },\n    ]\n  }\n</code></pre></div>\n<p dir=\"auto\">Here's the configuration format for Node groups in our eks-cluster module:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"variable &quot;managed_node_group_configurations&quot; {\n  description = &quot;Configure one or more Node Groups to manage the EC2 instances in this cluster. Set to empty object ({}) if you do not wish to configure managed node groups.&quot;\n  # Ideally, this would be a map of (string, object), with all the supported properties, but object does not support\n  # optional properties. We can't use a map(any) either as that would require the values to all have the same type.\n  type = any\n\n  # Each configuration must be keyed by a unique string that will be used as a suffix for the node group name. The\n  # values support the following attributes:\n  #\n  #\n  # OPTIONAL (defaults to value of corresponding module input):\n  # - subnet_ids          list(string)       : (Defaults to value from var.node_group_default_subnet_ids) A list of the\n  #                                            subnets into which the EKS Cluster's managed nodes will be launched.\n  #                                            These should usually be all private subnets and include one in each AWS\n  #                                            Availability Zone. NOTE: If using a cluster autoscaler with EBS volumes,\n  #                                            each ASG may only belong to a single availability zone.\n  # - min_size            number             : (Defaults to value from var.node_group_default_min_size) The minimum\n  #                                            number of EC2 Instances representing workers launchable for this EKS\n  #                                            Cluster. Useful for auto-scaling limits.\n  # - max_size            number             : (Defaults to value from var.node_group_default_max_size) The maximum\n  #                                            number of EC2 Instances representing workers that must be running for\n  #                                            this EKS Cluster. We recommend making this at least twice the min_size,\n  #                                            even if you don't plan on scaling the cluster up and down, as the extra\n  #                                            capacity will be used to deploy updates to the cluster.\n  # - desired_size        number             : (Defaults to value from var.node_group_default_desired_size) The current\n  #                                            desired number of EC2 Instances representing workers that must be running\n  #                                            for this EKS Cluster.\n  # - instance_types      list(string)       : (Defaults to value from var.node_group_default_instance_types) A list of\n  #                                            instance types (e.g., t2.medium) to use for the EKS Cluster's worker\n  #                                            nodes. EKS will choose from this list of instance types when launching\n  #                                            new instances. When using launch templates, this setting will override\n  #                                            the configured instance type of the launch template.\n  # - capacity_type       string             : (Defaults to value from var.node_group_default_capacity_type) Type of capacity\n  #                                            associated with the EKS Node Group. Valid values: ON_DEMAND, SPOT.\n  # - launch_template     LaunchTemplate     : (Defaults to value from var.node_group_default_launch_template)\n  #                                            Launch template to use for the node. Specify either Name or ID of launch\n  #                                            template. Must include version. Although the API supports using the\n  #                                            values &quot;$Latest&quot; and &quot;$Default&quot; to configure the version, this can lead\n  #                                            to a perpetual diff. Use the `latest_version` or `default_version` output\n  #                                            of the aws_launch_template data source or resource instead. See\n  #                                            https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_node_group#launch_template-configuration-block\n  #                                            for more information.\n  # - instance_root_volume_size   number     : (Defaults to value from var.node_group_default_instance_root_volume_size)\n  #                                            The root volume size of instances to use for the ASG in GB (e.g., 40).\n  # - instance_root_volume_type   string     : (Defaults to value from var.node_group_default_instance_root_volume_type)\n  #                                            The root volume type of instances to use for the ASG (e.g., &quot;standard&quot;).\n  # - instance_root_volume_encryption  bool  : (Defaults to value from var.node_group_default_instance_root_volume_encryption)\n  #                                             Whether or not to enable root volume encryption for instances of the ASG.\n  # - tags                map(string)        : (Defaults to value from var.node_group_default_tags) Custom tags to apply\n  #                                            to the EC2 Instances in this node group. This should be a key value pair,\n  #                                            where the keys are tag keys and values are the tag values. Merged with\n  #                                            var.common_tags.\n  # - labels              map(string)        : (Defaults to value from var.node_group_default_labels) Custom Kubernetes\n  #                                            Labels to apply to the EC2 Instances in this node group. This should be a\n  #                                            key value pair, where the keys are label keys and values are the label\n  #                                            values. Merged with var.common_labels.\n  # - eks_kubelet_extra_args        string   : Extra args to pass to the kubelet process on node boot.\n  # - eks_bootstrap_script_options  string   : Extra option args to pass to the bootstrap.sh script. This will be\n  #                                            passed through directly to the bootstrap script.\n  # - cloud_init_parts    map(string)        : (Defaults to value from var.cloud_init_parts)\n  #                                            Per-ASG cloud init scripts to run at boot time on the node.  See var.cloud_init_parts for accepted keys.\n  #\n  # Structure of LaunchTemplate object:\n  # - name     string  : The Name of the Launch Template to use. One of ID or Name should be provided.\n  # - id       string  : The ID of the Launch Template to use. One of ID or Name should be provided.\n  # - version  string  : The version of the Launch Template to use.\n  #\n  # Example:\n  # managed_node_group_configurations = {\n  #   ngroup1 = {\n  #     desired_size = 1\n  #     min_size     = 1\n  #     max_size     = 3\n  #     subnet_ids  = [data.terraform_remote_state.vpc.outputs.private_app_subnet_ids[0]]\n  #   }\n  #   asg2 = {\n  #     desired_size   = 1\n  #     min_size       = 1\n  #     max_size       = 3\n  #     subnet_ids     = [data.terraform_remote_state.vpc.outputs.private_app_subnet_ids[0]]\n  #     disk_size      = 50\n  #   }\n  #   ngroup2 = {}  # Only defaults\n  # }\n  default = {}\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">variable \"managed_node_group_configurations\" {\n  description = \"Configure one or more Node Groups to manage the EC2 instances in this cluster. Set to empty object ({}) if you do not wish to configure managed node groups.\"\n  # Ideally, this would be a map of (string, object), with all the supported properties, but object does not support\n  # optional properties. We can't use a map(any) either as that would require the values to all have the same type.\n  type = any\n\n  # Each configuration must be keyed by a unique string that will be used as a suffix for the node group name. The\n  # values support the following attributes:\n  #\n  #\n  # OPTIONAL (defaults to value of corresponding module input):\n  # - subnet_ids          list(string)       : (Defaults to value from var.node_group_default_subnet_ids) A list of the\n  #                                            subnets into which the EKS Cluster's managed nodes will be launched.\n  #                                            These should usually be all private subnets and include one in each AWS\n  #                                            Availability Zone. NOTE: If using a cluster autoscaler with EBS volumes,\n  #                                            each ASG may only belong to a single availability zone.\n  # - min_size            number             : (Defaults to value from var.node_group_default_min_size) The minimum\n  #                                            number of EC2 Instances representing workers launchable for this EKS\n  #                                            Cluster. Useful for auto-scaling limits.\n  # - max_size            number             : (Defaults to value from var.node_group_default_max_size) The maximum\n  #                                            number of EC2 Instances representing workers that must be running for\n  #                                            this EKS Cluster. We recommend making this at least twice the min_size,\n  #                                            even if you don't plan on scaling the cluster up and down, as the extra\n  #                                            capacity will be used to deploy updates to the cluster.\n  # - desired_size        number             : (Defaults to value from var.node_group_default_desired_size) The current\n  #                                            desired number of EC2 Instances representing workers that must be running\n  #                                            for this EKS Cluster.\n  # - instance_types      list(string)       : (Defaults to value from var.node_group_default_instance_types) A list of\n  #                                            instance types (e.g., t2.medium) to use for the EKS Cluster's worker\n  #                                            nodes. EKS will choose from this list of instance types when launching\n  #                                            new instances. When using launch templates, this setting will override\n  #                                            the configured instance type of the launch template.\n  # - capacity_type       string             : (Defaults to value from var.node_group_default_capacity_type) Type of capacity\n  #                                            associated with the EKS Node Group. Valid values: ON_DEMAND, SPOT.\n  # - launch_template     LaunchTemplate     : (Defaults to value from var.node_group_default_launch_template)\n  #                                            Launch template to use for the node. Specify either Name or ID of launch\n  #                                            template. Must include version. Although the API supports using the\n  #                                            values \"$Latest\" and \"$Default\" to configure the version, this can lead\n  #                                            to a perpetual diff. Use the `latest_version` or `default_version` output\n  #                                            of the aws_launch_template data source or resource instead. See\n  #                                            https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_node_group#launch_template-configuration-block\n  #                                            for more information.\n  # - instance_root_volume_size   number     : (Defaults to value from var.node_group_default_instance_root_volume_size)\n  #                                            The root volume size of instances to use for the ASG in GB (e.g., 40).\n  # - instance_root_volume_type   string     : (Defaults to value from var.node_group_default_instance_root_volume_type)\n  #                                            The root volume type of instances to use for the ASG (e.g., \"standard\").\n  # - instance_root_volume_encryption  bool  : (Defaults to value from var.node_group_default_instance_root_volume_encryption)\n  #                                             Whether or not to enable root volume encryption for instances of the ASG.\n  # - tags                map(string)        : (Defaults to value from var.node_group_default_tags) Custom tags to apply\n  #                                            to the EC2 Instances in this node group. This should be a key value pair,\n  #                                            where the keys are tag keys and values are the tag values. Merged with\n  #                                            var.common_tags.\n  # - labels              map(string)        : (Defaults to value from var.node_group_default_labels) Custom Kubernetes\n  #                                            Labels to apply to the EC2 Instances in this node group. This should be a\n  #                                            key value pair, where the keys are label keys and values are the label\n  #                                            values. Merged with var.common_labels.\n  # - eks_kubelet_extra_args        string   : Extra args to pass to the kubelet process on node boot.\n  # - eks_bootstrap_script_options  string   : Extra option args to pass to the bootstrap.sh script. This will be\n  #                                            passed through directly to the bootstrap script.\n  # - cloud_init_parts    map(string)        : (Defaults to value from var.cloud_init_parts)\n  #                                            Per-ASG cloud init scripts to run at boot time on the node.  See var.cloud_init_parts for accepted keys.\n  #\n  # Structure of LaunchTemplate object:\n  # - name     string  : The Name of the Launch Template to use. One of ID or Name should be provided.\n  # - id       string  : The ID of the Launch Template to use. One of ID or Name should be provided.\n  # - version  string  : The version of the Launch Template to use.\n  #\n  # Example:\n  # managed_node_group_configurations = {\n  #   ngroup1 = {\n  #     desired_size = 1\n  #     min_size     = 1\n  #     max_size     = 3\n  #     subnet_ids  = [data.terraform_remote_state.vpc.outputs.private_app_subnet_ids[0]]\n  #   }\n  #   asg2 = {\n  #     desired_size   = 1\n  #     min_size       = 1\n  #     max_size       = 3\n  #     subnet_ids     = [data.terraform_remote_state.vpc.outputs.private_app_subnet_ids[0]]\n  #     disk_size      = 50\n  #   }\n  #   ngroup2 = {}  # Only defaults\n  # }\n  default = {}\n}\n</code></pre></div>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "976a839179c51e26424295c1f41c369a"
}
##DOCS-SOURCER-END -->
