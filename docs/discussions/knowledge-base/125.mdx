---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/125" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Error: error reading Macie ClassificationJob</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AObti","number":125,"author":{"login":"zackproser"},"title":"Error: error reading Macie ClassificationJob","body":"A customer asked: \r\n\r\n> Had a question regarding updating users in the users.yml file under our security account. When I ran terragrunt plan locally, it was able to complete without issue, however in the plan phase of our pipeline it is failing with this error:\r\n\r\n```\r\n[ecs-deploy-runner][2022-01-04T20:12:14+0000] module.security_baseline.module.kms_grants.aws_kms_grant.grants_for_us_west_2[\"ami_encryption_key\"]: Refreshing state... [id=arn:aws:kms:us-west-2:[REDACTED]:key/KEY:KEY]\r\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] ╷\r\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] │ Error: error reading Macie ClassificationJob (9e9c0f2494cf219ec6c1f967c4bd5273): AccessDeniedException: User: arn:aws:sts::[REDACTED]:assumed-role/ecs-deploy-runner-terraform-planner/7ceec9c9348b40b1814a7fe3f6323153 is not authorized to perform: macie2:DescribeClassificationJob on resource: arn:aws:macie2:us-west-2:[REDACTED]:classification-job/9e9c0f2494cf219ec6c1f967c4bd5273\r\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] │ \r\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] │   with module.macie.aws_macie2_classification_job.macie_job_us_west_2[0],\r\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] │   on ../../security/macie/main.tf line 1157, in resource \"aws_macie2_classification_job\" \"macie_job_us_west_2\":\r\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] │ 1157: resource \"aws_macie2_classification_job\" \"macie_job_us_west_2\" {\r\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] │ \r\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] ╵\r\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] time=2022-01-04T20:12:15Z level=error msg=1 error occurred:\r\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] \t* exit status 1\r\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] [INFO] [infrastructure-deploy-script] 2022-01-04 20:12:15  \"terragrunt plan\" exited with code 1\r\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] Error: Could not run \"terragrunt plan\"\r\n```","bodyHTML":"<p dir=\"auto\">A customer asked:</p>\n<blockquote>\n<p dir=\"auto\">Had a question regarding updating users in the users.yml file under our security account. When I ran terragrunt plan locally, it was able to complete without issue, however in the plan phase of our pipeline it is failing with this error:</p>\n</blockquote>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"[ecs-deploy-runner][2022-01-04T20:12:14+0000] module.security_baseline.module.kms_grants.aws_kms_grant.grants_for_us_west_2[&quot;ami_encryption_key&quot;]: Refreshing state... [id=arn:aws:kms:us-west-2:[REDACTED]:key/KEY:KEY]\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] ╷\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] │ Error: error reading Macie ClassificationJob (9e9c0f2494cf219ec6c1f967c4bd5273): AccessDeniedException: User: arn:aws:sts::[REDACTED]:assumed-role/ecs-deploy-runner-terraform-planner/7ceec9c9348b40b1814a7fe3f6323153 is not authorized to perform: macie2:DescribeClassificationJob on resource: arn:aws:macie2:us-west-2:[REDACTED]:classification-job/9e9c0f2494cf219ec6c1f967c4bd5273\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] │ \n[ecs-deploy-runner][2022-01-04T20:12:15+0000] │   with module.macie.aws_macie2_classification_job.macie_job_us_west_2[0],\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] │   on ../../security/macie/main.tf line 1157, in resource &quot;aws_macie2_classification_job&quot; &quot;macie_job_us_west_2&quot;:\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] │ 1157: resource &quot;aws_macie2_classification_job&quot; &quot;macie_job_us_west_2&quot; {\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] │ \n[ecs-deploy-runner][2022-01-04T20:12:15+0000] ╵\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] time=2022-01-04T20:12:15Z level=error msg=1 error occurred:\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] \t* exit status 1\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] [INFO] [infrastructure-deploy-script] 2022-01-04 20:12:15  &quot;terragrunt plan&quot; exited with code 1\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] Error: Could not run &quot;terragrunt plan&quot;\"><pre class=\"notranslate\"><code class=\"notranslate\">[ecs-deploy-runner][2022-01-04T20:12:14+0000] module.security_baseline.module.kms_grants.aws_kms_grant.grants_for_us_west_2[\"ami_encryption_key\"]: Refreshing state... [id=arn:aws:kms:us-west-2:[REDACTED]:key/KEY:KEY]\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] ╷\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] │ Error: error reading Macie ClassificationJob (9e9c0f2494cf219ec6c1f967c4bd5273): AccessDeniedException: User: arn:aws:sts::[REDACTED]:assumed-role/ecs-deploy-runner-terraform-planner/7ceec9c9348b40b1814a7fe3f6323153 is not authorized to perform: macie2:DescribeClassificationJob on resource: arn:aws:macie2:us-west-2:[REDACTED]:classification-job/9e9c0f2494cf219ec6c1f967c4bd5273\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] │ \n[ecs-deploy-runner][2022-01-04T20:12:15+0000] │   with module.macie.aws_macie2_classification_job.macie_job_us_west_2[0],\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] │   on ../../security/macie/main.tf line 1157, in resource \"aws_macie2_classification_job\" \"macie_job_us_west_2\":\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] │ 1157: resource \"aws_macie2_classification_job\" \"macie_job_us_west_2\" {\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] │ \n[ecs-deploy-runner][2022-01-04T20:12:15+0000] ╵\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] time=2022-01-04T20:12:15Z level=error msg=1 error occurred:\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] \t* exit status 1\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] [INFO] [infrastructure-deploy-script] 2022-01-04 20:12:15  \"terragrunt plan\" exited with code 1\n[ecs-deploy-runner][2022-01-04T20:12:15+0000] Error: Could not run \"terragrunt plan\"\n</code></pre></div>","answer":{"body":"One thing to check would be your deploy_permissions.yml file - which could be in various places (but probably next to your mgmt/ecs-deploy-runner  directory, depending on when your Ref Arch was deployed).\r\n\r\nThe idea is that ECS deploy runner permissions are defined here and used to generate the actual IAM policies that allow pipelines to manage infrastructure for you. \r\n\r\nYou also have a `read_only_permissions.yml` file which should look like this (if you're running a CIS-compliant Ref Arch): \r\n\r\n```\r\nMacieReadOnlyAccess:\r\n  effect: \"Allow\"\r\n  actions:\r\n  - \"macie2:Get*\"\r\n  - \"macie2:List*\"\r\n  - \"macie2:Describe*\"\r\n  resources:\r\n  - \"*\"\r\n```\r\n\r\nYou should also have an entry for `ECSReadOnlyAccess` if your Ref Arch uses ECS as a backing compute cluster, as defined here: https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/_envcommon/mgmt/read_only_permissions.yml#L208\r\n\r\nFinally - once you you have updated your permissions yaml file with the correct permissions, you will need to re `apply` your ECS deploy runner / pipelines configuration for the new permission set to be reflected. ","bodyHTML":"<p dir=\"auto\">One thing to check would be your deploy_permissions.yml file - which could be in various places (but probably next to your mgmt/ecs-deploy-runner  directory, depending on when your Ref Arch was deployed).</p>\n<p dir=\"auto\">The idea is that ECS deploy runner permissions are defined here and used to generate the actual IAM policies that allow pipelines to manage infrastructure for you.</p>\n<p dir=\"auto\">You also have a <code class=\"notranslate\">read_only_permissions.yml</code> file which should look like this (if you're running a CIS-compliant Ref Arch):</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"MacieReadOnlyAccess:\n  effect: &quot;Allow&quot;\n  actions:\n  - &quot;macie2:Get*&quot;\n  - &quot;macie2:List*&quot;\n  - &quot;macie2:Describe*&quot;\n  resources:\n  - &quot;*&quot;\"><pre class=\"notranslate\"><code class=\"notranslate\">MacieReadOnlyAccess:\n  effect: \"Allow\"\n  actions:\n  - \"macie2:Get*\"\n  - \"macie2:List*\"\n  - \"macie2:Describe*\"\n  resources:\n  - \"*\"\n</code></pre></div>\n<p dir=\"auto\">You should also have an entry for <code class=\"notranslate\">ECSReadOnlyAccess</code> if your Ref Arch uses ECS as a backing compute cluster, as defined here: <a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/_envcommon/mgmt/read_only_permissions.yml#L208\">https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/_envcommon/mgmt/read_only_permissions.yml#L208</a></p>\n<p dir=\"auto\">Finally - once you you have updated your permissions yaml file with the correct permissions, you will need to re <code class=\"notranslate\">apply</code> your ECS deploy runner / pipelines configuration for the new permission set to be reflected.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "2285870b9b9e64e5ab265bdf8965eb6c"
}
##DOCS-SOURCER-END -->
