---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/674" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>S3 module upgrade fails with AccessControlListNotSupported when bucket_ownership is set to BucketOwnerEnforced</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84ASv7_","number":674,"author":{"login":"sewmiuraj"},"title":"S3 module upgrade fails with AccessControlListNotSupported when bucket_ownership is set to BucketOwnerEnforced","body":"\r\nHello,\r\n\r\nI am currently upgrading my S3 modules to v.0.95.1. In this version, it is shown in the plan that it wishes to create an acl:\r\n\r\n```\r\n# module.s3_bucket_primary.aws_s3_bucket_acl.bucket[0] will be created\r\n  + resource \"aws_s3_bucket_acl\" \"bucket\" {\r\n      + acl    = \"private\"\r\n      + bucket = \"xxx\"\r\n      + id     = (known after apply)\r\n\r\n      + access_control_policy {\r\n          + grant {\r\n              + permission = (known after apply)\r\n\r\n              + grantee {\r\n                  + display_name  = (known after apply)\r\n                  + email_address = (known after apply)\r\n                  + id            = (known after apply)\r\n                  + type          = (known after apply)\r\n                  + uri           = (known after apply)\r\n                }\r\n            }\r\n\r\n          + owner {\r\n              + display_name = (known after apply)\r\n              + id           = (known after apply)\r\n            }\r\n        }\r\n    }\r\n```\r\n\r\nHowever, upon apply I am recieving the error:\r\n\r\n`Error: error creating S3 bucket ACL for xxx: AccessControlListNotSupported: The bucket does not allow ACLs.`\r\n\r\nThis is probably because we have set: `bucket_ownership = \"BucketOwnerEnforced\"`\r\n\r\nIs there a way for me to not create this acl by default when bucket ownership is set to BucketOwnerEnforced?\r\n\r\n\r\n\r\n---\r\n\r\n<ins datetime=\"2023-03-01T16:00:08Z\">\r\n  <p><a href=\"https://support.gruntwork.io/hc/requests/109942\">Tracked in ticket #109942</a></p>\r\n</ins>\r\n","bodyHTML":"<p dir=\"auto\">Hello,</p>\n<p dir=\"auto\">I am currently upgrading my S3 modules to v.0.95.1. In this version, it is shown in the plan that it wishes to create an acl:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"# module.s3_bucket_primary.aws_s3_bucket_acl.bucket[0] will be created\n  + resource &quot;aws_s3_bucket_acl&quot; &quot;bucket&quot; {\n      + acl    = &quot;private&quot;\n      + bucket = &quot;xxx&quot;\n      + id     = (known after apply)\n\n      + access_control_policy {\n          + grant {\n              + permission = (known after apply)\n\n              + grantee {\n                  + display_name  = (known after apply)\n                  + email_address = (known after apply)\n                  + id            = (known after apply)\n                  + type          = (known after apply)\n                  + uri           = (known after apply)\n                }\n            }\n\n          + owner {\n              + display_name = (known after apply)\n              + id           = (known after apply)\n            }\n        }\n    }\"><pre class=\"notranslate\"><code class=\"notranslate\"># module.s3_bucket_primary.aws_s3_bucket_acl.bucket[0] will be created\n  + resource \"aws_s3_bucket_acl\" \"bucket\" {\n      + acl    = \"private\"\n      + bucket = \"xxx\"\n      + id     = (known after apply)\n\n      + access_control_policy {\n          + grant {\n              + permission = (known after apply)\n\n              + grantee {\n                  + display_name  = (known after apply)\n                  + email_address = (known after apply)\n                  + id            = (known after apply)\n                  + type          = (known after apply)\n                  + uri           = (known after apply)\n                }\n            }\n\n          + owner {\n              + display_name = (known after apply)\n              + id           = (known after apply)\n            }\n        }\n    }\n</code></pre></div>\n<p dir=\"auto\">However, upon apply I am recieving the error:</p>\n<p dir=\"auto\"><code class=\"notranslate\">Error: error creating S3 bucket ACL for xxx: AccessControlListNotSupported: The bucket does not allow ACLs.</code></p>\n<p dir=\"auto\">This is probably because we have set: <code class=\"notranslate\">bucket_ownership = \"BucketOwnerEnforced\"</code></p>\n<p dir=\"auto\">Is there a way for me to not create this acl by default when bucket ownership is set to BucketOwnerEnforced?</p>\n<hr>\n<ins datetime=\"2023-03-01T16:00:08Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/109942\" rel=\"nofollow\">Tracked in ticket #109942</a></p>\n</ins>","answer":{"body":"Hi [sewmiuraj](https://github.com/sewmiuraj), it seems that the child module [`private-s3-bucket`](https://github.com/gruntwork-io/terraform-aws-security/tree/main/modules/private-s3-bucket) has a [`var.acl`](https://github.com/gruntwork-io/terraform-aws-security/blob/fc70a8a7025e545f59b491515de5a963240efbea/modules/private-s3-bucket/variables.tf#L15) variable that can be set to `null`. This variable doesn't seem to be exposed in the service catalog yet. I'll see if I have the time to spin a PR to address this, but you could also try, in the meantime, modifying the module to pass acl as null.","bodyHTML":"<p dir=\"auto\">Hi <a href=\"https://github.com/sewmiuraj\">sewmiuraj</a>, it seems that the child module <a href=\"https://github.com/gruntwork-io/terraform-aws-security/tree/main/modules/private-s3-bucket\"><code class=\"notranslate\">private-s3-bucket</code></a> has a <a href=\"https://github.com/gruntwork-io/terraform-aws-security/blob/fc70a8a7025e545f59b491515de5a963240efbea/modules/private-s3-bucket/variables.tf#L15\"><code class=\"notranslate\">var.acl</code></a> variable that can be set to <code class=\"notranslate\">null</code>. This variable doesn't seem to be exposed in the service catalog yet. I'll see if I have the time to spin a PR to address this, but you could also try, in the meantime, modifying the module to pass acl as null.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "10c38146f6c3ecddae5784c56dcb1115"
}
##DOCS-SOURCER-END -->
