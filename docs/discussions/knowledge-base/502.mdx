---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/502" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Upgrading Aurora MySQL with minimal downtime</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AQFAQ","number":502,"author":{"login":"erictompkins"},"title":"Upgrading Aurora MySQL with minimal downtime","body":"\r\nWe currently have an Aurora RDS cluster with read and write instances. ([r:terraform-aws-data-storage](https://github.com/gruntwork-io/terraform-aws-data-storage))\r\n\r\n<img width=\"983\" alt=\"image\" src=\"https://user-images.githubusercontent.com/4851312/178852113-6bd99370-dc0f-4b95-b07f-1e0fac4cff21.png\">\r\n\r\nWe need to upgrade the Aurora version and also the instance size. My understanding is that both of those updates require downtime. Is that correct?\r\n\r\nCurrently, the engine version is `5.6.mysql_aurora.1.22.2`.  We do have Multi-AZ enabled with 2 zones.\r\n\r\n![CleanShot 2022-07-13 at 19 10 46@2x](https://user-images.githubusercontent.com/4851312/178852325-6bfbdb9b-9e8e-418c-8ff9-cbd47de943f1.png)\r\n\r\n\r\nDo you have any recommendations to do an upgrade with minimal downtime?\r\n\r\nI've done some research and doing a blue/green deployment may be a good way, but I'm not sure if that's the best way and how to set that up with Terraform.\r\n\r\nDev ops is not my primary function (we're a very small team) so any recommendations are welcomed. Thank you.\r\n\r\n---\r\n\r\n<ins datetime=\"2022-07-13T23:11:49Z\">\r\n  <p><a href=\"https://support.gruntwork.io/hc/requests/108982\">Tracked in ticket #108982</a></p>\r\n</ins>\r\n","bodyHTML":"<p dir=\"auto\">We currently have an Aurora RDS cluster with read and write instances. (<a href=\"https://github.com/gruntwork-io/terraform-aws-data-storage\">r:terraform-aws-data-storage</a>)</p>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/4851312/178852113-6bd99370-dc0f-4b95-b07f-1e0fac4cff21.png\"><img width=\"983\" alt=\"image\" src=\"https://user-images.githubusercontent.com/4851312/178852113-6bd99370-dc0f-4b95-b07f-1e0fac4cff21.png\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\">We need to upgrade the Aurora version and also the instance size. My understanding is that both of those updates require downtime. Is that correct?</p>\n<p dir=\"auto\">Currently, the engine version is <code class=\"notranslate\">5.6.mysql_aurora.1.22.2</code>.  We do have Multi-AZ enabled with 2 zones.</p>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/4851312/178852325-6bfbdb9b-9e8e-418c-8ff9-cbd47de943f1.png\"><img src=\"https://user-images.githubusercontent.com/4851312/178852325-6bfbdb9b-9e8e-418c-8ff9-cbd47de943f1.png\" alt=\"CleanShot 2022-07-13 at 19 10 46@2x\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\">Do you have any recommendations to do an upgrade with minimal downtime?</p>\n<p dir=\"auto\">I've done some research and doing a blue/green deployment may be a good way, but I'm not sure if that's the best way and how to set that up with Terraform.</p>\n<p dir=\"auto\">Dev ops is not my primary function (we're a very small team) so any recommendations are welcomed. Thank you.</p>\n<hr>\n<ins datetime=\"2022-07-13T23:11:49Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/108982\" rel=\"nofollow\">Tracked in ticket #108982</a></p>\n</ins>","answer":{"body":"Note, whatever you do, always schedule a maintenance window for this work, and let everyone know about the window. Minimal downtime is still downtime, and things can always go wrong.\r\n\r\nSome important resources:\r\n\r\n- https://aws.amazon.com/blogs/database/performing-major-version-upgrades-for-amazon-aurora-mysql-with-minimum-downtime/\r\n- https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_UpgradeDBInstance.Upgrading.html\r\n- https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/AuroraMySQL.Updates.MajorVersionUpgrade.html#AuroraMySQL.Upgrading.Compatibility\r\n\r\nAt `xlarge`, you're looking at several hours of downtime.\r\n\r\nWhether you do this update in place, or a blue/green deployment, the in-place and the green deployment can be upgraded the same way: \r\n- Change the `engine_version` number in your terragrunt/terraform configuration and run `terragrunt apply` or `terraform apply`. \r\n- For the instance type, change the `instance_type` or `instance_class` configuration (our `rds` module names this variable `instance_type`, but the resource calls it `instance_class` internally). You can do these both in the same changeset for the a single `apply`.\r\n- Some links to our module code: [aurora](https://github.com/gruntwork-io/terraform-aws-data-storage/blob/master/modules/aurora/main.tf#L298-L301) and [rds](https://github.com/gruntwork-io/terraform-aws-data-storage/blob/master/modules/rds/main.tf#L141-L144)\r\n\r\nIf you can afford it, blue/green deployment is the better choice. You should still plan for the minimal downtime which exists in blue/green deployment, during the switch over. Note that a lot of resources out there say that updating just the instance type (if you wanted to do the version and instance type as separate upgrade steps) is a zero downtime upgrade on Aurora RDS with multi-AZ setup. But this is not true. People still report downtime of 10 - 20 minutes. So my take is that if you're going to update both version and instance type, might as well do them together.\r\n\r\nSetting up the green environment replica can be done without using ClickOps as well. If you're familiar enough with the module code that currently manages your RDS cluster, you'd make a copy of that, put it in a new folder. If you're using our `infrastructure-live` folder structure, you would choose which account/region/environment it belongs in. If you're using our Gruntwork Pipelines (which comes with the Reference Architecture) you can push this new folder to your repo, have your CI pick up the change and run apply for you (with your approval). But you can instead opt to run `apply` locally, authing from your machine to AWS, from that folder. This might lock up your machine, which can be a downside. The plan should show what it will create. Once it's up, update the configuration and apply it. Then wait for the instances to be available. _This is where I'm not sure--your local machine might be locked up running this apply process for the full duration of the upgrade!_ When you're ready to destroy, run `destroy` manually from the original folder where the blue environment configuration is.","bodyHTML":"<p dir=\"auto\">Note, whatever you do, always schedule a maintenance window for this work, and let everyone know about the window. Minimal downtime is still downtime, and things can always go wrong.</p>\n<p dir=\"auto\">Some important resources:</p>\n<ul dir=\"auto\">\n<li><a href=\"https://aws.amazon.com/blogs/database/performing-major-version-upgrades-for-amazon-aurora-mysql-with-minimum-downtime/\" rel=\"nofollow\">https://aws.amazon.com/blogs/database/performing-major-version-upgrades-for-amazon-aurora-mysql-with-minimum-downtime/</a></li>\n<li><a href=\"https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_UpgradeDBInstance.Upgrading.html\" rel=\"nofollow\">https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_UpgradeDBInstance.Upgrading.html</a></li>\n<li><a href=\"https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/AuroraMySQL.Updates.MajorVersionUpgrade.html#AuroraMySQL.Upgrading.Compatibility\" rel=\"nofollow\">https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/AuroraMySQL.Updates.MajorVersionUpgrade.html#AuroraMySQL.Upgrading.Compatibility</a></li>\n</ul>\n<p dir=\"auto\">At <code class=\"notranslate\">xlarge</code>, you're looking at several hours of downtime.</p>\n<p dir=\"auto\">Whether you do this update in place, or a blue/green deployment, the in-place and the green deployment can be upgraded the same way:</p>\n<ul dir=\"auto\">\n<li>Change the <code class=\"notranslate\">engine_version</code> number in your terragrunt/terraform configuration and run <code class=\"notranslate\">terragrunt apply</code> or <code class=\"notranslate\">terraform apply</code>.</li>\n<li>For the instance type, change the <code class=\"notranslate\">instance_type</code> or <code class=\"notranslate\">instance_class</code> configuration (our <code class=\"notranslate\">rds</code> module names this variable <code class=\"notranslate\">instance_type</code>, but the resource calls it <code class=\"notranslate\">instance_class</code> internally). You can do these both in the same changeset for the a single <code class=\"notranslate\">apply</code>.</li>\n<li>Some links to our module code: <a href=\"https://github.com/gruntwork-io/terraform-aws-data-storage/blob/master/modules/aurora/main.tf#L298-L301\">aurora</a> and <a href=\"https://github.com/gruntwork-io/terraform-aws-data-storage/blob/master/modules/rds/main.tf#L141-L144\">rds</a></li>\n</ul>\n<p dir=\"auto\">If you can afford it, blue/green deployment is the better choice. You should still plan for the minimal downtime which exists in blue/green deployment, during the switch over. Note that a lot of resources out there say that updating just the instance type (if you wanted to do the version and instance type as separate upgrade steps) is a zero downtime upgrade on Aurora RDS with multi-AZ setup. But this is not true. People still report downtime of 10 - 20 minutes. So my take is that if you're going to update both version and instance type, might as well do them together.</p>\n<p dir=\"auto\">Setting up the green environment replica can be done without using ClickOps as well. If you're familiar enough with the module code that currently manages your RDS cluster, you'd make a copy of that, put it in a new folder. If you're using our <code class=\"notranslate\">infrastructure-live</code> folder structure, you would choose which account/region/environment it belongs in. If you're using our Gruntwork Pipelines (which comes with the Reference Architecture) you can push this new folder to your repo, have your CI pick up the change and run apply for you (with your approval). But you can instead opt to run <code class=\"notranslate\">apply</code> locally, authing from your machine to AWS, from that folder. This might lock up your machine, which can be a downside. The plan should show what it will create. Once it's up, update the configuration and apply it. Then wait for the instances to be available. <em>This is where I'm not sure--your local machine might be locked up running this apply process for the full duration of the upgrade!</em> When you're ready to destroy, run <code class=\"notranslate\">destroy</code> manually from the original folder where the blue environment configuration is.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "055b3a3998cd556b601a36aafe5ae6f5"
}
##DOCS-SOURCER-END -->
