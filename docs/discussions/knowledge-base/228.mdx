---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/228" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Elastic Deploy Runner: Error: main is not a supported Git Ref for running apply</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AO5sM","number":228,"author":{"login":"zackproser"},"title":"Elastic Deploy Runner: Error: main is not a supported Git Ref for running apply","body":"A customer asked: \r\n> I was setting up the CI workflow on GitHub for my new Ref Arch and got this error: \r\n```\r\n[infrastructure-deploy-script] 2022-02-24 22:23:03  Running command \"git config --global url.https://bitbucket.org/.insteadOf [git@bitbucket.org](mailto:git@bitbucket.org):\"\r\n[33](https://github.com/variational-research/infrastructure-live/runs/5326010392?check_suite_focus=true#step:12:33)\r\n[ecs-deploy-runner][2022-02-24T22:23:03+0000] Error: main is not a supported Git Ref for running apply\r\n[34](https://github.com/variational-research/infrastructure-live/runs/5326010392?check_suite_focus=true#step:12:34)\r\n[ecs-deploy-runner][2022-02-24T22:23:03+0000] exit status 1\r\n```\r\n\r\n","bodyHTML":"<p dir=\"auto\">A customer asked:</p>\n<blockquote>\n<p dir=\"auto\">I was setting up the CI workflow on GitHub for my new Ref Arch and got this error:</p>\n</blockquote>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"[infrastructure-deploy-script] 2022-02-24 22:23:03  Running command &quot;git config --global url.https://bitbucket.org/.insteadOf [git@bitbucket.org](mailto:git@bitbucket.org):&quot;\n[33](https://github.com/variational-research/infrastructure-live/runs/5326010392?check_suite_focus=true#step:12:33)\n[ecs-deploy-runner][2022-02-24T22:23:03+0000] Error: main is not a supported Git Ref for running apply\n[34](https://github.com/variational-research/infrastructure-live/runs/5326010392?check_suite_focus=true#step:12:34)\n[ecs-deploy-runner][2022-02-24T22:23:03+0000] exit status 1\"><pre class=\"notranslate\"><code class=\"notranslate\">[infrastructure-deploy-script] 2022-02-24 22:23:03  Running command \"git config --global url.https://bitbucket.org/.insteadOf [git@bitbucket.org](mailto:git@bitbucket.org):\"\n[33](https://github.com/variational-research/infrastructure-live/runs/5326010392?check_suite_focus=true#step:12:33)\n[ecs-deploy-runner][2022-02-24T22:23:03+0000] Error: main is not a supported Git Ref for running apply\n[34](https://github.com/variational-research/infrastructure-live/runs/5326010392?check_suite_focus=true#step:12:34)\n[ecs-deploy-runner][2022-02-24T22:23:03+0000] exit status 1\n</code></pre></div>","answer":{"body":"For this particular case, the issue is indeed that the deploy runner is configured to expect `master` based on the form input, and there is a bug in our scripts where it generated the GitHub Actions expecting `main`.\r\n\r\nMy recommendation would be to switch your main git branch to using `master` by creating a new branch off of `main` and pushing that as the default branch for your repo. Once you do that, you will want to make sure the GitHub Actions code is updated to use `master` instead of `main`.\r\n\r\nAlternatively, if you wish to continue using main, you can update the allowed apply refs from master to main for the ecs-deploy-runner here:  `https://github.com/gruntwork-clients/infrastructure-live-<your-company-name>/blob/main/_envcommon/mgmt/ecs-deploy-runner.hcl`\r\n\r\nNote that the latter requires deploying the `ecs-deploy-runner` module in each account to take effect.\r\n\r\n","bodyHTML":"<p dir=\"auto\">For this particular case, the issue is indeed that the deploy runner is configured to expect <code class=\"notranslate\">master</code> based on the form input, and there is a bug in our scripts where it generated the GitHub Actions expecting <code class=\"notranslate\">main</code>.</p>\n<p dir=\"auto\">My recommendation would be to switch your main git branch to using <code class=\"notranslate\">master</code> by creating a new branch off of <code class=\"notranslate\">main</code> and pushing that as the default branch for your repo. Once you do that, you will want to make sure the GitHub Actions code is updated to use <code class=\"notranslate\">master</code> instead of <code class=\"notranslate\">main</code>.</p>\n<p dir=\"auto\">Alternatively, if you wish to continue using main, you can update the allowed apply refs from master to main for the ecs-deploy-runner here:  <code class=\"notranslate\">https://github.com/gruntwork-clients/infrastructure-live-&lt;your-company-name&gt;/blob/main/_envcommon/mgmt/ecs-deploy-runner.hcl</code></p>\n<p dir=\"auto\">Note that the latter requires deploying the <code class=\"notranslate\">ecs-deploy-runner</code> module in each account to take effect.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "76cc6f32c55c82d515019ec49218c765"
}
##DOCS-SOURCER-END -->
