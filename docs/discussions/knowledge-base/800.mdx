---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/800" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>How do you do blue/green deployments, rolling deployments, and canary deployments with Terraform?</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AXaWG","number":800,"author":{"login":"brikis98"},"title":"How do you do blue/green deployments, rolling deployments, and canary deployments with Terraform?","body":"\r\n_This is a question we got from a customer. I'll share our recommendation below._\r\n\r\nHow can I use Terraform to do blue/green deployments, rolling deployments, and canary deployments? How would I integrate this sort of thing into my CI / CD pipelines?\r\n\r\n\r\n\r\n---\r\n\r\n<ins datetime=\"2024-01-26T21:28:25Z\">\r\n  <p><a href=\"https://support.gruntwork.io/hc/requests/110721\">Tracked in ticket #110721</a></p>\r\n</ins>\r\n","bodyHTML":"<p dir=\"auto\"><em>This is a question we got from a customer. I'll share our recommendation below.</em></p>\n<p dir=\"auto\">How can I use Terraform to do blue/green deployments, rolling deployments, and canary deployments? How would I integrate this sort of thing into my CI / CD pipelines?</p>\n<hr>\n<ins datetime=\"2024-01-26T21:28:25Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/110721\" rel=\"nofollow\">Tracked in ticket #110721</a></p>\n</ins>","answer":{"body":"As discussed in [How to use Terraform as a Team](https://blog.gruntwork.io/how-to-use-terraform-as-a-team-251bc1104973), Terraform does _not_ have support built into the _language_ or its standard _workflows_ for deployment strategies such as blue/green deployment, rolling deployment, or canary deployments. However, depending on what you're deploying, there are several ways to accomplish these deployment strategies:\r\n\r\n# Option 1: deployment strategies built into specific resources/services\r\n\r\nSome of the services that you manage with Terraform may natively support various deployment strategies if you configure the corresponding Terraform resources correctly. Here are a few examples:\r\n\r\n- **EKS/K8S**: Kubernetes has built-in support for rolling deployments using the [`Deployment` object](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#updating-a-deployment). Whenever you update a `Deployment`, Kubernetes automatically rolls out the changes by deploying new Pods, waiting for them to come up, and then undeploying the old Pods. So if you're using a Terraform module to manage your Kubernetes `Deployment`, such as the [`kubernetes-service` module](https://docs.gruntwork.io/reference/services/app-orchestration/kubernetes-service/), you get zero-downtime rolling deployment automatically any time you make a change and run `apply`. The `kubernetes-service` module also supports canary deployments by using the [`canary_image`](https://docs.gruntwork.io/reference/services/app-orchestration/kubernetes-service/#canary_image) and [`desired_number_of_canary_pods`](https://docs.gruntwork.io/reference/services/app-orchestration/kubernetes-service/#desired_number_of_canary_pods) parameters.\r\n- **ECS**: ECS also has built-in support for rolling deployment. If you manage your ECS services with a Terraform module, such as the [`ecs-service` module](https://docs.gruntwork.io/reference/modules/terraform-aws-ecs/ecs-service), then you can configure the rolling deployment using the [`deployment_maximum_percent`](https://docs.gruntwork.io/reference/modules/terraform-aws-ecs/ecs-service/#deployment_maximum_percent) and [`deployment_minimum_healthy_percent`](https://docs.gruntwork.io/reference/modules/terraform-aws-ecs/ecs-service/#deployment_minimum_healthy_percent) parameters: e.g., if you set `deployment_maximum_percent` to `200`, and you have 3 tasks running, then when you update your service configuration and run `apply`, ECS will spin up 3 new tasks, wait for them to be healthy, and will then tear down the 3 old tasks. The `ecs-service` module also supports canary deployments using the [`desired_number_of_canary_tasks_to_run`](https://docs.gruntwork.io/reference/modules/terraform-aws-ecs/ecs-service/#desired_number_of_canary_tasks_to_run) and [`ecs_task_definition_canary`](https://docs.gruntwork.io/reference/modules/terraform-aws-ecs/ecs-service/#ecs_task_definition_canary) parameters.\r\n- **EC2/ASG**: AWS supports rolling deployments for EC2 instances in Auto Scaling Groups (ASG) using [instance refresh](https://docs.aws.amazon.com/autoscaling/ec2/userguide/asg-instance-refresh.html). If you manage your EC2 instances using a Terraform module, such as the [`asg-instance-refresh` module](https://docs.gruntwork.io/reference/modules/terraform-aws-asg/asg-instance-refresh/), every time you make a change and run `apply`, AWS will automatically spin up a new ASG, wait for it to be healthy, and then tear down the old ASG.\r\n\r\n# Option 2: implement deployment strategies in custom scripts\r\n\r\nNot all Terraform resources have built-in deployment strategies (in fact, _most_ don't) or if they have them, they might not support the deployment strategy you want. In some cases, there's nothing you can do about it: e.g., you can't really do a blue/green deployment for a VPC route table update; either you update it, or you don't. \r\n\r\nFor some resources, you can implement the deployment strategy yourself using custom scripts. Here are a few examples:\r\n\r\n- **EKS/K8S**: To do a rolling deployment on the _worker nodes_ of an EKS cluster, we implemented an [`eks deploy` command in our open source CLI tool `kubergrunt`](https://github.com/gruntwork-io/kubergrunt?tab=readme-ov-file#deploy).\r\n- **ECS**: To do a rolling deployment on the EC2 instances in an ECS cluster, we implemented a [`roll-out-ecs-cluster-update.py` script](https://docs.gruntwork.io/reference/modules/terraform-aws-ecs/ecs-cluster/#how-do-you-make-changes-to-the-ec2-instances-in-the-cluster). _Note: ECS just recently added support for [managed instance draining](https://aws.amazon.com/about-aws/whats-new/2024/01/amazon-ecs-managed-instance-draining/), so we may be able to replace this script with native resource support soon!_\r\n\r\n# Option 3: use tools other than Terraform\r\n\r\nWhile Terraform is a great fit for managing your _infrastructure_, for managing the _apps_ that run on top of that infrastructure, dedicated tools can sometimes be a better fit. \r\n\r\n- **EKS/K8S**: If you install the [Argo Rollouts controller](https://argo-rollouts.readthedocs.io/en/stable/) in your Kubernetes cluster, you can use the [`rollout` object](https://argo-rollouts.readthedocs.io/en/stable/features/specification/) to do a blue/green deployment by configuring the [`BlueGreen` rollout strategy](https://argo-rollouts.readthedocs.io/en/stable/features/bluegreen/). Combined with [ArgoCD](https://argo-cd.readthedocs.io/en/stable/), which you can install using the [`eks-k8s-argocd` module](https://docs.gruntwork.io/reference/modules/terraform-aws-eks/eks-k8s-argocd/), this can be a way to get blue/green deployments for your Kubernetes services. ","bodyHTML":"<p dir=\"auto\">As discussed in <a href=\"https://blog.gruntwork.io/how-to-use-terraform-as-a-team-251bc1104973\" rel=\"nofollow\">How to use Terraform as a Team</a>, Terraform does <em>not</em> have support built into the <em>language</em> or its standard <em>workflows</em> for deployment strategies such as blue/green deployment, rolling deployment, or canary deployments. However, depending on what you're deploying, there are several ways to accomplish these deployment strategies:</p>\n<h1 dir=\"auto\">Option 1: deployment strategies built into specific resources/services</h1>\n<p dir=\"auto\">Some of the services that you manage with Terraform may natively support various deployment strategies if you configure the corresponding Terraform resources correctly. Here are a few examples:</p>\n<ul dir=\"auto\">\n<li><strong>EKS/K8S</strong>: Kubernetes has built-in support for rolling deployments using the <a href=\"https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#updating-a-deployment\" rel=\"nofollow\"><code class=\"notranslate\">Deployment</code> object</a>. Whenever you update a <code class=\"notranslate\">Deployment</code>, Kubernetes automatically rolls out the changes by deploying new Pods, waiting for them to come up, and then undeploying the old Pods. So if you're using a Terraform module to manage your Kubernetes <code class=\"notranslate\">Deployment</code>, such as the <a href=\"https://docs.gruntwork.io/reference/services/app-orchestration/kubernetes-service/\" rel=\"nofollow\"><code class=\"notranslate\">kubernetes-service</code> module</a>, you get zero-downtime rolling deployment automatically any time you make a change and run <code class=\"notranslate\">apply</code>. The <code class=\"notranslate\">kubernetes-service</code> module also supports canary deployments by using the <a href=\"https://docs.gruntwork.io/reference/services/app-orchestration/kubernetes-service/#canary_image\" rel=\"nofollow\"><code class=\"notranslate\">canary_image</code></a> and <a href=\"https://docs.gruntwork.io/reference/services/app-orchestration/kubernetes-service/#desired_number_of_canary_pods\" rel=\"nofollow\"><code class=\"notranslate\">desired_number_of_canary_pods</code></a> parameters.</li>\n<li><strong>ECS</strong>: ECS also has built-in support for rolling deployment. If you manage your ECS services with a Terraform module, such as the <a href=\"https://docs.gruntwork.io/reference/modules/terraform-aws-ecs/ecs-service\" rel=\"nofollow\"><code class=\"notranslate\">ecs-service</code> module</a>, then you can configure the rolling deployment using the <a href=\"https://docs.gruntwork.io/reference/modules/terraform-aws-ecs/ecs-service/#deployment_maximum_percent\" rel=\"nofollow\"><code class=\"notranslate\">deployment_maximum_percent</code></a> and <a href=\"https://docs.gruntwork.io/reference/modules/terraform-aws-ecs/ecs-service/#deployment_minimum_healthy_percent\" rel=\"nofollow\"><code class=\"notranslate\">deployment_minimum_healthy_percent</code></a> parameters: e.g., if you set <code class=\"notranslate\">deployment_maximum_percent</code> to <code class=\"notranslate\">200</code>, and you have 3 tasks running, then when you update your service configuration and run <code class=\"notranslate\">apply</code>, ECS will spin up 3 new tasks, wait for them to be healthy, and will then tear down the 3 old tasks. The <code class=\"notranslate\">ecs-service</code> module also supports canary deployments using the <a href=\"https://docs.gruntwork.io/reference/modules/terraform-aws-ecs/ecs-service/#desired_number_of_canary_tasks_to_run\" rel=\"nofollow\"><code class=\"notranslate\">desired_number_of_canary_tasks_to_run</code></a> and <a href=\"https://docs.gruntwork.io/reference/modules/terraform-aws-ecs/ecs-service/#ecs_task_definition_canary\" rel=\"nofollow\"><code class=\"notranslate\">ecs_task_definition_canary</code></a> parameters.</li>\n<li><strong>EC2/ASG</strong>: AWS supports rolling deployments for EC2 instances in Auto Scaling Groups (ASG) using <a href=\"https://docs.aws.amazon.com/autoscaling/ec2/userguide/asg-instance-refresh.html\" rel=\"nofollow\">instance refresh</a>. If you manage your EC2 instances using a Terraform module, such as the <a href=\"https://docs.gruntwork.io/reference/modules/terraform-aws-asg/asg-instance-refresh/\" rel=\"nofollow\"><code class=\"notranslate\">asg-instance-refresh</code> module</a>, every time you make a change and run <code class=\"notranslate\">apply</code>, AWS will automatically spin up a new ASG, wait for it to be healthy, and then tear down the old ASG.</li>\n</ul>\n<h1 dir=\"auto\">Option 2: implement deployment strategies in custom scripts</h1>\n<p dir=\"auto\">Not all Terraform resources have built-in deployment strategies (in fact, <em>most</em> don't) or if they have them, they might not support the deployment strategy you want. In some cases, there's nothing you can do about it: e.g., you can't really do a blue/green deployment for a VPC route table update; either you update it, or you don't.</p>\n<p dir=\"auto\">For some resources, you can implement the deployment strategy yourself using custom scripts. Here are a few examples:</p>\n<ul dir=\"auto\">\n<li><strong>EKS/K8S</strong>: To do a rolling deployment on the <em>worker nodes</em> of an EKS cluster, we implemented an <a href=\"https://github.com/gruntwork-io/kubergrunt?tab=readme-ov-file#deploy\"><code class=\"notranslate\">eks deploy</code> command in our open source CLI tool <code class=\"notranslate\">kubergrunt</code></a>.</li>\n<li><strong>ECS</strong>: To do a rolling deployment on the EC2 instances in an ECS cluster, we implemented a <a href=\"https://docs.gruntwork.io/reference/modules/terraform-aws-ecs/ecs-cluster/#how-do-you-make-changes-to-the-ec2-instances-in-the-cluster\" rel=\"nofollow\"><code class=\"notranslate\">roll-out-ecs-cluster-update.py</code> script</a>. <em>Note: ECS just recently added support for <a href=\"https://aws.amazon.com/about-aws/whats-new/2024/01/amazon-ecs-managed-instance-draining/\" rel=\"nofollow\">managed instance draining</a>, so we may be able to replace this script with native resource support soon!</em></li>\n</ul>\n<h1 dir=\"auto\">Option 3: use tools other than Terraform</h1>\n<p dir=\"auto\">While Terraform is a great fit for managing your <em>infrastructure</em>, for managing the <em>apps</em> that run on top of that infrastructure, dedicated tools can sometimes be a better fit.</p>\n<ul dir=\"auto\">\n<li><strong>EKS/K8S</strong>: If you install the <a href=\"https://argo-rollouts.readthedocs.io/en/stable/\" rel=\"nofollow\">Argo Rollouts controller</a> in your Kubernetes cluster, you can use the <a href=\"https://argo-rollouts.readthedocs.io/en/stable/features/specification/\" rel=\"nofollow\"><code class=\"notranslate\">rollout</code> object</a> to do a blue/green deployment by configuring the <a href=\"https://argo-rollouts.readthedocs.io/en/stable/features/bluegreen/\" rel=\"nofollow\"><code class=\"notranslate\">BlueGreen</code> rollout strategy</a>. Combined with <a href=\"https://argo-cd.readthedocs.io/en/stable/\" rel=\"nofollow\">ArgoCD</a>, which you can install using the <a href=\"https://docs.gruntwork.io/reference/modules/terraform-aws-eks/eks-k8s-argocd/\" rel=\"nofollow\"><code class=\"notranslate\">eks-k8s-argocd</code> module</a>, this can be a way to get blue/green deployments for your Kubernetes services.</li>\n</ul>"}}} />

</CenterLayout>
  

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "674527313f9bc184cf137d7aad22ff22"
}
##DOCS-SOURCER-END -->
