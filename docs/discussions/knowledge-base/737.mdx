---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/737" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Automatically create S3 backend bucket from pipeline</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84AUM7U","number":737,"author":{"login":"gberlot-luna"},"title":"Automatically create S3 backend bucket from pipeline","body":"\nI'm running a new plan on a dev branch that will create a new VPC in another region using the github action pipeline. I notice that isn't able to create the corresponding S3 bucket and the plan failed.  Should I have to run terragrunt init manually on that resource in order to get the bucket created ? See log below:\r\n.\r\n.\r\n[ecs-deploy-runner][2023-06-13T21:42:20+0000] [INFO] [infrastructure-deploy-script] 2023-06-13 21:42:20  Running command \"terragrunt plan -input=false\"\r\n[ecs-deploy-runner][2023-06-13T21:42:23+0000] Remote state S3 bucket lunasolutions-dev-us-east-2-tf-state does not exist or you don't have permissions to access it. Would you like Terragrunt to create it? (y/n) time=2023-06-13T21:42:23Z level=error msg=EOF\r\n[ecs-deploy-runner][2023-06-13T21:42:23+0000] time=2023-06-13T21:42:23Z level=error msg=Unable to determine underlying exit code, so Terragrunt will exit with error code 1\r\n[ecs-deploy-runner][2023-06-13T21:42:23+0000] [INFO] [infrastructure-deploy-script] 2023-06-13 21:42:23  \"terragrunt plan\" exited with code 1\r\n[ecs-deploy-runner][2023-06-13T21:42:23+0000] Error: Could not run \"terragrunt plan\". Error=Remote state S3 bucket lunasolutions-dev-us-east-2-tf-state does not exist or you don't have permissions to access it. Would you like Terragrunt to create it? (y/n) time=2023-06-13T21:42:23Z level=error msg=EOF\r\n[ecs-deploy-runner][2023-06-13T21:42:23+0000] time=2023-06-13T21:42:23Z level=error msg=Unable to determine underlying exit code, so Terragrunt will exit with error code 1\r\n[ecs-deploy-runner][2023-06-13T21:42:23+0000] exit status 1\r\n.\r\n.\r\nPlease, advice.\n\n---\n\n<ins datetime=\"2023-06-13T22:06:29Z\">\n  <p><a href=\"https://support.gruntwork.io/hc/requests/110254\">Tracked in ticket #110254</a></p>\n</ins>\n","bodyHTML":"<p dir=\"auto\">I'm running a new plan on a dev branch that will create a new VPC in another region using the github action pipeline. I notice that isn't able to create the corresponding S3 bucket and the plan failed.  Should I have to run terragrunt init manually on that resource in order to get the bucket created ? See log below:<br>\n.<br>\n.<br>\n[ecs-deploy-runner][2023-06-13T21:42:20+0000] [INFO] [infrastructure-deploy-script] 2023-06-13 21:42:20  Running command \"terragrunt plan -input=false\"<br>\n[ecs-deploy-runner][2023-06-13T21:42:23+0000] Remote state S3 bucket lunasolutions-dev-us-east-2-tf-state does not exist or you don't have permissions to access it. Would you like Terragrunt to create it? (y/n) time=2023-06-13T21:42:23Z level=error msg=EOF<br>\n[ecs-deploy-runner][2023-06-13T21:42:23+0000] time=2023-06-13T21:42:23Z level=error msg=Unable to determine underlying exit code, so Terragrunt will exit with error code 1<br>\n[ecs-deploy-runner][2023-06-13T21:42:23+0000] [INFO] [infrastructure-deploy-script] 2023-06-13 21:42:23  \"terragrunt plan\" exited with code 1<br>\n[ecs-deploy-runner][2023-06-13T21:42:23+0000] Error: Could not run \"terragrunt plan\". Error=Remote state S3 bucket lunasolutions-dev-us-east-2-tf-state does not exist or you don't have permissions to access it. Would you like Terragrunt to create it? (y/n) time=2023-06-13T21:42:23Z level=error msg=EOF<br>\n[ecs-deploy-runner][2023-06-13T21:42:23+0000] time=2023-06-13T21:42:23Z level=error msg=Unable to determine underlying exit code, so Terragrunt will exit with error code 1<br>\n[ecs-deploy-runner][2023-06-13T21:42:23+0000] exit status 1<br>\n.<br>\n.<br>\nPlease, advice.</p>\n<hr>\n<ins datetime=\"2023-06-13T22:06:29Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/110254\" rel=\"nofollow\">Tracked in ticket #110254</a></p>\n</ins>","answer":{"body":"Ah, I think I understand what's happening @gberlot-luna. \r\n\r\nIt looks like your ecs-deploy-runner is on `v0.45.11`, this can be checked by looking at the `build_deploy_runner_image.sh` build arguments. Looking at your `infrastructure-live` repo I can see this being passed in: `--build-arg 'terragrunt_version=v0.45.11' \\` along with terraform version `1.1.9` from `--build-arg 'terraform_version=1.1.9' \\`\r\n\r\nWhat is likely happening is you deployed locally using `v0.36.0`, which is over a year old. This also explains the ACL error you were seeing (as this was fixed in terragrunt `v0.45.4`).\r\n\r\nTerragrunt state currently is expecting `v0.36.0` since that's what it was created with, but the ecs-deploy-runner is on a much newer version. If you update your local version of terragrunt to `v0.45.11` to match what the ecs-deploy-runner is using, along with your local version of terraform to `1.1.9` I suspect you will see the `out of date` error with the state bucket, and you'll be prompted to update it. Once you update it locally and let terragrunt update the state, you can try re-running the ecs-deploy-runner and it should hopefully work. \r\n\r\n\r\n","bodyHTML":"<p dir=\"auto\">Ah, I think I understand what's happening <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/gberlot-luna/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/gberlot-luna\">@gberlot-luna</a>.</p>\n<p dir=\"auto\">It looks like your ecs-deploy-runner is on <code class=\"notranslate\">v0.45.11</code>, this can be checked by looking at the <code class=\"notranslate\">build_deploy_runner_image.sh</code> build arguments. Looking at your <code class=\"notranslate\">infrastructure-live</code> repo I can see this being passed in: <code class=\"notranslate\">--build-arg 'terragrunt_version=v0.45.11' \\</code> along with terraform version <code class=\"notranslate\">1.1.9</code> from <code class=\"notranslate\">--build-arg 'terraform_version=1.1.9' \\</code></p>\n<p dir=\"auto\">What is likely happening is you deployed locally using <code class=\"notranslate\">v0.36.0</code>, which is over a year old. This also explains the ACL error you were seeing (as this was fixed in terragrunt <code class=\"notranslate\">v0.45.4</code>).</p>\n<p dir=\"auto\">Terragrunt state currently is expecting <code class=\"notranslate\">v0.36.0</code> since that's what it was created with, but the ecs-deploy-runner is on a much newer version. If you update your local version of terragrunt to <code class=\"notranslate\">v0.45.11</code> to match what the ecs-deploy-runner is using, along with your local version of terraform to <code class=\"notranslate\">1.1.9</code> I suspect you will see the <code class=\"notranslate\">out of date</code> error with the state bucket, and you'll be prompted to update it. Once you update it locally and let terragrunt update the state, you can try re-running the ecs-deploy-runner and it should hopefully work.</p>"}}} />

</CenterLayout>
  

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "aff3e81b817cbe759d94df624bca3963"
}
##DOCS-SOURCER-END -->
