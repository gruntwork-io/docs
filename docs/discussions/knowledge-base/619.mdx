---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/619" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>Reference Architecture - new users do not have access to setup MFA</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84ARy9T","number":619,"author":{"login":"drafie"},"title":"Reference Architecture - new users do not have access to setup MFA","body":"\r\nOur RA was just deployed, but I've run into a problem where new users including the IAM Security User do not have permission to setup MFA from the web console.   They are members of iam-user-self-mgmt, but when setting up an MFA device they receive this error: \r\n\r\nYou need permissions\r\nYou do not have the permission required to perform this operation. Ask your administrator to add permissions.\r\n\r\nUser xxxx is not authorized to perform: iam:CreateVirtualMFADevice on resource xxxxx: because no identity-based policy allows the iam:CreateVirtualMFADevice action.\r\n\r\nAm I taking the wrong steps to Assign MFA?  From the profile dropdown I am selecting Security Credentials and then under Multi-Factor Authentication I am clicking on Assign MFA Device.   I give the device a name and select Authenticator App, click Next and then I receive the error. \r\n\r\n\r\n---\r\n\r\n<ins datetime=\"2022-12-15T04:22:53Z\">\r\n  <p><a href=\"https://support.gruntwork.io/hc/requests/109730\">Tracked in ticket #109730</a></p>\r\n</ins>\r\n\r\nhttps://github.com/gruntwork-io/terraform-aws-security","bodyHTML":"<p dir=\"auto\">Our RA was just deployed, but I've run into a problem where new users including the IAM Security User do not have permission to setup MFA from the web console.   They are members of iam-user-self-mgmt, but when setting up an MFA device they receive this error:</p>\n<p dir=\"auto\">You need permissions<br>\nYou do not have the permission required to perform this operation. Ask your administrator to add permissions.</p>\n<p dir=\"auto\">User xxxx is not authorized to perform: iam:CreateVirtualMFADevice on resource xxxxx: because no identity-based policy allows the iam:CreateVirtualMFADevice action.</p>\n<p dir=\"auto\">Am I taking the wrong steps to Assign MFA?  From the profile dropdown I am selecting Security Credentials and then under Multi-Factor Authentication I am clicking on Assign MFA Device.   I give the device a name and select Authenticator App, click Next and then I receive the error.</p>\n<hr>\n<ins datetime=\"2022-12-15T04:22:53Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/109730\" rel=\"nofollow\">Tracked in ticket #109730</a></p>\n</ins>\n<p dir=\"auto\"><a href=\"https://github.com/gruntwork-io/terraform-aws-security\">https://github.com/gruntwork-io/terraform-aws-security</a></p>","answer":{"body":"This appears to be a result of the way the policy is written in the official security module. \r\n\r\nhttps://github.com/gruntwork-io/terraform-aws-security/blob/01900ebb91f0bdc29f5cc14a6d9d3dce817b92ea/modules/iam-policies/main.tf#L673\r\n\r\nThis policy is written as: \r\n\r\n            \"Resource\": [\r\n                \"arn:aws:iam::311698643943:user/${aws:username}\",\r\n                \"arn:aws:iam::311698643943:mfa/${aws:username}\"\r\n\r\nBut, I think it ought to be written as:\r\n\r\n            \"Resource\": [\r\n                \"arn:aws:iam::311698643943:user/${aws:username}\",\r\n                \"arn:aws:iam::311698643943:mfa/*\"\r\n\r\nOr the documentation should tell us the MFA Device must be named exactly the same as your username.  \r\n","bodyHTML":"<p dir=\"auto\">This appears to be a result of the way the policy is written in the official security module.</p>\n<p dir=\"auto\"><a href=\"https://github.com/gruntwork-io/terraform-aws-security/blob/01900ebb91f0bdc29f5cc14a6d9d3dce817b92ea/modules/iam-policies/main.tf#L673\">https://github.com/gruntwork-io/terraform-aws-security/blob/01900ebb91f0bdc29f5cc14a6d9d3dce817b92ea/modules/iam-policies/main.tf#L673</a></p>\n<p dir=\"auto\">This policy is written as:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"        &quot;Resource&quot;: [\n            &quot;arn:aws:iam::311698643943:user/${aws:username}&quot;,\n            &quot;arn:aws:iam::311698643943:mfa/${aws:username}&quot;\"><pre class=\"notranslate\"><code class=\"notranslate\">        \"Resource\": [\n            \"arn:aws:iam::311698643943:user/${aws:username}\",\n            \"arn:aws:iam::311698643943:mfa/${aws:username}\"\n</code></pre></div>\n<p dir=\"auto\">But, I think it ought to be written as:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"        &quot;Resource&quot;: [\n            &quot;arn:aws:iam::311698643943:user/${aws:username}&quot;,\n            &quot;arn:aws:iam::311698643943:mfa/*&quot;\"><pre class=\"notranslate\"><code class=\"notranslate\">        \"Resource\": [\n            \"arn:aws:iam::311698643943:user/${aws:username}\",\n            \"arn:aws:iam::311698643943:mfa/*\"\n</code></pre></div>\n<p dir=\"auto\">Or the documentation should tell us the MFA Device must be named exactly the same as your username.</p>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "2469e4fa12b2f1cabb455f0f0cf84ff5"
}
##DOCS-SOURCER-END -->
