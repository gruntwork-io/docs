---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<head>
  <link rel="canonical" href="https://github.com/gruntwork-io/knowledge-base/discussions/432" />
</head>

<CenterLayout>
<span className="searchCategory">Knowledge Base</span>
<h1>I got a Ref Arch with EKS on Fargate. How can use EKS with EC2 nodes instead of Fargate?</h1>
<GitHub discussion={{"id":"D_kwDOF8slf84APoIk","number":432,"author":{"login":"rhoboat"},"title":"I got a Ref Arch with EKS on Fargate. How can use EKS with EC2 nodes instead of Fargate?","body":"\nWe've had customers ask this question often, and here are a couple of them:\r\n\r\n> We are currently investigating switching our EKS cluster away from Fargate in favor of EC2. We are attempting to use Sysdig for some of our security and compliance pieces, but have recently discovered that they do not actually support Fargate. They deploy their agents as daemonsets which Fargate doesn't support. Does the Gruntworks ref architecture support the use of EC2 nodes rather than Fargate nodes\r\n\r\n> When Gruntwork created the Reference Architecture for us, I selected Fargate as the EKS node type. Since then we've changed our mind and would prefer to use EC2 nodes. Would it be possible for Gruntwork to re-generate the HCL files provided to us in our infrastructure-live repo with the EC2 type instead? \r\n> My hope/goal is that this will allow us to streamline the transition to EC2 without any guesswork about how Gruntwork would have set this up in the first place. If I had the files as they would have originally been generated then I can just diff them against my current configuration.\n\n---\n\n<ins datetime=\"2022-05-24T22:49:40Z\">\n  <p><a href=\"https://support.gruntwork.io/hc/requests/108658\">Tracked in ticket #108658</a></p>\n</ins>\n","bodyHTML":"<p dir=\"auto\">We've had customers ask this question often, and here are a couple of them:</p>\n<blockquote>\n<p dir=\"auto\">We are currently investigating switching our EKS cluster away from Fargate in favor of EC2. We are attempting to use Sysdig for some of our security and compliance pieces, but have recently discovered that they do not actually support Fargate. They deploy their agents as daemonsets which Fargate doesn't support. Does the Gruntworks ref architecture support the use of EC2 nodes rather than Fargate nodes</p>\n</blockquote>\n<blockquote>\n<p dir=\"auto\">When Gruntwork created the Reference Architecture for us, I selected Fargate as the EKS node type. Since then we've changed our mind and would prefer to use EC2 nodes. Would it be possible for Gruntwork to re-generate the HCL files provided to us in our infrastructure-live repo with the EC2 type instead?<br>\nMy hope/goal is that this will allow us to streamline the transition to EC2 without any guesswork about how Gruntwork would have set this up in the first place. If I had the files as they would have originally been generated then I can just diff them against my current configuration.</p>\n</blockquote>\n<hr>\n<ins datetime=\"2022-05-24T22:49:40Z\">\n  <p dir=\"auto\"><a href=\"https://support.gruntwork.io/hc/requests/108658\" rel=\"nofollow\">Tracked in ticket #108658</a></p>\n</ins>","answer":{"body":"Here's what you can do:\r\n\r\n- Build your worker node AMI using a version of https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/shared/us-west-2/_regional/amis/build_eks_cluster_instance.sh that maps to your environment\r\n- Update your EKS cluster _envcommon to have https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/181b0a07c3b92629dec1ab25b0c9ad6d7b94aea8/examples/for-production/infrastructure-live/_envcommon/services/eks-cluster.hcl#L118-L139\r\n- Run `apply` to roll out the new worker nodes.","bodyHTML":"<p dir=\"auto\">Here's what you can do:</p>\n<ul dir=\"auto\">\n<li>Build your worker node AMI using a version of <a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/shared/us-west-2/_regional/amis/build_eks_cluster_instance.sh\">https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-production/infrastructure-live/shared/us-west-2/_regional/amis/build_eks_cluster_instance.sh</a> that maps to your environment</li>\n<li>Update your EKS cluster _envcommon to have <a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/181b0a07c3b92629dec1ab25b0c9ad6d7b94aea8/examples/for-production/infrastructure-live/_envcommon/services/eks-cluster.hcl#L118-L139\">https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/181b0a07c3b92629dec1ab25b0c9ad6d7b94aea8/examples/for-production/infrastructure-live/_envcommon/services/eks-cluster.hcl#L118-L139</a></li>\n<li>Run <code class=\"notranslate\">apply</code> to roll out the new worker nodes.</li>\n</ul>"}}} />

</CenterLayout>

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "9e926a159845d58599df25d0359eb481"
}
##DOCS-SOURCER-END -->
