---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<CenterLayout>
<span class="title">Knowledge Base</span>
<h1>Certificates remain in terraform-aws-openvpn s3 backup after running openvpn-admin revoke</h1>
<GitHub json={{"id":"D_kwDOF8slf84AOdiB","number":128,"author":{"login":"zackproser"},"title":"Certificates remain in terraform-aws-openvpn s3 backup after running openvpn-admin revoke","body":"A customer asked: \r\n> Hi, how do we remove users from openvpn after they have left the company? \r\nI issued openvpn-admin revoke and it appeas to have worked but we still see the certificates in the s3 backup. ","bodyHTML":"<p dir=\"auto\">A customer asked:</p>\n<blockquote>\n<p dir=\"auto\">Hi, how do we remove users from openvpn after they have left the company?<br>\nI issued openvpn-admin revoke and it appeas to have worked but we still see the certificates in the s3 backup.</p>\n</blockquote>","answer":{"body":"Revoking the certificate  from the openvpn server does not also remove it from the s3 backup. \r\n\r\nWhen a cert is revoked, the backup should contain both the previously issued cert, and the CRL (certificate revoke list) indicating that cert is revoked. \r\n\r\nWhen the server is replaced, the certs should get loaded along with the CRL. \r\n\r\nThe CRL gets stored in the openvpn directory, which is backed up by https://github.com/gruntwork-io/terraform-aws-openvpn/blob/master/modules/backup-openvpn-pki/bin/backup-openvpn-pki#L43, and loaded by init-openvpn here: https://github.com/gruntwork-io/terraform-aws-openvpn/blob/master/modules/init-openvpn/bin/init-openvpn#L96 (note that the CRL is stored as crl.pem)","bodyHTML":"<p dir=\"auto\">Revoking the certificate  from the openvpn server does not also remove it from the s3 backup.</p>\n<p dir=\"auto\">When a cert is revoked, the backup should contain both the previously issued cert, and the CRL (certificate revoke list) indicating that cert is revoked.</p>\n<p dir=\"auto\">When the server is replaced, the certs should get loaded along with the CRL.</p>\n<p dir=\"auto\">The CRL gets stored in the openvpn directory, which is backed up by <a href=\"https://github.com/gruntwork-io/terraform-aws-openvpn/blob/master/modules/backup-openvpn-pki/bin/backup-openvpn-pki#L43\">https://github.com/gruntwork-io/terraform-aws-openvpn/blob/master/modules/backup-openvpn-pki/bin/backup-openvpn-pki#L43</a>, and loaded by init-openvpn here: <a href=\"https://github.com/gruntwork-io/terraform-aws-openvpn/blob/master/modules/init-openvpn/bin/init-openvpn#L96\">https://github.com/gruntwork-io/terraform-aws-openvpn/blob/master/modules/init-openvpn/bin/init-openvpn#L96</a> (note that the CRL is stored as crl.pem)</p>"},"comments":{"edges":[{"node":{"author":{"login":"zackproser"},"body":"Revoking the certificate  from the openvpn server does not also remove it from the s3 backup. \r\n\r\nWhen a cert is revoked, the backup should contain both the previously issued cert, and the CRL (certificate revoke list) indicating that cert is revoked. \r\n\r\nWhen the server is replaced, the certs should get loaded along with the CRL. \r\n\r\nThe CRL gets stored in the openvpn directory, which is backed up by https://github.com/gruntwork-io/terraform-aws-openvpn/blob/master/modules/backup-openvpn-pki/bin/backup-openvpn-pki#L43, and loaded by init-openvpn here: https://github.com/gruntwork-io/terraform-aws-openvpn/blob/master/modules/init-openvpn/bin/init-openvpn#L96 (note that the CRL is stored as crl.pem)"}},{"node":{"author":{"login":"zackproser"},"body":"Credit for this solution goes to @rhoboat "}}]}}} />

</CenterLayout>
  

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "22d8b82655f30d682c8229d387c158e0"
}
##DOCS-SOURCER-END -->
