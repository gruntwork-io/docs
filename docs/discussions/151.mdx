---
hide_table_of_contents: true
hide_title: true
custom_edit_url: null
---

import CenterLayout from "/src/components/CenterLayout"
import GitHub from "/src/components/GitHub"

<CenterLayout>
<span class="title">Knowledge Base</span>
<h1>Error when trying to use network_configuration for FARGATE tasks</h1>
<GitHub json={{"id":"D_kwDOF8slf84AOoRR","number":151,"author":{"login":"fsanzdev"},"title":"Error when trying to use network_configuration for FARGATE tasks","body":"Hi, \r\n\r\nI'm having some issues when trying to use network_configuration for FARGATE tasks. This is the code I have:\r\n```\r\n  desired_number_of_tasks = \"1\"\r\n  launch_type             = \"FARGATE\"\r\n  network_mode            = \"awsvpc\"\r\n  task_cpu                = 512\r\n  task_memory             = 1024\r\n  network_configuration   = {\r\n    subnets                       = dependency.vpc.outputs.private_app_subnet_ids\r\n    vpc_id                        = dependency.vpc.outputs.vpc_id\r\n    security_group_rules          = {\r\n      sg-service-name-port = {\r\n        type                     = \"ingress\"\r\n        from_port                = local.container_port\r\n        to_port                  = local.container_port\r\n        protocol                 = \"tcp\"\r\n        # source_security_group_id = \"sg-${local.service_name}\"\r\n        cidr_blocks              = [dependency.vpc.outputs.vpc_cidr_block]\r\n      }\r\n    }\r\n    additional_security_group_ids = []\r\n    assign_public_ip              = false\r\n```\r\n\r\nBut it looks like both, `source_security_group_id` and `cidr_blocks` attributes are required by the module, when according to the SG rule documentation you can't have both, having an `Error: Conflicting configuration arguments` message when applying the plan.\r\n\r\nCould you please confirm if I'm doing something wrong?","bodyHTML":"<p dir=\"auto\">Hi,</p>\n<p dir=\"auto\">I'm having some issues when trying to use network_configuration for FARGATE tasks. This is the code I have:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  desired_number_of_tasks = &quot;1&quot;\n  launch_type             = &quot;FARGATE&quot;\n  network_mode            = &quot;awsvpc&quot;\n  task_cpu                = 512\n  task_memory             = 1024\n  network_configuration   = {\n    subnets                       = dependency.vpc.outputs.private_app_subnet_ids\n    vpc_id                        = dependency.vpc.outputs.vpc_id\n    security_group_rules          = {\n      sg-service-name-port = {\n        type                     = &quot;ingress&quot;\n        from_port                = local.container_port\n        to_port                  = local.container_port\n        protocol                 = &quot;tcp&quot;\n        # source_security_group_id = &quot;sg-${local.service_name}&quot;\n        cidr_blocks              = [dependency.vpc.outputs.vpc_cidr_block]\n      }\n    }\n    additional_security_group_ids = []\n    assign_public_ip              = false\"><pre class=\"notranslate\"><code>  desired_number_of_tasks = \"1\"\n  launch_type             = \"FARGATE\"\n  network_mode            = \"awsvpc\"\n  task_cpu                = 512\n  task_memory             = 1024\n  network_configuration   = {\n    subnets                       = dependency.vpc.outputs.private_app_subnet_ids\n    vpc_id                        = dependency.vpc.outputs.vpc_id\n    security_group_rules          = {\n      sg-service-name-port = {\n        type                     = \"ingress\"\n        from_port                = local.container_port\n        to_port                  = local.container_port\n        protocol                 = \"tcp\"\n        # source_security_group_id = \"sg-${local.service_name}\"\n        cidr_blocks              = [dependency.vpc.outputs.vpc_cidr_block]\n      }\n    }\n    additional_security_group_ids = []\n    assign_public_ip              = false\n</code></pre></div>\n<p dir=\"auto\">But it looks like both, <code class=\"notranslate\">source_security_group_id</code> and <code class=\"notranslate\">cidr_blocks</code> attributes are required by the module, when according to the SG rule documentation you can't have both, having an <code class=\"notranslate\">Error: Conflicting configuration arguments</code> message when applying the plan.</p>\n<p dir=\"auto\">Could you please confirm if I'm doing something wrong?</p>","answer":{"body":"It was not quite clear looking at the code or the documentation, but all made sense after looking at this example https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-learning-and-testing/services/ecs-service/main.tf\r\n\r\nOne of those fields has to be set to null (not just remove it)","bodyHTML":"<p dir=\"auto\">It was not quite clear looking at the code or the documentation, but all made sense after looking at this example <a href=\"https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-learning-and-testing/services/ecs-service/main.tf\">https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-learning-and-testing/services/ecs-service/main.tf</a></p>\n<p dir=\"auto\">One of those fields has to be set to null (not just remove it)</p>"},"comments":{"edges":[{"node":{"author":{"login":"gruntwork-discussions"},"body":"You must label this issue with at least one of the following labels before it can be answered:\n\n* [r:terraform-aws-service-catalog](https://github.com/gruntwork-io/terraform-aws-service-catalog)\n* [r:terraform-aws-vpc](https://github.com/gruntwork-io/terraform-aws-vpc)\n* [r:terraform-aws-architecture-catalog](https://github.com/gruntwork-io/terraform-aws-architecture-catalog)\n* [r:terraform-aws-asg](https://github.com/gruntwork-io/terraform-aws-asg)\n* [r:terraform-aws-beanstalk](https://github.com/gruntwork-io/terraform-aws-beanstalk)\n* [r:terraform-aws-cache](https://github.com/gruntwork-io/terraform-aws-cache)\n* [r:terraform-aws-ci](https://github.com/gruntwork-io/terraform-aws-ci)\n* [r:terraform-aws-ci-pipeline-example](https://github.com/gruntwork-io/terraform-aws-ci-pipeline-example)\n* [r:terraform-aws-cis-service-catalog](https://github.com/gruntwork-io/terraform-aws-cis-service-catalog)\n* [r:terraform-aws-data-storage](https://github.com/gruntwork-io/terraform-aws-data-storage)\n* [r:terraform-aws-ecs](https://github.com/gruntwork-io/terraform-aws-ecs)\n* [r:terraform-aws-eks](https://github.com/gruntwork-io/terraform-aws-eks)\n* [r:terraform-aws-elk](https://github.com/gruntwork-io/terraform-aws-elk)\n* [r:terraform-aws-kafka](https://github.com/gruntwork-io/terraform-aws-kafka)\n* [r:terraform-aws-lambda](https://github.com/gruntwork-io/terraform-aws-lambda)\n* [r:terraform-aws-load-balancer](https://github.com/gruntwork-io/terraform-aws-load-balancer)\n* [r:terraform-aws-messaging](https://github.com/gruntwork-io/terraform-aws-messaging)\n* [r:terraform-aws-mongodb](https://github.com/gruntwork-io/terraform-aws-mongodb)\n* [r:terraform-aws-monitoring](https://github.com/gruntwork-io/terraform-aws-monitoring)\n* [r:terraform-aws-openvpn](https://github.com/gruntwork-io/terraform-aws-openvpn)\n* [r:terraform-aws-sam](https://github.com/gruntwork-io/terraform-aws-sam)\n* [r:terraform-aws-security](https://github.com/gruntwork-io/terraform-aws-security)\n* [r:terraform-aws-server](https://github.com/gruntwork-io/terraform-aws-server)\n* [r:terraform-aws-static-assets](https://github.com/gruntwork-io/terraform-aws-static-assets)\n* [r:terraform-aws-zookeeper](https://github.com/gruntwork-io/terraform-aws-zookeeper)\n* [r:terragrunt](https://github.com/gruntwork-io/terragrunt)\n* [r:terratest](https://github.com/gruntwork-io/terratest)\n* [r:repo-copier](https://github.com/gruntwork-io/repo-copier)\n\n\n[Community Guidelines](https://github.com/gruntwork-io/knowledge-base/discussions/1)\n[Getting help](https://gruntwork.io/support/)\n[Gruntwork documentation](https://www.gruntwork.io)\n"}},{"node":{"author":{"login":"denis256"},"body":"Hello,\r\nif I matched correctly definition, in module is created `aws_security_group_rule` with `source_security_group_id` / `cidr_blocks` : \r\n\r\nhttps://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/modules/services/ecs-service/main.tf#L126\r\n\r\nDefinition of `aws_security_group_rule` specify: \r\n  * cidr_blocks - (Optional) List of CIDR blocks. Cannot be specified with `source_security_group_id`\r\n\r\nhttps://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group_rule\r\n\r\n"}},{"node":{"author":{"login":"fsanzdev"},"body":"Thanks for the reply @denis256, but it looks like in GW code there is no conditional and according to the TF documentation you refer:\r\n\r\n`source_security_group_id - (Optional) Security group id to allow access to/from, depending on the type. Cannot be specified with cidr_blocks, ipv6_cidr_blocks, or self.`\r\n\r\nSo it looks like both (cidr_blocks and source_security_group_id) can't be used at the same time, it looks like it has to be one or the other"}},{"node":{"author":{"login":"fsanzdev"},"body":"It was not quite clear looking at the code or the documentation, but all made sense after looking at this example https://github.com/gruntwork-io/terraform-aws-service-catalog/blob/master/examples/for-learning-and-testing/services/ecs-service/main.tf\r\n\r\nOne of those fields has to be set to null (not just remove it)"}}]}}} />

</CenterLayout>
  

<!-- ##DOCS-SOURCER-START
{
  "sourcePlugin": "github-discussions",
  "hash": "a21f2a7afa38e3f1c7fcefe2c533e17e"
}
##DOCS-SOURCER-END -->
